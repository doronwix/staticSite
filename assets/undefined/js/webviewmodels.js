function CustomerValidators(){var t=[],a="passwordnotinblacklist",i="passwordnotcustomerfullname";return{addValidationBlackList:function(){$.validator.unobtrusive.adapters.add(a,["param"],function(e){e.rules[a]=!0,e.messages[a]=e.message}),$.validator.addMethod(a,function(e){return!t||!t.length||-1===t.indexOf(e)}),$.get(function(){var e="";if(UrlResolver.getAssetsPath)e=UrlResolver.combine(UrlResolver.getAssetsPath(),"Account","PasswordsBlacklist.js");else{var t=UrlResolver.getVersion();e=t?Model.CdnPath+Model.jsVirtualPath+"/assets/"+t+"/Account/PasswordsBlacklist.js":Model.jsVirtualPath+"/Account/PasswordsBlacklist"}return e}()).then(function(e){$.isArray(e)&&(t=e)}).done()},addValidationCustomerFullName:function(){if(window.$customer){customer=window.$customer;var t={firstName:customer.prop.firstName,lastName:customer.prop.lastName,combinations:[customer.prop.firstName+customer.prop.lastName,customer.prop.firstName+" "+customer.prop.lastName,customer.prop.lastName+customer.prop.firstName,customer.prop.lastName+" "+customer.prop.firstName]};$.validator.unobtrusive.adapters.add(i,["param"],function(e){e.rules[i]=!0,e.messages[i]=e.message}),$.validator.addMethod(i,function(e){return e!==t.firstName&&e!==t.lastName&&-1===t.combinations.indexOf(e)})}}}}define("FxNet/DataAccessLayer/DalTradingInfoSrv",["ErrorManager"],function(l){var u=-1,c=($.signalR.connectionState.connecting,$.signalR.connectionState.connected),d=($.signalR.connectionState.reconnecting,3),m=$.signalR.connectionState.disconnected;return function(e){var t,a=e,o=[],n=[],r=u,i=new TDelegate;function s(e,t,a,i){n[e](t,a,i)}return{CreateHub:function(i){var e=t.createHubProxy(i);e&&(e.on("onUpdateClient",function(e,t,a){s(i,e,t,a)}),e.on("empty",function(e,t){s(i,null,e)})),o[i]=e},UpdateCallbacks:function(e,t,a){a(r===c),i.Add(a),n[e]=t},InitConnection:function(e){(t=$.hubConnection(a)).stateChanged(function(e){r=e.newState}),t.reconnected(function(){i.Invoke(!0)}),t.error(function(e){i.Invoke(!1),l.onError("dalTradingInfoSrv/connect failed",e,eErrorSeverity.warning)}),t.disconnected(function(){e()})},Connect:function(e){t.qs={authToken:e},t.start().done(function(){i.Invoke(!0)}).fail(function(e){i.Invoke(!1),l.onError("dalTradingInfoSrv/connect failed",e,eErrorSeverity.warning)})},Disconnect:function(){r=d,t.stop(),t.disconnected()},Subscribe:function(t,e){var a=o[t];a&&r===c&&a.invoke("subscribe",e).done(function(){}).fail(function(e){r!==m&&r!==d&&l.onError("dalTradingInfoSrv/subscribe failed for hub "+t,e,eErrorSeverity.warning)})},SubscribeByGroup:function(t,e,a){var i=o[t];i&&r===c&&i.invoke("subscribe",a,e).done(function(){}).fail(function(e){r!==m&&r!==d&&l.onError("dalTradingInfoSrv/subscribeByGroup failed for hub "+t,e,eErrorSeverity.warning)})},Unsubscribe:function(t,e){var a=o[t];r===c&&a.invoke("unsubscribe",e).done(function(){}).fail(function(e){r!==m&&r!==d&&l.onError("dalTradingInfoSrv/unsubscribe failed for hub"+t,e,eErrorSeverity.warning)})}}}}),define("FxNet/LogicLayer/GeneralManager/TradingInfoConnManager",["FxNet/DataAccessLayer/DalTradingInfoSrv","economicCalendarConfig","sentimentsConfig","SystemInfo","Customer"],function(e,t,a,i,o){var n,r,s,l=!1,u=0,c=function(e){n=e,s.Connect(n)},d=function(){o.GetToken().then(c)};return(s=new e(i.get("tradingInfoSrvUrl"))).InitConnection(function(){l||(r&&clearTimeout(r),r=setTimeout(function(){++u<1e3&&o.GetToken().then(c)},5e3))}),s.CreateHub(t.hubname),s.CreateHub(a.hubname),d(),{UpdateCallbacks:function(e,t,a){s.UpdateCallbacks(e,t,a)},Subscribe:function(e,t){s.Subscribe(e,t)},SubscribeByGroup:function(e,t,a){s.SubscribeByGroup(e,t,a)},Unsubscribe:function(e,t){s.Unsubscribe(e,t)},Dispose:function(){l=!0,s.Disconnect()},Connect:d}}),define("FxNet/LogicLayer/EconomicCalendar/EconomicCalendarHandler",[],function(){return{DateInterval:function(e){var t,a,i=this.GetToday();switch(e){case eDateFilter.Yesterday:t=new Date(Date.UTC(i.getUTCFullYear(),i.getUTCMonth(),i.getUTCDate()-1)),a=new Date(Date.UTC(i.getUTCFullYear(),i.getUTCMonth(),i.getUTCDate()-1,23,59,59));break;case eDateFilter.Today:t=new Date(Date.UTC(i.getUTCFullYear(),i.getUTCMonth(),i.getUTCDate())),a=new Date(Date.UTC(i.getUTCFullYear(),i.getUTCMonth(),i.getUTCDate(),23,59,59));break;case eDateFilter.Tomorrow:t=new Date(Date.UTC(i.getUTCFullYear(),i.getUTCMonth(),i.getUTCDate()+1)),a=new Date(Date.UTC(i.getUTCFullYear(),i.getUTCMonth(),i.getUTCDate()+1,23,59,59));break;case eDateFilter.ThisWeek:t=new Date(Date.UTC(i.getUTCFullYear(),i.getUTCMonth(),i.getUTCDate()-i.getUTCDay()+1)),a=new Date(Date.UTC(i.getUTCFullYear(),i.getUTCMonth(),i.getUTCDate()-i.getUTCDay()+7,23,59,59));break;case eDateFilter.NextWeek:t=new Date(Date.UTC(i.getUTCFullYear(),i.getUTCMonth(),i.getUTCDate()-i.getUTCDay()+8)),a=new Date(Date.UTC(i.getUTCFullYear(),i.getUTCMonth(),i.getUTCDate()-i.getUTCDay()+14,23,59,59));break;default:return}return{FromDate:t,ToDate:a}},GetToday:function(){return new Date}}}),define("FxNet/LogicLayer/EconomicCalendar/EconomicCalendarConnManager",["Q","economicCalendarConfig","FxNet/LogicLayer/GeneralManager/TradingInfoConnManager","StateObject!EconomicCalendarConnManager"],function(e,t,i,o){var n=t.hubname,r={},s={},a=function(e,t,a){if(s[t]){var i=s[t].name,o=r[i];s[t].done=!0,"function"==typeof o&&o(e,a)}},l=function(e){var t=o.get("IsServiceAvailable"),a=!!e;o.update("IsServiceAvailable",a),!t&&a&&function(){for(var e in s)s.hasOwnProperty(e)&&(s[e].done=!1,i.SubscribeByGroup(n,s[e].args,e))}()},u=function(){o.set("IsServiceAvailable",!1),i.UpdateCallbacks(n,a,l)};return u(),{Init:u,WhenAvailable:function(){var t,a=e.defer();return o.get("IsServiceAvailable")?a.resolve(!0):t=o.subscribe("IsServiceAvailable",function(e){t(),e?a.resolve(!0):a.resolve(!1)}),a.promise},SetMessageReceivedCallback:function(e,t){r[e]=t},Subscribe:function(e,t){t=t||{};var a=createGuid();return s[a]={name:e,args:t,done:!1},i.SubscribeByGroup(n,t,a),a},Unsubscribe:function(e){delete s[e],i.Unsubscribe(n,e)},Dispose:function(){o.unset("IsServiceAvailable"),i.Dispose()}}}),define("TileSettingsManager",["require","ChartSettingManager"],function(e){var i=e("ChartSettingManager");function a(){return i.Chart().tileSettings}function o(e){i.Chart().tileSettings=extendType(i.Chart().tileSettings,e),i.SaveChart()}return{Init:function(e){var t,a;e=e||{},i.Chart().tileSettings=i.Chart().tileSettings||{},isDefinedType(i.Chart().tileSettings.activeTileId)||(i.Chart().tileSettings.activeTileId=0),isDefinedType(i.Chart().tileSettings.layoutId)&&(t=e,a=i.Chart(),isNullOrUndefined(t.initialLayout)||a.tileSettings.layoutId===t.initialLayout||a.tileSettings.layoutId===eTileLayout.Single)||(i.Chart().tileSettings.layoutId=e.initialLayout||eTileLayout.FourSplit),i.SaveChart()},GetLayout:function(){return i.Chart().tileSettings.layoutId},GetActiveTileId:function(){return i.Chart().tileSettings.activeTileId},UpdateActiveTileId:function(e){var t=a();t.activeTileId=e,o(t)},UpdateLayout:function(e){var t=a();t.layoutId=e,o(t)}}}),define("viewModels/demoDeposit/demo-deposit-icon",["require","KoComponentViewModel","Customer","CustomerProfileManager","dalDemoAccount","dalCommon","AmountConverter","Dictionary","BuilderForInBetweenQuote","SystemInfo"],function(e){var t=e("KoComponentViewModel"),v=e("Customer"),D=e("CustomerProfileManager"),S=e("dalDemoAccount"),y=e("AmountConverter"),T=e("Dictionary"),C=e("BuilderForInBetweenQuote"),h=e("SystemInfo"),a=extendClass(t,function(e){var t,a=this,i=this.parent,o=e,n={quoteForUSDCcyToSelectedAccuntCcy:ko.observable(""),isProcessing:ko.observable(!1),shouldWaitForInBetweenQuote:ko.observable(!1)},r=a.createComputed(function(){return y.Convert(D.ProfileCustomer().demoDepositAmount,n.quoteForUSDCcyToSelectedAccuntCcy())}).extend({deferred:!0}),s=a.createComputed(function(){return e="demoDepositToolTip",String.format(T.GetItem(e),Format.toNumberWithCurrency(r(),{currencyId:v.prop.selectedCcyId()}));var e}),l=v.prop.isDemo,u=!1,c=!1,d=!1,m=function(){d||(t&&clearInterval(t),n.shouldWaitForInBetweenQuote(!1))},b=a.createComputed(function(){return!0!==c&&(!0===u&&!n.isProcessing()||!(!l||n.isProcessing())&&(!0!==n.shouldWaitForInBetweenQuote()&&(u=Number.fromStr(o.equity())<(!0===d?(n.shouldWaitForInBetweenQuote(!0),t=setInterval(m,500),0):y.Convert(h.get("config").MaxEquityForDemoDepositInUsd,n.quoteForUSDCcyToSelectedAccuntCcy.peek())))))}).extend({deferred:!0}),p=function(e){!0===JSON.parse(e).isSuccessful&&(c=!0),n.isProcessing(!1)},f=function(e){e&&(n.quoteForUSDCcyToSelectedAccuntCcy(e),d=!1)},g=function(){d=!0,C.GetInBetweenQuote(47,v.prop.selectedCcyId()).then(f).done()};return{init:function(e){i.init.call(a,e),g(),a.subscribeTo(v.prop.selectedCcyId,function(){g()})},dispose:function(){i.dispose.call(a)},tooltipMessage:s,isCustomerDemo:l,isEligableToDemoDeposit:b,onClick:function(){n.isProcessing(!0),S.processDemoDeposit(p)},obs:n}});return{createViewModel:function(e){var t=new a(e||{});return t.init(),t}}}),define("viewModels/AccountCardRecordsBaseViewModel",["require","knockout","KoComponentViewModel","ViewsManager","Customer","InstrumentsManager","SymbolsManager","dalAccountingActions","initConfiguration","Dictionary","StateObject!Positions"],function(e){var d=e("knockout"),t=e("KoComponentViewModel"),m=e("ViewsManager"),b=e("Customer"),p=e("InstrumentsManager"),f=e("SymbolsManager"),g=e("dalAccountingActions"),v=e("Dictionary"),D=e("initConfiguration"),S=e("StateObject!Positions");return extendClass(t,function(){var t,a=this,i=this.parent,o=this.Data,e={},n=new function(){var e=this;e.SymbolId=d.observable(0),e.SymbolName=d.observable(""),e.ActionCategory=d.observable(eAccountingActionsCategory.OvernightHistory),e.From=d.observable((new Date).AddWeeks(-1).ExtractDate()),e.To=d.observable((new Date).ExtractDate()),e.Position=d.observable(""),e.Page=d.observable(1),e.PageSize=D.AccountCardRecordsConfiguration.pageSize,e.ShowCosts=!1,e.ClosedDate=d.observable((new Date).AddWeeks(-1).ExtractDate())};var r={idField:"actionNumber",columns:[{name:"rowNumber",transform:function(e,t){return t}},{name:"actionNumber",dataIndex:eAccountingAction.actionID},{name:"date",dataIndex:eAccountingAction.date},{name:"credit",dataIndex:eAccountingAction.credit},{name:"debit",dataIndex:eAccountingAction.debit},{name:"symbolId",dataIndex:eAccountingAction.symbolID},{name:"symbolName",transform:function(e,t,a,i){return f.GetTranslatedSymbolById(i[eAccountingAction.symbolID])}},{name:"type",transform:function(e,t,a,i){return v.GetItem("acctype"+i[eAccountingAction.actionTypeID])}},{name:"comment",dataIndex:eAccountingAction.comment},{name:"totalsum",dataIndex:eAccountingAction.totalsum}],pageSizes:20,statusField:"status",totalField:"totalItems",dataField:"actions",pagination:{pagesPerPage:5,pageIndexField:"Page",pageSizeField:"PageSize"},Filter:n,DAL:{reference:g.LoadAccountingActions,callerName:"StatementControl/onLoadComplete",errorSeverity:eErrorSeverity.medium,onLoad:function(e){if(d.postbox.publish(eAppEvents.accountCardRecordsDataLoaded),0<s.DataRows().length&&o.totalSum(s.DataRows()[0].totalsum),o.showZeroCosts=e.showZeroCosts,e.costs){var t={};t.SpreadCost=e.costs.SpreadCostInAccountBase,t.SpreadDiscount=e.costs.SpreadDiscount,t.Commission=e.costs.CommissionInAccountBase,t.RolloverSpreadCost=e.costs.RolloverSpreadCostInAccountBase,t.ConversionCost=e.costs.ConversionCostInAccountBase,o.showSpreadCost=!!t.SpreadCost,o.showSpreadDiscount=!!t.SpreadDiscount,o.showCommision=!!t.Commission||0===t.Commission&&0===t.SpreadCost,o.showRolloverSpreadCost=!!t.RolloverSpreadCost,o.showConversionCost=!!t.ConversionCost,t.OvernightFinancing=Number.fromStr(o.totalSum()),t.TotalCosts=(null===t.SpreadCost?0:t.SpreadCost)+(null===t.SpreadDiscount?0:t.SpreadDiscount)+(null===t.Commission?0:t.Commission)+(null===t.RolloverSpreadCost?0:t.RolloverSpreadCost)+(null===t.ConversionCost?0:t.ConversionCost),o.showTotalCosts=o.showSpreadCost||o.showSpreadDiscount||o.showCommision||o.showRolloverSpreadCost||o.showConversionCost,t.TotalWithOvernightFinancing=t.TotalCosts+t.OvernightFinancing,o.costValues(t)}S.containsKey("ofhPositionNumber")&&S.update("ofhPositionNumber",null),o.isDataReady(!0)}}},s=new ObservableDataSet(r);function l(){n.From((new Date).AddWeeks(-1).toShortISOString()),n.To((new Date).toShortISOString()),n.Position(""),n.PageSize=D.AccountCardRecordsConfiguration.pageSize,o.totalSum("0"),o.isDataReady(!1)}var u=a.createComputed(function(){return!s.IsLoadingData()},a);function c(e){return e&&str2Date(e)?str2Date(e).toShortISOString():null}return{init:function(e){i.init.call(a,e),o.totalSum=d.observable(0),o.isDataReady=d.observable(!1),o.costs=d.observable(null),o.costValues=d.observable(null),l(),t=m.GetViewArgs(eViewTypes.vAccountCardRecords),t=m.GetViewArgs(eViewTypes.vAccountCardRecords),l(),b.prop.autoConvert?n.SymbolId(b.prop.baseCcyId()):n.SymbolId(p.GetInstrument(t.instrumentId).otherSymbol),n.SymbolName(f.GetTranslatedSymbolById(n.SymbolId())),n.Position(t.posNum),n.From(c(t.fromDate)),n.ShowCosts=!!t.showCosts,n.ClosedDate(c(t.closedDate)),s.SetFilter(n),s.Load()},dispose:function(){s.Clean(),e.scrolled=null,i.dispose.call(a)},Data:o,BalanceInfo:s.DataRows,GetNextBalance:s.Paging.ShowMore,VisibleShowMore:s.Paging.HasNextPage,DataSet:s,Filter:n,EnableApplyButton:u,HasRecords:s.HasRecords,DsColumns:r,IsLoadingData:s.IsLoadingData}})}),define("viewModels/AmlViewModel",["require","knockout","KoComponentViewModel","JSONHelper","ViewModelsManager","FxNet/DataAccessLayer/dalCompliance","currentAppFolder/UILayer/uiBehavior","Customer","SystemInfo","initConfiguration"],function(e){var r=e("knockout"),t=e("KoComponentViewModel"),s=e("JSONHelper"),l=e("ViewModelsManager"),u=e("FxNet/DataAccessLayer/dalCompliance"),c=e("currentAppFolder/UILayer/uiBehavior"),m=e("Customer"),b=e("SystemInfo"),p=e("initConfiguration");return extendClass(t,function(){var e=this,t=this.parent,d=this.Data;d.pepAnswersDisplay=e.createComputed(function(){return"p3"!==d.pepAnsweredValue()});var a=function(){t.init.call(e),i(),n(),o()},i=function(){d.pepAnsweredValue=r.observable("p3"),d.isPepRequiredCsmLess=r.observable(!1),d.hasUploadDocs=r.observable(!0),d.hasVideoIdentification=r.observable(!1),d.hasAlternativeDocSend=r.observable(!0)},o=function(){var a=b.get("countries"),e=Object.keys(a),i=p.AmlConfiguration.countriesWithDisabledUpload,o=p.AmlConfiguration.countriesWithVideoId,n=p.AmlConfiguration.countriesWithDisabledAlternativeSend,r=[],s=[],l=[],u=function(e,t){return-1!==e.indexOf(t)},c=function(e,t){return-1===e.indexOf(t)};e.forEach(function(e){var t=a[e];c(i,t)&&r.push(e),u(o,t)&&s.push(e),c(n,t)&&l.push(e)}),d.hasUploadDocs(u(r,m.prop.countryID)),d.hasVideoIdentification(u(s,m.prop.countryID)),d.hasAlternativeDocSend(u(l,m.prop.countryID))},n=function(){u.getPepStatus(function(e){(e=s.STR2JSON("AmlStatusViewModel/getPepStatus",e,eErrorSeverity.medium)).Status==eResult.Success&&d.isPepRequiredCsmLess(e.Result==ePEPStatus.Required)})};return a(),{Init:a,SetPepStatus:function(){u.setPepStatus(d.pepAnsweredValue(),function(e){e==eResult.Success&&c.closeAmlPepForm()})},isPepRequiredCsmLess:d.isPepRequiredCsmLess,pepAnsweredValue:d.pepAnsweredValue,PepAnswersDisplay:d.pepAnswersDisplay,goToUploadDocuments:function(){l.VManager.RedirectToForm(eForms.UploadDocuments),DialogViewModel&&DialogViewModel.close()},hasVideoIdentification:d.hasVideoIdentification,hasUploadDocs:d.hasUploadDocs,hasAlternativeDocSend:d.hasAlternativeDocSend}})}),define("viewModels/BaseInstrumentSearchViewModel",["require","knockout","KoComponentViewModel","InstrumentsManager","ViewModelsManager","Dictionary"],function(e){var l=e("knockout"),t=e("KoComponentViewModel"),u=e("InstrumentsManager"),c=e("ViewModelsManager").VmQuotesPreset;return extendClass(t,function(e){var a=this,i=this.parent,o=this.Data,n=2;function r(e){!e||!e.id||e.id<=-1||isFunctionType(o.selectedInstrumentId)&&o.selectedInstrumentId(e.id)}function s(){var e,t=u.GetFavoriteInstruments();0===t.length?(t=u.GetMainMostPopularInstruments(),e=u.GetPresetInstruments(u.GetMainMostPopularPresetId())):(e=u.GetCustomizedUiOrder(),o.favouritePreset(!0)),u.SetQuotesUIOrder(e,!1,eRegistrationListName.Search),o.instrumentsList(function(e){for(var t=0;t<e.length;t++){var a,i=e[t],o=u.GetPresetsForInstrument(i.id),n=o.some(function(e){if(c.IsSearchPreset(e))return a=parseInt(e),!0});a=n?a:i.presetId,i.presetLabel=c.GetPreset(a).Label}return e}(t))}return{init:function(e){var t;i.init.call(a,e),o.list=c.SearchInstrumentsObservable,o.searchMinLength=l.observable(c.SingleCharSearch()?1:n),o.selected=l.observable({}),o.instrumentsList=l.observableArray([]),o.favouritePreset=l.observable(!1),t=e,s(),o.selectedInstrumentId=t.selectedInstrumentId,o.suffixId=t.suffixId,o.searchPostBoxTopic=t.searchPostBoxTopic,a.subscribeTo(o.selected,r),u.OnFavoritesPresetChanged.Add(s)},dispose:function(){u.OnFavoritesPresetChanged.Remove(s),i.dispose.call(a)}}})}),define("viewModels/BaseSignalsViewModel",["require","knockout","Dictionary","KoComponentViewModel","dalTradingSignals","Customer","InstrumentsManager","AlertsManager","CookieHandler","JSONHelper","InstrumentTranslationsManager","PermissionsModule","ViewsManager","UrlResolver","RegistrationManager"],function(e){var d=e("knockout"),m=e("Dictionary"),t=e("KoComponentViewModel"),b=e("dalTradingSignals"),p=e("Customer"),f=e("InstrumentsManager"),g=e("AlertsManager"),v=e("CookieHandler"),D=e("JSONHelper"),S=e("InstrumentTranslationsManager"),y=e("PermissionsModule"),T=e("ViewsManager"),C=e("UrlResolver"),h=e("RegistrationManager");return extendClass(t,function(e){var a=this,i=e,o=this.parent,n=this.Data,r={};function s(){var t;n.isLoading()||!n.hasAgreedDisclaimer()||i.instrumentId||i.signalId||(n.fetchingData(1!==n.pageIndex()),n.isLoading(1==n.pageIndex()),b.getSignalsDetailsForTechAnalysis({symbol:null,pageIndex:n.pageIndex()}).then(function(e){t=D.STR2JSON("getSignalsDetailsForTechAnalysis/onLoadComplete",e),n.totalRecords(Number(t.totalRecords)),function(e,t){var a=[];if(e.status==eResult.Success&&0==e.resultStatus)for(var i=0;i<e.result.length;i++){var o=u(e.result[i]);n.signalsList.Add(o),a.push(o.instrument.id)}n.signalsAreAvailable(e.status==eResult.Success&&0==e.resultStatus||t),n.fetchingData(!1),n.isLoading(!1),a.length&&l(a)}(t,1<n.pageIndex())}).done())}function l(e){h.Update(eRegistrationListName.TradingSignals,e)}function u(e){var t=f.GetInstrumentBySignalName(e[eTradingSignal.symbol]);return{signalId:e[eTradingSignal.signalId],signalTitle:e[eTradingSignal.signalTitle],signalDate:e[eTradingSignal.signalDate],imagePath:e[eTradingSignal.imagePath],shortTermLevel:e[eTradingSignal.shortTerm],shortTermText:c(e[eTradingSignal.shortTerm],!0),mediumTermLevel:e[eTradingSignal.mediumTermLevel],mediumTermText:c(e[eTradingSignal.mediumTermLevel],!1),weekDelta:e[eTradingSignal.weekDelta],longTermLevel:e[eTradingSignal.longTermLevel],longTermText:c(e[eTradingSignal.longTermLevel],!1),monthDelta:e[eTradingSignal.monthDelta],summary:e[eTradingSignal.summary],instrument:t,symbol:t?S.Long(t.id):e[eTradingSignal.symbol]}}function c(e,t){var a;switch(e){case eSignalTrendsValues.StrongBuy:a="lblStrongBuy";break;case eSignalTrendsValues.Buy:a="lblBuy";break;case eSignalTrendsValues.Sell:a="lblSell";break;case eSignalTrendsValues.StrongSell:a="lblStrongSell";break;default:a=t?"lblNotAvailable":"lblNeutral"}return a}return{init:function(e){var t;o.init.call(a,e),n.hasAgreedDisclaimer=d.observable(!1),n.signalsAreAvailable=d.observable(!1),n.isLoading=d.observable(!1),n.fetchingData=d.observable(!1),n.signalsList=new ObservableHashTable("signalId",{enabled:!0,sortProperty:"signalId",asc:!1}),n.signalsEndDate=d.observable(""),n.areSignalsAllowed=d.observable(!1),n.pageIndex=d.observable(1),n.totalRecords=d.observable(0),r.disclaimerClick=function(){g.UpdateAlert(AlertTypes.ServerResponseAlert,m.GetItem("DisclaimerTitle"),m.GetItem("lblDisclaimerText"),null,{}),g.PopAlert(AlertTypes.ServerResponseAlert)},r.clickDisclaimerAgree=function(){v.CreateCookie("TsComplianceDate",(new Date).toDateString(),(new Date).AddMonths(12)),n.hasAgreedDisclaimer(!0),s()},a.subscribeTo(n.areSignalsAllowed,function(e){e&&s()}),a.subscribeTo(n.isLoading,function(e){d.postbox.publish(ePostboxTopic.SetSpinnerVisibility,e)}),n.isShowAgreement=a.createComputed(function(){return!this.hasAgreedDisclaimer()&&this.areSignalsAllowed()&&!this.isLoading()},a.Data),n.isShowSignal=a.createComputed(function(){return this.hasAgreedDisclaimer()&&this.signalsAreAvailable()&&this.areSignalsAllowed()&&!this.isLoading()},a.Data),n.isShowSignalUnavailable=a.createComputed(function(){return this.hasAgreedDisclaimer()&&!this.signalsAreAvailable()&&this.areSignalsAllowed()&&!(this.isLoading()||this.fetchingData())},a.Data),n.signalsAreDissallowed=a.createComputed(function(){return!this.areSignalsAllowed()&&!this.isLoading()},a.Data),t=v.ReadCookie("TsComplianceDate"),n.hasAgreedDisclaimer(null!==t),n.areSignalsAllowed(p.prop.AreSignalsAllowed),n.signalsEndDate(p.prop.signalsEndDate)},dispose:function(){o.dispose.call(a),n.signalsList.Clear()},Handlers:r,FilterData:i,toSignalObject:u,registerInstruments:l,openDeal:function(e){e&&e.instrument?T.RedirectToURL(C.getRedirectUrl("NewDeal","instrumentId="+e.instrument.id)):T.SwitchViewVisible(eForms.Quotes,{})},updateSignalsList:s,permissionsModule:y}})}),define("viewModels/BonusViewModel",["knockout","BonusManager"],function(i,o){function t(e){var t=this.Data||{};function a(){var e=o.bonus();t.CashBack(e.accumulatedVolumeUsd/e.volumeUsd*e.amountBase),t.MaxCashBack(e.amountBase),t.SpreadDiscount(e.amountGivenBase),t.MaxSpreadDiscount(e.amountGivenBase+e.amountBase),t.isDataLoaded(0<e.amountBase)}return t.CashBack=i.observable(""),t.MaxCashBack=i.observable(""),t.isDataLoaded=i.observable(!1),t.SpreadDiscount=i.observable(""),t.MaxSpreadDiscount=i.observable(""),o.onChange.Add(a),a(),{Data:t,Params:e||{},dispose:function(){o.onChange.Remove(a)}}}return{viewModel:{createViewModel:function(e){return new t(e)}}}}),define("viewModels/CashBackViewModel",["require","knockout","Q","dalOrders","Customer","KoComponentViewModel","InstrumentsManager","InstrumentTranslationsManager","ViewsManager","DialogViewModel","PortfolioStaticManager","UrlResolver"],function(e){var l=e("knockout"),t=e("Q"),u=e("dalOrders"),m=e("Customer"),a=e("KoComponentViewModel"),b=e("InstrumentsManager"),p=e("InstrumentTranslationsManager"),f=e("ViewsManager"),o=e("DialogViewModel"),g=e("PortfolioStaticManager"),v=e("UrlResolver"),i=extendClass(a,function(e){var n=this,r=this.parent,c=this.Data;function d(i){i.forEach(function(e,t){var a=e.USDAmountWeighted/c.Summary.MaxVolume()*c.Summary.MaxCashBack();isNaN(a)&&(a=0),i[t].usdAmount=formatNumber(String(e.USDAmount)),i[t].usdAmountWeighted=formatNumber(String(e.USDAmountWeighted)),i[t].estimatedCashBack=parseFloat(a).toFixed(2)})}function s(e){var t,a,i,o,n;t=e[0].Summary,a=toNumeric(t.WeightedVolume),i=toNumeric(t.PendingBonusAmount),o=toNumeric(t.ConditionalVolume),n=0===o?0:i*a/o,n=Math.min(n,i),c.Summary.CashBack(n),c.Summary.MaxCashBack(i),c.Summary.Volume(a),c.Summary.MaxVolume(o),c.Summary.EndDate(t.PendingBonusEnd),d(e[0].EnhancedInstruments);for(var r=0;r<e[0].EnhancedInstruments.length;r++){var s=b.GetInstrument(e[0].EnhancedInstruments[r].InstrumentId);e[0].EnhancedInstruments[r].baseSymbolId=s.baseSymbol,e[0].EnhancedInstruments[r].otherSymbolId=s.otherSymbol}c.Enhanced(e[0].EnhancedInstruments),d(e[0].RegularInstruments);for(var l=0;l<e[0].RegularInstruments.length;l++){var u=b.GetInstrument(e[0].RegularInstruments[l].InstrumentId);e[0].RegularInstruments[l].baseSymbolId=u.baseSymbol,e[0].RegularInstruments[l].otherSymbolId=u.otherSymbol}c.Regular(e[0].RegularInstruments)}function a(){return t.fcall(function(){isDefinedType(o)&&o.close&&o.close()}).delay(10)}function i(e,t){i.enabled()&&e&&e.id&&a().then(function(){f.RedirectToURL(v.combine(v.getRedirectPath(),"/NewDeal?instrumentId="+e.id))}).done()}return i.enabled=l.observable(!!e.enableNewDeal),{init:function(e){var t,a,i,o;g.Portfolio.pendingBonusType===ePendingBonusType.cashBack?(r.init.call(n,e),c.Summary={EndDate:l.observable(""),CashBack:l.observable(""),Volume:l.observable(""),MaxCashBack:l.observable(""),MaxVolume:l.observable("")},c.Enhanced=l.observableArray(),c.Regular=l.observableArray(),c.isDataLoaded=l.observable(!1),c.customerSymbolId=l.observable(m.prop.baseCcyId()),c.hasWeightedVolumeFactor=l.observable(m.prop.hasWeightedVolumeFactor),c.hasEnhancedInstruments=l.computed(function(){return c.Enhanced()&&0<c.Enhanced().length}),c.hasRegularInstruments=l.computed(function(){return c.Regular()&&0<c.Regular().length}),c.hasVolumes=l.computed(function(){return c.hasEnhancedInstruments()||c.hasRegularInstruments()}),u.CashBackVolumesInfo().then(function(e){s(e),c.isDataLoaded(!0)}).done(),0!==(t=b.GetEnhancedInstruments().map(function(e){return{id:e.id,name:p.Short(e.id),multiplier:e.weightedVolumeFactor}})).length&&(o=t.map(function(e){return e.name}).join(", "),a=Math.round(100*Math.max.apply(Math,t.map(function(e){return e.multiplier}))),i=t[Math.floor(Math.random()*t.length)],c.enhancedInstruments=t,c.maxMultiplier=a,c.randomEnhancedInstrument={name:i.name,equivalentVolume:Math.round(100*i.multiplier)},c.enhancedInstrumentNames=o)):f.SwitchViewVisible($customer.prop.mainPage,{})},dispose:function(){r.dispose.call(n)},Data:c,ClosePopup:a,StartNewDeal:i}});return{viewModel:{createViewModel:function(e){var t=new i(e||{});return t.init(),t}}}}),define("viewModels/ChangePasswordViewModel",["require","assets/js/jquery.validator","registration/ChangePasswordModule","PermissionsModule","Customer","ViewModelsManager","StateObject!Setting"],function(e){var a=e("registration/ChangePasswordModule"),i=e("PermissionsModule"),o=e("Customer"),n=e("ViewModelsManager"),r=e("StateObject!Setting");return{viewModel:{createViewModel:function(){var t=ko.observable(!0);return a.init(!0),$viewModelsManager.VManager.GetViewArgs(eViewTypes.vChangePassword)===eViewTypes.vChangePassword&&t(!1),r.get("AccountHubSetting")||r.set("AccountHubSetting",null),r.subscribe("AccountHubSetting",function(e){t(e!==eViewTypes.vChangePassword)}),{dispose:function(){a.unsetDomEvents()},CollapsedToggle:function(){o.prop.isDemo?n.VManager.RedirectToForm(eForms.Settings,eViewTypes.vChangePassword):i.CheckPermissions("changePassword")?t(!t()):(AlertsManager.UpdateAlert(AlertTypes.ServerResponseAlert,Dictionary.GetItem("GenericAlert"),Dictionary.GetItem("Forbidden"),null),AlertsManager.PopAlert(AlertTypes.ServerResponseAlert))},isCollapsed:t}}}}}),define("viewModels/ContractRolloverBaseViewModel",["require","knockout","KoComponentViewModel","ViewModelsManager","dalAccountingActions","LoadDictionaryContent!deals_ContractRollover","StateObject!Positions"],function(e){var r=e("knockout"),t=e("KoComponentViewModel"),s=e("ViewModelsManager"),l=e("dalAccountingActions"),u=e("StateObject!Positions");return extendClass(t,function(){var t=this,a=this.parent,o=this.Data,i={},e={idField:"actionNumber",columns:[{name:"rowNumber",transform:function(e,t){return t}},{name:"actionID",dataIndex:eContractRollover.actionID},{name:"posNum",dataIndex:eContractRollover.posNum},{name:"date",dataIndex:eContractRollover.date},{name:"credit",dataIndex:eContractRollover.credit},{name:"debit",dataIndex:eContractRollover.debit},{name:"symbolName",dataIndex:eContractRollover.symbol},{name:"openMidRate",transform:function(e,t,a,i){return Format.toRate(i[eContractRollover.openMidRate],!0,o.instrumentID())}},{name:"closeMidRate",transform:function(e,t,a,i){return Format.toRate(i[eContractRollover.closeMidRate],!0,o.instrumentID())}},{name:"gap",transform:function(e,t,a,i){return Format.toRate(i[eContractRollover.gap],!0,o.instrumentID())}},{name:"spread",transform:function(e,t,a,i){return Format.toRate(i[eContractRollover.spread],!0,o.instrumentID())}}],pageSizes:20,statusField:"status",totalField:"totalItems",dataField:"actions",pagination:{pagesPerPage:5,pageIndexField:"Page",pageSizeField:"PageSize"},Filter:i,DAL:{reference:l.GetContractRollover,callerName:"ContractRollover/onLoadComplete",errorSeverity:eErrorSeverity.medium,onLoad:function(e){r.postbox.publish(eAppEvents.contractRolloverDataLoaded),o.totalSum(e.totalAmount),isEmptyValue(e.actions)||isEmptyValue(e.actions[0])||o.currency(e.actions[0][eContractRollover.symbol]),u.containsKey("plPositionNumber")&&u.update("plPositionNumber",null),o.isDataReady(!0)}}},n=new ObservableDataSet(e);return{init:function(e){a.init.call(t,e),function(){o.totalSum=r.observable(0),o.totalSumFormatted=r.computed(function(){return Format.toNumberWithThousandsSeparator(r.utils.unwrapObservable(o.totalSum),2)}),o.isDataReady=r.observable(!1),o.currency=r.observable(""),o.instrumentID=r.observable(s.VManager.GetViewArgs(eViewTypes.vContractRollover).instrumentID),o.dealAmount=s.VManager.GetViewArgs(eViewTypes.vContractRollover).dealAmount;var e=s.VManager.GetViewArgs(eViewTypes.vContractRollover).posNum;i.Position=r.observable(e),i.Page=r.observable(InitConfiguration.ContractRolloverConfiguration.defaultPage),i.PageSize=InitConfiguration.ContractRolloverConfiguration.pageSize}(),n.Init(),n.SetFilter(i),n.Load()},dispose:function(){n.Clean(),a.dispose.call(t)},Data:o,BalanceInfo:n.DataRows,DataSet:n,GetNextBalance:n.Paging.ShowMore,VisibleShowMore:n.Paging.HasNextPage}})}),define("viewModels/CustomDropDown",[],function(){return{viewModel:{createViewModel:function(e){var t=e.value;return isEmptyValue(t())&&t(e.options()[0]),{options:e.options,value:t,optionText:e.optionText}}}}}),define("viewModels/DemoBannerViewModel",["require","knockout","KoComponentViewModel","Customer","Dictionary","UrlResolver","LoadDictionaryContent!demo_banners"],function(e){var i=e("knockout"),t=e("KoComponentViewModel"),r=e("Customer"),s=e("Dictionary"),l=e("UrlResolver"),a=extendClass(t,function(){var t=this,a=this.parent,o=this.Data,n=2;return{init:function(e){a.init.call(t),o.isVisible=i.observable(r.prop.isDemo),o.message=i.observable(String.empty),o.buttonMessage=i.observable(String.empty),o.urlToRedirect=i.observable(String.empty),function(e){var t,a=e.dataRecords.length,i=e.dataRecords.reduce(function(e,t){return e+Number(t.pandLCalc)},0);switch(e.alertName){case"DealAddServerResponseAlert":t=e.dataRecords[0].instrumentId,o.message(s.GetItem("OpenDealMessage","demo_banners")),o.buttonMessage(s.GetItem("OpenDealButtonMessage","demo_banners")),o.urlToRedirect(l.getRedirectUrl("NewDeal",String.format("Mode={0}&instrumentId={1}",n,t)));break;case"DealsClosedServerResponseAlert":if(1!=e.dataRecords[0].status)return o.isVisible(!1);1===a?0<=i?(o.message(s.GetItem("CloseOneDealWithProfitMessage","demo_banners")),o.buttonMessage(s.GetItem("CloseOneDealWithProfitButtonMessage","demo_banners")),o.urlToRedirect(l.getRedirectUrl("Deals",String.format("Mode={0}",n)))):(o.message(s.GetItem("CloseOneDealWithLossOrNoProfitMessage","demo_banners")),o.buttonMessage(String.empty),o.urlToRedirect(String.empty)):(o.message(s.GetItem("CloseMultipleDealsMessage","demo_banners")),o.buttonMessage(s.GetItem("CloseMultipleDealsButtonMessage","demo_banners")),o.urlToRedirect(l.getRedirectUrl("Deals",String.format("Mode={0}",n))));break;default:o.isVisible(!1)}}(e)},dispose:function(){a.dispose.call(t)},Data:o}});return{viewModel:{createViewModel:function(e){var t=new a;return t.init(e),t}}}}),define("viewModels/EconomicCalendarViewModel",["knockout","economicCalendarConfig","KoComponentViewModel","FxNet/LogicLayer/EconomicCalendar/EconomicCalendarConnManager","StateObject!EconomicCalendarConnManager","LoadDictionaryContent!economicCalendarLongData","LoadDictionaryContent!economicCalendar"],function(g,v,e,D,S){var y,T=function(e){var t;return!isEmptyValue(e)&&(t=e.split("/"),!isEmptyValue(t)&&2===t.length)&&{FirstCurrency:t[0],SecondCurrency:t[1]}},o=extendClass(e,function(e){var t,a=this,i=this.parent,s=this.Data,o=e.viewName,n=function(){s.filters={FirstCurrency:g.observable(),SecondCurrency:g.observable(),FromDate:g.observable(),ToDate:g.observable(),TimeZoneId:g.observable(),TimeZoneOffset:g.observable(),CountryCodes:g.observableArray([]),Importance:g.observableArray([]),CountryCodesMandatory:g.observable(),ImportanceMandatory:g.observable(),Count:g.observable()}},r=function(){s.ccyPair=a.createComputed(function(){return isDefinedType(e.ccyPair)?e.ccyPair():""}),s.isShowEventsUnavailable=a.createComputed(function(){return!s.hasEvents()&&!s.isLoading()}),s.isShowLoader=a.createComputed(function(){return s.isLoading()}),s.isShowEvents=a.createComputed(function(){return s.hasEvents()&&!s.isLoading()})},l=debounce(function(){t=D.Subscribe(o,g.toJS(s.filters))}),u=function(){s.events([]),s.mapEvents([]),s.hasEvents(!1),t&&D.Unsubscribe(t)},c=function(e,t){var a,i;return{EventTime:e.EventTime.trim()+"Z",CountryCode:e.CountryCode.toLowerCase(),Symbol:isArrayType(e.Symbols)?e.Symbols.shift():"",ImportanceActive:e.Importance,ImportanceInactive:v.eventsMaxImportance-e.Importance,Title:Dictionary.GetItem("ec"+e.ContentId,"economicCalendar").trim(),Previous:e.Previous,Actual:e.Actual,ActualDirection:(a=e.Forecast,i=e.Actual,""!==a?extractNumberFromString(a)>extractNumberFromString(i)?eDirections.Down:extractNumberFromString(a)<extractNumberFromString(i)?eDirections.Up:eDirections.Bold:""),Forecast:e.Forecast,ContentKey:v.contentKeySection+e.ContentId,RecordId:e.RecordId,Description:Dictionary.GetItem("eclong"+e.ContentId,"economicCalendarLongData"),isDescriptionExpanded:g.observable(!1),ContentId:e.ContentId,TotalCount:t}},d=function(e,t){if(e){for(var a,i=s.events(),o=s.mapEvents(),n=0,r=e.length;n<r;n++)a=null,1===t&&(a=o[e[n].RecordId]),a||0==a?i[a]=c(e[n],i[a].TotalCount):(i.push(c(e[n],e[n].TotalCount)),o[e[n].RecordId]=i.length-1);s.events(i),s.hasEvents(!0)}else 1===s.pageIndex()&&s.hasEvents(!1);s.isLoading(!1)},m=function(){s.hasEvents=g.observable(!1),s.isLoading=g.observable(!0),s.events=g.observableArray([]),s.newEvents=g.observableArray([]),s.mapEvents=g.observableArray([]),s.showFilters=g.observable(!1),s.pageIndex=g.observable(1)},b=function(a){a=a||{},1===s.pageIndex()&&(s.isLoading(!0),u()),D.WhenAvailable().then(function(e){if(!e)return s.hasEvents(!1),void s.isLoading(!1);for(var t in a)a.hasOwnProperty(t)&&s.filters.hasOwnProperty(t)&&s.filters[t](a[t]);l()}).done()},p=function(e){e===eAvailabilityState.NotAvailable&&(s.hasEvents(!1),s.isLoading(!1),s.events([]),s.mapEvents([]))},f=function(){a.subscribeTo(s.ccyPair,function(e){var t=T(e);!1!==t&&b(t)}),y=S.subscribe("IsServiceAvailable",p)};return{ApplyFilter:b,init:function(e){i.init.call(a,e),n(),m(),r(),f(),D.SetMessageReceivedCallback(o,d)},dispose:function(){y(),u(),i.dispose.call(a)}}});return{viewModel:{createViewModel:function(e){var t=new o(e);t.init();var a,i=e.ccyPair;return isDefinedType(i)&&!1!==(a=T(g.utils.unwrapObservable(i)))&&t.ApplyFilter(a),t}},EconomicCalendarViewModel:o}}),define("viewModels/MarketClosedViewModel",["require","knockout","KoComponentViewModel","StatesManager","ErrorManager","dalMarketState"],function(e){var s=e("knockout"),t=e("KoComponentViewModel"),l=e("StatesManager"),u=e("ErrorManager"),c=e("dalMarketState"),a=extendClass(t,function(t){var a=this,i=this.parent,o=this.Data;function n(e){o.marketState=e,o.isReady(!0)}function r(e){throw u.onError("MarketClosedViewModel.getData","",eErrorSeverity.high),e}return{init:function(e){i.init.call(a,e),o.postboxTopic=t.postboxTopic,o.marketState=null,o.isReady=s.observable(!1),o.isVisibleMarketClosedBanner=a.createComputed(function(){var e=l.States.IsMarketClosed()&&!l.States.IsPortfolioInactive();return e&&c.GetData().then(n).fail(r).done(),e})}}});return{viewModel:{createViewModel:function(e){var t=new a(e);return t.init(),t}}}}),define("viewModels/MissingCustomerInformationViewModel",["require","knockout","Customer","dalCustomer","PaymentSelectionBehaviors","Dictionary","AlertsManager","JSONHelper"],function(e){var o=e("knockout"),n=e("Customer"),r=e("dalCustomer"),s=e("PaymentSelectionBehaviors"),l=e("Dictionary"),u=e("AlertsManager"),c=e("JSONHelper");return{viewModel:{createViewModel:function(){var t={firstName:{required:!0},lastName:{required:!0},phone:{required:!0,pattern:/^( ?-?\d){5,}$/},signAgreementDate:{equal:!0},gender:{required:!0,in:[eGender.Female,eGender.Male,eGender.Female.toLowerCase(),eGender.Male.toLowerCase()]},dateOfBirth:{required:!0},idNumber:{required:!0,number:!0,minLength:9,maxLength:9,asyncValidation:{asyncFunction:r.IsIdNumberValid}},address:{required:!0,pattern:/^.*[^0-9].*$/}},a={customerForm:{firstName:o.observable("").extend({initialyVisible:!1}),lastName:o.observable("").extend({initialyVisible:!1}),phone:o.observable("").extend({initialyVisible:!1}),signAgreementDate:o.observable(!n.HasMissingAgreement()).extend({initialyVisible:!1}),gender:o.observable("").extend({initialyVisible:!1}),dateOfBirth:o.observable("").extend({initialyVisible:!1}),idNumber:o.observable("").extend({initialyVisible:!1}),isLoading:o.observable(!0).extend({equal:!1}),address:o.observable("").extend({initialyVisible:!1})}};function e(){var e=new Date;return e.setFullYear(e.getFullYear()-18),e}function i(){var e=new Date;return e.setFullYear(e.getFullYear()-150),e}return r.GetCustomerDetails().then(function(e){var t=JSON.parse(e);a.customerForm.firstName(t.contactFirst),a.customerForm.lastName(t.contactLast),a.customerForm.phone(t.phone),a.customerForm.gender(t.gender),a.customerForm.dateOfBirth(t.dateOfBirth),a.customerForm.idNumber(t.idNumber),a.customerForm.address(t.address)}).done(),a.firstFieldInteractionDone=!1,a.fieldInteraction=function(){!1===a.firstFieldInteractionDone&&(o.postbox.publish("trading-event","agreement-first-interaction"),a.firstFieldInteractionDone=!0)},a.formValidation=o.validatedObservable(a.customerForm),a.dateOfBirthInfo={minDate:i(),maxDate:e(),yearRange:i().getFullYear()+":"+e().getFullYear()},a.agreementPhrase=o.observable(""),r.GetCustomerAgreementPhrase(function(e){a.agreementPhrase(e)}),a.updateMissingFields=function(){if(o.postbox.publish("trading-event","agreement-submit"),a.formValidation.isValid()){var e={FirstName:a.customerForm.firstName(),LastName:a.customerForm.lastName(),Phone:a.customerForm.phone(),HasSignedAgreement:a.customerForm.signAgreementDate(),Gender:a.customerForm.gender(),DateOfBirth:a.customerForm.dateOfBirth(),IdNumber:a.customerForm.idNumber(),Address:a.customerForm.address()};r.UpdateMissingInformation(e,function(e){var t=c.STR2JSON("updateMissingCustomerInformation",e);t.Status!==eOperationStatus.ValidationFailed?(n.UpdateMissingInformation(t.CustomerUpdated),s.OnCustomerSuccessfullUpdate()):u.ShowAlert(AlertTypes.ServerResponseAlert,l.GetItem("GenericAlert"),l.GetItem("ServerError"),null)})}else a.formValidation.errors.showAllMessages()},a.formValidation.errors.showAllMessages(),r.GetRequiredFieldsForDeposit(function(e){c.STR2JSON("getRequiredFieldsForDeposit",e).forEach(function(e){a.customerForm[e].extend(t[e]),a.customerForm[e].isVisible(!0)}),a.customerForm.isLoading(!1)}),a}}}}),define("viewModels/NotificationsSettingsViewModel",["knockout","KoComponentViewModel","FxNet/DataAccessLayer/dalCompliance","ViewModelsManager","Customer","Dictionary","PermissionsModule","StateObject!Setting","AlertsManager"],function(f,e,g,v,D,S,y,T,C){var a=extendClass(e,function(){var a=this,t=this.parent,n=this.Data,e={},r={Other:0,Legal:1,AccountInformation:2,MovementsAndEvents:3,PromotionsOffers:4,Informative:5,EconomicCalendar:6,PriceAlert:7,LimitExecution:8,LowMarginAlert:9,AccountLiquidation:10,Support:11},i=[r.LimitExecution,r.LowMarginAlert,r.AccountLiquidation],o=[r.MovementsAndEvents,r.EconomicCalendar,r.Support,r.PromotionsOffers],s={CCID_8:0,CCID_9:1,CCID_10:2},l={CCID_3:0,CCID_6:1,CCID_11:2,CCID_4:3},u={TradingInformation:1,Marketing:2};function c(){var e=n.notificationCategories().find(function(e){return e.CampaignCategoryID===r.LowMarginAlert});if(e){for(var t=!isNullOrUndefined(n.lowMarginAlertValue())&&""!==n.lowMarginAlertValue()&&n.lowMarginAlertValueValid(),a=!1,i=0,o=e.CategoryMethods.length;i<o;i++)e.CategoryMethods[i].Enable&&(a=a||e.CategoryMethods[i].ObservableAllowed());n.spinnerEnabled(a),n.saveMarginButtonEnabled(t&&a&&n.lowMarginAlertValue.isDirty())}}var d=function(e){var t=JSONHelper.STR2JSON("NotificationsSettingsViewModel/getNotificationsSettings",e,eErrorSeverity.medium);t&&t.Status===eOperationStatus.Success&&(0!==t.Result.MinExposureCoverage&&0!==t.Result.MaxExposureCoverage&&(n.minMargin(t.Result.MinExposureCoverage),n.maxMargin(t.Result.MaxExposureCoverage),n.lowMarginAlertMinMax([n.minMargin(),n.maxMargin()])),n.lowMarginAlertValue()||0===t.Result.MinPctEQXP||(n.lowMarginAlertValue(t.Result.MinPctEQXP),n.lowMarginAlertValue.markClean()),t.Result.SendingCategoryList.forEach(function(e){-1<i.indexOf(e.CampaignCategoryID)&&(e.groupId=u.TradingInformation,e.order=s["CCID_"+e.CampaignCategoryID]),-1<o.indexOf(e.CampaignCategoryID)&&(e.groupId=u.Marketing,e.order=l["CCID_"+e.CampaignCategoryID]),e.subscriptions=e.subscriptions||[];for(var t=0,a=e.CategoryMethods.length;t<a;t++)e.CategoryMethods[t].Enable&&(e.CategoryMethods[t].ObservableAllowed=f.observable(e.CategoryMethods[t].Allowed),b()||e.subscriptions.push(m(e.CategoryMethods[t].ObservableAllowed,{categoryId:e.CampaignCategoryID,methodId:e.CategoryMethods[t].SendingMethodId})))}),n.notificationCategories().forEach(function(e){e.subscriptions.forEach(function(e){e.dispose()})}),n.notificationCategories(t.Result.SendingCategoryList),n.areNotificationsChanging(!1),c());n.updated.resolve()},m=function(e,t){return a.subscribeTo(e,function(e){var t=this.categoryId,a=this.methodId;if(!n.areNotificationsChanging()){var i=n.notificationCategories().find(function(e){return e.CampaignCategoryID===t});if(i){var o=i.CategoryMethods.find(function(e){return e.SendingMethodId===a});o&&(o.Allowed=e,f.postbox.publish("notifications-settings-change",i.CampaignCategoryName+"+"+o.SendingMethodName+"+"+o.Allowed),n.areNotificationsChanging(!0),g.setNotificationsSettings(n.notificationCategories()).then(d).done())}}},t)};T.get("AccountHubSetting")||T.set("AccountHubSetting",null),T.subscribe("AccountHubSetting",function(e){n.isCollapsed(e!==eViewTypes.vNotificationsSettings)});function b(){return!y.CheckPermissions("notificationsSettings")}function p(){C.UpdateAlert(AlertTypes.ServerResponseAlert,Dictionary.GetItem("GenericAlert"),Dictionary.GetItem("Forbidden"),null),C.PopAlert(AlertTypes.ServerResponseAlert)}return{init:function(e){t.init.call(a,e),n.isReady=f.observable(!1),n.areNotificationsChanging=f.observable(!1),n.notificationCategories=f.observableArray([]),n.lowMarginAlertValue=f.observable(),n.minMargin=f.observable(.25),n.maxMargin=f.observable(10),n.step=.25,n.lowMarginAlertMinMax=f.observable([n.minMargin(),n.maxMargin()]),n.lowMarginAlertValue.extend({amountValidation:n.lowMarginAlertMinMax,dirty:!1}),n.lowMarginAlertValue.extend({notify:"always"}),n.lowMarginAlertValueValid=f.observable(!0),n.isCollapsed=f.observable(!0),n.saveMarginButtonEnabled=f.observable(!1),n.spinnerEnabled=f.observable(!1),n.updated=Q.defer(),n.isProcessing=f.observable(!1),n.lowMarginAlertValueValid.subscribe(c),n.lowMarginAlertValue.subscribe(c),n.updated.promise.then(function(){n.isReady(!0)}),g.getNotificationsSettings().then(d).done(),v.VManager.GetViewArgs(eViewTypes.vNotificationsSettings)===eViewTypes.vNotificationsSettings&&n.isCollapsed(!1)},dispose:function(){e.notificationSettingChanged=null,t.dispose.call(a)},Handlers:e,Data:n,Dictionary:S,GetDataByGroup:function(t){var e=n.notificationCategories().filter(function(e){return e.groupId===t});return e=e.sort(function(e,t){return e.order>t.order?1:-1})},eNotificationsSettingsGroups:u,eCampaignCategories:r,CollapsedToggle:function(){D.prop.isDemo?v.VManager.RedirectToForm(eForms.Settings,eViewTypes.vNotificationsSettings):n.isCollapsed(!n.isCollapsed())},SaveButtonHandler:function(){b()?p():(n.isProcessing(!0),D.prop.minPctEQXP=n.lowMarginAlertValue(),g.sendExposureCoverage(n.lowMarginAlertValue(),function(){n.isProcessing(!1),n.lowMarginAlertValue.markClean(),c()}))},IsRestricted:b,CheckPermissions:function(){b()&&p()}}});return{viewModel:{createViewModel:function(e){var t=new a(e);return t.init(),t}},NotificationsSettingsViewModel:a}}),define("viewModels/SortStateViewModel",["knockout","KoComponentViewModel"],function(c,e){var a=extendClass(e,function(e){var t=this,a=this.parent,i=e.sortPropertiesObs,o=e.sortProperty,n=e.setSorting||function(){},r=c.observable(""),s=e.defaultAsc||!1;function l(e){var t="";isBooleanType(e)&&(t=e?"up":"down"),r(t)}function u(e){n(!0,o,e)}return a.init.call(t),t.parent.subscribeTo(e.sortPropertiesObs,function(e){e.sortProperty===o?l(e.asc):l()},t),l(i().sortProperty===o?i().asc:null),{sortDir:r,changeSort:function(){var e=i().sortProperty===o?i().asc:null;isBooleanType(e)?u(!e):u(s)}}});return{viewModel:{createViewModel:function(e){var t=new a(e);return t.init(),t}}}}),define("viewModels/fields/AmountSpinnerFieldViewModel",["require","knockout","Dictionary"],function(e){var g=e("knockout"),v=e("Dictionary");return function(a){var i,e,t,o,n,r,s,l=g.observable(1),u=g.pureComputed(function(){return(l().toString().split(".")[1]||"").length}),c=g.observable(),d=g.observable(),m=g.observable(!1),b=g.observable(!0);function p(e){var t=a.forceNonFractionalValue();e&&(i.dispose(),a.value.extend({toNumericLength:!1}),a.value.extend({incremental:!1})),a.value.extend({toNumericLength:{ranges:[{from:0,to:10,decimalDigits:t?0:1},{from:10,to:Number.MAX_SAFE_INTEGER,decimalDigits:0}]}}),a.value.extend({incremental:{ranges:[{from:0,to:10,step:t?1:.1},{from:10,to:100,step:1},{from:100,to:1e3,step:10},{from:1e3,to:1e4,step:100},{from:1e4,to:1e5,step:1e3},{from:1e5,to:1e6,step:1e4},{from:1e6,to:1e7,step:1e5},{from:1e7,to:1e8,step:1e6},{from:1e8,to:1e9,step:1e7},{from:1e9,to:1e10,step:1e8},{from:1e10,to:1e11,step:1e9}]}}),l(a.value.step()),i=a.value.step.subscribe(function(e){l(e)})}function f(e){c((e=e||[])[0]||0),d(e[1]||1e10)}return a.value.extend({tooltipValidation:{message:v.GetItem("txtRateValidationTooltip"),notify:"always",showTooltip:function(){return m()}}}),p(!1),f(g.utils.unwrapObservable(a.options)),t=a.options.subscribe(function(){f(this._target())},null,"arrayChange"),r=a.value.tooltipClosed.subscribe(function(e){e&&m(!1)}),e=a.value.subscribe(function(){m(!1)}),o=g.postbox.subscribe("deal-slip-show-validation-tooltips",function(){a.value.resetTooltip(),m(!0)}),n=a.value.isValid.subscribe(function(e){b(e)}),s=a.forceNonFractionalValue.subscribe(function(){p(!0)}),{id:a.id,name:a.name,value:a.value,isSelectedAmountValid:b,min:c,max:d,step:l,format:u,dispose:function(){u.dispose(),i.dispose(),r.dispose(),e.dispose(),o.dispose(),n.dispose(),a.value.extend({incremental:!1}),a.value.extend({tooltipValidation:!1}),a.value.extend({toDealAmount:!1}),t.dispose(),s.dispose()}}}}),define("viewModels/fields/LowMarginSpinnerViewModel",["require","knockout"],function(e){var d=e("knockout");return function(e){var t,a,i,o=d.observable(1),n=d.observable(),r=d.observable(),s=d.observable(!1),l=d.observable(!0),u=d.observable(!0);function c(e){n((e=e||[])[0]||0),r(e[1]||1e10)}return e.value.extend({toNumericLength:{ranges:[{from:0,to:10,decimalDigits:2},{from:10,to:Number.MAX_SAFE_INTEGER,decimalDigits:0}]}}),e.value.extend({incremental:{ranges:[{from:0,to:10,step:.25}]}}),o(e.step),d.isObservable(e.enabled)&&(u=e.enabled),d.isObservable(e.amountValidSubscriber)&&(l=e.amountValidSubscriber),c(d.utils.unwrapObservable(e.options)),a=e.options.subscribe(function(){c(this._target())},null,"arrayChange"),t=e.value.subscribe(function(){s(!1)}),i=e.value.isValid.subscribe(function(e){l(e)}),{id:e.id,name:e.name,value:e.value,isSelectedAmountValid:l,min:n,max:r,step:o,dispose:function(){t.dispose(),i.dispose(),e.value.extend({toDealAmount:!1}),e.value.extend({incremental:!1}),a.dispose()},enabled:u}}}),define("viewModels/TabsViewModel",["require","knockout","KoComponentViewModel","ViewModelsManager","StateObject!DealsTabs","dealTabsConfiguration"],function(e){var s=e("knockout"),t=e("KoComponentViewModel"),l=e("ViewModelsManager"),u=e("StateObject!DealsTabs"),c=e("dealTabsConfiguration"),a=extendClass(t,function(){var i=this,o=this.parent,n=this.Data,r="selectedTabView"+c.view;return{init:function(e){var t,a;o.init.call(i,e),n.tabs=c.tabs,t=l.VManager.GetViewArgs(c.view),a=(t?t.selectedTab:null)||u.containsKey(r)&&u.get(r)||c.tabs[0].type,n.selectedTab=u.set(r,s.observable(a))}}});return{viewModel:{createViewModel:function(e){var t=new a;return t.init(e),t}}}}),define("viewModels/TransactionsReportViewModel",["require","require","knockout","KoComponentViewModel","ViewModelsManager","LoadDictionaryContent!TransactionsReport"],function(e){var s=e("knockout"),t=e("KoComponentViewModel"),l=e("ViewModelsManager"),a=extendClass(t,function(){var a=this,i=this.parent,o=s.observable(),n=s.observable(),r=new ObservableDataSet({columns:[{name:"PositionNumber",dataIndex:eTransactionsReports.PositionNumber},{name:"TranactionNumber",dataIndex:eTransactionsReports.TransactionNumber},{name:"ExecutionDate",dataIndex:eTransactionsReports.ExecutionDate},{name:"BuySell",dataIndex:eTransactionsReports.BuySell},{name:"Item",dataIndex:eTransactionsReports.Item},{name:"InstrumentId",dataIndex:eTransactionsReports.InstrumentId},{name:"ItemBase",transform:function(e,t,a,i,o){return o.Item.split(/\//)[0]}},{name:"QuantityTraded",dataIndex:eTransactionsReports.QuantityTraded},{name:"UnitPrice",dataIndex:eTransactionsReports.UnitPrice},{name:"QuantityTradedAndOtherCcy",transform:function(e,t,a,i,o){return o.QuantityTraded}},{name:"TotalAmountCurrency",dataIndex:eTransactionsReports.TotalAmountCurrency},{name:"USDVolume",dataIndex:eTransactionsReports.USDVolume},{name:"TypeOfOrder",dataIndex:eTransactionsReports.TypeOfOrder},{name:"OpenRolloverClose",dataIndex:eTransactionsReports.OpenRolloverClose},{name:"BaseCur",dataIndex:eTransactionsReports.BaseCur},{name:"OtherCur",dataIndex:eTransactionsReports.OtherCur},{name:"Commission",dataIndex:eTransactionsReports.Commission}],statusField:"status",totalField:"totalItems",dataField:"Transactions",pagination:{pagesPerPage:5,pageIndexField:"page",pageSizeField:"pagesize"},Filter:{page:1,pagesize:20,to:n,from:o},DAL:{reference:dalTransactionsReport.LoadTransactions,callerName:"TransactionsReportViewModel/getTransactions",errorSeverity:eErrorSeverity.medium}});return{init:function(e){var t;i.init.call(a,e),t=new Date,o(new Date(t.getFullYear(),t.getMonth(),1).ExtractDate()),n((new Date).ExtractDate()),a.subscribeTo(l.VManager.GetActiveFormViewProperties(eViewTypes.vTransactionsReport).state,function(e){switch(e){case eViewState.Refresh:r.Load(),l.VManager.GetActiveFormViewProperties(eViewTypes.vTransactionsReport).state(eViewState.Initial)}}),a.subscribeTo(r.HasRecords,function(e){s.postbox.publish("printableDataAvailable",{dataAvailable:e,viewType:l.VManager.ActiveFormType(),viewModel:"TransactionsReportsViewModel"})}),r.Init(),r.ApplyFilter()},dispose:function(){r.Clean(),i.dispose.call(a)},Transactions:r.DataRows,HasRecords:r.HasRecords,DataSet:r,EnableApplyButton:r.IsLoadingData,Filter:{From:o,To:n,Apply:function(){r.IsLoadingData()||r.ApplyFilter()}}}});return{viewModel:{createViewModel:function(e){var t=new a;return t.init(e),t}}}}),define("FxNet/UILayer/ViewModels/UploadDocumentsPopUpsManager",["Dictionary","AlertsManager","StatesManager"],function(e,i,s){var l="UploadDocumentsStatusPopUpMessages";return new function(){function a(e){var t=[];return function(e,t){var a,i,o=getEnumName(eUploadDocumentType,t);switch(t){case eUploadDocumentType.OtherDocuments:(a=Dictionary.GetItem("doc_load_success",l))&&(i=a);break;default:var n=Dictionary.GetItem("docname_"+o,l);(a=Dictionary.GetItem("docname_load_success",l))&&(i=a.replace("{0}",n))}i&&e.push(i)}(t,e),function(e,t){var a,i=[eUploadDocumentStatus.Incomplete,eUploadDocumentStatus.AwaitingDocument];if(!(s.States.AmlStatus()===eAMLStatus.Approved||t!==eUploadDocumentType.ProofOfID&&t!==eUploadDocumentType.ProofOfResidence||i.indexOf(s.States.docProofOfID())<0&&i.indexOf(s.States.docProofOfResidence())<0)){var o,n,r=Dictionary.GetItem("doc_shuld_be_provided",l);if(r.trim()){switch(t){case eUploadDocumentType.ProofOfID:0<=i.indexOf(s.States.docProofOfResidence())&&(o=getEnumName(eUploadDocumentType,eUploadDocumentType.ProofOfResidence));break;case eUploadDocumentType.ProofOfResidence:0<=i.indexOf(s.States.docProofOfID())&&(o=getEnumName(eUploadDocumentType,eUploadDocumentType.ProofOfID));break;default:return}o&&(n=Dictionary.GetItem("docname_"+o,l),(a=r.replace("{0}",n))&&e.push(a))}}}(t,e),function(e,t){if(s.States.AmlStatus()!==eAMLStatus.Approved&&(t===eUploadDocumentType.ProofOfID||t===eUploadDocumentType.ProofOfResidence)){var a=Dictionary.GetItem("notify_when_doc_reviewed",l);a.trim()&&e.push(a)}}(t,e),{title:Dictionary.GetItem("popup_title",l),messages:t}}return{showPopUp:function(e){var t=a(e);0<t.messages.length&&(i.UpdateAlert(AlertTypes.GeneralOkAlert,t.title,t.body,t.messages,{theme:"alerts-white-theme alerts-no-close-x spaced-list"}),i.PopAlert(AlertTypes.GeneralOkAlert))}}}}),define("viewModels/UploadDocumentsComponentViewModel",["require","knockout","postbox","Q","environmentData","Dictionary","Customer","UrlResolver","FxNet/DataAccessLayer/dalClaims","fxnet/dataaccesslayer/dalcommon","StatesManager","FxNet/DataAccessLayer/dalCompliance","FxNet/UILayer/Managers/InterWindowsCommunicator","PermissionsModule","initConfiguration","FxNet/UILayer/ViewModels/UploadDocumentsPopUpsManager"],function(e){var T=e("knockout"),C=e("Q"),h=e("environmentData"),w=e("Dictionary"),L=e("Customer"),A=e("UrlResolver"),I=e("FxNet/DataAccessLayer/dalClaims"),M=e("fxnet/dataaccesslayer/dalcommon"),P=e("FxNet/DataAccessLayer/dalCompliance"),R=e("FxNet/UILayer/Managers/InterWindowsCommunicator"),V=e("StatesManager"),k=e("PermissionsModule"),F=e("initConfiguration").UploadDocumentsConfiguration,x=e("FxNet/UILayer/ViewModels/UploadDocumentsPopUpsManager");return{viewModel:{createViewModel:function(t){var a,i,o=t.id||"unknown",n=R(window,o.toString()+(t.hashTag?t.hashTag:"")),e=C.defer(),r=0,s=createGuid(),l=t.recordType?t.recordType:eClaimRecordType.generalDocument;V.startGetDocumentsStatus();var u={progressVisible:T.observable(!1),textFileUpload:T.observable(),iframeReady:T.observable(!1),autoUpload:t.autoUpload||!1,iframeElement:T.observable(),canBrowse:T.observable(!0),canUpload:T.observable(!1),files:T.observableArray(),iframeSrc:T.observable(c()+d()).extend({notify:"always"}),successFirst:T.observable(!1)};function c(){return h.pciPath+h.pciFileUploadPage+"?id="+o+"&v="+window.versionPCI+"&d="+window.location.host.replace(/\./g,"_")}function d(){var e="an="+L.prop.accountNumber+"&guid="+s;return void 0!==t.hashTag?"#"+o+t.hashTag+"&"+e:"#"+e}function m(){if(r>F.uploadFrameRetryCount){clearInterval(i);var e=u.iframeSrc();M.LogFrameNotLoadedMessage(eTokenizationError.frameNotLoaded,encodeURI(e),extractGuid(e))}else{var t;r++,u.iframeSrc((t=c(),A.getUrlWithRndKeyValue(t)+d()))}}function b(){isFunctionType(t.uploadResponseCallback)&&t.uploadResponseCallback()}function p(){u.canUpload(!1),u.canBrowse(!1),u.files.push(a),I.getClaim(eClaimActionType.Save,l,L.prop.accountNumber).then(g).then(v).fail(D).done()}function f(e){n.postMessage(u.iframeElement(),e,h.pciPath)}function g(e){var t=JSON.parse(e);if(!t||t.error)throw new Error(e);return t}function v(e){f({msg:"upload",value:e}),u.successFirst()||u.successFirst(!0)}function D(e){u.canBrowse(!0),u.canUpload(!1),u.textFileUpload("");var t=u.files().length-1,a=$.extend({},u.files()[t]);a.errorText=y("uploadError"),a.errorType="uploadError",a.isSuccessfull=!1,a.showProgress=!1,a.isFinished=!0,u.files.replace(u.files()[t],a),S(a,eTokenizationError.claimError,e.status?"Claim request failed with status "+e.status:e),u.canUpload(!1),u.canBrowse(!0),b()}function S(e,t,a){var i,o;!e.isSuccessfull&&(i=e).errorType&&k.CheckPermissions("uploadDocuments")&&"uploadError"===i.errorType&&M.LogUploadActivityMessage(t,encodeURI(u.iframeSrc())+" "+((o=a)?o instanceof Error?o.message+" StackTrace: "+(o.stack?o.stack:""):JSON.stringify(o):""))}function y(e){if(e)switch(e){case"noFileToUpload":case"uploadError":return w.GetItem("lblErrMsgSendindFaildTitle");case"fileTypeError":return w.GetItem("lblFileTypeError");case"fileNumberError":return w.GetItem("lblFileCountError");case"invalidFileName":return w.GetItem("lblFileNameError");case"maxSize":return w.GetItem("lblFileSizeError");default:return e}return w.GetItem("lblSuccessfullyUploaded")}return M.LogUploadCommunication("VM load","load promise timeout started","written"),e.promise.timeout(F.interWindowsCommunicationLimit).then(function(e){M.LogUploadCommunication("VM load","load promise timeout was resolved with result: "+e,"written")},function(){i=setInterval(m,F.uploadFrameReloadTimeout)}).done(),u.isBrowseEnabled=T.computed(function(){return u.iframeReady()&&u.canBrowse()}),u.isBrowseUploadOneClickEnabled=T.computed(function(){return u.iframeReady()&&u.canBrowse()&&k.CheckPermissions("uploadDocuments")}),u.isUploadEnabled=T.computed(function(){return u.iframeReady()&&u.canUpload()&&k.CheckPermissions("uploadDocuments")}),T.postbox.subscribe(eAppEvents.dialogClosed,function(){t.isCloseable&&u.iframeSrc("")}),n.registerMessageHandler(h.pciPath,{uploadStatus:function(e){u.canBrowse(!0),u.canUpload(!1);var t=e.data,a=u.files().length-1;t.errorText=y(t.errorType),t.name=u.files()[a].name,u.files.replace(u.files()[a],t),S(t,eTokenizationError.uploadError,e),t.errorType&&b(),e.result&&u.textFileUpload("")},ready:function(){clearInterval(i),e.resolve("ready"),u.iframeReady(!0),f({msg:"ready"})},logUploadData:function(e){var t=e.uploadResult&&e.uploadResult.guid?e.uploadResult.guid:void 0,a=e.uploadResult&&e.uploadResult.name?e.uploadResult.name:u.textFileUpload(),i=e.uploadResult&&e.uploadResult.size?e.uploadResult.size:"",o=e.uploadResult&&e.uploadResult.contenttype?e.uploadResult.contenttype:"",n=-1;e.uploadResult&&e.uploadResult.validationErrorCode&&/^\d+$/.test(e.uploadResult.validationErrorCode)?n=e.uploadResult.validationErrorCode:e.uploadResult&&!e.uploadResult.validationErrorCode&&(n=0<i&&a.length&&0<o.length?0:n),b(),0===n&&(l===eUploadDocumentType.ProofOfID?V.States.docProofOfID(eUploadDocumentStatus.Processing):l===eUploadDocumentType.ProofOfResidence&&V.States.docProofOfResidence(eUploadDocumentStatus.Processing),x.showPopUp(l)),P.logUploadResult({ErrNum:n,ErrType:e.errType,FileName:a,FileSize:i,ContType:o,GuId:t,RecType:l})},fileData:function(e){e.errorText=y(e.errorType),u.textFileUpload(e.name),u.canUpload(!e.isFinished),(a=e).isFinished&&(u.files.push(a),S(a,eTokenizationError.uploadError,e)),e.errorType&&b(),!e.isFinished&&u.autoUpload&&p()}}),{upload:p,uploadStringImage:function(e){f({msg:"uploadStringImage",value:{base64Image:e.content,fileName:e.fileName}})},browse:function(){f({msg:"browse"})},removeFileLog:function(e){u.files.remove(e)},dispose:function(){u.iframeSrc(""),n.unregisterMessageHandler(),e.resolve("dispose"),i&&clearInterval(i)},form:u}}}}}),define("viewModels/UploadDocumentsViewModel",["require","JSONHelper","knockout","ViewsManager","Customer","FxNet/DataAccessLayer/dalCompliance","viewModels/UploadDocumentsComponentViewModel","PermissionsModule","AlertsManager","DepositConfirmationActions"],function(e){var c=e("knockout"),d=e("JSONHelper"),m=e("FxNet/DataAccessLayer/dalCompliance"),b=e("ViewsManager"),p=e("Customer"),f=e("viewModels/UploadDocumentsComponentViewModel"),g=e("PermissionsModule"),v=e("AlertsManager"),D=e("DepositConfirmationActions");return{viewModel:{createViewModel:function(){var a=c.observable(),i=c.observable([]),e=c.observable(!1),o=c.observable(!1),n=g.CheckPermissions("uploadDocuments"),r=0,s=new THashTable;if(!p.prop.isDemo)return a(s),m.getUploadDocumentsData(t),{documentsData:a,notApprovedCreditCards:i,ccTooltipVisible:e,showCCTooltip:function(){e(!e())},getIndexInc:function(e){return e?++r:0},getIndex:function(){return r},getStatusColor:function(e){return e===eUploadDocumentStatus.Processing?"status-orange":e===eUploadDocumentStatus.Approved||e===eUploadDocumentStatus.NotRequired?"status-green":e===eUploadDocumentStatus.Incomplete||e===eUploadDocumentStatus.AwaitingSignatureHighAmount?"status-red":"status-gray"},dispose:function(){a().ForEach(u),s.Clear()},openDepositconfirmationPopup:D.OpenConfirmation,sendEmail:function(){if(n&&!o()){m.sendDepositConfirmation();var e=Dictionary.GetItem("depositConfirmationEmail"),t=Dictionary.GetItem("PleaseNote");o(!0),v.UpdateAlert(AlertTypes.DepositConfirmationEmailSentAlert,t,e),v.PopAlert(AlertTypes.DepositConfirmationEmailSentAlert)}},isEmailClicked:o,isPermitted:n};function t(e){var t=d.STR2JSON("UploadDocumentsViewModel/getUploadDocumentsData",e,eErrorSeverity.medium);t&&(t.Data&&function(e){s=a(),e.forEach(l);var t=s.GetItem(eUploadDocumentType.OtherDocuments);s.OverrideItem(eUploadDocumentType.OtherDocuments,t),r=0,a(s)}(t.Data),t.NotApprovedCreditCards&&i(t.NotApprovedCreditCards))}function l(e,t){[eUploadDocumentType.ProofOfID,eUploadDocumentType.ProofOfResidence,eUploadDocumentType.CreditCardCopy,eUploadDocumentType.DepositConfirmation,eUploadDocumentType.WithdrawalPendingRequest,eUploadDocumentType.TaxCard,eUploadDocumentType.OtherDocuments].contains(e.DocumentTypeID)&&(e.IsVisible=!0,e.uploadVm=f.viewModel.createViewModel({recordType:e.DocumentTypeID,autoUpload:!0,id:"upload",hashTag:t+1,uploadResponseCallback:e.DocumentTypeID===eUploadDocumentType.DepositConfirmation?D.CloseConfirmation:emptyFn}),e.dispose=e.uploadVm.dispose,s.OverrideItem(e.DocumentTypeID,e))}function u(e,t){t&&isFunctionType(t.dispose)&&t.dispose()}b.SwitchViewVisible(p.prop.mainPage,{})}}}}),define("FxNet/LogicLayer/Deal/DealAmountLabel",["require","Dictionary","DealAmountPrefixKey","SymbolsManager"],function(e){var r=e("Dictionary"),s=e("DealAmountPrefixKey"),l=e("SymbolsManager");return{Translate:function(e,t){if(e){var a,i=!1,o=isNullOrUndefined(t)?s:t,n=o+e.id;return r.ValueIsEmpty(n)&&(e.isFuture?n=o+"future":e.isShare?n=o+"share":(n=o+"default",i=!0)),a=r.GetItem(n),i&&(a+=" "+l.GetTranslatedSymbolById(e.baseSymbol)),{label:a}}}}}),define("FxNet/LogicLayer/Deal/DealLifeCycle",["require","CacheManager"],function(e){var a=e("CacheManager"),o=function(e,t){return(e===eAssetType.Share||e===eAssetType.Future)&&t===eDealPermit.Islamic?new Date(a.ServerTime().getTime()).toLaterDate().skipWeekendDays():null};return{getIslamicValueDateBeforeDeal:o,sharesIsCorporateActionDateSignificant_BeforeDeal:function(e,t,a){return t===eAssetType.Share&&(e!==eDealPermit.Islamic&&!!a||e===eDealPermit.Islamic&&!!a&&str2Date(a,"d/m/Y H:M")<o(t,e))},sharesIsDividendDateSignificant_BeforeDeal:function(e,t,a,i){return t===eAssetType.Share&&(e!==eDealPermit.Islamic&&!a&&!!i||e===eDealPermit.Islamic&&!a&&!!i&&str2Date(i,"d/m/Y H:M")<o(t,e))},futuresIsRolloverDateSignificant_BeforeDeal:function(e,t,a){return t===eAssetType.Future&&(e!==eDealPermit.Islamic&&!!a||e===eDealPermit.Islamic&&!!a&&str2Date(a,"d/m/Y H:M")<o(t,e))},futuresIsRolloverDateSignificant_AfterDeal:function(e,t,a){return!(e!==eAssetType.Future||!t)&&(!a||str2Date(t,"d,m,y,H,M,S")<str2Date(a,"d,m,y,H,M,S"))},sharesIsCorporateActionDateSignificant_AfterDeal:function(e,t,a){return!(e!==eAssetType.Share||!t)&&(!a||str2Date(t,"d,m,y,H,M,S")<str2Date(a,"d,m,y,H,M,S"))},sharesIsDividendDateSignificant_AfterDeal:function(e,t,a,i){return!(e!==eAssetType.Share||!t||a)&&(!i||str2Date(t,"d,m,y,H,M,S")<str2Date(i,"d,m,y,H,M,S"))}}}),define("FxNet/LogicLayer/Deal/DealMarginCalculator",["require","Customer","AmountConverter"],function(e){var t=e("Customer"),m=e("AmountConverter");function b(e,t){var a=Math.pow(10,t);return Math.round(e*a)/a}var r=function(e,t){return m.Convert(e,t)},s=function(e){return e&&(e=parseFloat(e.toFixed(2))),e},p=function(e){return(e.orderDir===eOrderDir.Sell||e.orderDir===eOrderDir.Buy)&&isNumber(e.requiredMarginPercentage)&&isNumber(e.dealRate)&&isNumber(e.dealAmount)};return{DealMargin:function(e){if(p(e)){var t,a,i=toNumeric(e.otherSymbolAmount),o=toNumeric(e.baseSymbolAmount),n=toNumeric(e.requiredMarginPercentage),r=e.dealAmount*toNumeric(e.dealRate);e.hasPosition?a=-1*(t=e.orderDir===eOrderDir.Sell?-1:1):t=a=1;var s=b(m.Convert(Math.abs(i),e.quoteForOtherCcyToAccountCcy,!0),2),l=b(m.Convert(Math.abs(o),e.quoteForBaseCcyToAccountCcy,!0),2),u=Math.max(s,l)*n,c=b(m.Convert(Math.abs(i+r*a),e.quoteForOtherCcyToAccountCcy,!0),2),d=b(m.Convert(Math.abs(o+e.dealAmount*t),e.quoteForBaseCcyToAccountCcy,!0),2);return b(Math.max(c,d)*n-u,2)}},PipWorth:function(e,t,a,i){var o=e*(1/Math.pow(10,t)),n=r(o,a);return 10<i&&n?n.toFixed(0):s(n)},DealAmount:function(e){return e.quoteForOtherCcyToAccountCcy?e.baseSymbol==t.prop.baseCcyId()?e.dealAmount:r(e.dealRate*e.dealAmount,e.quoteForOtherCcyToAccountCcy):""},SpreadWorthInAcountCCY:function(e){var t=e.ask-e.bid,a=e.dealAmount*t,i=0;return isNumber(a)&&(i=Math.abs(r(-a,e.quoteForOtherCcyToAccountCcy))),b(i,2)},Convert:r}}),define("FxNet/LogicLayer/Deal/NewDealValidator",["require","Dictionary","InstrumentsManager","AlertsManager","QuotesManager","StatesManager"],function(e){var s,l=e("Dictionary"),u=e("InstrumentsManager"),c=e("AlertsManager"),d=e("QuotesManager"),m=e("StatesManager");return{Init:function(e){s=e},Validate:function(e,t){var a,i=u.GetInstrument(e),o=s.CheckTradingAgreement(i);if(1==m.States.fxDenied())return s.ValidateOnlineTradingUser(),!1;if(o!==eTradingAgreement.NotNeeded)return a=String.format(l.GetItem("rcFuturesRedirect"),i.ccyPair),c.UpdateAlert(AlertTypes.ServerResponseAlert,null,a,""),c.PopAlert(AlertTypes.ServerResponseAlert),!1;var n=d.Quotes.GetItem(i.id);if(n&&n.state==eQuoteStates.NotActive)return a=String.format(l.GetItem("InstrumentInactive"),i.ccyPair),c.UpdateAlert(AlertTypes.ServerResponseAlert,null,a,""),c.PopAlert(AlertTypes.ServerResponseAlert),!1;var r=t||"";return!(0<r.length&&(a=r,c.UpdateAlert(AlertTypes.ServerResponseAlert,null,a,""),c.PopAlert(AlertTypes.ServerResponseAlert),1))}}}),define("FxNet/LogicLayer/Deal/SentimentsConnManager",["initConfiguration","FxNet/LogicLayer/GeneralManager/TradingInfoConnManager","StateObject!SentimentsConnManager"],function(e,i,o){var a,n=e.MarketInfoConfiguration.hubname,r={},t=function(e,t){r[t]&&(r[t].done=!0,e&&"function"==typeof a&&a(e))},s=function(e){var t=o.get("IsServiceAvailable"),a=!!e;o.update("IsServiceAvailable",a),!t&&a&&function(){for(var e in r)r.hasOwnProperty(e)&&(r[e].done=!1,i.Subscribe(n,r[e].args))}()};return o.set("IsServiceAvailable",!1),i.UpdateCallbacks(n,t,s),{SetMessageReceivedCallback:function(e){a=e},Subscribe:function(e,t){var a=[e,t];r[t]={args:a,done:!1},i.Subscribe(n,a)},Unsubscribe:function(e,t){var a=[e,t];i.Unsubscribe(n,a)},Dispose:function(){o.unset("IsServiceAvailable"),i.Dispose()}}}),define("FxNet/LogicLayer/Deal/InstrumentInfoLines",["require","Dictionary","LoadDictionaryContent!deals_InstrumentInfoTool"],function(e){var u,c,d=e("Dictionary"),i=[{id:instrumentInfoProps.pipValue,available:!0,label:"txtPipValue",labelMobile:"lblPipValue",tooltip:"txtPipValueInfo",attrIdOfValue:"lblPipValue",attrIdOfValueMobile:"lblPipValue",value:"pipValue"},{id:instrumentInfoProps.pipWorth,available:!0,label:"lblPipWorth",labelMobile:"lblPipWorth",tooltip:"txtPipWorthInfo",attrIdOfValue:"lblPipWorth",attrIdOfValueMobile:"lblPipWorth",value:"pipWorth"},{id:instrumentInfoProps.requiredMargin,available:!0,label:"lblRequiredMargin",labelMobile:"lblRequiredMargin",tooltip:"txtRequiredMarginInfo",attrIdOfValue:"lblRequiredMargin",attrIdOfValueMobile:"lblRequiredMargin",value:"requiredMargin"},{id:instrumentInfoProps.offHoursRequiredMargin,available:!0,label:"lblOffHoursRequiredMargin",labelMobile:"lblOffHoursRequiredMargin",tooltip:"txtOffHoursRequiredMarginInfo",attrIdOfValue:"lblOffHoursRequiredMargin",attrIdOfValueMobile:"lblOffHoursRequiredMargin",value:"offHoursRequiredMargin"},{id:instrumentInfoProps.maximumLeverage,available:!0,label:"lblMaximumLeverage",labelMobile:"lblMaximumLeverage",tooltip:null,attrIdOfValue:"lblMaximumLeverage",attrIdOfValueMobile:"lblMaximumLeverage",value:"maximumLeverage"},{id:instrumentInfoProps.minDealAmount,available:!0,label:"minDealAmountLabel",labelMobile:"minDealAmountLabel",tooltip:"txtMinAmountToTrade",attrIdOfValue:"lblMinAmount",attrIdOfValueMobile:"lblMinAmount",value:"minAmount"},{id:instrumentInfoProps.maxDealAmount,available:!0,label:"maxDealAmountLabel",labelMobile:"maxDealAmountLabel",tooltip:"txtMaxAmountToTrade",attrIdOfValue:"lblMaxAmount",attrIdOfValueMobile:"lblMaxAmount",value:"maxAmount"},{id:instrumentInfoProps.marketPriceTolerance,available:!0,label:"lblMaketPriceTolerance",labelMobile:"lblMraketPriceTolerance",tooltip:"txtMaketPriceToleranceInfo",attrIdOfValue:"lblMaketPriceTolerance",attrIdOfValueMobile:"lblMarketPriceTolerance",value:"marketPriceTolerance"},{id:instrumentInfoProps.ofSell,available:!0,label:"lblOFSell",labelMobile:"lblOFSell",tooltip:"txtShortOvernightFinancingInfo",attrIdOfValue:"lblovernightFinancingShort",attrIdOfValueMobile:"lblovernightFinancingShort",value:"overnightFinancingShort"},{id:instrumentInfoProps.ofBuy,available:!0,label:"lblOFBuy",labelMobile:"lblOFBuy",tooltip:"txtLongOvernightFinancingInfo",attrIdOfValue:"lblovernightFinancingLong",attrIdOfValueMobile:"lblovernightFinancingLong",value:"overnightFinancingLong"},{id:instrumentInfoProps.ofPercentageSell,available:!0,label:"lblOFPercentageSell",labelMobile:"lblOFPercentageSell",tooltip:"txtOvernightFinancingPercent",attrIdOfValue:"lblOFPercentageSell",attrIdOfValueMobile:"lblOFPercentageSell",value:"overnightFinancingPercentageSell"},{id:instrumentInfoProps.ofPercentageBuy,available:!0,label:"lblOFPercentageBuy",labelMobile:"lblOFPercentageBuy",tooltip:"txtOvernightFinancingPercent",attrIdOfValue:"lblOFPercentageBuy",attrIdOfValueMobile:"lblOFPercentageBuy",value:"overnightFinancingPercentageBuy"},{id:instrumentInfoProps.overnightFinancingGMT,available:!0,label:"lblOvernightFinancingGMT",labelMobile:"lblOvernightFinancingGMT",tooltip:null,attrIdOfValue:"lblOFGMT",attrIdOfValueMobile:"lblOvernightFinancingGMT",value:"overnightFinancingTimeGMT"},{id:instrumentInfoProps.rolloverDate,available:!0,label:"lblRolloverDate",labelMobile:"lblRolloverDate",tooltip:null,attrIdOfValue:"lblRolloverDate",attrIdOfValueMobile:"lblRolloverDate",value:"rolloverDate"},{id:instrumentInfoProps.dividendDate,available:!0,label:"lblDividendDate",labelMobile:"lblDividendDate",tooltip:null,attrIdOfValue:"lblDividendDate",attrIdOfValueMobile:"lblDividendDate",value:"dividendDate"},{id:instrumentInfoProps.dividendAmount,available:!0,label:"lblDividendAmount",labelMobile:"lblDividendAmount",tooltip:null,attrIdOfValue:"lblDividendAmount",attrIdOfValueMobile:"lblDividendAmount",value:"dividendAmount"},{id:instrumentInfoProps.weekendFinancing,available:!0,label:"lblWeekendFinancing",labelMobile:"lblWeekendFinancing",tooltip:null,attrIdOfValue:"",attrIdOfValueMobile:"",value:""}];return{GetInfoLines:function(e,t){var a=[];return u=e,c=t,i.forEach(function(e){var t=function(e){var t,a,i=instrumentInfoProps,o="deals_InstrumentInfoTool",n={id:e.id,available:e.available,label:"",labelm:"",value:"",tooltip:e.tooltip?d.GetItem(e.tooltip,o):null,tooltipConfig:{tooltipClass:"tooltip tooltipBottom",position:{my:"center bottom-18",at:"center center"}},attr:(t=e,a={},t.attrIdOfValue&&(a.id=t.attrIdOfValue),t.attrIdOfValueMobile&&(a.idm=t.attrIdOfValueMobile),a)};switch(e.id){case i.pipWorth:n.label=d.GetItem(e.label,o),n.labelm=d.GetItem(e.labelMobile,o),n.value=Format.toNumberWithCurrency(c[e.value](),{currencyId:c.customerSymbolId()});break;case i.offHoursRequiredMargin:n.available=n.available&&c.displayOffHoursRequiredMargin(),n.label=d.GetItem(e.label,o),n.labelm=d.GetItem(e.labelMobile,o),n.value=c[e.value]();break;case i.maxDealAmount:case i.minDealAmount:var r=e.id===i.minDealAmount?Math.ceil:Math.floor;n.label=c[e.label](),n.labelm=c[e.label](),n.value=c.isStock()?formatNumberWithThousandsSeparator(r(toNumeric(c[e.value]()))):c[e.value]();break;case i.ofSell:case i.ofBuy:n.available=n.available&&!c.isStock()&&c.isNotIslamicDealPermit&&u.isOvernightFinancing(),n.label=d.GetItem(e.label,o),n.labelm=d.GetItem(e.labelMobile,o),n.value=Format.toNumberWithCurrency(c[e.value](),{currencyId:c.customerSymbolId()});break;case i.ofPercentageSell:case i.ofPercentageBuy:case i.overnightFinancingGMT:n.available=n.available&&!c.isStock()&&c.isNotIslamicDealPermit&&u.isOvernightFinancing(),n.label=d.GetItem(e.label,o),n.labelm=d.GetItem(e.labelMobile,o),n.value=c[e.value]();break;case i.rolloverDate:n.available=n.available&&u.isFuture&&c.rolloverDate(),n.label=d.GetItem(e.label,o),n.labelm=d.GetItem(e.labelMobile,o),n.value=c[e.value]();break;case i.dividendDate:n.available=n.available&&u.isShare&&c.dividendDate(),n.label=d.GetItem(e.label,o),n.labelm=d.GetItem(e.labelMobile,o),n.value=c[e.value]();break;case i.dividendAmount:n.available=n.available&&u.isShare&&c.dividendDate()&&c.dividendAmount(),n.label=d.GetItem(e.label,o),n.labelm=d.GetItem(e.labelMobile,o),n.value=Format.toNumberWithCurrency(c[e.value](),{currencyId:c.otherInstrumentSymbol()});break;case i.weekendFinancing:if(n.available=n.available&&!c.isStock()&&c.weekendFinancingType()!=eWeekendFinancingTypes.None&&c.isNotIslamicDealPermit,!n.available)return n;var s=c.weekendFinancingType()==eWeekendFinancingTypes.Thursday?"txtThursday":c.weekendFinancingType()==eWeekendFinancingTypes.Friday?"txtFriday":null,l=c.weekendFinancingType()==eWeekendFinancingTypes.Thursday?"lblWeekendFinancingThursday":c.weekendFinancingType()==eWeekendFinancingTypes.Friday?"lblWeekendFinancingFriday":null;l&&(n.attr.dataAutomation=l),n.label=d.GetItem(e.label,o),n.labelm=d.GetItem(e.labelMobile,o),n.value=s?d.GetItem(s,o):"";break;default:n.label=d.GetItem(e.label,o),n.labelm=d.GetItem(e.labelMobile,o),n.value=c[e.value]()}return n}(e);t.available&&a.push(t)}),a}}}),define("viewModels/Deals/ClosedDealsModule",["require","knockout","Customer","closedDealsGridSettings","InstrumentTranslationsManager","SymbolsManager","ViewModelBase","dalClosedDeals","FxNet/LogicLayer/Deal/DealPermissions","InstrumentsManager"],function(e){var u=e("knockout"),c=e("Customer"),t=e("closedDealsGridSettings"),d=e("InstrumentTranslationsManager"),m=e("SymbolsManager"),b=e("ViewModelBase"),p=e("dalClosedDeals"),f=e("FxNet/LogicLayer/Deal/DealPermissions"),g=e("InstrumentsManager");var a=new function(){var t,a=clone(b),i={},o={positionNumber:u.observable(),instrumentId:u.observable(),instrument:u.observable(),from:u.observable(),to:u.observable(),page:u.observable(1),pagesize:40},e={idField:"positionNumber",columns:[{name:"rowNumber",transform:function(e,t){return t}},{name:"positionNumber",dataIndex:eClosedDealsBase.positionNumber},{name:"orderID",dataIndex:eClosedDealsBase.orderID},{name:"instrumentID",dataIndex:eClosedDealsBase.instrumentID},{name:"instrumentName",transform:function(e,t,a,i){var o=i[eClosedDealsBase.instrumentID],n=i[eClosedDealsBase.instrumentEnglishName],r=d.Short(o);return isEmptyValue(r)?n:r}},{name:"specialFontStart",dataIndex:eClosedDealsBase.specialFontStart},{name:"specialFontLength",dataIndex:eClosedDealsBase.specialFontLength},{name:"buyAmount",dataIndex:eClosedDealsBase.buyAmount},{name:"buySymbol",transform:function(e,t,a,i){var o=m.ExtractSymbolsNames(i[eClosedDealsBase.instrumentID]);return o?i[eClosedDealsBase.orderDir]==eOrderDir.Buy?o.base:o.other:""}},{name:"sellAmount",dataIndex:eClosedDealsBase.sellAmount},{name:"sellSymbol",transform:function(e,t,a,i){var o=m.ExtractSymbolsNames(i[eClosedDealsBase.instrumentID]);return o?i[eClosedDealsBase.orderDir]==eOrderDir.Buy?o.other:o.base:""}},{name:"orderDir",dataIndex:eClosedDealsBase.orderDir},{name:"dealAmount",transform:function(e,t,a,i){return i[eClosedDealsBase.orderDir]==eOrderDir.Sell?i[eClosedDealsBase.sellAmount]:i[eClosedDealsBase.buyAmount]}},{name:"dealType",dataIndex:eClosedDealsBase.dealType},{name:"valueDate",dataIndex:eClosedDealsBase.valueDate},{name:"positionStart",dataIndex:eClosedDealsSummaries.positionStart},{name:"positionStartFormatted",dataIndex:eClosedDealsSummaries.positionStart,transform:function(e){return l(e)}},{name:"positionStartNormalized",dataIndex:eClosedDealsSummaries.positionStart,transform:function(e){return s(e)}},{name:"executionTime",dataIndex:eClosedDealsBase.executionTime},{name:"executionTimeFormatted",dataIndex:eClosedDealsBase.executionTime,transform:function(e){return l(e)}},{name:"executionTimeNormalized",dataIndex:eClosedDealsBase.executionTime,transform:function(e){return s(e)}},{name:"forwardPips",dataIndex:eClosedDealsBase.forwardPips},{name:"originalPosNum",dataIndex:eClosedDealsSummaries.originalPosNum},{name:"orderRateOpen",dataIndex:eClosedDealsSummaries.orderRateOpen,transform:function(e,t,a,i){var o=i[eClosedDealsBase.instrumentID],n=i[eClosedDealsBase.decimalDigit];return Format.toRate(e,!0,o,n)}},{name:"orderRateOpenNumeric",dataIndex:eClosedDealsSummaries.orderRateOpen,transform:function(e){return toNumeric(e)}},{name:"orderRateClosed",dataIndex:eClosedDealsSummaries.orderRateClosed,transform:function(e,t,a,i){var o=i[eClosedDealsBase.instrumentID],n=i[eClosedDealsBase.decimalDigit];return Format.toRate(e,!0,o,n)}},{name:"orderRateClosedNumeric",dataIndex:eClosedDealsSummaries.orderRateClosed,transform:function(e){return toNumeric(e)}},{name:"pl",dataIndex:eClosedDealsSummaries.pl},{name:"plAsNumber",dataIndex:eClosedDealsSummaries.pl,transform:function(e){return toNumeric(e)}},{name:"plCCY",dataIndex:eClosedDealsSummaries.plCCY},{name:"plCCYAsNumber",dataIndex:eClosedDealsSummaries.plCCY,transform:function(e){return toNumeric(e)}},{name:"plSymbol",transform:function(e,t,a,i){var o=m.ExtractSymbolsNames(i[eClosedDealsBase.instrumentID]);return o?o.other:""}},{name:"hasAdditionalPL",transform:function(e,t,a,i){return 0!==Number(i[eClosedDealsSummaries.additionalPL])}},{name:"plSign",dataIndex:eClosedDealsSummaries.pl,transform:function(e){return e.sign()}},{name:"adj",dataIndex:eClosedDealsSummaries.originalPosNum,transform:function(e,t,a,i){return c.prop.dealPermit!=eDealPermit.Islamic&&(!i[eClosedDealsBase.valueDate]||isPos(e))}},{name:"instrumentShortName",transform:function(e,t,a,i){return d.Short(i[eClosedDealsBase.instrumentID])}},{name:"spreadDiscount",dataIndex:eClosedDealsSummaries.spreadDiscount},{name:"commission",dataIndex:eClosedDealsSummaries.commission},{name:"grossPL",transform:function(e,t,a,i){return f.CustomerDealPermit()===eDealPermit.ZeroSpread?(toNumeric(i[eClosedDealsSummaries.pl])+toNumeric(i[eClosedDealsSummaries.commission])).toFixed(2).toString():f.HasSpreadDiscount()?(toNumeric(i[eClosedDealsSummaries.pl])-toNumeric(i[eClosedDealsSummaries.spreadDiscount])).toFixed(2).toString():i[eClosedDealsSummaries.pl]}},{name:"isStock",transform:function(e,t,a,i){var o=i[eClosedDealsBase.instrumentID];return g.IsInstrumentStock(o)}}],statusField:"status",totalField:"totalItems",dataField:"closedDealSummary",pagination:{pagesPerPage:5,pageIndexField:"page",pageSizeField:"pagesize"},Filter:o,DAL:{reference:p.LoadClosedDealsSummariesWithThreshold,callerName:"ClosedDealsViewModel/getLastClosedDeals",errorSeverity:eErrorSeverity.medium}},n=new ObservableDataSet(e,{enabled:!0,sortProperty:"executionTimeNormalized",asc:!1});function r(){o.positionNumber(""),o.instrumentId(Number.MAX_SAFE_INTEGER),o.instrument(),o.from((new Date).AddWeeks(-1).ExtractDateUTC()),o.to((new Date).ExtractDateUTC()),o.page(1),o.pagesize=a.getSettings(t).pageSize||o.pagesize,a.getSettings(t).threshold&&(o.threshold=a.getSettings(t).threshold)}function s(e){var t=e.split(" "),a=t[0].split("/");return t[0]=a[2]+a[1]+a[0],t.join("").replace(/[/\|:| ]/g,"")}function l(e){var t=SplitDateTime(e);return t.date+" "+t.time}return{init:function(e){t=this,a.setSettings(t,e),i.isOpenedInDialog=u.observable(!1),i.ccyPairs=u.observableArray([]),i.isApplyButtonEnabled=u.computed(function(){return!n.IsLoadingData()},t),o.positionNumber=o.positionNumber.extend({toNumericLength:{ranges:[{from:0,to:Number.MAX_SAFE_INTEGER,decimalDigits:0}]}}),r(),n.Init()},DataSet:n,HasRecords:n.HasRecords,ViewData:i,ClosedDeals:n.DataRows,Filter:{Position:o.positionNumber,InstrumentId:o.instrumentId,Instrument:o.instrument,From:o.from,To:o.to},ApplyFilter:function(e){i.isApplyButtonEnabled()&&(e&&r(),n.ApplyFilter())},DsColumns:e,SetSorting:n.SetSorting,SortProperties:n.SortProperties,DealPermissions:f}};return a.init(t),a}),define("viewModels/Deals/CloseDealBaseViewModel",["require","knockout","KoComponentViewModel","closeDealSettings","DealsManager","ViewModelsManager","FxNet/LogicLayer/Deal/DealAmountLabel","BaseOrder","QuotesSubscriber","InstrumentsManager","InstrumentTranslationsManager","StatesManager","Customer","CustomerProfileManager","QuotesManager","StateObject!Transaction","BuilderForInBetweenQuote","FxNet/LogicLayer/Deal/DealPermissions"],function(e){var p=e("knockout"),t=e("KoComponentViewModel"),f=e("closeDealSettings"),g=e("DealsManager"),v=e("ViewModelsManager"),D=e("FxNet/LogicLayer/Deal/DealAmountLabel"),S=e("BaseOrder"),y=e("QuotesSubscriber"),T=e("InstrumentsManager"),C=e("InstrumentTranslationsManager"),h=e("StatesManager"),w=e("Customer"),L=e("CustomerProfileManager"),A=e("QuotesManager"),I=e("StateObject!Transaction"),M=e("BuilderForInBetweenQuote"),P=e("FxNet/LogicLayer/Deal/DealPermissions");return extendClass(t,function(){var a=this,i=this.parent,o=this.Data,n=new S,r=new y,s=new ObservableHashTable("orderID",{enabled:!0,sortProperty:"orderID",asc:!1});function l(){var e=A.Quotes.GetItem(o.selectedInstrument());e&&(o.changePips(e.changePips),o.tradeTime(e.tradeTime),o.close(e.close),o.open(e.open),o.change(Format.toPercent(e.change)),o.highBid(e.highBid),o.lowAsk(e.lowAsk),o.bid(e.bid),o.ask(e.ask),o.quoteIsActive(e.state!==eQuoteStates.NotActive))}function u(e){e&&(function(e){for(var t=0;t<e.length;t++)s.Remove(e[t])}(e.removedItems),function(e){for(var t=0,a=e.length;t<a;t++){var i=m(g.Deals.GetItem(e[t]));i&&s.Update(i.orderID,i)}}(e.editedItems),function(e){for(var t=0,a=e.length;t<a;t++){var i=m(g.Deals.GetItem(e[t]));i&&s.Add(i)}}(e.newItems))}function c(e){var t=P.HasSpreadDiscount()?-toNumeric(e.spreadDiscount):P.CustomerDealPermit()===eDealPermit.ZeroSpread?toNumeric(e.commission):0;return(toNumeric(e.pl)+t).toFixed(2)}function d(e){for(var t=0,a=e.length;t<a;t++){var i=s.Get(e[t]);if(i){var o=g.Deals.GetItem(e[t]);if(o){var n={prevSpotRate:i.spotRate(),spotRate:o.spotRate,spotRateLabel:b(o.spotRate,o.instrumentID),closingRateLabel:b(o.closingRate,o.instrumentID),fwPips:o.fwPips,closingRate:o.closingRate,pl:o.pl,lastUpdate:r.GetQuote(o.instrumentID).time(),commission:o.commission,grosspl:c(o)};s.Update(e[t],n)}}}}function m(e){var t=T.GetInstrument(e.instrumentID),a={positionNumber:e.positionNumber,instrumentID:e.instrumentID||0,orderDir:e.orderDir,dealAmount:e.orderDir==eOrderDir.Sell?e.sellAmount:e.buyAmount,orderID:e.orderID,prevSpotRate:p.observable(e.spotRate),spotRate:p.observable(e.spotRate),closingRate:p.observable(e.closingRate),fwPips:p.observable(e.fwPips),exeTime:p.observable(e.exeTime),valueDate:p.observable(function(e){var t=T.GetInstrument(e.instrumentID);if(t.isShare){var a=t.getCorporateActionDate();if(a)return e.valueDate?{isValueDateEmpty:!1,date:str2Date(e.valueDate,"d/m/y H:M")<str2Date(a,"d/m/y H:M")?e.valueDate:a}:{isValueDateEmpty:!0,date:a}}return e.valueDate?{isValueDateEmpty:!1,date:e.valueDate}:{isValueDateEmpty:!0,date:null}}(e)),pl:p.observable(e.pl),dealRate:e.orderRate,dealRateLabel:b(e.orderRate,e.instrumentID),spotRateLabel:p.observable(b(e.spotRate,e.instrumentID)),closingRateLabel:p.observable(b(e.closingRate,e.instrumentID)),slRate:e.slRate,tpRate:e.tpRate,slRateLabel:b(e.slRate,e.instrumentID),tpRateLabel:b(e.tpRate,e.instrumentID),Instrument:{ccyPairLong:C.Long(e.instrumentID),ccyPair:t.ccyPair,baseSymbol:C.GetTranslatedInstrumentById(e.instrumentID).baseSymbolName,dealAmountLbl:D.Translate(t).label,amountSymbol:t.otherSymbol,isFuture:t.isFuture,isShare:t.isShare,isStock:t.isStock,baseSymbolId:t.baseSymbol,otherSymbolId:t.otherSymbol}};return a.commission=p.observable(isStringType(e.commission)?e.commission:Number.toStr(e.commission)),a.spreadDiscount=p.observable(isStringType(e.spreadDiscount)?e.spreadDiscount:Number.toStr(e.spreadDiscount)),a.grosspl=p.observable(c(e)),a.hasAdditionalPL=p.observable(0!==Number(e.additionalPL)),a.adj=p.computed(function(){return w.prop.dealPermit!=eDealPermit.Islamic&&(0===e.valueDate.length||e.positionNumber!=e.orderID)}),a.isProfit=p.computed(function(){return 0<=toNumeric(this.pl())},a),a.isLoss=p.computed(function(){return toNumeric(this.pl())<0},a),a.isUp=p.computed(function(){return this.spotRate()>this.prevSpotRate()},a),a.isDown=p.computed(function(){return this.spotRate()<this.prevSpotRate()},a),a}function b(e,t){var a={First:0,Middle:0,Last:0},i=Format.tenthOfPipSplitRate(e,t);return a.First=i.button.first,a.Middle=i.button.middle,a.Last=i.button.last,a}return{init:function(e){var t;i.init.call(a,e),n.Init({},o),o.PageName=eDealPage.CloseDeal,o.orderID=p.observable(""),o.selectedInstrument=I.set("selectedInstrument",p.observable("")),o.ccyPairLong=p.observable(""),o.orderDir=I.set("orderDir",p.observable(eOrderDir.None)),o.ccyPair=I.set("ccyPair",p.observable("")),o.customerSymbolName=I.set("customerSymbolName",p.observable("")),o.customerSymbolId=p.observable(w.prop.baseCcyId()),o.selectedCcyId=p.observable(w.prop.selectedCcyId()),o.changePips=p.observable(""),o.selectedDealAmount=I.set("selectedDealAmount",p.observable("")),o.quoteForOtherCcyToAccountCcy=I.set("quoteForOtherCcyToAccountCcy",p.observable("")),o.amountSymbol=I.set("amountSymbol",p.observable("")),o.baseSymbol=I.set("baseSymbol",p.observable("")),o.bidPips=p.observable(""),o.askPips=p.observable(""),o.isFuture=I.set("isFuture",p.observable("")),o.isShare=I.set("isShare",p.observable("")),o.change=I.set("change",p.observable("")),o.tradeTime=I.set("tradeTime",p.observable("")),o.open=I.set("open",p.observable("")),o.close=I.set("close",p.observable("")),o.highBid=I.set("highBid",p.observable("")),o.lowAsk=I.set("lowAsk",p.observable("")),o.isProcessing=p.observable(!1),o.isCollapsed=p.observable(!1),o.SelectedPosition=p.observable(""),o.profileKeyForDefaultTab=p.observable(f.profileKeyForDefaultTab),o.initialToolTab=I.set("initialToolTab",p.observable("")),o.selectedCcyName=p.observable(w.prop.selectedCcyName()),o.bid=I.set("bid",p.observable("")),o.ask=I.set("ask",p.observable("")),o.slRate=p.observable("").extend({dirty:!1}),o.tpRate=p.observable("").extend({dirty:!1}),o.quoteIsActive=I.set("isActiveQuote",p.observable(!1)),o.customerSymbolName(w.prop.baseCcyName()),o.initialToolTab(L.ProfileCustomer()[f.profileKeyForDefaultTab]||eNewDealTool.Chart),o.HasPosition=a.createComputed(function(){var e=p.utils.unwrapObservable(o.SelectedPosition);return!isEmptyValue(e)}),o.CloseDealReady=a.createComputed(function(){var e=!o.isProcessing(),t=!!isDefinedType(h.States.IsMarketClosed())&&h.States.IsMarketClosed(),a=o.quoteIsActive()&&!t&&e&&o.HasPosition();return a}),a.subscribeTo(o.SelectedPosition,function(e){e&&(o.selectedInstrument(e.instrumentID),o.ccyPairLong(e.Instrument.ccyPairLong),o.ccyPair(e.Instrument.ccyPair),o.selectedDealAmount(e.dealAmount),o.amountSymbol(e.Instrument.amountSymbol),o.baseSymbol(e.Instrument.baseSymbolId),o.isFuture(e.Instrument.isFuture),o.isShare(e.Instrument.isShare),o.orderDir(e.orderDir),o.slRate(e.slRate),o.tpRate(e.tpRate),l())}),a.subscribeTo(o.selectedInstrument,function(e){var t=T.GetInstrument(e);t&&M.GetInBetweenQuote(t.otherSymbol,w.prop.baseCcyId()).then(function(e){o.quoteForOtherCcyToAccountCcy(e)}).done()}),g.OnDealsChange.Add(u),g.OnDealsPLChange.Add(d),A.OnChange.Add(l),o.isProcessing(!1),o.SelectedPosition(""),g.Deals.ForEach(function(e,t){var a=m(t);s.Add(a)}),(t=v.VManager.GetViewArgsByKeyName(eViewTypes.vCloseDeal,"orderId"))&&(o.SelectedPosition(s.Get(t)),o.orderID(t)),I.update("stopLossRate",p.observable(o.SelectedPosition().slRate)),I.update("takeProfitRate",p.observable(o.SelectedPosition().tpRate)),I.update("dealRate",o.SelectedPosition().dealRate),I.update("chart",f.chart),I.update("currentRateDirectionSwitch",f.currentRateDirectionSwitch),r.Start()},Data:o,ChangeSelectedPosition:function(){o.SelectedPosition(s.Values()[0])},OpenDeals:s.Values,BaseOrder:n,DealPermissions:P,dispose:function(){I.unset("stopLossRate"),I.unset("takeProfitRate"),I.unset("dealRate"),I.unset("chart"),g.OnDealsPLChange.Remove(d),g.OnDealsChange.Remove(u),A.OnChange.Remove(l),s.Clear(),r.Stop(),I.unset("cachedOvernightFinancing"),I.unset("currentRateDirectionSwitch"),i.dispose.call(a)}}})}),define("viewModels/Deals/DealBaseViewModel",["require","knockout","KoComponentViewModel","newDealSettings","Customer","BaseOrder","SetLimitsViewModel","dalOrders","RegistrationManager","QuotesManager","InstrumentsManager","CustomerProfileManager","ViewsManager","FxNet/LogicLayer/Deal/DealAmountLabel","SymbolsManager","DealTypeManager","StateObject!Transaction","BuilderForInBetweenQuote","PortfolioStaticManager","AlertsManager"],function(e){var f=e("knockout"),t=e("KoComponentViewModel"),g=e("newDealSettings"),v=e("Customer"),D=e("BaseOrder"),S=e("SetLimitsViewModel"),y=e("dalOrders"),T=e("RegistrationManager"),C=e("QuotesManager"),h=e("InstrumentsManager"),w=e("CustomerProfileManager"),L=e("ViewsManager"),A=e("FxNet/LogicLayer/Deal/DealAmountLabel"),I=e("SymbolsManager"),M=e("DealTypeManager"),P=e("StateObject!Transaction"),R=e("BuilderForInBetweenQuote"),V=e("PortfolioStaticManager"),k=e("AlertsManager");return extendClass(t,function(){var s=this,r=this.parent,l=this.Data,u=new D,c=47,d=new S;function m(){var e=L.GetActiveFormViewProperties(eViewTypes.vTransactionSwitcher);return!(!e||!e.visible())&&(e.args||{})}function b(e){e!=eOrderDir.Buy&&e!=eOrderDir.Sell&&e!=eOrderDir.None&&(e=eOrderDir.None),l.orderDir(e)}function e(){C.OnChange.Remove(p),V.OnChange.Remove(t)}function t(){l.pendingBonusType(V.Portfolio.pendingBonusType)}function p(){l.activeQuote=C.Quotes.GetItem(l.selectedInstrument()),l.activeQuote&&(l.isActiveQuote(l.activeQuote.state!=eQuoteStates.NotActive),l.bid(l.activeQuote.bid),l.ask(l.activeQuote.ask),l.open(l.activeQuote.open),l.close(l.activeQuote.close),l.change(Format.toPercent(l.activeQuote.change)),l.formattedChange(Format.toSignedPercent(l.activeQuote.change,"")),l.changePips(l.activeQuote.changePips),l.highBid(l.activeQuote.highBid),l.lowAsk(l.activeQuote.lowAsk),l.tradeTime(l.activeQuote.tradeTime),l.activeQuoteState(l.activeQuote.state),l.quotesAvailable(!0))}function a(){var e=new TDeal;if(e.dealType=M.GetStatus(),e.instrumentID=l.selectedInstrument(),e.amount=l.selectedDealAmount(),e.marketRate=l.orderDir()===eOrderDir.Sell?l.activeQuote.bid:l.activeQuote.ask,e.otherRateSeen=l.orderDir()===eOrderDir.Sell?l.activeQuote.ask:l.activeQuote.bid,e.orderDir=l.orderDir(),e.slRate=0,e.tpRate=0,l.enableSLLimit()){if(""===d.Data.stopLossRate())return n();e.slRate=d.Data.stopLossRate()}if(l.enableTPLimit()){if(""===d.Data.takeProfitRate())return n();e.tpRate=d.Data.takeProfitRate()}l.hasInstrument(!1),l.isProcessing(!0),y.OpenDeal(e,i)}function i(e,t,a,i){l.hasInstrument(!0),l.isProcessing(!1);var o,n=h.GetInstrument(a),r=s.getSettings().onSuccessRedirectTo;n&&(u.ResultStatusSuccess(e)&&(h.SetInstrumentDealAmount(a,i.amount),f.postbox.publish("deal-slip-success",{instrument:l.ccyPair()}),(o=w.ProfileCustomer()).defaultSlLimitTab=d.Data.curSlActiveTab(),o.defaultTpLimitTab=d.Data.curTpActiveTab(),w.ProfileCustomer(o),d.Data.stopLossRate(String.empty),d.Data.takeProfitRate(String.empty),l.enableSLLimit(!1),l.enableTPLimit(!1),b(eOrderDir.None)),r?u.OnActionReturn(e,t,n,{redirectToView:r,requestData:i}):u.OnActionReturn(e,t,n,{requestData:i}),u.RaiseErrorEvent(e,"deal-slip-error-details",{}))}function o(){l.enableSLLimit(!1),l.enableTPLimit(!1),a()}function n(){k.UpdateAlert(AlertTypes.GeneralOkAlert,Dictionary.GetItem("pleaseNoteTitle"),Dictionary.GetItem("sltpValidationMsg","deals_NewDeal"),null,{okButtonCallback:o}),k.PopAlert(AlertTypes.GeneralOkAlert)}return{init:function(e){r.init.call(s,e),u.Init({},l),l.PageName=eDealPage.NewDeal,l.ready=f.observable(!1),l.customerSymbolName=P.set("customerSymbolName",f.observable(v.prop.baseCcyName())),l.customerSymbolId=P.set("customerSymbolId",f.observable(v.prop.baseCcyId())),l.orderDir=P.set("orderDir",f.observable(eOrderDir.None).extend({dirty:!1})),l.selectedInstrument=P.set("selectedInstrument",f.observable()),l.selectedDealAmount=P.set("selectedDealAmount",f.observable()),l.selectedDealAmount.extend({notify:"always"}),l.selectedDealAmount.extend({amountValidation:[]}),l.amountSymbol=P.set("amountSymbol",f.observable("")),l.quoteForOtherCcyToAccountCcy=P.get("quoteForOtherCcyToAccountCcy"),l.quoteForBaseCcyToAccountCcy=P.get("quoteForBaseCcyToAccountCcy"),l.quoteForUsdCcyToAccountCcy=P.get("quoteForUsdCcyToAccountCcy"),l.bid=P.set("bid",f.observable("")),l.ask=P.set("ask",f.observable("")),l.initialToolTab=P.set("initialToolTab",f.observable("")),l.showTools=P.set("showTools",f.observable(!0)),l.bidPips=P.set("bidPips",f.observable("")),l.askPips=P.set("askPips",f.observable("")),l.changePips=P.set("changePips",f.observable("")),l.tradeTime=P.set("tradeTime",f.observable("")),l.highBid=P.set("highBid",f.observable("")),l.lowAsk=P.set("lowAsk",f.observable("")),l.open=P.set("open",f.observable("")),l.close=P.set("close",f.observable("")),l.change=P.set("change",f.observable("")),l.isForex=P.set("isForex",f.observable(!1)),l.isFuture=P.set("isFuture",f.observable(!1)),l.isShare=P.set("isShare",f.observable(!1)),l.isStock=P.set("isStock",f.observable(!1)),l.isNonForex=f.observable(!0),l.hasInstrument=f.observable(!1),l.baseSymbolName=f.observable(""),l.otherSymbolName=f.observable(""),l.dealAmountLabel=f.observable(""),l.dealMinMaxAmounts=f.observableArray([]),l.originalSymbolName=f.observable(""),l.baseSymbol=f.observable(""),l.ccyPair=P.set("ccyPair",f.observable("")),l.quotesAvailable=f.observable(!1),l.isProcessing=f.observable(!1),l.limitsReady=f.observable(!1),l.activeQuote=null,l.isActiveQuote=P.set("isActiveQuote",f.observable(!1)),l.activeQuoteState=f.observable(),l.formattedChange=f.observable(""),l.bid10K=f.observable(""),l.bid100K=f.observable(""),l.ask10K=f.observable(""),l.ask100K=f.observable(""),l.bidLabel={First:f.observable(""),Middle:f.observable(""),Last:f.observable("")},l.askLabel={First:f.observable(""),Middle:f.observable(""),Last:f.observable("")},l.profileKeyForDefaultTab=P.set("profileKeyForDefaultTab",f.observable(g.profileKeyForDefaultTab)),l.enableSLLimit=f.observable(!1),l.enableTPLimit=f.observable(!1),l.isSlRateActiveTab=f.observable(!1),l.isSlAmountActiveTab=f.observable(!1),l.isSlPercentActiveTab=f.observable(!1),l.isTpRateActiveTab=f.observable(!1),l.isTpAmountActiveTab=f.observable(!1),l.isTpPercentActiveTab=f.observable(!1),l.displaySlPercentSymbol=f.observable(!1),l.displayTpPercentSymbol=f.observable(!1),l.displaySlAmountCcySymbol=f.observable(!1),l.displayTpAmountCcySymbol=f.observable(!1),l.quoteForAccountCcyToUSDCcy=f.observable(""),l.quoteForBaseCcyToUSDCcy=f.observable(""),l.quoteForAccountCcyToOtherCcy=f.observable(""),l.buyBtnClick=function(){b(eOrderDir.Buy)},l.sellBtnClick=function(){b(eOrderDir.Sell)},s.subscribeAndNotify(l.ask,function(e){var t=Format.tenthOfPipSplitRate(e,l.selectedInstrument());l.askLabel.First(t.button.first),l.askLabel.Middle(t.button.middle),l.askLabel.Last(t.button.last)}),s.subscribeAndNotify(l.bid,function(e){var t=Format.tenthOfPipSplitRate(e,l.selectedInstrument());l.bidLabel.First(t.button.first),l.bidLabel.Middle(t.button.middle),l.bidLabel.Last(t.button.last)}),s.subscribeChanged(l.selectedInstrument,function(e,t){t&&e!==t&&(l.selectedDealAmount(""),P.containsKey("skipReset")&&P.get("skipReset")||l.orderDir(eOrderDir.None))}),s.subscribeTo(l.baseSymbol,function(e){var t;t=e,R.GetInBetweenQuote(v.prop.baseCcyId(),c).then(function(e){l.quoteForAccountCcyToUSDCcy(e)}).done(),R.GetInBetweenQuote(t,c).then(function(e){l.quoteForBaseCcyToUSDCcy(e)}).done()}),s.subscribeTo(l.selectedInstrument,function(e){var t,a,i,s=h.GetInstrument(e);if(s){l.quotesAvailable(!1),l.dealMinMaxAmounts([]),P.containsKey("skipReset")&&P.get("skipReset")||(l.enableSLLimit(!1),l.enableTPLimit(!1)),h.GetUpdatedInstrumentWithDealMinMaxAmounts(e).then(function(e){var t,a,i,o,n=s.isStock&&e.dealMinMaxAmounts&&1<e.dealMinMaxAmounts.length?(o=e.dealMinMaxAmounts,[Math.ceil(o[0]),Math.floor(o[1])]):e.dealMinMaxAmounts,r=s.isStock&&n&&1<n.length?(t=e.defaultDealSize,a=n,(i=Math.ceil(t))<a[1]?i:Math.floor(t)):e.defaultDealSize;l.dealMinMaxAmounts(n),l.selectedDealAmount.extend({amountValidation:n}),l.selectedDealAmount(l.selectedDealAmount()||r)}).done(),l.amountSymbol(s.otherSymbol),l.baseSymbolName(I.GetTranslatedSymbolById(s.baseSymbol)),l.otherSymbolName(I.GetTranslatedSymbolById(s.otherSymbol)),l.originalSymbolName(s.baseSymbolName),l.baseSymbol(s.baseSymbol),l.ccyPair(s.ccyPair),l.isNonForex(s.instrumentTypeId!==eInstrumentType.Currencies),l.isForex(s.isForex),l.isShare(s.isShare),l.isFuture(s.isFuture),l.isStock(s.isStock),i=e,T.Update(eRegistrationListName.SingleQuote,i);var o=A.Translate(s);l.dealAmountLabel(o.label),M.Init(),s.isFuture?M.ConsumeEvent("future"):s.isShare?M.ConsumeEvent("share"):M.ConsumeEvent(),l.pendingBonusType=f.observable(V.Portfolio.pendingBonusType),l.spreadDiscount=f.observable(V.Portfolio.spreadDiscountVolumePercentage),p(),R.GetInBetweenQuote(v.prop.baseCcyId(),s.otherSymbol).then(function(e){l.quoteForAccountCcyToOtherCcy(e)}).done(),l.hasInstrument(!0),t=e,a=m(),isNullOrUndefined(a)||!1===a||(a.instrumentId=t,L.ChangeViewState(eViewTypes.vTransactionSwitcher,eViewState.Update,a))}else l.hasInstrument(!1)}),l.isShowBuyBox=s.createComputed(function(){return l.orderDir()===eOrderDir.Buy}),l.isShowSellBox=s.createComputed(function(){return l.orderDir()===eOrderDir.Sell}),l.ViewModelReady=s.createComputed(function(){if(l.ready())return!0;var e=l.hasInstrument(),t=l.limitsReady(),a=e&&t;return l.ready(a),a}),l.isUp=f.pureComputed(function(){return l.activeQuoteState()===eQuoteStates.Up}),l.isDown=f.pureComputed(function(){return l.activeQuoteState()===eQuoteStates.Down});var t=s.getSettings().setlimitsConfiguration;d.Init(l,t),a=m()||{},i=a.tab,o=l.selectedInstrument(),n=a.instrumentId||l.selectedInstrument()||h.GetUserDefaultInstrumentId(),l.selectedInstrument(n),o===n&&l.selectedInstrument.notifySubscribers(n),isInt(a.orderDir)&&b(a.orderDir),a.selectedDealAmount&&l.selectedDealAmount(a.selectedDealAmount),l.initialToolTab(isDefinedType(i)&&isDefinedType(eNewDealTool[i])?eNewDealTool[i]:w.ProfileCustomer()[g.profileKeyForDefaultTab]||eNewDealTool.Chart);var a,i,o,n},dispose:function(){e(),l.selectedDealAmount.extend({amountValidation:!1}),P.unset("cachedOvernightFinancing"),r.dispose.call(s)},Data:l,BaseOrder:u,SetLimitsModel:d,openDeal:a,unRegisterFromDispatcher:e,registerToDispatcher:function(){C.OnChange.Add(p),V.OnChange.Add(t)},setLimitTabsFromClientProfile:function(){var e=w.ProfileCustomer();e.defaultSlLimitTab?d.SetSlActiveTab(e.defaultSlLimitTab):d.SetSlActiveTab(eSetLimitsTabs.Amount),e.defaultTpLimitTab?d.SetTpActiveTab(e.defaultTpLimitTab):d.SetTpActiveTab(eSetLimitsTabs.Amount)}}})}),define("viewModels/Deals/ConvertedAmountViewModel",["require","knockout","KoComponentViewModel","FxNet/LogicLayer/Deal/DealMarginCalculator","Customer"],function(e){var s=e("knockout"),t=e("KoComponentViewModel"),l=e("FxNet/LogicLayer/Deal/DealMarginCalculator"),u=e("Customer"),a=extendClass(t,function(e){var t=this,a=this.parent,i=this.Data,o=e||{},n=function(){var e=s.utils.unwrapObservable(o.customerSymbolName);i.currencySymbol=s.observable(e),i.customerSymbolId=s.observable(u.prop.baseCcyId())},r=function(){i.convertedDealAmount=t.createComputed(function(){var e={dealAmount:toNumeric(o.selectedDealAmount()),dealRate:toNumeric(o.orderDir()==eOrderDir.Sell?o.bid():o.ask()),quoteForOtherCcyToAccountCcy:o.quoteForOtherCcyToAccountCcy(),otherSymbol:o.amountSymbol(),baseSymbol:o.hasOwnProperty("baseSymbol")?o.baseSymbol():o.baseSymbolId()};return l.DealAmount(e)}).extend({empty:!0}),i.isCompleted=t.createComputed(function(){return!i.convertedDealAmount.isEmpty()}),i.isBaseEqualWithCustomerCcy=t.createComputed(function(){return o.hasOwnProperty("baseSymbol")?o.baseSymbol()===u.prop.baseCcyId():o.baseSymbolId()===u.prop.baseCcyId()})};return{init:function(e){a.init.call(t,e),n(),r()},dispose:function(){a.dispose.call(t)}}});return{viewModel:{createViewModel:function(e){var t=new a(e);return t.init(),t}}}}),define("viewModels/Deals/DealMarginViewModel",["require","knockout","KoComponentViewModel","FxNet/LogicLayer/Deal/DealMarginCalculator","InstrumentVolumeManager","dalOrders","ClientStateHolderManager","Customer","PortfolioStaticManager","LoadDictionaryContent!deals_RequireMargin"],function(e){var l=e("knockout"),t=e("KoComponentViewModel"),p=e("FxNet/LogicLayer/Deal/DealMarginCalculator"),f=e("InstrumentVolumeManager"),u=e("dalOrders"),c=e("ClientStateHolderManager"),d=e("Customer"),g=e("PortfolioStaticManager"),a=extendClass(t,function(e,t){var a=this,i=this.parent,m=this.Data,b=e||{},o=function(){m.triggerDealMarginCalculation=l.observable().extend({notify:"always"}),m.requiredMarginPercentage=l.observable(""),m.displayDealMargin=l.observable(""),m.prevInstrumentId=l.observable("");var e=l.utils.unwrapObservable(b.customerSymbolName);m.currencySymbol=l.observable(e),m.customerSymbolId=l.observable(d.prop.baseCcyId()),m.isDealMarginHigher=l.observable(!1),m.spreadWorth=l.observable(),m.availableMargin=l.observable()},n=function(){m.dealMargin=a.createComputed(function(){var e,t=0,a=0,i=b.selectedInstrument(),o=f.InstrumentVolumes.GetItem(i),n=b.orderDir(),r=b.openLimit&&b.openLimit(),s=!1;o&&(t=o.OtherSymbolAmount,a=o.BaseSymbolAmount,s=!0),s||n!=eOrderDir.None||(n=eOrderDir.Buy),e=r?b.openLimit()<b.bid()?Format.toMidRate(b.bid(),b.ask()):b.openLimit():n==eOrderDir.Sell?b.bid():b.ask();var l={orderDir:n,dealAmount:toNumeric(b.selectedDealAmount()),dealRate:toNumeric(e),ask:toNumeric(b.ask()),bid:toNumeric(b.bid()),quoteForBaseCcyToAccountCcy:b.quoteForBaseCcyToAccountCcy(),quoteForOtherCcyToAccountCcy:b.quoteForOtherCcyToAccountCcy(),otherSymbol:b.amountSymbol(),baseSymbol:b.baseSymbol(),hasPosition:s,otherSymbolAmount:t,baseSymbolAmount:a,requiredMarginPercentage:s?toNumeric(m.requiredMarginPercentage())/100:toNumeric(m.requiredMarginPercentage())};m.triggerDealMarginCalculation();var u=p.SpreadWorthInAcountCCY(l);m.spreadWorth(u);var c=p.DealMargin(l),d=Math.round(100*(c+u))/100;return d=Math.abs(d),m.displayDealMargin(d),c}).extend({empty:!0}),m.isDealMarginPositive=a.createComputed(function(){var e=toNumeric(m.dealMargin()),t=b&&b.isStock&&b.isStock()?toNumeric(g.Portfolio.tradingBonus):0;return 0<e||e<=0&&Math.abs(e)<m.spreadWorth()?(m.displayDealMargin()>=m.availableMargin()-t?m.isDealMarginHigher(!0):m.isDealMarginHigher(!1),!0):(m.isDealMarginHigher(!1),!1)}),m.isCompleted=a.createComputed(function(){return!m.dealMargin.isEmpty()&&!isNaN(m.dealMargin())}),m.selectedInstrumentId=a.createComputed(function(){return b.selectedInstrument()}),m.isBaseEqualWithCustomerCcy=a.createComputed(function(){return b.baseSymbol()===d.prop.baseCcyId()})},r=function(){a.subscribeAndNotify(m.selectedInstrumentId,function(e){var t=f.InstrumentVolumes.GetItem(e);t?m.requiredMarginPercentage(t.RequiredMarginPercentage):m.prevInstrumentId()!=e&&u.GetDealMarginDetails(b.selectedInstrument()).then(function(e){m.requiredMarginPercentage(e[0].Result.MarginPercentage)}).done(),m.prevInstrumentId(e)}),a.addDisposable(l.postbox.subscribe("deal-slip-error-details",function(e){"OrderError12"==e.reason&&m.triggerDealMarginCalculation(!0)}))};function s(){var e=c.CSHolder,t=toNumeric(e.availableMargin);if(d.prop.baseCcyId()==d.prop.selectedCcyId())m.availableMargin(t);else{var a=p.Convert(t,b.quoteForUsdCcyToAccountCcy());m.availableMargin(a)}}return{init:function(e){i.init.call(a,e),o(),n(),r(),c.OnChange.Add(s),s()},content:t,dispose:function(){c.OnChange.Remove(s),i.dispose.call(a)}}});return{viewModel:{createViewModel:function(e){var t=new a(e.data,e.content);return t.init(),t}}}}),define("viewModels/Deals/DealToolsBaseViewModel",["require","knockout","KoComponentViewModel","CustomerProfileManager","StateObject!Transaction"],function(e){var u=e("knockout"),t=e("KoComponentViewModel"),c=e("CustomerProfileManager"),d=e("StateObject!Transaction"),a=extendClass(t,function(){var a,i=this,e=this.parent,o=this.Data,n={},r={},s=[];function l(e){var t;r=extendType(r,d.getAll()),(t=r).orderDir=r.orderDir||t.orderDir,function(e){var t=c.ProfileCustomer();t?(a=t.defaultTab,o.showTools(1===t.tools)):a=r.initialToolTab?r.initialToolTab():eNewDealTool.None;e.transArgs&&(e.transArgs.transactionType===eTransactionSwitcher.NewPriceAlert?o.isVisible(!1):e.transArgs.tab&&e.transArgs.tab===eNewDealTool.Signals&&(a=eNewDealTool.Signals,o.showTools(!0)));o.selectedToolTab=u.observable(a)}(e),o.isChartToolVisible=i.createComputed(function(){return o.selectedToolTab()==eNewDealTool.Chart&&o.showTools()}),o.isMarketInfoToolVisible=i.createComputed(function(){return o.selectedToolTab()==eNewDealTool.MarketLiveInfo&&o.showTools()}),o.isCalendarToolVisible=i.createComputed(function(){return o.selectedToolTab()==eNewDealTool.EconomicCalendar&&o.showTools()}),o.isSignalsToolVisible=i.createComputed(function(){return o.selectedToolTab()==eNewDealTool.Signals&&o.showTools()}),o.isInstrumentInfoToolVisible=i.createComputed(function(){return o.selectedToolTab()==eNewDealTool.InstrumentInfo&&o.showTools()}),o.tabName=i.createComputed(function(){return getKeyByValue(eNewDealTool,o.selectedToolTab())}),i.subscribeTo(o.selectedToolTab,function(e){var t=c.ProfileCustomer(),a=isNullOrUndefined(r.profileKeyForDefaultTab)?"defaultTab":r.profileKeyForDefaultTab();t[a]=e,c.ProfileCustomer(t)}),n.chartBtnClick=function(){o.selectedToolTab(eNewDealTool.Chart)},n.marketInfoBtnClick=function(){o.selectedToolTab(eNewDealTool.MarketLiveInfo)},n.calendarBtnClick=function(){o.selectedToolTab(eNewDealTool.EconomicCalendar)},n.signalsBtnClick=function(){o.selectedToolTab(eNewDealTool.Signals)},n.instrumentInfoBtnClick=function(){o.selectedToolTab(eNewDealTool.InstrumentInfo)},n.toggleToolsClick=function(){o.showTools(!o.showTools())},o.isDataLoaded(!0)}return{init:function(t){e.init.call(i,t),o.isDataLoaded=u.observable(!1),o.showTools=d.set("showTools",u.observable(!1)),o.showChartSignals=d.set("showChartSignals",!1),o.selectedInstrument=u.observable(0),o.isVisible=u.observable(!0),d.set(eStateObjectTopics.ReadyForUse,!1)?l(t):s.push({unsubscribe:d.subscribe(eStateObjectTopics.ReadyForUse,function(e){e&&l(t)})})},dispose:function(){for(n.chartBtnClick=null,n.marketInfoBtnClick=null,n.calendarBtnClick=null,n.signalsBtnClick=null,n.instrumentInfoBtnClick=null,n.toggleToolsClick=null,d.unset("showChartSignals");0<s.length;)s.pop().unsubscribe();e.dispose.call(i)},Handlers:n,DealData:r}});return{viewModel:{createViewModel:function(e){var t=new a;return t.init(e),t}},DealToolsViewModel:a}}),define("viewModels/Deals/EditClosingLimitBaseViewModel",["require","knockout","KoComponentViewModel","editClosingLimitSettings","ExpirationDateModel","dalOrders","DealsManager","ViewModelsManager","FxNet/LogicLayer/Deal/DealAmountLabel","SymbolsManager","QuotesManager","BaseOrder","SetLimitsViewModel","Customer","CustomerProfileManager","InstrumentsManager","ActiveLimitsManager","StatesManager","InstrumentTranslationsManager","StateObject!Transaction","BuilderForInBetweenQuote"],function(e){var w=e("knockout"),t=e("KoComponentViewModel"),L=e("editClosingLimitSettings"),A=e("ExpirationDateModel"),I=e("dalOrders"),M=e("DealsManager"),P=e("ViewModelsManager"),R=e("FxNet/LogicLayer/Deal/DealAmountLabel"),V=e("SymbolsManager"),k=e("QuotesManager"),F=e("BaseOrder"),x=e("SetLimitsViewModel"),N=e("Customer"),O=e("CustomerProfileManager"),E=e("InstrumentsManager"),B=e("ActiveLimitsManager"),G=e("InstrumentTranslationsManager"),U=e("StateObject!Transaction"),q=e("StatesManager"),H=e("BuilderForInBetweenQuote");return extendClass(t,function(){var s,t=this,a=this.parent,l=this.Data,e=null,u=new x,c=new F,d=new A,i="OrderError7",n="OrderError8";function m(e){l.profitLoss(e),l.isProfit(0<=toNumeric(e))}function b(e){var t=Format.tenthOfPipSplitRate(e.spotRate,e.instrumentID);l.spotRateLabel.First(t.button.first),l.spotRateLabel.Middle(t.button.middle),l.spotRateLabel.Last(t.button.last)}function p(e){var t=Format.tenthOfPipSplitRate(e.closingRate,e.instrumentID);l.closingRateLabel.First(t.button.first),l.closingRateLabel.Middle(t.button.middle),l.closingRateLabel.Last(t.button.last)}var f=debounce(function(){(e=k.Quotes.GetItem(l.selectedInstrument()))&&(l.isActiveQuote(e.state!==eQuoteStates.NotActive),l.prevBid(l.bid()),l.prevAsk(l.ask()),l.bid(e.bid),l.ask(e.ask),l.open(e.open),l.close(e.close),l.change(Format.toPercent(e.change)),l.changePips(e.changePips),l.highBid(e.highBid),l.lowAsk(e.lowAsk),l.tradeTime(e.tradeTime),l.quotesAvailable(!0))});function o(e){var t=M.Deals.GetItem(e.editedItems[0]);t&&(l.slRate(t.slRate),l.tpRate(t.tpRate),l.slRate.markClean(),l.tpRate.markClean())}function r(e){if(0<=e.indexOf(s)){var t=M.Deals.GetItem(s);t&&(b(t),m(t.pl),p(t))}}var g=debounce(function(){var e=M.Deals.GetItem(s);if(1==q.States.fxDenied())return c.ValidateOnlineTradingUser(),!1;if(isNullOrUndefined(e))T(n);else{if(L.showValidationTooltips&&(l.limitType()===eLimitType.StopLoss?u.ValidateSlRate():u.ValidateTpRate()).length)return w.postbox.publish("edit-deal-limit-show-validation-tooltips"),!1;var t=y();!isNullOrUndefined(t)&&0<t.length&&(l.isProcessing(!0),I.SaveLimits(t,h))}},300,!0);function v(e,t){return{instrumentID:l.selectedInstrument(),positionNumber:l.positionNumber(),amount:0,orderDir:l.orderDir()===eOrderDir.Sell?eOrderDir.Buy:eOrderDir.Sell,limitRate:t,ifDoneSLRate:0,ifDoneTPRate:0,expirationDate:C(),type:e,mode:eLimitMode.CloseDeal,action:eOrderActionType.NewLimit}}function D(e,t){var a=B.limits.GetItem(e);if(!isNullOrUndefined(a))return a.limitRate=t,a.expirationDate=C(),a.ifDoneSLRate=0,a.ifDoneTPRate=0,a.amount=0,a.action=eOrderActionType.EditLimit,a;T(i)}function S(e){var t=B.limits.GetItem(e);if(!isNullOrUndefined(t))return t.action=eOrderActionType.DeleteLimit,t;T(i)}function y(){var e,t,a=[],i=M.Deals.GetItem(s),o=d.Data.isExpirationDateDirty();if(!isNullOrUndefined(i))return""!=i.slID&&0!=i.slID||!u.Data.stopLossRate.isDirty()?(u.Data.stopLossRate.isDirty()||o&&l.limitType()===eLimitType.StopLoss)&&""!=u.Data.stopLossRate()?e=D(i.slID,u.Data.stopLossRate()):""!=i.slID&&0!=i.slID&&u.Data.stopLossRate.isDirty()&&(e=S(i.slID)):e=v(eLimitType.StopLoss,u.Data.stopLossRate()),""!=i.tpID&&0!=i.tpID||!u.Data.takeProfitRate.isDirty()?(u.Data.takeProfitRate.isDirty()||o&&l.limitType()===eLimitType.TakeProfit)&&""!=u.Data.takeProfitRate()?t=D(i.tpID,u.Data.takeProfitRate()):""!=i.tpID&&0!=i.tpID&&u.Data.takeProfitRate.isDirty()&&(t=S(i.tpID)):t=v(eLimitType.TakeProfit,u.Data.takeProfitRate()),e&&a.push(e),t&&a.push(t),a;T(n)}function T(e){AlertsManager.UpdateAlert(AlertTypes.ServerResponseAlert,null,Dictionary.GetItem(e),null,{redirectToView:eForms.OpenDeals}),AlertsManager.PopAlert(AlertTypes.ServerResponseAlert)}function C(){var e=null;if(!d.Data.expirationDateSelector.IsGoodTillCancelChecked()){e=d.Data.expirationDate();var t=d.Data.selectedHoursValue();isObjectType(t)&&isEmptyType(t)?e+="  "+t.value:isStringType(t)&&!isEmptyType(t)?e+="  "+t:e+="  00:00"}return e}function h(e,t,a,i){var o=M.Deals.GetItem(s);if(o){var n=E.GetInstrument(o.instrumentID);if(n){l.isProcessing(!1);var r={};L.redirectToOpenDeals&&(r.redirectToView=eForms.OpenDeals),"valueDate"in o&&(r.valueDate=o.valueDate),c.OnActionReturn(e,t,n,extendType(r,{requestData:i}))}}}return{init:function(e){a.init.call(t,e),c.Init({},l),d.Init(),l.PageName=eDealPage.EditClosingLimit,l.dealRate="",l.dealRateLabel={First:w.observable(""),Middle:w.observable(""),Last:w.observable("")},l.spotRateLabel={First:w.observable(""),Middle:w.observable(""),Last:w.observable("")},l.closingRateLabel={First:w.observable(""),Middle:w.observable(""),Last:w.observable("")},l.orderID=w.observable(""),l.exeTime=w.observable(""),l.positionNumber=w.observable(""),l.ccyPairLong=w.observable(""),l.selectedDealAmount=U.set("selectedDealAmount",w.observable("")),l.selectedDeal=w.observable(null),l.dealAmountLabel=w.observable(""),l.isNonForex=w.observable(!0),l.baseSymbolName=w.observable(""),l.baseSymbolId=w.observable(""),l.otherSymbolId=w.observable(""),l.isActiveQuote=U.set("isActiveQuote",w.observable(!1)),l.quoteForOtherCcyToAccountCcy=U.set("quoteForOtherCcyToAccountCcy",w.observable("")),l.quoteForAccountCcyToOtherCcy=w.observable(""),l.quotesAvailable=w.observable(!1),l.isProcessing=w.observable(!1),l.limitsReady=w.observable(!1),l.customerSymbolId=w.observable(N.prop.baseCcyId()),l.customerSymbolName=U.set("customerSymbolName",w.observable("")),l.selectedCcyName=w.observable(N.prop.selectedCcyName()),l.selectedCcyId=w.observable(N.prop.selectedCcyId()),l.limitCalc=w.observable("").extend({dirty:!1}),l.selectedInstrument=U.set("selectedInstrument",w.observable("")),l.amountSymbol=U.set("amountSymbol",w.observable("")),l.ccyPair=U.set("ccyPair",w.observable("")),l.orderDir=U.set("orderDir",w.observable("")),l.bid=U.set("bid",w.observable("")),l.ask=U.set("ask",w.observable("")),l.open=U.set("open",w.observable("")),l.close=U.set("close",w.observable("")),l.change=U.set("change",w.observable("")),l.tradeTime=U.set("tradeTime",w.observable("")),l.changePips=w.observable(""),l.highBid=U.set("highBid",w.observable("")),l.lowAsk=U.set("lowAsk",w.observable("")),l.prevBid=w.observable(""),l.prevAsk=w.observable(""),l.bidPips=w.observable(""),l.bid10K=w.observable(""),l.bid100K=w.observable(""),l.askPips=w.observable(""),l.ask10K=w.observable(""),l.ask100K=w.observable(""),l.limitType=w.observable(eLimitType.None),l.stopLossInCustomerCcy=w.observable(""),l.takeProfitInCustomerCcy=w.observable(""),l.displaySlPercentSymbol=w.observable(!1),l.displayTpPercentSymbol=w.observable(!1),l.displaySlAmountCcySymbol=w.observable(!1),l.displayTpAmountCcySymbol=w.observable(!1),l.profileKeyForDefaultTab=w.observable(L.profileKeyForDefaultTab),l.initialToolTab=U.set("initialToolTab",w.observable("")),l.isForex=w.observable(""),l.isShare=U.set("isShare",w.observable("")),l.isFuture=U.set("isFuture",w.observable("")),l.isStock=U.set("isStock",w.observable("")),l.isProfit=w.observable(""),l.profitLoss=w.observable(""),l.slRate=w.observable("").extend({dirty:!1}),l.tpRate=w.observable("").extend({dirty:!1}),l.originalLimits={slRate:w.observable(""),tpRate:w.observable("")},l.setLimitsIsDirty=w.observable(!1),l.closingLimit=w.observable(null),l.valueDate=w.observable(null),l.hasAdditionalPL=w.observable(!1),l.additionalPL=w.observable(""),l.customerSymbolName(N.prop.baseCcyName()),l.initialToolTab(O.ProfileCustomer()[L.profileKeyForDefaultTab]||eNewDealTool.Chart),l.setLimitsIsDirty=t.createComputed(function(){var e=l.limitsReady(),t=l.limitType();if(!e)return!1;var a=toNumeric(l.slRate.originalValue()),i=toNumeric(u.Data.stopLossRate()||"0"),o=a!==i,n=toNumeric(l.tpRate.originalValue()),r=toNumeric(u.Data.takeProfitRate()||"0"),s=n!==r;return t===eLimitType.StopLoss?o:t===eLimitType.TakeProfit&&s}),l.UpdateButtonEnabled=t.createComputed(function(){var e=l.setLimitsIsDirty(),t=l.limitsReady()&&l.quotesAvailable(),a=l.isActiveQuote(),i=N.prop.brokerAllowLimitsOnNoRates,o=l.isProcessing(),n=d.Data.isExpirationDateDirty(),r=!isNullOrUndefined(l.closingLimit());return(i||a)&&t&&!o&&(e||n&&r)}),l.hasRateAdded=t.createComputed(function(){var e;if(l.limitType()===eLimitType.StopLoss)e=l.slRate.originalValue();else{if(l.limitType()!==eLimitType.TakeProfit)return!1;e=l.tpRate.originalValue()}return isNumber(e)&&0!=e}),l.adj=w.computed(function(){return N.prop.dealPermit!==eDealPermit.Islamic&&(!l.valueDate()||l.positionNumber()!==l.orderID())}),u.Init(l,t.getSettings().setlimitsConfiguration),k.OnChange.Add(f),M.OnDealsChange.Add(o),M.OnDealsPLChange.Add(r),U.update("stopLossRate",u.Data.stopLossRate),U.update("takeProfitRate",u.Data.takeProfitRate),U.update("chart",L.chart),U.update("currentRateDirectionSwitch",L.currentRateDirectionSwitch)},dispose:function(){k.OnChange.Remove(f),M.OnDealsChange.Remove(o),M.OnDealsPLChange.Remove(r),U.unset("cachedOvernightFinancing"),U.unset("currentRateDirectionSwitch"),a.dispose.call(t)},Data:l,TPField:u.TPField,SLField:u.SLField,SetLimitsInfo:u.Data,SetLimitsViewProperties:u.ViewProperties,ExpirationDate:d,SetLimitsModel:u,EditLimit:g,DeleteLimit:function(){if(l.hasRateAdded()){if(l.limitType()===eLimitType.StopLoss)u.Data.stopLossRate("");else{if(l.limitType()!==eLimitType.TakeProfit)return;u.Data.takeProfitRate("")}g()}},getLimitsValidationModel:function(){return l.limitType()===eLimitType.StopLoss?w.validatedObservable({stopLossAmount:u.Data.stopLossAmount,ccySLAmount:u.Data.ccySLAmount,stopLossRate:u.Data.stopLossRate,stopLossPercent:u.Data.stopLossPercent}):l.limitType()===eLimitType.TakeProfit?w.validatedObservable({takeProfitAmount:u.Data.takeProfitAmount,ccyTPAmount:u.Data.ccyTPAmount,takeProfitRate:u.Data.takeProfitRate,takeProfitPercent:u.Data.takeProfitPercent}):w.validatedObservable({stopLossAmount:u.Data.stopLossAmount,takeProfitAmount:u.Data.takeProfitAmount,ccySLAmount:u.Data.ccySLAmount,ccyTPAmount:u.Data.ccyTPAmount,stopLossRate:u.Data.stopLossRate,takeProfitRate:u.Data.takeProfitRate,stopLossPercent:u.Data.stopLossPercent,takeProfitPercent:u.Data.takeProfitPercent})},createAmountFieldsWrappers:function(){var a=w.observable(""),i=w.observable("");t.subscribeTo(u.Data.ccySLAmount,function(e){u.Data.curSlActiveTab()===eSetLimitsTabs.Amount||a(e)}),l.stopLossInCustomerCcy=t.createComputed({read:function(){var e,t="";return"NA"===(e=u.Data.curSlActiveTab()===eSetLimitsTabs.Amount?a():u.Data.ccySLAmount())?e:(""===e||isNaN(e)||(t=(t=Number(e))<0?Math.floor(t):Math.ceil(t)),t)}}),l.stopLossInCustomerCcy.extend({validation:{validator:function(){return u.Data.stopLossAmount.isValid()},params:u.Data.stopLossAmount}}),l.stopLossInCustomerCcy.extend({notify:"always"}),t.subscribeTo(u.Data.ccyTPAmount,function(e){u.Data.curTpActiveTab()===eSetLimitsTabs.Amount||i(e)}),l.takeProfitInCustomerCcy=t.createComputed({read:function(){var e,t="";return"NA"===(e=u.Data.curTpActiveTab()===eSetLimitsTabs.Amount?i():u.Data.ccyTPAmount())?e:(""===e||isNaN(e)||(t=(t=Number(e))<0?Math.floor(t):Math.ceil(t)),t)}}),l.takeProfitInCustomerCcy.extend({validation:{validator:function(){return u.Data.takeProfitAmount.isValid()},params:u.Data.takeProfitAmount}}),l.takeProfitInCustomerCcy.extend({notify:"always"})},updateViewModelData:function(){s=P.VManager.GetViewArgs(eViewTypes.vEditClosingLimit).orderId;var e,t,a,i=M.Deals.GetItem(s);if(i){l.orderID(s),l.selectedDeal(i),l.limitType(P.VManager.GetViewArgs(eViewTypes.vEditClosingLimit).limitType),l.exeTime(i.exeTime),l.positionNumber(i.positionNumber),l.orderDir(i.orderDir),l.selectedInstrument(i.instrumentID),t=i.orderDir===eOrderDir.Sell?i.sellAmount:i.buyAmount,l.selectedDealAmount(t),l.limitCalc(i.orderRate),l.slRate(i.slRate),l.slRate.markClean(),l.originalLimits.slRate(i.slRate),l.tpRate(i.tpRate),l.tpRate.markClean(),l.originalLimits.tpRate(i.tpRate),l.valueDate(i.valueDate),l.hasAdditionalPL(0!==Number(i.additionalPL)),l.additionalPL(i.additionalPL);var o=i.orderRate,n=Format.tenthOfPipSplitRate(o,i.instrumentID);if(l.dealRate=o,l.dealRateLabel.First=n.button.first,l.dealRateLabel.Middle=n.button.middle,l.dealRateLabel.Last=n.button.last,m(i.pl),b(i),p(i),e=E.GetInstrument(i.instrumentID)){l.isForex(e.isForex),l.isShare(e.isShare),l.isFuture(e.isFuture),l.isStock(e.isStock),l.ccyPairLong(G.Long(e.id)),l.isNonForex(e.instrumentTypeId!==eInstrumentType.Currencies),l.baseSymbolName(V.GetTranslatedSymbolById(e.baseSymbol)),l.amountSymbol(e.otherSymbol),l.ccyPair(e.ccyPair),l.baseSymbolId(e.baseSymbol),l.otherSymbolId(e.otherSymbol);var r=R.Translate(e);l.dealAmountLabel(r.label),a=e,H.GetInBetweenQuote(a.otherSymbol,N.prop.baseCcyId()).then(function(e){l.quoteForOtherCcyToAccountCcy(e)}).done(),H.GetInBetweenQuote(N.prop.baseCcyId(),a.otherSymbol).then(function(e){l.quoteForAccountCcyToOtherCcy(e)}).done(),f(),d.UpdateSelectedWithToday(i.instrumentID)}}},FillLimitsData:y}})}),define("viewModels/Deals/InstrumentInfoViewModel",["require","knockout","KoComponentViewModel","InstrumentsManager","Customer","dalInstruments","dalOrders","BuilderForInBetweenQuote","StateObject!Transaction","StateObject!ScheduleGroup","FxNet/LogicLayer/Deal/DealMarginCalculator","FxNet/LogicLayer/Deal/DealAmountLabel","FxNet/LogicLayer/Deal/InstrumentInfoLines"],function(e){var b=e("knockout"),t=e("KoComponentViewModel"),p=e("InstrumentsManager"),f=e("Customer"),g=e("dalInstruments"),v=e("dalOrders"),D=e("BuilderForInBetweenQuote"),S=e("StateObject!Transaction"),y=e("StateObject!ScheduleGroup"),T=e("FxNet/LogicLayer/Deal/DealMarginCalculator"),C=e("FxNet/LogicLayer/Deal/DealAmountLabel"),h=e("FxNet/LogicLayer/Deal/InstrumentInfoLines"),a=extendClass(t,function(){var e=this,t=this.parent,n=this.Data,a=47,s="cachedOvernightFinancing",r=S.getAll(),i=function(){n.principalOfLong=b.observable(),n.principalOfShort=b.observable(),n.conversionRate=b.observable();var e=b.utils.unwrapObservable(r.customerSymbolName);n.currencySymbol=b.observable(e),n.customerSymbolId=b.observable(f.prop.baseCcyId()),n.dividendDate=b.observable(""),n.dividendAmount=b.observable(""),n.displayToleranceInSecondTable=b.observable(!1),n.otherInstrumentSymbol=b.observable(),n.rolloverDate=b.observable(""),n.marketPriceTolerance=b.observable(""),n.overnightFinancingPercentageSell=b.observable(),n.overnightFinancingPercentageBuy=b.observable(),n.principalOfLongPercentage=b.observable(),n.principalOfShortPercentage=b.observable(),n.overnightFinancingTimeGMT=b.observable(""),n.weekendFinancingType=b.observable(eWeekendFinancingTypes.None),n.maxDealAmountLabel=b.observable(""),n.minDealAmountLabel=b.observable(""),n.requiredMargin=b.observable(""),n.offHoursRequiredMargin=b.observable(""),n.maximumLeverage=b.observable(""),n.pipValue=b.observable(""),n.maxAmount=b.observable(""),n.minAmount=b.observable(""),n.displayOffHoursRequiredMargin=b.observable(!1),n.isStock=b.observable(!1)};var o=function(e){var t=p.GetInstrument(e);if(t){n.dividendDate(t.getInstrumentDividendDate()),n.dividendAmount(t.getInstrumentDividendAmount()),n.otherInstrumentSymbol(t.otherSymbol),n.rolloverDate(t.getInstrumentRolloverDate()),n.pipValue(1/Math.pow(10,t.PipDigit)),n.isStock(t.isStock);var a=t.marketPriceTolerance*n.pipValue();n.marketPriceTolerance(0==a?0:Format.toRate(a,!0,e)),d(),p.GetUpdatedInstrumentWithDealMinMaxAmounts(e).then(function(e){n.minAmount(Format.formatDealAmount(e.dealMinMaxAmounts[0])),n.maxAmount(Format.formatDealAmount(e.dealMinMaxAmounts[1]))}).done();var i=C.Translate(t,"maxDealAmountLabel_");n.maxDealAmountLabel(i.label);var o=C.Translate(t,"minDealAmountLabel_");n.minDealAmountLabel(o.label)}},l=function(){e.subscribeTo(r.selectedInstrument,function(e){o(e),m()})};function u(e,t){var a,i=Q.defer(),o=null,n=t+"_"+e;if(S.containsKey(s)){var r=S.get(s);o=r&&r[n]}return(a=o)&&a.long&&a.short&&a.longPercentage&&a.shortPercentage&&a.time-(new Date).getTime()<=36e5?i.resolve(o):v.GetOvernightFinancing(t,e).then(function(e){var t={long:e[0].Result.LongOvernightFinancing,short:e[0].Result.ShortOvernightFinancing,longPercentage:e[0].Result.LongOvernightFinancingPercentage,shortPercentage:e[0].Result.ShortOvernightFinancingPercentage,time:(new Date).getTime()};!function(e,t){if(!isNullOrUndefined(e)){var a=null;S.containsKey(s)?((a=S.get(s))[t]=e,S.update(s,a)):((a={})[t]=e,S.set(s,a))}}(t,n),i.resolve(t)}).done(),i.promise}var c=function(){n.principal=e.createComputed(function(){var e=p.GetInstrument(r.selectedInstrument()),t=toNumeric(r.selectedDealAmount());isDefinedType(e)&&n.isNotIslamicDealPermit&&e.isOvernightFinancing()&&isDefinedType(t)&&!isNaN(t)&&u(t,e.id).then(function(e){n.principalOfLong(e.long),n.principalOfShort(e.short),n.principalOfLongPercentage(e.longPercentage),n.principalOfShortPercentage(e.shortPercentage)}).done()},e,!1),n.overnightFinancingLong=e.createComputed(function(){var e;return isDefinedType(n.principalOfLong())?(e=n.principalOfLong(),e=10<n.conversionRate()?-0===parseFloat(e.toFixed(0))?0:parseFloat(e.toFixed(0)):-0===parseFloat(e.toFixed(2))?0:parseFloat(e.toFixed(2))):""}),n.overnightFinancingShort=e.createComputed(function(){var e;return isDefinedType(n.principalOfShort())?(e=n.principalOfShort(),e=10<n.conversionRate()?-0===parseFloat(e.toFixed(0))?0:parseFloat(e.toFixed(0)):-0===parseFloat(e.toFixed(2))?0:parseFloat(e.toFixed(2))):""}),n.overnightFinancingPercentageSell=e.createComputed(function(){var e=p.GetInstrument(r.selectedInstrument()),t=toNumeric(r.selectedDealAmount());if(isDefinedType(e)&&isDefinedType(t))return Format.toPercentWithPrecision(n.principalOfShortPercentage(),5)}),n.overnightFinancingPercentageBuy=e.createComputed(function(){var e=p.GetInstrument(r.selectedInstrument()),t=toNumeric(r.selectedDealAmount());if(isDefinedType(e)&&isDefinedType(t))return Format.toPercentWithPrecision(n.principalOfLongPercentage(),5)}),n.OfCalculationTimeGMT=e.createComputed(function(){var a,i,e=p.GetInstrument(r.selectedInstrument());g.GetScheduleGroup(e.id).then(function(e){var t;a=e[0].GMTCloseTime,i=a.split(" ")[1],n.overnightFinancingTimeGMT(i),n.weekendFinancingType(e[0].WeekendFinancingType),d(),t=e[0],y.update("ScheduleGroupData",t)}).done()},e,!1),n.pipWorth=e.createComputed(function(){var e=p.GetInstrument(r.selectedInstrument());return T.PipWorth(toNumeric(r.selectedDealAmount()),e.PipDigit,r.quoteForOtherCcyToAccountCcy(),n.conversionRate())}).extend({empty:!0}),n.infoLines=e.createComputed(function(){var e=p.GetInstrument(r.selectedInstrument());return h.GetInfoLines(e,n)})};function d(){!isNullOrUndefined(f.prop.maintenanceMarginPercentage)&&0<f.prop.maintenanceMarginPercentage?n.displayOffHoursRequiredMargin(!1):n.displayOffHoursRequiredMargin(!0)}var m=function(){var t,a,i,o=0;v.GetDealMarginDetails(r.selectedInstrument()).then(function(e){a=e[0].Result.MaxNormalMargin,i=100*a,t=100*e[0].Result.MaxOffHoursMargin,0!=a&&(o=1/a),n.requiredMargin(parseFloat(i.toFixed(2))+"%"),n.offHoursRequiredMargin(parseFloat(t.toFixed(2))+"%"),n.maximumLeverage("1:"+o.toFixed(0))}).done()};return{init:function(){n.isNotIslamicDealPermit=f.prop.dealPermit!=eDealPermit.Islamic,i(),c(),l(),D.GetInBetweenQuote(a,f.prop.baseCcyId()).then(function(e){n.conversionRate(e.bid())}).done(),m();var e=b.utils.unwrapObservable(r.selectedInstrument);o(e)},dispose:function(){t.dispose.call(e)},NewDealData:r}});return{viewModel:{createViewModel:function(e){var t=new a(e);return t.init(),t}}}}),define("viewModels/Deals/BaseMarketInfoToolViewModel",["require","knockout","KoComponentViewModel","InstrumentsManager","Customer","CustomerProfileManager","dalInstruments","dalCustomerProfile","FxNet/LogicLayer/Deal/SentimentsConnManager","StateObject!Transaction","StateObject!SentimentsConnManager"],function(e){var m=e("knockout"),t=e("KoComponentViewModel"),b=e("InstrumentsManager"),p=e("Customer"),f=e("CustomerProfileManager"),g=e("dalInstruments"),v=e("dalCustomerProfile"),D=e("FxNet/LogicLayer/Deal/SentimentsConnManager"),S=e("StateObject!Transaction"),y=e("StateObject!SentimentsConnManager");return extendClass(t,function(e){var a=this,i=this.parent,o=this.Data,n=S.getAll(),r=0,s=function(e){var t,a;r&&(clearTimeout(r),r=0),e&&!isNullOrUndefined(e.PercentLong)?(a=100-(t=toNumeric(e.PercentLong)),o.risePercent(t/100),o.fallPercent(a/100),o.riseValue(Math.round(t)),o.fallValue(Math.round(a)),o.hasData(!0)):o.hasData(!1)},l=function(e){e&&(r&&(clearTimeout(r),r=0),r=setTimeout(s,400),D.Subscribe(p.prop.brokerID,e))},t=function(e){e&&D.Unsubscribe(p.prop.brokerID,e)},u=function(){o.hasData=m.observable(!1),o.risePercent=m.observable(""),o.fallPercent=m.observable(""),o.riseValue=m.observable(""),o.fallValue=m.observable(""),o.overnightFinancingTimeGMT=m.observable(""),o.OfCalculationTimeGMT=m.observable(),o.displayTradingSentimentsFirstView=m.observable(isEmptyType(f.ProfileCustomer().viewSentimentsDisclaimerClicked))},c=function(){a.subscribeTo(n.selectedInstrument,function(e){e&&t(e)},null,"beforeChange"),a.subscribeTo(n.selectedInstrument,function(e){l(e)})},d=function(){o.displayTradingSentiments=a.createComputed(function(){return y.get("IsServiceAvailable")&&o.hasData()}),o.change=a.createComputed(function(){var e=n.bid(),t=n.close();return Format.toRate(e-t,!0,n.selectedInstrument())}),o.OfCalculationTimeGMT=a.createComputed(function(){var t,a,e=b.GetInstrument(n.selectedInstrument());g.GetScheduleGroup(e.id).then(function(e){t=e[0].GMTCloseTime,a=t.split(" ")[1],o.overnightFinancingTimeGMT(a)}).done()},a,!1)};return{init:function(e){i.init.call(a,e),u(),d(),c();var t=m.utils.unwrapObservable(n.selectedInstrument);D.SetMessageReceivedCallback(s),setTimeout(l.bind(a,t))},dispose:function(){t(n.selectedInstrument()),i.dispose.call(a)},NewDealData:n,ViewSentimentsButtonHandler:function(){f.ProfileCustomer().viewSentimentsDisclaimerClicked=(new Date).toUTCString(),v.SaveSentimentsToProfileWebMobile({ViewSentimentsDisclaimerClicked:(new Date).toUTCString()})}}})}),define("viewModels/Deals/MarketInfoRatesViewModel",["require","knockout","KoComponentViewModel","CustomerProfileManager","QuotesManager","dalRates","StateObject!Transaction"],function(e){var c=e("knockout"),t=e("KoComponentViewModel"),d=e("CustomerProfileManager"),m=e("QuotesManager"),b=e("StateObject!Transaction"),p=e("dalRates"),a=extendClass(t,function(t){var a=this,i=this.parent,o=this.Data,n=b.getAll(),r=n.currentRateDirectionSwitch;function s(){var e=eOrderDir.Buy;return n.orderDir&&n.orderDir()===eOrderDir.Sell&&(e=n.orderDir()),r&&(e=e===eOrderDir.Sell?eOrderDir.Buy:eOrderDir.Sell),e}function l(){o.isLoading(!0),o.currentRate(""),u(),p.FetchPeriods(n.selectedInstrument(),s(),o.selectedPeriods()).then(function(e){o.periodData(e),o.isLoading(!1)},function(){o.isLoading(!1)})}function u(){var e=s(),t=m.Quotes.GetItem(n.selectedInstrument());isNullOrUndefined(t)||o.currentRate(e===eOrderDir.Sell?t.bid:t.ask)}return{init:function(){var e;i.init.call(a),o.tabsPeriods=[[eMarketInfoPeriods.FiveMin,eMarketInfoPeriods.OneH,eMarketInfoPeriods.TwelveHours,eMarketInfoPeriods.Today],[eMarketInfoPeriods.OneDay,eMarketInfoPeriods.OneWeek,eMarketInfoPeriods.TwoWeeks,eMarketInfoPeriods.ThisMonth],[eMarketInfoPeriods.ThirtyDays,eMarketInfoPeriods.NinetyDays,eMarketInfoPeriods.FiftyTwoWeeks,eMarketInfoPeriods.ThisYear]],o.selectedInstrument=c.observable(n.selectedInstrument()),o.selectedTab=c.observable(ePeriodTabs.None),o.isLoading=c.observable(!1),o.periodData=c.observable([]),o.currentRate=c.observable(),o.selectedPeriods=c.observable(o.selectedTab()!==ePeriodTabs.None?o.tabsPeriods[o.selectedTab()]:[]),a.subscribeTo(o.selectedTab,function(){o.selectedPeriods(o.selectedTab()!==ePeriodTabs.None?o.tabsPeriods[o.selectedTab()]:[])}),a.subscribeTo(n.selectedInstrument,function(e){o.selectedInstrument(e),l()}),a.subscribeTo(o.selectedPeriods,function(){l()}),isNullOrUndefined(t.expandHighLow)||a.subscribeTo(t.expandHighLow,function(e){e&&l()}),n.orderDir&&a.subscribeTo(n.orderDir,function(){l()}),m.OnChange.Add(u),e=d.ProfileCustomer(),isNullOrUndefined(e.riTab)?(o.selectedTab(ePeriodTabs.Short),e.riTab=o.selectedTab(),d.ProfileCustomer(e)):o.selectedTab(e.riTab)},dispose:function(){m.OnChange.Remove(u),i.dispose.call(a)},ChangeTab:function(t){var e=d.ProfileCustomer(),a=Object.keys(ePeriodTabs).find(function(e){return ePeriodTabs[e]===Number(t)});o.selectedTab(t),e.riTab=t,d.ProfileCustomer(e),c.postbox.publish("deal-slip-change-highlow-term",a+"Term")},Data:o,DealData:n}});return{viewModel:{createViewModel:function(e){var t=new a(e);return t.init(),t}}}}),define("viewModels/Deals/RateRangeIndicatorViewModel",["require","knockout","KoComponentViewModel"],function(e){var s=e("knockout"),t=e("KoComponentViewModel"),a=extendClass(t,function(a){var i=this,o=this.parent,n=this.Data;function r(){var e=parseFloat(n.lowValue()),t=parseFloat(n.highValue()),a=parseFloat(n.currentRate()),i=0;return a<e?(e=a,n.lowValue(n.currentRate())):i=t<a?(t=a,n.highValue(n.currentRate()),100):e!==t?parseInt(100*(a-e)/(t-e)):50,i}return{init:function(e){var t;o.init.call(i,e),n.instrumentId=a.instrumentId,n.id=a.id,n.currentRate=a.currentRate,n.lowValue=s.observable(""),n.highValue=s.observable(""),n.range=s.observable(0),i.subscribeTo(n.currentRate,function(){n.range(r())}),(t=a.periodData.find(function(e){return e.id===n.id}))&&(n.lowValue(t.low),n.highValue(t.high),n.range(""!==n.currentRate()?r():0))},dispose:function(){o.dispose.call(i)},Data:n}});return{viewModel:{createViewModel:function(e){var t=new a(e);return t.init(),t}}}}),define("viewModels/Deals/OpenDealsModule",["require","knockout","Customer","AlertsManager","Dictionary","ClientStateHolderManager","DealsManager","InstrumentsManager","StatesManager","VmHelpers","dalOrders","BaseOrder","QuotesSubscriber","ViewModelBase","QuotesManager","BuilderForInBetweenQuote","AmountConverter","FxNet/LogicLayer/Deal/DealPermissions","GridSelectionModule"],function(e){var F=e("knockout"),x=e("Customer"),N=e("AlertsManager"),O=e("Dictionary"),E=e("ClientStateHolderManager"),B=e("DealsManager"),G=e("InstrumentsManager"),U=e("StatesManager"),q=e("VmHelpers"),H=e("dalOrders"),Q=e("BaseOrder"),j=e("QuotesSubscriber"),K=e("ViewModelBase"),_=e("QuotesManager"),W=e("BuilderForInBetweenQuote"),z=e("AmountConverter"),J=e("FxNet/LogicLayer/Deal/DealPermissions"),Y=e("GridSelectionModule");return extendClass(OpenDealsViewModelBase,function(){var i=this,r=new ObservableHashTable("orderID",{enabled:!0,sortProperty:"positionNumber",asc:!1}),s=new j,o=F.observable(!0),n=F.observable(!0),e={},l=new Q,u={},a=clone(K),t=F.observable(0),c=F.observable(null),d=F.observable(!0),m=function(){if(a.getSettings(i).closeSelected){Y.apply(u,r.Values,function(e){return!0===e.quoteIsActive()});var t=function(){var e={failCallback:function(){n(!0)}};return 0<u.CheckedItems().length?(n(!1),H.CloseDeals(u.CheckedItems(),A,e)):ErrorManager.onError("closeDealAfterConfirmation","trying to close empty list of positions",eErrorSeverity.low)};u.CloseSelected=function(){1!=U.States.fxDenied()?u.HasSelections()&&(CookieHandler.ReadCookie("hideMultipleDealsCloseAlert")?t():function(){var e={selectedData:u.CheckedItems(),confirmationCloseDeal:t};AlertsManager.UpdateAlert(AlertTypes.MultipleDealsClosedConfirmation,this.title,this.body,[],e),AlertsManager.PopAlert(AlertTypes.MultipleDealsClosedConfirmation)}()):l.ValidateOnlineTradingUser()}}},b=function(){e.isMarketClosed=U.States.IsMarketClosed},p=function(){B.OnDealsChange.Add(g),B.OnDealsPLChange.Add(S),E.OnChange.Add(D),_.OnChange.Add(v)},f=function(){d(!0),B.Deals.ForEach(function(e,t){var a=M(t);r.Add(a)}),d(!1)},g=function(e){e&&(y(e.removedItems),T(e.editedItems),C(e.newItems))},v=function(){for(var e=0,t=r.Values().length;e<t;e++){var a=r.Values()[e].instrumentID,i=_.Quotes.GetItem(a);i&&r.Values()[e].quoteIsActive(i.state!==eQuoteStates.NotActive)}},D=function(){t(toNumeric(E.CSHolder.equity))},S=function(e){for(var t=0,a=e.length;t<a;t++){var i=r.Get(e[t]);if(i){var o=B.Deals.GetItem(e[t]);if(o){var n={prevSpotRate:i.spotRate(),spotRate:o.spotRate,fwPips:o.fwPips,prevClosingRate:i.closingRate(),closingRate:o.closingRate,pl:o.pl,plNumeric:toNumeric(o.pl),plSign:Math.floor(toNumeric(o.pl)).sign(),lastUpdate:s.GetQuote(o.instrumentID).dataTime(),commission:o.commission};r.Update(e[t],n)}}}},y=function(e){for(var t=0;t<e.length;t++)r.Remove(e[t])},T=function(e){for(var t=0,a=e.length;t<a;t++){var i=M(B.Deals.GetItem(e[t]));i&&r.Update(i.orderID,i)}},C=function(e){for(var t=0,a=e.length;t<a;t++){var i=M(B.Deals.GetItem(e[t]));i&&r.Add(i)}},h=function(e){if(N.GetAlert(AlertTypes.CloseDealAlert).DisableThisAlertByCookie()){var t=w(r.Get(e.orderID));t&&(e.OnCloseDealEnable(!1),o(!1),H.CloseDeals([t],L))}else N.UpdateAlert(AlertTypes.CloseDealAlert,null,O.GetItem("closeDealConfirmationAlert"),[],{positionNumber:e.positionNumber,orderDir:e.orderDir,dealAmount:e.dealAmount,instrumentID:e.instrumentID,closingRate:e.closingRate,deal:e,caller:k}),N.PopAlert(AlertTypes.CloseDealAlert)},w=function(e){var t=null;if(e){var a=F.toJS(e);t=q.GeneratePrimitiveTypeArray(a)}return t},L=function(e,t,a){I(e,t,{requestData:a}),r.Get(a.orderID).OnCloseDealEnable(!0)},A=function(e,t,a){u.IsProcessing(!1),I(e,t,extendType({isCloseMultipleDealsCall:!0},{requestData:a}))},I=function(e,t,a){o(!0),l.OnActionReturn(e,t,null,a),n(!0)},M=function(e){var a={};return a.positionNumber=e.positionNumber,a.exeTime=e.exeTime,a.instrumentID=e.instrumentID,a.orderDir=e.orderDir,a.dealAmount=e.orderDir==eOrderDir.Sell?e.sellAmount:e.buyAmount,a.dealType=e.dealType,a.buyAmount=e.buyAmount,a.buySymbolID=e.buySymbolID,a.sellAmount=e.sellAmount,a.sellSymbolID=e.sellSymbolID,a.orderRate=e.orderRate,a.orderRateNumeric=toNumeric(e.orderRate),a.valueDate=i.getValueDate(e),a.slRate=F.observable(0==e.slRate?cEmptyRate:e.slRate),a.typeSL=O.GetItem("limtype1_short"),a.tpRate=F.observable(0==e.tpRate?cEmptyRate:e.tpRate),a.typeTP=O.GetItem("limtype2_short"),a.orderID=e.orderID,a.prevSpotRate=F.observable(e.spotRate),a.spotRate=F.observable(e.spotRate),a.fwPips=F.observable(e.fwPips),a.hasAdditionalPL=F.observable(e.hasAdditionalPL),a.prevClosingRate=F.observable(e.closingRate),a.closingRate=F.observable(e.closingRate),a.closeDealRate=F.computed(function(){return a.closingRate()?a.closingRate().substring(0,a.closingRate().length-2):"0."}),a.closeDealRatePips=F.computed(function(){return a.closingRate()?a.closingRate().substring(a.closingRate().length-2,a.closingRate().length):"00"}),a.dialogTitleSLDealLimit=F.computed(function(){return isNumber(a.slRate())&&0!=a.slRate()?O.GetItem("UpdateRemoveStopLossTitle"):O.GetItem("AddStopLossTitle")}),a.dialogTitleTpDealLimit=F.computed(function(){return isNumber(a.tpRate())&&0!=a.tpRate()?O.GetItem("UpdateRemoveTakeProfitTitle"):O.GetItem("AddTakeProfitTitle")}),a.pl=F.observable(isStringType(e.pl)?e.pl:Number.toStr(e.pl)),a.plNumeric=toNumeric(e.pl),a.plSign=F.observable(Math.floor(toNumeric(e.pl)).sign()),a.commission=F.observable(isStringType(e.commission)?e.commission:Number.toStr(e.commission)),a.spreadDiscount=F.observable(isStringType(e.spreadDiscount)?e.spreadDiscount:Number.toStr(e.spreadDiscount)),a.spreadDiscountConverted=F.observable(isStringType(e.spreadDiscount)?e.spreadDiscount:Number.toStr(e.spreadDiscount)),a.grosspl=F.computed(function(){if(c()&&x.prop.selectedCcyId()!==x.prop.baseCcyId()){var e=z.Convert(toNumeric(a.spreadDiscount()),c());a.spreadDiscountConverted(isStringType(e)?e:Number.toStr(e.toFixed(2)))}var t=0===toNumeric(a.spreadDiscountConverted())?toNumeric(a.commission()):-toNumeric(a.spreadDiscountConverted());return(toNumeric(a.pl())+t).toFixed(2)}),a.OnCloseDealEnable=F.observable(!0),a.OnCloseDealClick=h,a.ThisDealSwipe=F.observable(!0),a.lastUpdate=F.observable(s.GetQuote(e.instrumentID).dataTime()),a.quoteIsActive=F.observable(!1),a.isStock=F.observable(G.IsInstrumentStock(e.instrumentID)),a.adj=F.computed(function(){return x.prop.dealPermit!=eDealPermit.Islamic&&(0===e.valueDate.length||e.positionNumber!=e.orderID)}),a.isChecked=F.observable(!1),a.hasAdditionalPL=F.observable(0!==Number(e.additionalPL)),a},P=function(){return G.GetUserDefaultInstrumentId()},R=F.pureComputed(function(){return F.utils.arrayFirst(r.Values(),function(e){return!e.valueDate.isValueDateEmpty})}),V=F.pureComputed(function(){return 0<r.Values().length}),k={Init:function(e){a.setSettings(i,e),m(),b(),o(!0),p();var t=x.prop.baseCcyId();47!==t?W.GetInBetweenQuote(t,47).then(function(e){c(e),f()}).done():f(),s.Start()},OpenDeals:r.Values,HasRecords:V,FlagsState:e,CloseThisDeal:h,CloseThisDealEnable:o,OnCloseDealReturn:L,OnCloseDealsEnable:n,SetSorting:r.SetSorting,Positions:u,TotalEquity:t,GetSelectedInstrument:P,IsActiveQuote:function(){var e=s.GetQuote(P());return!isNullOrUndefined(e)&&e.state()!==eQuoteStates.NotActive},IsValueDateColumnVisible:R,SortProperties:r.SortProperties,IsLoadingData:d,DealPermissions:J};return k})}),define("viewModels/BackOffice/Deals/OpenDealsModule",["require","knockout","dalTransactions","BaseOrder","viewModels/Deals/OpenDealsModule","openDealsGridSettings"],function(e){var a=e("knockout"),t=e("dalTransactions"),r=new(e("BaseOrder")),i=e("openDealsGridSettings"),s=new(e("viewModels/Deals/OpenDealsModule"));s.Init(i);var o=function(e,t,a){var i,o,n;s.Positions.IsProcessing(!1),i=e,o=t,n=extendType({isCloseMultipleDealsCall:!0},{requestData:a}),s.CloseThisDealEnable(!0),r.OnActionReturn(i,o,null,n),s.OnCloseDealsEnable(!0)},n=function(){var e={hasUnwrappedItems:!1,failCallback:function(){s.CloseThisDealEnable(!0)},forceRetry:!0};return 0<s.Positions.CheckedItems().length?(s.CloseThisDealEnable(!1),t.CloseDeals(s.Positions.CheckedItems(),o,e)):ErrorManager.onError("closeDealAfterConfirmation","trying to close empty list of positions",eErrorSeverity.low)};return s.Positions.CheckAll=a.computed({read:function(){return null===a.utils.arrayFirst(s.OpenDeals(),function(e){return!1===e.isChecked()})&&0<s.OpenDeals().length},write:function(t){a.utils.arrayForEach(s.OpenDeals(),function(e){e.isChecked(t)})},owner:s}),s.Positions.CloseSelected=function(){s.Positions.HasSelections()&&(CookieHandler.ReadCookie("hideMultipleDealsCloseAlert")?n():function(){var e={selectedData:s.Positions.CheckedItems(),confirmationCloseDeal:n};AlertsManager.UpdateAlert(AlertTypes.MultipleDealsClosedConfirmation,this.title,this.body,[],e),AlertsManager.PopAlert(AlertTypes.MultipleDealsClosedConfirmation)}())},s}),define("viewModels/Deals/ScheduleGroupViewModel",["require","knockout","KoComponentViewModel","StateObject!ScheduleGroup"],function(e){var r=e("knockout"),t=e("KoComponentViewModel"),s=e("StateObject!ScheduleGroup"),a=extendClass(t,function(){var t,a=this,i=this.parent,o=this.Data;function n(e){o.scheduleGroup(e),isNullOrUndefined(e)||(o.hasOneTradingHour(!isEmpty(e.TradingBreak1_GMT)&&isEmpty(e.TradingBreak2_GMT)),o.hasMultipleTradingHours(!isEmpty(e.TradingBreak1_GMT)&&!isEmpty(e.TradingBreak2_GMT)))}return{init:function(e){i.init.call(a,e),o.scheduleGroup=r.observable(),o.hasOneTradingHour=r.observable(),o.hasMultipleTradingHours=r.observable(),s.get("ScheduleGroupData")||s.set("ScheduleGroupData",null),t=s.subscribe("ScheduleGroupData",n),n(s.get("ScheduleGroupData"))},dispose:function(){t&&t()},Data:o}});return{viewModel:{createViewModel:function(){var e=new a;return e.init(),e}}}}),define("viewModels/Limits/ActiveLimitsModule",["require","knockout","Dictionary","ViewModelsManager","ActiveLimitsManager","InstrumentTranslationsManager","dalOrders","ActiveLimitsConfiguration","QuotesSubscriber","BaseOrder","ViewModelBase"],function(e){var g=e("knockout"),v=e("Dictionary"),D=e("ActiveLimitsManager"),S=e("InstrumentTranslationsManager"),y=e("dalOrders"),t=e("ActiveLimitsConfiguration"),T=e("QuotesSubscriber"),C=e("BaseOrder"),h=e("ViewModelBase");var a=new function(){var n,r=new ObservableHashTable("orderID",{enabled:!0,sortProperty:"orderID",asc:!1}),t=new T,i=new C,s=clone(h),a={},e=g.observable(!0),o=function(){D.OnChange.Add(u)},l=function(){e(!0);var i=s.getSettings(n).defaultLimitMode;D.limits.ForEach(function(e,t){if(i===eLimitMode.None||i==t.mode){var a=p(t);r.Add(a)}}),e(!1)},u=function(e){e&&(c(e.removedLimits),d(e.editedLimits),m(e.newLimits))},c=function(e){for(var t=0;t<e.length;t++)r.Remove(e[t])},d=function(e){for(var t=s.getSettings(n).defaultLimitMode,a=0,i=e.length;a<i;a++){var o=p(D.limits.GetItem(e[a]));t!==eLimitMode.None&&t!=o.mode||r.Update(o.orderID,o)}},m=function(e){if(e&&e.length)for(var t=0,a=e.length;t<a;t++){var i=p(D.limits.GetItem(e[t]));s.getSettings(n).defaultLimitMode!==eLimitMode.None&&s.getSettings(n).defaultLimitMode!=i.mode||r.Add(i)}},b=function(e,t,a){i.ShowMessageResult(e,t,null,a),isDefinedType(r.Get(e[0].itemId).isRemoving)&&r.Get(e[0].itemId).isRemoving(!1)},p=function(e){return{instrumentName:g.observable(S.Long(e.instrumentID)),instrumentID:e.instrumentID,isInactiveQuote:t.GetQuote(e.instrumentID).isInactive,baseSymbol:e.baseSymbol,otherSymbol:e.otherSymbol,orderID:e.orderID,positionNumber:0==e.positionNumber?"":e.positionNumber,accountNumber:e.accountNumber,orderDir:e.orderDir,orderRate:e.orderRate,orderRateNumeric:toNumeric(e.orderRate),buySymbolID:e.buySymbolID,buyAmount:e.buyAmount,sellSymbolID:e.sellSymbolID,sellAmount:e.sellAmount,limitAmount:e.orderDir==eOrderDir.Sell?e.sellAmount:e.buyAmount,type:e.type,mode:e.mode,expirationDate:isEmptyValue(e.expirationDate)?v.GetItem("GoodTillCancel"):e.expirationDate,entryTime:e.entryTime,slRate:e.slRate,tpRate:e.tpRate,otherLimitID:e.otherLimitID,ThisDealSwipe:g.observable(!0),typeTP_abrv:v.GetItem("limtype2_short"),typeTP:v.GetItem("limtype2"),typeSL_abrv:v.GetItem("limtype1_short"),typeSL:v.GetItem("limtype1"),rateDirIsUp:t.GetQuote(e.instrumentID).rateDirIsUp,rateDirIsDown:t.GetQuote(e.instrumentID).rateDirIsDown,isEditable:e.mode===eLimitMode.OpenDeal,isRemoving:g.observable(!1)}},f=g.pureComputed(function(){return 0<a.Data().length});return{init:function(e){n=this,s.setSettings(n,e),i.Init({},r),a.Data=r.Values,a.ShowPager=g.observable(!1),o(),l(),t.Start()},DataInfo:a,DataInfoExp:{},RemoveLimit:function(e){var t=D.limits.GetItem(e.orderID);t&&(e.isRemoving(!0),y.DeleteLimit(t,b))},SetSorting:r.SetSorting,SortProperties:r.SortProperties,Refresh:l,IsLoadingData:e,ApplyFilter:function(){},HasRecords:f}};return a.init(t),a}),define("viewModels/Limits/PriceAlertsModule",["require","knockout","ViewModelsManager","ActiveLimitsManager","InstrumentTranslationsManager","dalOrders","QuotesManager","BaseOrder","ViewModelBase","GridSelectionModule","InstrumentsManager"],function(e){var S=e("knockout"),y=e("ActiveLimitsManager"),T=e("InstrumentTranslationsManager"),C=e("dalOrders"),h=e("QuotesManager"),w=e("BaseOrder"),L=e("ViewModelBase"),A=e("GridSelectionModule"),I=e("InstrumentsManager");var t=new function(){var e,o=new ObservableHashTable("orderID",{enabled:!0,sortProperty:"orderID",asc:!1}),n=new w,t=clone(L),a={},r={},i=S.observable(!0),s=function(){y.OnChange.Add(m),h.OnChange.Add(u)},l=function(){A.apply(r,a.Data)},u=function(){for(var e=0,t=o.Values().length;e<t;e++){var a=o.Values()[e].instrumentID,i=h.Quotes.GetItem(a);i&&o.Values()[e].currentRate(o.Values()[e].orderDir==eOrderDir.Sell?i.bid:i.ask)}},c=function(e){return e?C.DeletePriceAlerts(e,g):ErrorManager.onError("closePriceAlertAfterConfirmation","trying to close empty list of price alerts",eErrorSeverity.low)},d=function(){i(!0),y.GetPriceAlerts().ForEach(function(e,t){var a=v(t);o.Add(a)}),i(!1)},m=function(e){e&&(b(e.removedLimits),p(e.editedLimits),f(e.newLimits))},b=function(e){for(var t=0;t<e.length;t++)o.Remove(e[t])},p=function(e){for(var t=0,a=e.length;t<a;t++){var i=v(y.GetPriceAlerts().GetItem(e[t]));i&&o.Update(i.orderID,i)}},f=function(e){if(e&&e.length)for(var t=0,a=e.length;t<a;t++){var i=v(y.GetPriceAlerts().GetItem(e[t]));i&&o.Add(i)}},g=function(e,t,a){for(var i=0;i<e.length;i++)e[i].status!==eResult.Success&&(e[i].msgKey="OrderError23",e[i].result="OrderError23");n.ShowMessageResult(e,t,null,a)},v=function(e){if(e)return{instrumentName:S.observable(T.Long(e.instrumentID)),instrumentID:e.instrumentID,orderID:e.orderID,positionNumber:0==e.positionNumber?"":e.positionNumber,orderDir:e.orderDir,orderRate:e.orderRate,orderRateNumeric:toNumeric(e.orderRate),priceAlertAmount:e.orderDir==eOrderDir.Sell?e.sellAmount:e.buyAmount,type:e.type,mode:e.mode,expirationDate:e.expirationDate,entryTime:e.entryTime,isChecked:S.observable(!1),currentRate:S.observable(e.orderDir==eOrderDir.Sell?h.Quotes.GetItem(e.instrumentID).bid:h.Quotes.GetItem(e.instrumentID).ask)}},D=S.pureComputed(function(){return 0<a.Data().length});return{init:function(){e=this,t.setSettings(e,{}),n.Init({},o),a.Data=o.Values,a.ShowPager=S.observable(!1),l(),s(),d()},DataInfo:a,RemovePriceAlert:function(e){e=null===e?r.CheckedItems():[e];for(var t=[],a=y.GetPriceAlerts(),i=0;i<e.length;i++){var o=a.GetItem(e[i].orderID);o&&(o.limitRate=o.orderRate,t.push(o))}0<t.length&&(CookieHandler.ReadCookie("hideMultiplePriceAlertsCloseAlert")?c(t):n.ShowAlert(AlertTypes.MultiplePriceAlertsClosedConfirmation,this.title,this.body,{selectedData:t,confirmationCloseDeal:function(){c(t)}}))},SetSorting:o.SetSorting,SortProperties:o.SortProperties,Refresh:d,IsLoadingData:i,ApplyFilter:function(){},HasRecords:D,Positions:r,GetSelectedInstrument:function(){return I.GetUserDefaultInstrumentId()}}};return t.init(),t}),define("viewModels/Limits/AmountFieldsWrapper",["require","knockout","KoComponentViewModel","LimitValuesCalculator"],function(e){var r=e("knockout"),t=e("KoComponentViewModel"),f=e("LimitValuesCalculator");return extendClass(t,function(){var u,c,e=this,t=this.parent,a=this.Data,d=r.observable(""),m=r.observable(""),b=r.observable(!1),p=r.observable(!1),i=function(){a.stopLossInCustomerCcy=e.createComputed({read:function(){var e,t="";return"NA"===(e=u.Data.curSlActiveTab()==eSetLimitsTabs.Amount||u.Data.curSlActiveTab()==u.Data.defaultTab?d():u.Data.ccySLAmount())?e:(""===e||isNaN(e)||(t=Math.abs(Number(e)),t=Math.ceil(t)),t)},write:function(e){var t,a=u.Data.curSlActiveTab()==eSetLimitsTabs.Amount||u.Data.curSlActiveTab()==u.Data.defaultTab,i=""===e||-1<"NA".indexOf(e)||isStringType(e)&&-1<e.indexOf("NA"),o=!isNaN(e),n=c.quoteForAccountCcyToOtherCcy(),r="",s=d(),l=u.Data.stopLossAmount();a&&(i?t="":r=o?parseFloat(e):s,i||""===r||isNaN(r)||(t=f.CalculateAmount(r,n,eLimitType.StopLoss),t=Math.abs(t)),b(!0),d(r),r===s&&d.notifySubscribers(r),u.Data.stopLossAmount(t),t===l&&u.Data.stopLossAmount.notifySubscribers(t),b(!1))}}),a.takeProfitInCustomerCcy=e.createComputed({read:function(){var e,t="";return"NA"===(e=u.Data.curTpActiveTab()==eSetLimitsTabs.Amount||u.Data.curTpActiveTab()==u.Data.defaultTab?m():u.Data.ccyTPAmount())?e:(""===e||isNaN(e)||(t=Math.abs(Number(e)),t=Math.ceil(t)),t)},write:function(e){var t,a=u.Data.curTpActiveTab()==eSetLimitsTabs.Amount||u.Data.curTpActiveTab()==u.Data.defaultTab,i=""===e||-1<"NA".indexOf(e)||isStringType(e)&&-1<e.indexOf("NA"),o=!isNaN(e),n=c.quoteForAccountCcyToOtherCcy(),r="",s=m(),l=u.Data.takeProfitAmount();a&&(i?t="":r=o?parseFloat(e):s,i||""===r||isNaN(r)||(t=f.CalculateAmount(r,n,eLimitType.TakeProfit),t=Math.abs(t)),p(!0),m(r),r===s&&m.notifySubscribers(r),u.Data.takeProfitAmount(t),t===l&&u.Data.takeProfitAmount.notifySubscribers(t),p(!1))}})},o=function(){e.subscribeTo(u.Data.ccySLAmount,function(e){var t=u.Data.curSlActiveTab()==eSetLimitsTabs.Amount||u.Data.curSlActiveTab()==u.Data.defaultTab;b()||(t&&(isEmpty(d())||isNaN(d()))||!t)&&d(e)}),e.subscribeTo(u.Data.ccyTPAmount,function(e){var t=u.Data.curTpActiveTab()==eSetLimitsTabs.Amount||u.Data.curTpActiveTab()==u.Data.defaultTab;p()||(t&&(isEmpty(m())||isNaN(m()))||!t)&&m(e)})},n=function(){a.stopLossInCustomerCcy.extend({validation:{validator:function(){return u.Data.stopLossAmount.isValid()},params:u.Data.stopLossAmount}}),a.stopLossInCustomerCcy.extend({incremental:{ranges:[{from:0,to:10,step:1},{from:10,to:100,step:5},{from:100,to:1e3,step:50},{from:1e3,to:Number.MAX_VALUE,step:500}]}}),a.stopLossInCustomerCcy.extend({notify:"always"}),a.takeProfitInCustomerCcy.extend({validation:{validator:function(){return u.Data.takeProfitAmount.isValid()},params:u.Data.takeProfitAmount}}),a.takeProfitInCustomerCcy.extend({incremental:{ranges:[{from:0,to:10,step:1},{from:10,to:100,step:5},{from:100,to:1e3,step:50},{from:1e3,to:Number.MAX_VALUE,step:500}]}}),a.takeProfitInCustomerCcy.extend({notify:"always"})};return{init:function(e,t){u=e,c=t,i(),o(),n()},Data:a,dispose:function(){t.dispose.call(e),c=u=null}}})}),define("viewModels/Limits/EditLimitBaseViewModel",["require","knockout","KoComponentViewModel","editLimitSettings","Dictionary","dalOrders","BaseOrder","SetLimitsViewModel","RateFieldModel","ViewModelsManager","ActiveLimitsManager","InstrumentTranslationsManager","InstrumentsManager","QuotesManager","ExpirationDateModel","CustomerProfileManager","Customer","SymbolsManager","AlertsManager","StateObject!Transaction","ViewsManager","BuilderForInBetweenQuote","FxNet/LogicLayer/Deal/DealAmountLabel","viewModels/Limits/AmountFieldsWrapper","ClientStateFlagsManager","LimitRangesCalculator"],function(e){var w=e("knockout"),L=e("Dictionary"),t=e("KoComponentViewModel"),A=e("editLimitSettings"),I=e("dalOrders"),M=e("BaseOrder"),P=e("SetLimitsViewModel"),R=e("ViewModelsManager"),V=e("ActiveLimitsManager"),k=e("InstrumentTranslationsManager"),F=e("InstrumentsManager"),x=e("QuotesManager"),N=e("ExpirationDateModel"),O=e("CustomerProfileManager"),E=e("Customer"),B=e("SymbolsManager"),G=e("AlertsManager"),U=e("StateObject!Transaction"),q=e("ViewsManager"),H=e("BuilderForInBetweenQuote"),Q=e("FxNet/LogicLayer/Deal/DealAmountLabel"),j=e("viewModels/Limits/AmountFieldsWrapper"),K=e("ClientStateFlagsManager"),_=e("RateFieldModel"),W=e("LimitRangesCalculator");return extendClass(t,function(){var i=this,o=this.parent,d=this.Data,l=null,n=null,u=null,e={},r=new M,s=new j,m=new N,b=new P,c=new _;function p(e,t){var a={First:0,Middle:0,Last:0},i=Format.tenthOfPipSplitRate(e,t);return a.First=i.button.first,a.Middle=i.button.middle,a.Last=i.button.last,a}function f(){u=V.limits.GetItem(l);var e=F.GetInstrument(u.instrumentID),t=d.orderDir();W.CalculateOpeningRanges(d.bid(),d.ask(),t,d.openLimitLowerRange,d.openLimitHigherRange,e,K.CSFlags.limitMultiplier);var a=t===eOrderDir.Sell?d.openLimitLowerRange.near():d.openLimitHigherRange.near();d.lowerRangeNear(Format.toRate(a,!0,d.instrumentID()));var i=t===eOrderDir.Sell?d.openLimitHigherRange.near():d.openLimitLowerRange.near();d.higherRangeNear(Format.toRate(i,!0,d.instrumentID())),d.lowerRangeNearLabel(p(d.lowerRangeNear(),d.instrumentID())),d.higherRangeNearLabel(p(d.higherRangeNear(),d.instrumentID()));var o=t===eOrderDir.Sell?d.openLimitLowerRange.far():d.openLimitHigherRange.far(),n=Math.min(d.openLimitHigherRange.near(),d.openLimitLowerRange.near()),r=Math.max(d.openLimitHigherRange.near(),d.openLimitLowerRange.near()),s=t===eOrderDir.Sell?d.openLimitHigherRange.far():d.openLimitLowerRange.far();c.pipDigit(e.PipDigit),c.precision(e.DecimalDigit),c.min1(o),c.max1(n),c.min2(r),c.max2(s)}function g(){if((u=V.limits.GetItem(l))&&(n=x.Quotes.GetItem(u.instrumentID))){d.isActiveQuote(n.state!=eQuoteStates.NotActive),d.prevBid(d.bid()),d.prevAsk(d.ask()),d.bid(n.bid),d.ask(n.ask),d.changePips(n.changePips),d.open(n.open),d.close(n.close),d.change(Format.toPercent(n.change)),d.tradeTime(n.tradeTime),d.highBid(n.highBid),d.lowAsk(n.lowAsk);var e=u.orderDir==eOrderDir.Buy?n.ask:n.bid;d.spotRateLabel(p(e,u.instrumentID)),f()}}function v(e){if(e.newLimits&&0<e.newLimits.length){l=e.newLimits[0];var t=V.limits.GetItem(l);t&&(d.openLimit(t.orderRate),d.openLimit.markClean())}}function a(){return!!(u=V.limits.GetItem(l))||(G.UpdateAlert(AlertTypes.ServerResponseAlert,null,String.format("{0}",L.GetItem("OrderError7")),null,{redirectToView:eForms.Limits}),G.PopAlert(AlertTypes.ServerResponseAlert),!1)}function t(e,t,a){d.onRemoveLimitEnable(!0),d.isProcessing(!1);var i=F.GetInstrument(d.instrumentID());i&&r.OnActionReturn(e,t,i,{redirectToView:eForms.Limits,requestData:a})}function D(e){e.positionNumber=0,e.instrumentID=d.instrumentID(),e.amount=d.selectedDealAmount(),e.orderDir=d.orderDir(),e.limitRate=d.openLimit(),e.ifDoneSLRate=""==b.ObservableSetLimitsObject.stopLossRate()?0:b.ObservableSetLimitsObject.stopLossRate(),e.ifDoneTPRate=""==b.ObservableSetLimitsObject.takeProfitRate()?0:b.ObservableSetLimitsObject.takeProfitRate(),e.expirationDate=function(){var e=null;if(!m.Data.expirationDateSelector.IsGoodTillCancelChecked()){e=m.Data.expirationDate();var t=m.Data.selectedHoursValue();isObjectType(t)&&isEmptyType(t)?e+="  "+t.value:isStringType(t)&&!isEmptyType(t)?e+="  "+t:e+="  00:00"}return e}(),e.mode=eLimitMode.OpenDeal,e.type=eLimitType.None}var S=debounce(function(){d.EditLimitReady()&&(b.Validate().length?A.showValidationTooltips&&(w.postbox.publish("deal-slip-show-validation-tooltips"),d.showLimits(!0)):y())});function y(){if(a()&&(u=V.limits.GetItem(l),r.LimitValidate(u.instrumentID,b.Validate())&&r.LimitValidateQuote(u.instrumentID))){var e=new TLimit(u.orderID);if(D(e),t=e,d.enableSLLimit()&&0===t.ifDoneSLRate||d.enableTPLimit()&&0===t.ifDoneTPRate)return G.UpdateAlert(AlertTypes.GeneralOkAlert,L.GetItem("pleaseNoteTitle"),L.GetItem("sltpValidationMsg","deals_EditLimit"),null,{okButtonCallback:C}),void G.PopAlert(AlertTypes.GeneralOkAlert);e.removedIfDoneSLRate=0==parseFloat(e.ifDoneSLRate)&&0<parseFloat(u.slRate),e.removedIfDoneTPRate=0==parseFloat(e.ifDoneTPRate)&&0<parseFloat(u.tpRate),d.onSaveLimitEnable(!1),d.isProcessing(!0),I.EditLimit(e,T)}var t}function T(e,t,a){d.onSaveLimitEnable(!0),u=V.limits.GetItem(l);var i,o=F.GetInstrument(u.instrumentID);o&&(r.ResultStatusSuccess(e)&&((i=O.ProfileCustomer()).defaultEditSlLimitTab=b.Data.curSlActiveTab(),i.defaultEditTpLimitTab=b.Data.curTpActiveTab(),O.ProfileCustomer(i)),d.isProcessing(!1),d.isShowEditableRate(!1),b.MarkClean(),r.OnActionReturn(e,t,o,{redirectToView:eForms.Limits,requestData:a}))}function C(){d.enableSLLimit(!1),d.enableTPLimit(!1),y()}function h(){b.SetActiveTab(eSetLimitsTabs.Rate)}return{init:function(e){var t,a;o.init.call(i,e),r.Init({},d),m.Init(),d.PageName=R.VManager.GetViewArgs(eViewTypes.vEditLimit).pageName,d.ccyPair=U.set("ccyPair",w.observable("")),d.orderID=w.observable(""),d.entryTime=w.observable(""),d.instrumentID=w.observable(0),d.dealAmountLabel=w.observable(""),d.selectedDealAmount=U.set("selectedDealAmount",w.observable("").extend({dirty:!1})),d.buySymbol=w.observable(""),d.sellSymbol=w.observable(""),d.orderDir=U.set("orderDir",w.observable("")),d.isNonForex=w.observable(!0),d.bid=U.set("bid",w.observable("")),d.ask=U.set("ask",w.observable("")),d.spotRateLabel=w.observable(""),d.isActiveQuote=U.set("isActiveQuote",w.observable(!1)),d.openLimit=w.observable("").extend({dirty:!1,rate:!0}),d.openLimitLowerRange=new LimitRange,d.openLimitHigherRange=new LimitRange,d.lowerRangeNear=w.observable("").extend({dirty:!1}),d.higherRangeNear=w.observable("").extend({dirty:!1}),d.decimalDigit=w.observable(0),d.limitCalc=w.observable("").extend({dirty:!1}),d.onSaveLimitEnable=w.observable(""),d.setLimitsIsDirty=w.observable(!1),d.templateToUse=w.observable(""),d.isShowEditableRate=w.observable(""),d.ready=w.observable(!1),d.hasInstrument=w.observable(!1),d.customerSymbolId=w.observable(E.prop.baseCcyId()),d.onRemoveLimitEnable=w.observable(!0),d.isProcessing=w.observable(!1),d.limitType=w.observable(eLimitType.None),d.baseSymbolId=w.observable(""),d.otherSymbolId=w.observable(""),d.lowerRangeNearLabel=w.observable(""),d.higherRangeNearLabel=w.observable(""),d.expirationDate=w.observable(""),d.isStock=w.observable(!1),d.selectedInstrument=U.set("selectedInstrument",w.observable("")),d.profileKeyForDefaultTab=w.observable(A.profileKeyForDefaultTab),d.initialToolTab=U.set("initialToolTab",w.observable("")),d.customerSymbolName=U.set("customerSymbolName",w.observable("")),d.changePips=w.observable(""),d.quoteForOtherCcyToAccountCcy=U.get("quoteForOtherCcyToAccountCcy"),d.quoteForOtherCcyToAccountCcy?d.quoteForOtherCcyToAccountCcy(""):d.quoteForOtherCcyToAccountCcy=U.set("quoteForOtherCcyToAccountCcy",w.observable("")),d.quoteForAccountCcyToOtherCcy=w.observable(""),d.amountSymbol=U.set("amountSymbol",w.observable("")),d.bidPips=w.observable(""),d.askPips=w.observable(""),d.isFuture=U.set("isFuture",w.observable("")),d.isShare=U.set("isShare",w.observable("")),d.open=U.set("open",w.observable("")),d.close=U.set("close",w.observable("")),d.change=U.set("change",w.observable("")),d.tradeTime=U.set("tradeTime",w.observable("")),d.highBid=U.set("highBid",w.observable("")),d.lowAsk=U.set("lowAsk",w.observable("")),d.isForex=w.observable(""),d.prevBid=w.observable(""),d.prevAsk=w.observable(""),d.enableSLLimit=w.observable(!1),d.enableTPLimit=w.observable(!1),d.enableLimitLevel=w.observable(!1),d.showLimits=w.observable(!1).extend({notify:"always"}),d.limitsReady=w.observable(!1),d.isSlRateActiveTab=w.observable(!1),d.displaySlPercentSymbol=w.observable(!1),d.displayTpPercentSymbol=w.observable(!1),d.isSlAmountActiveTab=w.observable(!1),d.isSlPercentActiveTab=w.observable(!1),d.isTpRateActiveTab=w.observable(!1),d.isTpAmountActiveTab=w.observable(!1),d.isTpPercentActiveTab=w.observable(!1),d.displaySlAmountCcySymbol=w.observable(!1),d.displayTpAmountCcySymbol=w.observable(!1),d.slRate=w.observable("").extend({dirty:!1}),d.tpRate=w.observable("").extend({dirty:!1}),d.customerSymbolName(E.prop.baseCcyName()),d.initialToolTab(O.ProfileCustomer()[A.profileKeyForDefaultTab]||eNewDealTool.Chart),d.addSlTpType=w.observable(eLimitType.None),d.isShowBuyBox=i.createComputed(function(){return d.orderDir()===eOrderDir.Buy}),d.isShowSellBox=i.createComputed(function(){return d.orderDir()===eOrderDir.Sell}),d.setLimitsIsDirty=i.createComputed(function(){var e=d.limitsReady();if(!e)return!1;var t=toNumeric(d.slRate.originalValue()),a=toNumeric(b.Data.stopLossRate()||"0"),i=t!==a,o=toNumeric(d.tpRate.originalValue()),n=toNumeric(b.Data.takeProfitRate()||"0"),r=o!==n;return!(!i&&!r)}),d.baseSymbolName=i.createComputed(function(){return d.orderDir()==eOrderDir.Buy?d.buySymbol():d.sellSymbol()}),d.ViewModelReady=i.createComputed(function(){if(d.ready())return!0;var e=d.hasInstrument(),t=d.limitsReady(),a=e&&t;return d.ready(a),a}),d.ValidationRules=i.createComputed(function(){if(d.lowerRangeNear()==d.higherRangeNear())return d.openLimit.rules;d.openLimit.rules.removeAll();var e={};return d.orderDir()===eOrderDir.Buy?(e.minfar=toNumeric(Format.toRate(d.openLimitHigherRange.far(),!0,d.instrumentID())),e.minnear=toNumeric(Format.toRate(d.openLimitHigherRange.near(),!0,d.instrumentID())),e.maxnear=toNumeric(Format.toRate(d.openLimitLowerRange.near(),!0,d.instrumentID())),e.maxfar=toNumeric(Format.toRate(d.openLimitLowerRange.far(),!0,d.instrumentID()))):(e.minfar=toNumeric(Format.toRate(d.openLimitLowerRange.far(),!0,d.instrumentID())),e.minnear=toNumeric(Format.toRate(d.openLimitLowerRange.near(),!0,d.instrumentID())),e.maxnear=toNumeric(Format.toRate(d.openLimitHigherRange.near(),!0,d.instrumentID())),e.maxfar=toNumeric(Format.toRate(d.openLimitHigherRange.far(),!0,d.instrumentID()))),{required:!0,rangeInterval:e,rate:{message:L.GetItem("limitLevelInvalid"),params:!0},toNumericLength:{ranges:[{from:0,to:Number.MAX_SAFE_INTEGER,decimalDigits:d.decimalDigit()}]}}}).extend({notify:"always"}),d.EditLimitReady=i.createComputed(function(){var e=d.isActiveQuote(),t=d.openLimit.isDirty(),a=!!d.setLimitsIsDirty(),i=m.Data.isExpirationDateDirty(),o=!!d.openLimit&&d.openLimit.isValid(),n=!A.showValidationTooltips&&0<b.Validate().length,r=t||a||i,s=d.onSaveLimitEnable(),l=m.IsValid(),u=E.prop.brokerAllowLimitsOnNoRates,c=(u||e)&&s&&l&&r&&o&&!n;return c}).extend({notify:"always"}),i.subscribeTo(d.ValidationRules,function(){d.openLimit.extend(d.ValidationRules())}),i.subscribeTo(d.openLimit,function(e){var t=toNumeric(e);isNullOrUndefined(d.openLimitLowerRange)||isNullOrUndefined(d.openLimitHigherRange)||(InRange(t,d.openLimitLowerRange)||InRange(t,d.openLimitHigherRange))&&d.limitCalc(t)}),function(){if(l=R.VManager.GetViewArgs(eViewTypes.vEditLimit).orderId,d.onSaveLimitEnable(!0),d.onRemoveLimitEnable(!0),u=V.limits.GetItem(l)){d.orderID(l),d.entryTime(u.entryTime),d.limitType(u.type),d.instrumentID(u.instrumentID),d.ccyPair(k.Long(u.instrumentID)),d.selectedDealAmount(u.orderDir==eOrderDir.Sell?u.sellAmount:u.buyAmount),d.buySymbol(B.GetTranslatedSymbolById(u.buySymbolID)),d.sellSymbol(B.GetTranslatedSymbolById(u.sellSymbolID)),d.orderDir(u.orderDir),d.limitCalc(u.orderRate),d.selectedInstrument(u.instrumentID),d.templateToUse(eTemplateNames.editLimitNavigator),d.isShowEditableRate(!1),d.openLimit(u.orderRate),d.expirationDate(u.expirationDate),d.slRate(u.slRate),d.slRate.markClean(),d.tpRate(u.tpRate),d.tpRate.markClean();var e=F.GetInstrument(u.instrumentID);if(e){var t=Q.Translate(e);d.dealAmountLabel(t.label),d.isNonForex(e.instrumentTypeId!==eInstrumentType.Currencies),d.decimalDigit(e.DecimalDigit),c.precision(e.DecimalDigit),d.amountSymbol(e.otherSymbol),d.isFuture(e.isFuture),d.isForex(e.isForex),d.isShare(e.isShare),d.enableSLLimit(!1),d.enableTPLimit(!1),d.baseSymbolId(e.baseSymbol),d.otherSymbolId(e.otherSymbol),a=e,H.GetInBetweenQuote(a.otherSymbol,E.prop.baseCcyId()).then(function(e){d.quoteForOtherCcyToAccountCcy(e)}).done(),H.GetInBetweenQuote(E.prop.baseCcyId(),a.otherSymbol).then(function(e){d.quoteForAccountCcyToOtherCcy(e)}).done(),m.UpdateSelectedWithToday(u.instrumentID),d.hasInstrument(!0),d.isStock(e.isStock)}!isEmpty(u.expirationDate)&&A.showExpirationCalendar&&m.SetOrder(u.orderID)}var a;d.openLimit.markClean(),n&&f()}(),x.OnChange.Add(g),V.OnChange.Add(v),g(),b.Init(d,i.getSettings().setlimitsConfiguration),s.init(b,d),t=R.VManager.GetViewArgs(eViewTypes.vEditLimit).limitType,a=O.ProfileCustomer(),d.showLimits(1===a.editLimitIfDoneExpanded),(u=V.limits.GetItem(l))&&(t&&(d.showLimits(!0),d.addSlTpType(t)),t===eLimitType.StopLoss&&d.enableSLLimit(!0),t===eLimitType.TakeProfit&&d.enableTPLimit(!0),isNullOrUndefined(u.slRate)||0==u.slRate||d.enableSLLimit(!0),isNullOrUndefined(u.tpRate)||0==u.tpRate||d.enableTPLimit(!0)),U.update("stopLossRate",b.Data.stopLossRate),U.update("takeProfitRate",b.Data.takeProfitRate),U.update("openLimit",d.openLimit),U.update("chart",q.GetViewArgs(eViewTypes.vEditLimit).chart),U.update("switchToRate",h),U.update("currentRateDirectionSwitch",q.GetViewArgs(eViewTypes.vEditLimit).currentRateDirectionSwitch)},dispose:function(){b.Stop(),x.OnChange.Remove(g),V.OnChange.Remove(v),e.Limits&&e.Limits.isValid&&e.Limits.isValid.dispose(),e.Limits=null,s.dispose(),s=null,U.unset("cachedOvernightFinancing"),U.unset("currentRateDirectionSwitch"),o.dispose.call(i)},Data:d,BaseOrder:r,EditLimit:S,ExpirationDate:m,SetLimitsInfo:b.ObservableSetLimitsObject,SetLimitsViewProperties:b.ViewProperties,TPField:b.TPField,SLField:b.SLField,FieldWrappers:s,DeleteLimit:function(){if(d.onRemoveLimitEnable()&&a()&&(u=V.limits.GetItem(l),r.LimitValidate(u.instrumentID,b.Validate())&&r.LimitValidateQuote(u.instrumentID))){var e=new TLimit(u.orderID);D(e),d.isProcessing(!0),d.onRemoveLimitEnable(!1),I.DeleteLimit(e,t)}},LimitLevelField:c,ValidationModel:e,SetLimitsViewModel:b,setLimitTabsFromClientProfile:function(){var e=O.ProfileCustomer();e.defaultEditSlLimitTab?b.SetSlActiveTab(e.defaultEditSlLimitTab):b.SetSlActiveTab(eSetLimitsTabs.Amount),e.defaultEditTpLimitTab?b.SetTpActiveTab(e.defaultEditTpLimitTab):b.SetTpActiveTab(eSetLimitsTabs.Amount)},FillLimitData:D}})}),define("ExpirationDateModel",["require","knockout","CacheManager","ActiveLimitsManager","ExpirationDateSelectorModel","DialogViewModel"],function(e){var g=e("knockout"),v=e("CacheManager"),D=e("ActiveLimitsManager"),S=e("ExpirationDateSelectorModel"),y=e("DialogViewModel");return function(){var c,d={},t=[],e=function(){d.expirationDate=g.observable("").extend({dirty:!1}),d.expirationTime=g.observable("").extend({dirty:!1}),d.selectedExpirationDateTime=g.observable("").extend({dirty:!1}),d.isDateTimeApplied=g.observable(!1),d.maxExpirationDate=g.observable(""),d.minExpirationDate=g.observable(""),d.hoursList=g.observableArray([]),d.selectedHoursValue=g.observable("")},a=function(){d.expirationDate.extend({validation:{validator:u}}),d.selectedHoursValue.extend({validation:{validator:m}})},i=function(){d.expirationDateTime=g.computed(function(){return String.format("{0} {1}",pad(this.expirationDate(),2),pad(this.expirationTime(),2))},d),t.push(d.expirationDateTime),d.isDirty=g.computed(function(){return d.expirationDate.isDirty()||d.expirationTime.isDirty()}),t.push(d.isDirty),d.isExpirationDateDirty=g.computed(function(){var e=d.selectedExpirationDateTime(),t=d.selectedExpirationDateTime.originalValue();return!!d.isDateTimeApplied()&&e!==t}),t.push(d.isExpirationDateDirty)},o=function(){t.push(d.expirationDate.subscribe(function(e){isEmptyType(e)||l()})),t.push(d.selectedHoursValue.subscribe(function(e){d.expirationTime(e)}))},n=function(e){var t,a,i,o=s(e);t=o,a=String.format("{0} {1}",t.date,t.time),d.maxExpirationDate(str2Date(a,"d/m/Y H:M")),i=String.format("{0} {1}",v.ServerTime().ExtractDate(),v.ServerTime().ExtractTime()),d.minExpirationDate(str2Date(i,"d/m/Y H:M"))},r=function(){var e=new Date(v.ServerTime().getTime());return e.setHours(23),e.setMinutes(59),e.skipWeekendDays(),e},s=function(e){c=e;var t,a=$instrumentsManager.GetInstrument(c),i=new Date(v.ServerTime().getTime()).AddYear(1);return i.setHours(23),i.setMinutes(59),(t=a.isFuture?str2Date(a.expirationDate,"d/m/Y H:M"):a.expirationDate&&str2Date(a.expirationDate,"d/m/Y H:M")<i?str2Date(a.expirationDate,"d/m/Y H:M"):i)?t.skipWeekendDays():t=i,{date:SplitDateTime(t.ExtractDate()).date,time:t.ExtractTime()}},l=function(){var e=23,t=59,a=0;SplitDateTime(v.ServerTime().ExtractDate()).date==d.expirationDate()&&(a=v.ServerTime().getHours()+1);var i=$instrumentsManager.GetInstrument(c);if(i&&i.expirationDate){var o=SplitDateTime(i.expirationDate);o.date==d.expirationDate()&&(e=parseInt(o.hour,10),t=parseInt(o.min,10))}var n=d.selectedHoursValue(),r=0;if(!isEmptyType(n)){var s=n.split(":");r=60*parseInt(s[0],10)+parseInt(s[1],10)}var l=60*e+t;r<60*a?d.selectedHoursValue(String.format("{0}:00",pad(a,2))):l<r&&d.selectedHoursValue(String.format("{0}:{1}",pad(e,2),pad(t,2)));var u=[];fillHoursList(u,e,t,a),d.hoursList(u)},u=function(e){if(d.expirationDateSelector.IsGoodTillCancelChecked())return d.isDateTimeApplied(!0),d.selectedExpirationDateTime(""),!0;d.isDateTimeApplied(!1);var t=b(e,d.selectedHoursValue());return t>v.ServerTime()&&t<=d.maxExpirationDate()},m=function(e){if(d.expirationDateSelector.IsGoodTillCancelChecked())return d.isDateTimeApplied(!0),d.selectedExpirationDateTime(""),!0;d.isDateTimeApplied(!1);var t=b(d.expirationDate(),e);return t>v.ServerTime()&&t<=d.maxExpirationDate()},b=function(e,t){var a=e+" "+t,i=str2Date(a,"d/m/Y H:M");return d.selectedExpirationDateTime(a),i},p=function(){return d.selectedHoursValue.isValid()||d.expirationDateSelector.IsGoodTillCancelChecked()},f=function(){isDefinedType(y)&&y.close()};return{Data:d,SetOrder:function(e){var t=D.limits.GetItem(e);if(t){n(t.instrumentID);var a=r();!function(e,t){var a;if(isEmptyValue(e.expirationDate))d.expirationDate(t.date),d.selectedHoursValue(t.time),a=String.format("{0} {1}",pad(d.expirationDate(),2),pad(d.expirationTime(),2)),d.selectedExpirationDateTime(a),d.expirationDateSelector.ResetObservables();else{var i=SplitDateTime(e.expirationDate);d.expirationDate(i.date),d.selectedHoursValue(String.format("{0}:{1}",pad(i.hour,2),pad(i.min,2))),a=String.format("{0} {1}",pad(d.expirationDate(),2),pad(d.expirationTime(),2)),d.selectedExpirationDateTime(a),d.selectedExpirationDateTime.markClean(),d.expirationDateSelector.UpdateSelectedDateUI(d.expirationDateTime())}}(t,{date:SplitDateTime(a.ExtractDate()).date,time:a.ExtractTime()}),d.expirationDate.markClean(),d.expirationTime.markClean()}},UpdateSelectedWithToday:function(e){d.expirationDateSelector.ResetObservables(),n(e);var t=r();d.expirationDate(SplitDateTime(t.ExtractDate()).date),d.selectedHoursValue(t.ExtractTime())},IsValid:p,Init:function(){d.expirationDateSelector=new S,d.expirationDateSelector.Init(),e(),a(),i(),o()},OnExpirationDateTimeSet:function(){p()&&(d.expirationDateSelector.UpdateSelectedDateUI(d.expirationDateTime()),d.isDateTimeApplied(!0),f())},dispose:function(){if(0<t.length)for(var e=0;e<t.length;e++)t[e].dispose();t.length=0}}}}),define("ExpirationDateSelectorModel",["require","knockout","Dictionary","DialogViewModel"],function(e){var u=e("knockout"),c=e("Dictionary"),d=e("DialogViewModel");return function(e){var t={},a={title:c.GetItem("EditLimitExpirationDate"),width:420,dialogClass:"fx-dialog expPopup",onCloseCallback:function(){s()}};u.utils.extend(a,e||{});var i=function(){t.isGoodTillCancel=u.observable(!0),t.expirationDateValue=u.observable("")},o=function(){t.isGoodTillCancel.subscribe(function(){n()})},n=function(){l()||r()},r=function(){isDefinedType(d)&&d.open(eDialog.EditLimitExpirationDate,a,eViewTypes.vEditLimitExpirationDate)},s=function(){isEmpty(t.expirationDateValue())&&t.isGoodTillCancel(!0)},l=function(){return!0===t.isGoodTillCancel()};return{Init:function(){i(),o()},Data:t,IsGoodTillCancelChecked:l,OnOptionChanged:n,UpdateSelectedDateUI:function(e){t.expirationDateValue(e),t.isGoodTillCancel(!1)},ResetObservables:function(){t.isGoodTillCancel(!0),t.expirationDateValue("")}}}}),define("viewModels/Limits/LimitBaseViewModel",["require","Dictionary","knockout","KoComponentViewModel","newLimitSettings","ExpirationDateModel","ViewsManager","FxNet/LogicLayer/Deal/DealAmountLabel","SymbolsManager","QuotesManager","BaseOrder","SetLimitsViewModel","RateFieldModel","Customer","CustomerProfileManager","InstrumentsManager","RegistrationManager","BuilderForInBetweenQuote","StateObject!Transaction","ClientStateFlagsManager","LimitRangesCalculator","LimitValuesCalculator"],function(e){var g=e("knockout"),t=e("KoComponentViewModel"),v=e("newLimitSettings"),a=e("ExpirationDateModel"),D=e("ViewsManager"),S=e("FxNet/LogicLayer/Deal/DealAmountLabel"),y=e("SymbolsManager"),i=e("QuotesManager"),o=e("BaseOrder"),n=e("SetLimitsViewModel"),T=e("RateFieldModel"),C=e("Customer"),h=e("CustomerProfileManager"),w=e("InstrumentsManager"),L=e("RegistrationManager"),A=e("BuilderForInBetweenQuote"),I=e("StateObject!Transaction"),M=e("ClientStateFlagsManager"),P=e("LimitRangesCalculator");return extendClass(t,function(){var s=this,r=this.parent,l=this.Data,u=new o,c=new a,d=new n,m=new T;function b(){var e=D.GetActiveFormViewProperties(eViewTypes.vTransactionSwitcher),t=D.GetActiveFormViewProperties(eViewTypes.vNewPriceAlert);return e&&e.visible()?e.args||{}:!(!t||!t.visible())&&(t.args||{})}function p(e){e!=eOrderDir.Buy&&e!=eOrderDir.Sell&&e!=eOrderDir.None&&(e=eOrderDir.None),l.orderDir(e),l.activeQuote&&s.updateDistances()}function f(){l.activeQuote=i.Quotes.GetItem(l.selectedInstrument()),l.activeQuote&&(l.isActiveQuote(l.activeQuote.state!==eQuoteStates.NotActive),l.bid(l.activeQuote.bid),l.ask(l.activeQuote.ask),l.open(l.activeQuote.open),l.close(l.activeQuote.close),l.change(Format.toPercent(l.activeQuote.change)),l.formattedChange(Format.toSignedPercent(l.activeQuote.change,"")),l.changePips(l.activeQuote.changePips),l.highBid(l.activeQuote.highBid),l.lowAsk(l.activeQuote.lowAsk),l.tradeTime(l.activeQuote.tradeTime),l.quotesAvailable(!0),l.activeQuoteState(l.activeQuote.state),s.updateDistances())}function e(){i.OnChange.Remove(f)}return s.updateDistances=function(){var e=l.orderDir()===eOrderDir.None?eOrderDir.Buy:l.orderDir(),t=w.GetInstrument(l.selectedInstrument());if(t){P.CalculateOpeningRanges(l.bid(),l.ask(),e,l.openLimitLowerRange,l.openLimitHigherRange,t,M.CSFlags.limitMultiplier);var a=e===eOrderDir.Sell?l.openLimitLowerRange.near():l.openLimitHigherRange.near();l.lowerRangeNear(Format.toRate(a,!0,l.selectedInstrument()));var i=e===eOrderDir.Sell?l.openLimitHigherRange.near():l.openLimitLowerRange.near();l.higherRangeNear(Format.toRate(i,!0,l.selectedInstrument()));var o=l.orderDir()===eOrderDir.Sell?l.openLimitLowerRange.far():l.openLimitHigherRange.far(),n=Math.min(l.openLimitHigherRange.near(),l.openLimitLowerRange.near()),r=Math.max(l.openLimitHigherRange.near(),l.openLimitLowerRange.near()),s=l.orderDir()===eOrderDir.Sell?l.openLimitHigherRange.far():l.openLimitLowerRange.far();m.pipDigit(t.PipDigit),m.precision(t.DecimalDigit),m.min1(o),m.max1(n),m.min2(r),m.max2(s)}},{init:function(e){r.init.call(s,e),u.Init({},l),c.Init(),l.ready=g.observable(!1),l.customerSymbolName=I.set("customerSymbolName",g.observable(C.prop.baseCcyName())),l.customerSymbolId=I.set("customerSymbolId",g.observable(C.prop.baseCcyId())),l.orderDir=I.set("orderDir",g.observable(eOrderDir.None).extend({dirty:!1})),l.selectedInstrument=I.set("selectedInstrument",g.observable()),l.selectedDealAmount=I.set("selectedDealAmount",g.observable()),l.selectedDealAmount.extend({notify:"always"}),l.selectedDealAmount.extend({amountValidation:[]}),l.amountSymbol=I.set("amountSymbol",g.observable("")),l.quoteForOtherCcyToAccountCcy=I.get("quoteForOtherCcyToAccountCcy"),l.quoteForBaseCcyToAccountCcy=I.get("quoteForBaseCcyToAccountCcy"),l.quoteForUsdCcyToAccountCcy=I.get("quoteForUsdCcyToAccountCcy"),l.bid=I.set("bid",g.observable("")),l.ask=I.set("ask",g.observable("")),l.initialToolTab=I.set("initialToolTab",g.observable("")),l.showTools=I.set("showTools",g.observable(1===h.ProfileCustomer().tools)),l.bidPips=I.set("bidPips",g.observable("")),l.askPips=I.set("askPips",g.observable("")),l.changePips=I.set("changePips",g.observable("")),l.tradeTime=I.set("tradeTime",g.observable("")),l.highBid=I.set("highBid",g.observable("")),l.lowAsk=I.set("lowAsk",g.observable("")),l.open=I.set("open",g.observable("")),l.close=I.set("close",g.observable("")),l.change=I.set("change",g.observable("")),l.isForex=I.set("isForex",g.observable(!1)),l.isFuture=I.set("isFuture",g.observable(!1)),l.isShare=I.set("isShare",g.observable(!1)),l.isStock=I.set("isStock",g.observable(!1)),l.isNonForex=g.observable(!0),l.hasInstrument=g.observable(!1),l.ccyPair=I.set("ccyPair",g.observable("")),l.activeQuote=null,l.isActiveQuote=I.set("isActiveQuote",g.observable(!1)),l.activeQuoteState=g.observable(),l.PageName=eDealPage.NewLimitViewModel,l.dealMinMaxAmounts=g.observableArray([]),l.dealAmountLabel=g.observable(""),l.openLimit=I.set("openLimit",g.observable("").extend({dirty:!1,rate:!0})),l.limitCalc=g.observable("").extend({dirty:!1}),l.enableSLLimit=g.observable(!1),l.enableTPLimit=g.observable(!1),l.limitsReady=g.observable(!1),l.enableLimitLevel=g.observable(!1),l.lowerRangeNear=g.observable("").extend({dirty:!1}),l.higherRangeNear=g.observable("").extend({dirty:!1}),l.openLimitLowerRange=new LimitRange,l.openLimitHigherRange=new LimitRange,l.decimalDigit=g.observable(0),l.bidLabel={First:g.observable(""),Middle:g.observable(""),Last:g.observable("")},l.askLabel={First:g.observable(""),Middle:g.observable(""),Last:g.observable("")},l.quotesAvailable=g.observable(!1),l.formattedChange=g.observable(""),l.baseSymbol=g.observable(""),l.baseSymbolName=g.observable(""),l.profileKeyForDefaultTab=g.observable(v.profileKeyForDefaultTab),l.isSlRateActiveTab=g.observable(!1),l.isSlAmountActiveTab=g.observable(!1),l.isSlPercentActiveTab=g.observable(!1),l.isTpRateActiveTab=g.observable(!1),l.isTpAmountActiveTab=g.observable(!1),l.isTpPercentActiveTab=g.observable(!1),l.displaySlPercentSymbol=g.observable(!1),l.displayTpPercentSymbol=g.observable(!1),l.displaySlAmountCcySymbol=g.observable(!1),l.displayTpAmountCcySymbol=g.observable(!1),l.isProcessing=g.observable(!1),l.quoteForAccountCcyToOtherCcy=g.observable(""),l.buyBtnClick=function(){l.enableLimitLevel(!0),p(eOrderDir.Buy)},l.sellBtnClick=function(){l.enableLimitLevel(!0),p(eOrderDir.Sell)},l.isShowBuyBox=s.createComputed(function(){return l.orderDir()===eOrderDir.Buy}),l.isShowSellBox=s.createComputed(function(){return l.orderDir()===eOrderDir.Sell}),l.ViewModelReady=s.createComputed(function(){if(l.ready())return!0;var e=l.hasInstrument(),t=l.limitsReady(),a=e&&t;return l.ready(a),a}),l.ValidationRules=s.createComputed(function(){if(l.lowerRangeNear()==l.higherRangeNear())return l.openLimit.rules;l.openLimit.rules.removeAll();var e={};return l.orderDir()===eOrderDir.Sell?(e.minfar=toNumeric(Format.toRate(l.openLimitLowerRange.far(),!0,l.selectedInstrument())),e.minnear=toNumeric(Format.toRate(l.openLimitLowerRange.near(),!0,l.selectedInstrument())),e.maxnear=toNumeric(Format.toRate(l.openLimitHigherRange.near(),!0,l.selectedInstrument())),e.maxfar=toNumeric(Format.toRate(l.openLimitHigherRange.far(),!0,l.selectedInstrument()))):(e.minfar=toNumeric(Format.toRate(l.openLimitHigherRange.far(),!0,l.selectedInstrument())),e.minnear=toNumeric(Format.toRate(l.openLimitHigherRange.near(),!0,l.selectedInstrument())),e.maxnear=toNumeric(Format.toRate(l.openLimitLowerRange.near(),!0,l.selectedInstrument())),e.maxfar=toNumeric(Format.toRate(l.openLimitLowerRange.far(),!0,l.selectedInstrument()))),{required:!0,rangeInterval:e,rate:{message:Dictionary.GetItem("limitLevelInvalid"),params:!0},toNumericLength:{ranges:[{from:0,to:Number.MAX_SAFE_INTEGER,decimalDigits:l.decimalDigit()}]}}}).extend({notify:"always"}),l.isUp=g.pureComputed(function(){return l.activeQuoteState()===eQuoteStates.Up}),l.isDown=g.pureComputed(function(){return l.activeQuoteState()===eQuoteStates.Down}),s.subscribeAndNotify(l.ask,function(e){var t=Format.tenthOfPipSplitRate(e,l.selectedInstrument());l.askLabel.First(t.button.first),l.askLabel.Middle(t.button.middle),l.askLabel.Last(t.button.last)}),s.subscribeAndNotify(l.bid,function(e){var t=Format.tenthOfPipSplitRate(e,l.selectedInstrument());l.bidLabel.First(t.button.first),l.bidLabel.Middle(t.button.middle),l.bidLabel.Last(t.button.last)}),s.subscribeChanged(l.selectedInstrument,function(e,t){t&&e!==t&&(l.selectedDealAmount(""),I.containsKey("skipReset")&&I.get("skipReset")||l.orderDir(eOrderDir.None))}),s.subscribeTo(l.selectedInstrument,function(e){var t,s=w.GetInstrument(e);if(s){l.quotesAvailable(!1),l.dealMinMaxAmounts([]),w.GetUpdatedInstrumentWithDealMinMaxAmounts(e).then(function(e){var t,a,i,o,n=s.isStock&&e.dealMinMaxAmounts&&1<e.dealMinMaxAmounts.length?(o=e.dealMinMaxAmounts,[Math.ceil(o[0]),Math.floor(o[1])]):e.dealMinMaxAmounts,r=s.isStock&&n&&1<n.length?(t=e.defaultDealSize,a=n,(i=Math.ceil(t))<a[1]?i:Math.floor(t)):e.defaultDealSize;l.dealMinMaxAmounts(n),l.selectedDealAmount.extend({amountValidation:n}),l.selectedDealAmount(l.selectedDealAmount()||r)}).done(),l.ccyPair(s.ccyPair),l.amountSymbol(s.otherSymbol),l.baseSymbol(s.baseSymbol),l.baseSymbolName(y.GetTranslatedSymbolById(s.baseSymbol)),l.isForex(s.isForex),l.isShare(s.isShare),l.isFuture(s.isFuture),l.isStock(s.isStock),l.isNonForex(s.instrumentTypeId!==eInstrumentType.Currencies),l.decimalDigit(s.DecimalDigit),m.precision(s.DecimalDigit),I.containsKey("skipReset")&&I.get("skipReset")||(l.enableSLLimit(!1),l.enableTPLimit(!1),l.enableLimitLevel(!1),l.openLimit(""),l.openLimit.markClean(),l.openLimit.isModified(!1));var a=S.Translate(s);l.dealAmountLabel(a.label),t=e,L.Update(eRegistrationListName.SingleQuote,t),f(),c.UpdateSelectedWithToday(e),A.GetInBetweenQuote(C.prop.baseCcyId(),s.otherSymbol).then(function(e){l.quoteForAccountCcyToOtherCcy(e)}).done(),l.hasInstrument(!0),function(e){var t=b();if(!isNullOrUndefined(t)&&!1!==t){t.instrumentId=e;var a=D.GetActiveFormViewProperties(eViewTypes.vTransactionSwitcher),i=D.GetActiveFormViewProperties(eViewTypes.vNewPriceAlert);a&&a.visible()?D.ChangeViewState(eViewTypes.vTransactionSwitcher,eViewState.Update,t):i&&i.visible()&&D.ChangeViewState(eViewTypes.vNewPriceAlert,eViewState.Update,t)}}(e)}else l.hasInstrument(!1)}),s.subscribeTo(l.openLimit,function(e){l.limitCalc(e)}),s.subscribeTo(l.ValidationRules,function(e){l.openLimit.extend(e)});var t=s.getSettings().setlimitsConfiguration;d.Init(l,t),a=b()||{},i=a.tab,o=l.selectedInstrument(),n=a.instrumentId||l.selectedInstrument()||w.GetUserDefaultInstrumentId(),l.selectedInstrument(n),o===n&&l.selectedInstrument.notifySubscribers(n),isInt(a.orderDir)&&p(a.orderDir),a.selectedDealAmount&&l.selectedDealAmount(a.selectedDealAmount),l.initialToolTab(isDefinedType(i)&&isDefinedType(eNewDealTool[i])?eNewDealTool[i]:h.ProfileCustomer()[v.profileKeyForDefaultTab]||eNewDealTool.Chart);var a,i,o,n},dispose:function(){e(),l.selectedDealAmount.extend({amountValidation:!1}),I.unset("cachedOvernightFinancing"),r.dispose.call(s)},Data:l,BaseOrder:u,SetLimitsModel:d,ExpirationDate:c,LimitLevelField:m,fillData:function(e){if(e.positionNumber=0,e.instrumentID=l.selectedInstrument(),e.amount=l.selectedDealAmount(),e.orderDir=l.orderDir(),e.limitRate=l.openLimit(),e.ifDoneSLRate=0,e.ifDoneTPRate=0,l.enableSLLimit()&&(e.ifDoneSLRate=""===d.Data.stopLossRate()?0:d.Data.stopLossRate()),l.enableTPLimit()&&(e.ifDoneTPRate=""===d.Data.takeProfitRate()?0:d.Data.takeProfitRate()),c.Data.expirationDateSelector.IsGoodTillCancelChecked())e.expirationDate=null;else{e.expirationDate=c.Data.expirationDate();var t=c.Data.selectedHoursValue();isObjectType(t)&&isEmptyType(t)?e.expirationDate+="  "+t.value:isStringType(t)&&!isEmptyType(t)?e.expirationDate+="  "+t:e.expirationDate+="  00:00"}e.mode=eLimitMode.OpenDeal,e.type=eLimitType.None},onOpenLimit:function(e,t,a,i){l.hasInstrument(!0),l.isProcessing(!1);var o,n=w.GetInstrument(a),r=s.getSettings().onSuccessRedirectTo;n&&(u.ResultStatusSuccess(e)&&(w.SetInstrumentDealAmount(a,i.amount),g.postbox.publish("new-limit-success",{instrument:l.ccyPair()}),(o=h.ProfileCustomer()).defaultSlOrderTab=d.Data.curSlActiveTab(),o.defaultTpOrderTab=d.Data.curTpActiveTab(),h.ProfileCustomer(o),l.openLimit(String.empty),p(eOrderDir.None),d.Data.stopLossRate(String.empty),d.Data.takeProfitRate(String.empty),l.enableSLLimit(!1),l.enableTPLimit(!1)),r?u.OnActionReturn(e,t,n,{redirectToView:r,requestData:i}):(u.RaiseErrorEvent(e,"new-limit-error-details",{}),u.OnActionReturn(e,t,n,{requestData:i})))},unRegisterFromDispatcher:e,registerToDispatcher:function(){i.OnChange.Add(f)},setLimitTabsFromClientProfile:function(){var e=h.ProfileCustomer();e.defaultSlOrderTab?d.SetSlActiveTab(e.defaultSlOrderTab):d.SetSlActiveTab(eSetLimitsTabs.Amount),e.defaultTpOrderTab?d.SetTpActiveTab(e.defaultTpOrderTab):d.SetTpActiveTab(eSetLimitsTabs.Amount)}}})}),define("RateFieldModel",["require","knockout"],function(e){var t=e("knockout");return function(){var a=this,i=t.observable(Number.MIN_VALUE),o=t.observable(Number.MAX_VALUE),n=t.observable(Number.MIN_VALUE),r=t.observable(Number.MAX_VALUE);a.minValidation=a.minValidation1=t.observable(Number.MIN_VALUE),a.maxValidation=a.maxValidation1=t.observable(Number.MAX_VALUE),a.minValidation2=t.observable(Number.MIN_VALUE),a.maxValidation2=t.observable(Number.MAX_VALUE),a.precision=t.observable(0),a.pipDigit=t.observable(0),a.startSpinFrom=t.observable(eStartSpinFrom.None),a.near=t.observable(),a.far=t.observable(),a.min=a.min1=t.pureComputed({read:i,write:function(e){var t=Format.roundToPip(e,a.pipDigit(),a.precision(),">");!1===t&&i(Number.MIN_VALUE),i(Number(t)),a.minValidation1(e)},owner:a}),a.max=a.max1=t.pureComputed({read:o,write:function(e){var t=Format.roundToPip(e,a.pipDigit(),a.precision(),"<");!1===t&&o(Number.MAX_VALUE),o(Number(t)),a.maxValidation1(e)},owner:a}),a.min2=t.pureComputed({read:n,write:function(e){var t=Format.roundToPip(e,a.pipDigit(),a.precision(),">");!1===t&&n(Number.MIN_VALUE),n(Number(t)),a.minValidation2(e)},owner:a}),a.max2=t.pureComputed({read:r,write:function(e){var t=Format.roundToPip(e,a.pipDigit(),a.precision(),"<");!1===t&&r(Number.MAX_VALUE),r(Number(t)),a.maxValidation2(e)},owner:a}),a.format=t.pureComputed(function(){var e=parseInt(a.precision(),10);return!isNaN(e)&&0<=e?"n"+e:"n"}),a.step=t.pureComputed(function(){var e=parseInt(a.pipDigit(),10);return isNaN(e)?1:1/Math.pow(10,e)})}}),define("SetLimitsViewModel",["require","knockout","Dictionary","VmHelpers","LimitValuesCalculator","LimitRangesCalculator","ViewModelBase","RateFieldModel"],function(e){var W=e("knockout"),z=e("Dictionary"),J=e("VmHelpers"),Y=e("LimitValuesCalculator"),$=e("LimitRangesCalculator"),X=e("ViewModelBase"),Z=e("RateFieldModel");return function(){var i,u,c={SLLimitLabel:{},TPLimitLabel:{}},o=clone(X),d=new Z,m=new Z,e={},n=[],t=[],b=1,p=2,f=3,g=4,v=5,D=6,r=function(){c.State.subscribe(function(e){switch(e){case eViewState.Start:a();break;case eViewState.Stop:s()}})},a=function(){y(),C(),I(),_()},s=function(){w(),T(),J.CleanKoObservableSimpleObject(c),x()},l=function(){c.stopLossAmount.extend({positiveInteger:{message:z.GetItem("depCC_InvalidAmount"),params:!0}}),c.takeProfitAmount.extend({positiveInteger:{message:z.GetItem("depCC_InvalidAmount"),params:!0}}),c.displaySLAmount.extend({validation:{validator:function(){return c.stopLossAmount.isValid()},params:c.stopLossAmount}}),c.displayTPAmount.extend({validation:{validator:function(){return c.takeProfitAmount.isValid()},params:c.takeProfitAmount}}),c.ccySLAmount.extend({validation:{validator:function(){return c.stopLossAmount.isValid()},params:c.stopLossAmount}}),c.ccyTPAmount.extend({validation:{validator:function(){return c.takeProfitAmount.isValid()},params:c.takeProfitAmount}}),c.stopLossRate.extend({rate:{message:z.GetItem("limitLevelInvalid"),params:!0}}),c.takeProfitRate.extend({rate:{message:z.GetItem("limitLevelInvalid"),params:!0}}),c.stopLossPercent.extend({min:-.001,max:1000.001}),c.takeProfitPercent.extend({min:-.001,max:1000.001})},S=function(e){var t=$instrumentsManager.GetInstrument(e);t&&(c.decimalDigit(t.DecimalDigit),c.stopLossRate.extend({toNumericLength:{ranges:[{from:0,to:Number.MAX_SAFE_INTEGER,decimalDigits:c.decimalDigit()}],isAllowNAValue:!0}}),c.takeProfitRate.extend({toNumericLength:{ranges:[{from:0,to:Number.MAX_SAFE_INTEGER,decimalDigits:c.decimalDigit()}],isAllowNAValue:!0}}))},y=function(){S(c.instrumentId()),n.push(c.displaySLLimit.subscribe(function(e){var t=e.substring(1,e.length),a={rate:{message:z.GetItem("limitLevelInvalid"),params:!0},min:m.minValidation(),max:m.maxValidation()};c.stopLossRate.rules.removeAll(),c.stopLossRate.extend(a),c.stopLossAmount.rules.removeAll(),c.stopLossAmount.extend({validation:{validator:function(e){var t=c.SLLimitLabel.MinAmount(),a=c.SLLimitLabel.MaxAmount(),i=Math.abs(e);return isEmptyValue(e)||isEmptyValue(t)||isEmptyValue(a)?c.stopLossRate.isValid():t<=i&&i<=a&&c.stopLossRate.isValid()},params:c.stopLossRate}}),c.stopLossPercent.rules.removeAll(),c.stopLossPercent.extend({validation:{validator:function(e){var t=c.SLLimitLabel.MinPercent(),a=c.SLLimitLabel.MaxPercent();return isEmptyValue(e)||isEmptyValue(t)||isEmptyValue(a)?c.stopLossRate.isValid():t<=e&&e<=a&&c.stopLossRate.isValid()},params:c.stopLossRate}});var i=Format.tenthOfPipSplitRate(t,c.instrumentId());c.SLLimitLabel.First(i.label.first),c.SLLimitLabel.Last(i.label.last)})),n.push(c.displayTPLimit.subscribe(function(e){var t=e.substring(1,e.length),a={rate:{message:z.GetItem("limitLevelInvalid"),params:!0},min:d.minValidation(),max:d.maxValidation()};c.takeProfitRate.rules.removeAll(),c.takeProfitRate.extend(a),c.takeProfitAmount.rules.removeAll(),c.takeProfitAmount.extend({validation:{validator:function(e){var t=c.TPLimitLabel.MinAmount(),a=c.TPLimitLabel.MaxAmount(),i=Math.abs(e);return isEmptyValue(e)||isEmptyValue(t)||isEmptyValue(a)?c.takeProfitRate.isValid():t<=i&&i<=a&&c.takeProfitRate.isValid()},params:c.takeProfitRate}}),c.takeProfitPercent.rules.removeAll(),c.takeProfitPercent.extend({validation:{validator:function(e){var t=c.TPLimitLabel.MinPercent(),a=c.TPLimitLabel.MaxPercent();return isEmptyValue(e)||isEmptyValue(t)||isEmptyValue(a)?c.takeProfitRate.isValid():t<=e&&e<=a&&c.takeProfitRate.isValid()},params:c.takeProfitRate}});var i=Format.tenthOfPipSplitRate(t,c.instrumentId());c.TPLimitLabel.First(i.label.first),c.TPLimitLabel.Last(i.label.last)}))},T=function(){if(0<t.length)for(var e=0;e<t.length;e++)t[e].dispose();t.length=0},C=function(){c.SLLimit=W.computed(B,c).extend({dirty:!1}),t.push(c.SLLimit),c.TPLimit=W.computed(E,c).extend({dirty:!1}),t.push(c.TPLimit),c.isRangeChanged=W.computed(function(){var e=c.SLLimit(),t=c.TPLimit();return!isEmptyType(e)&&0<toNumeric(e.substring(1,e.length))||!isEmptyType(t)&&0<toNumeric(t.substring(1,t.length))}),t.push(c.isRangeChanged),c.showsAvalibleSetLimits=W.computed(function(){return isDefinedType(c.limitCalc())?!(0!=c.isShowTabs()||!o.getSettings(i).isAvalibleSetLimits||!c.limitCalc().isDirty()):!(0!=c.isShowTabs()||!o.getSettings(i).isAvalibleSetLimits)},c),t.push(c.showsAvalibleSetLimits),c.isSlRateDirty=W.computed(function(){var e=c.stopLossRate.isDirty()&&c.stopLossRate.isValid(),t=c.curSlActiveTab()==eSetLimitsTabs.None,a=c.curSlActiveTab()==eSetLimitsTabs.Rate;return(t||a)&&e}).extend({notify:"always"}),t.push(c.isSlRateDirty),c.isSlAmountDirty=W.computed(function(){var e=c.stopLossAmount.isDirty()&&c.stopLossAmount.isValid(),t=c.curSlActiveTab()==eSetLimitsTabs.None,a=c.curSlActiveTab()==eSetLimitsTabs.Amount;return(t||a)&&e}).extend({notify:"always"}),t.push(c.isSlAmountDirty),c.isSlPercentDirty=W.computed(function(){var e=c.stopLossPercent.isDirty()&&c.stopLossPercent.isValid(),t=c.curSlActiveTab()==eSetLimitsTabs.None,a=c.curSlActiveTab()==eSetLimitsTabs.Percent;return(t||a)&&e}).extend({notify:"always"}),t.push(c.isSlPercentDirty),c.isTpRateDirty=W.computed(function(){var e=c.takeProfitRate.isDirty()&&c.takeProfitRate.isValid(),t=c.curTpActiveTab()==eSetLimitsTabs.None,a=c.curTpActiveTab()==eSetLimitsTabs.Rate;return(t||a)&&e}).extend({notify:"always"}),t.push(c.isTpRateDirty),c.isTpAmountDirty=W.computed(function(){var e=c.takeProfitAmount.isDirty()&&c.takeProfitAmount.isValid(),t=c.curTpActiveTab()==eSetLimitsTabs.None,a=c.curTpActiveTab()==eSetLimitsTabs.Amount;return(t||a)&&e}).extend({notify:"always"}),t.push(c.isTpAmountDirty),c.isTpPercentDirty=W.computed(function(){var e=c.stopLossPercent.isDirty()&&c.stopLossPercent.isValid(),t=c.curTpActiveTab()==eSetLimitsTabs.None,a=c.curTpActiveTab()==eSetLimitsTabs.Percent;return(t||a)&&e}).extend({notify:"always"}),t.push(c.isTpPercentDirty),c.isDirty=W.computed(function(){return c.isSlRateDirty()||c.isSlAmountDirty()||c.isSlPercentDirty()||c.isTpRateDirty()||c.isTpAmountDirty()||c.isTpPercentDirty()}).extend({notify:"always"}),t.push(c.isDirty),c.isCustomerCurrency=W.computed(function(){return c.customerCcyName().toLowerCase()==c.symbolName().toLowerCase()}),t.push(c.isCustomerCurrency)},h=function(){c.instrumentId=W.computed(function(){return u.selectedInstrument?u.selectedInstrument():u.instrumentId?u.instrumentId():u.instrumentID?u.instrumentID():void 0}),c.bid=W.computed(function(){return u.bid()}),c.ask=W.computed(function(){return u.ask()}),c.open=W.computed(function(){if(u.open)return u.open()}),c.close=W.computed(function(){if(u.close)return u.close()}),c.change=W.computed(function(){if(u.change)return u.change()}),c.ccyPair=W.computed(function(){if(u.ccyPair)return u.ccyPair()}),c.orderDir=W.computed(function(){if(u.orderDir)return u.orderDir()}),c.quoteForOtherCcyToAccountCcy=W.computed(function(){if(u.quoteForOtherCcyToAccountCcy)return u.quoteForOtherCcyToAccountCcy()}).extend({empty:!0}),c.symbolName=W.computed(function(){return u.symbolName?u.symbolName():u.baseSymbolName?u.baseSymbolName():void 0}),c.amountSymbol=W.computed(function(){if(u.amountSymbol)return u.amountSymbol()}),c.selectedDealAmount=W.computed(function(){return isDefinedType(u.selectedDealAmount)?toNumeric(u.selectedDealAmount()):void 0}),c.limitCalc=W.computed(function(){return isDefinedType(u.limitCalc)?u.limitCalc:isDefinedType(u.openLimit)?u.openLimit:void 0}),c.additionalPL=W.pureComputed(function(){return isDefinedType(u.additionalPL)?toNumeric(u.additionalPL()):void 0})},w=function(){if(0<n.length)for(var e=0;e<n.length;e++)n[e].dispose();n.length=0},L=function(){return{bid:c.limitCalc()?c.limitCalc():c.bid,ask:c.limitCalc()?c.limitCalc():c.ask}},A=function(e){if(isEmptyValue(e)||"NA"===e)return e;var t=parseFloat(e);return t=Math.abs(t),t=Math.ceil(t)},I=function(){var e=L(),t=e.bid,a=e.ask,i=debounce(function(){O()},50);n.push(t.subscribe(i)),n.push(a.subscribe(i)),n.push(c.selectedDealAmount.subscribe(function(){O()})),n.push(c.orderDir.subscribe(i)),n.push(c.quoteForOtherCcyToAccountCcy.subscribe(i)),n.push(c.SLLimit.subscribe(function(e){isEmptyValue(e)||i()})),n.push(c.TPLimit.subscribe(function(e){isEmptyValue(e)||i()})),n.push(c.stopLossAmount.subscribe(function(e){isEmptyType(e)?(c.stopLossPercent(""),c.stopLossRate(""),c.ccySLAmount(""),c.displaySLAmount("")):c.curSlActiveTab()===eSetLimitsTabs.Amount?(N(b),W.postbox.publish("stop-loss-changed","amount")):c.displaySLAmount(A(e))})),n.push(c.displaySLAmount.subscribe(function(e){c.curSlActiveTab()===eSetLimitsTabs.Amount&&c.stopLossAmount(e)})),n.push(c.stopLossPercent.subscribe(function(e){isEmptyType(e)?(c.stopLossAmount(""),c.stopLossRate(""),c.ccySLAmount(""),c.displaySLAmount("")):c.curSlActiveTab()===eSetLimitsTabs.Percent&&(N(f),W.postbox.publish("stop-loss-changed","percent"))})),n.push(c.stopLossRate.subscribe(function(e){if(isEmptyType(e))return c.stopLossAmount(""),c.stopLossPercent(""),c.ccySLAmount(""),c.displaySLAmount(""),void c.displaySLSummary(!1);c.curSlActiveTab()!==eSetLimitsTabs.Rate&&c.curSlActiveTab()!=c.defaultTab||(N(p),W.postbox.publish("stop-loss-changed","rate"));var t=Format.toRate(e,!0,c.instrumentId()),a=Format.tenthOfPipSplitRate(t,c.instrumentId());c.SLRateLabel.First(a.label.first),c.SLRateLabel.Last(a.label.last),c.displaySLSummary(!0)})),n.push(c.takeProfitAmount.subscribe(function(e){isEmptyType(e)?(c.takeProfitPercent(""),c.takeProfitRate(""),c.ccyTPAmount(""),c.displayTPAmount("")):c.curTpActiveTab()===eSetLimitsTabs.Amount?(N(g),W.postbox.publish("take-profit-changed","amount")):c.displayTPAmount(A(e))})),n.push(c.displayTPAmount.subscribe(function(e){c.curTpActiveTab()===eSetLimitsTabs.Amount&&c.takeProfitAmount(e)})),n.push(c.takeProfitPercent.subscribe(function(e){isEmptyType(e)?(c.takeProfitAmount(""),c.takeProfitRate(""),c.ccyTPAmount(""),c.displayTPAmount("")):c.curTpActiveTab()===eSetLimitsTabs.Percent&&(N(D),W.postbox.publish("take-profit-changed","percent"))})),n.push(c.takeProfitRate.subscribe(function(e){if(isEmptyType(e))return c.takeProfitAmount(""),c.takeProfitPercent(""),c.ccyTPAmount(""),c.displayTPAmount(""),void c.displayTPSummary(!1);c.curTpActiveTab()!==eSetLimitsTabs.Rate&&c.curTpActiveTab()!=c.defaultTab||(N(v),W.postbox.publish("take-profit-changed","rate"));var t=Format.toRate(e,!0,c.instrumentId()),a=Format.tenthOfPipSplitRate(t,c.instrumentId());c.TPRateLabel.First(a.label.first),c.TPRateLabel.Last(a.label.last),c.displayTPSummary(!0)})),n.push(c.isShowTabs.subscribe(function(e){!0===e&&(u.slRate&&!isEmptyType(u.slRate())&&toNumeric(u.slRate())?c.stopLossRate(u.slRate()):c.stopLossRate(""),u.tpRate&&!isEmptyType(u.tpRate())&&toNumeric(u.tpRate())?c.takeProfitRate(u.tpRate()):c.takeProfitRate(""),x())})),n.push(c.instrumentId.subscribe(function(){S(c.instrumentId())}))},M=function(){e.isNewLimit=function(){return o.getSettings(i).parentView==eViewTypes.vNewLimit},e.isNewDeal=function(){return o.getSettings(i).parentView==eViewTypes.vNewDeal||o.getSettings(i).parentView==eViewTypes.vNewDealSlip}},P=function(e,t){var a,i,o,n,r=L(),s=W.utils.unwrapObservable(e);if(!s)return"";if(c.quoteForOtherCcyToAccountCcy.isEmpty())return"";if(a=s.substring(0,1),i=s.substring(1,s.length),o=parseFloat(i),t==eLimitType.StopLoss&&(n=c.SLRange),t==eLimitType.TakeProfit&&(n=c.TPRange),!isDefinedType(n))return"";">"===a&&(o+=1/Math.pow(10,c.decimalDigit())),"<"===a&&(o-=1/Math.pow(10,c.decimalDigit()));var l=Y.CalculateValuesFromRate(r.bid(),r.ask(),o,c.orderDir(),t,c.selectedDealAmount(),n,c.quoteForOtherCcyToAccountCcy(),c.instrumentId());return l.isValid?l:""},R=function(e,t){var a=Math.pow(10,t);return Math.ceil(e*a)/a},V=function(e,t){var a=Math.pow(10,t);return Math.round(e*a)/a},k=function(e,t){var a=Math.pow(10,t);return Math.floor(e*a)/a},F=function(){e.isAdvancedView=W.observable(!1),c.SLRateLabel={First:W.observable(""),Last:W.observable("")},c.TPRateLabel={First:W.observable(""),Last:W.observable("")},c.SLLimitLabel.First=W.observable(""),c.SLLimitLabel.Last=W.observable(""),c.SLLimitLabel.BaseCcyAboveAmount=W.observable("").extend({empty:!0}),c.SLLimitLabel.BaseCcyMinAmount=W.observable(""),c.SLLimitLabel.BaseCcyMaxAmount=W.observable(""),c.SLLimitLabel.MinAmount=W.computed(function(){var e=P(m.near,eLimitType.StopLoss),t="",a="",i="";return isEmptyValue(e)||(t=Math.abs(Number(e.amount))||0,i=(a=Math.ceil(Math.abs(Number(e.value)))||1)-1),c.SLLimitLabel.BaseCcyMinAmount(a),c.SLLimitLabel.BaseCcyAboveAmount(i),t}),c.SLLimitLabel.MaxAmount=W.computed(function(){var e,t,a=P(m.far,eLimitType.StopLoss);return isEmptyValue(a)||(e=Math.abs(Number(a.amount))||1,t=Math.floor(Math.abs(Number(a.value)))||1),c.SLLimitLabel.BaseCcyMaxAmount(t),e}),c.SLLimitLabel.AbovePercent=W.observable("").extend({empty:!0}),c.SLLimitLabel.MinPercent=W.pureComputed(function(){var e,t,a,i=W.toJS(c.decimalDigit),o=c.orderDir(),n=W.toJS(m.minValidation),r=W.toJS(m.maxValidation),s=L(),l=s.bid(),u=s.ask();if(!(isEmptyValue(l)||isEmptyValue(u)||isEmptyValue(n)||isEmptyValue(r)))return e=o===eOrderDir.Sell?(a=n+1/Math.pow(10,i),Y.CalculatePercentFromRate(l,a)):(a=r-1/Math.pow(10,i),Y.CalculatePercentFromRate(u,a)),e=R(e,2),t=V(e-1/Math.pow(10,2),2),c.SLLimitLabel.AbovePercent(t),e}).extend({empty:!0}),c.SLLimitLabel.MaxPercent=W.pureComputed(function(){var e,t=c.orderDir(),a=W.toJS(m.minValidation),i=W.toJS(m.maxValidation),o=L(),n=o.bid(),r=o.ask();if(!(isEmptyValue(n)||isEmptyValue(r)||isEmptyValue(a)||isEmptyValue(i)))return e=t===eOrderDir.Sell?Y.CalculatePercentFromRate(n,i):Y.CalculatePercentFromRate(r,a),e=k(e,2)}),c.TPLimitLabel.First=W.observable(""),c.TPLimitLabel.Last=W.observable(""),c.TPLimitLabel.BaseCcyAboveAmount=W.observable("").extend({empty:!0}),c.TPLimitLabel.BaseCcyMinAmount=W.observable(""),c.TPLimitLabel.BaseCcyMaxAmount=W.observable(""),c.TPLimitLabel.MinAmount=W.computed(function(){var e=P(d.near,eLimitType.TakeProfit),t="",a="",i="";return isEmptyValue(e)||(t=Math.abs(Number(e.amount))||0,i=(a=Math.ceil(Math.abs(Number(e.value)))||1)-1),c.TPLimitLabel.BaseCcyMinAmount(a),c.TPLimitLabel.BaseCcyAboveAmount(i),t}),c.TPLimitLabel.MaxAmount=W.computed(function(){var e,t,a=P(d.far,eLimitType.TakeProfit);return isEmptyValue(a)||(e=Math.abs(Number(a.amount))||1,t=Math.floor(Math.abs(Number(a.value)))||1),c.TPLimitLabel.BaseCcyMaxAmount(t),e}),c.TPLimitLabel.AbovePercent=W.observable("").extend({empty:!0}),c.TPLimitLabel.MinPercent=W.pureComputed(function(){var e,t,a,i=W.toJS(c.decimalDigit),o=c.orderDir(),n=W.toJS(d.minValidation),r=W.toJS(d.maxValidation),s=L(),l=s.bid(),u=s.ask();if(!(isEmptyValue(l)||isEmptyValue(u)||isEmptyValue(n)||isEmptyValue(r)))return e=o===eOrderDir.Sell?(a=r-1/Math.pow(10,i),Y.CalculatePercentFromRate(l,a)):(a=n+1/Math.pow(10,i),Y.CalculatePercentFromRate(u,a)),e=R(e,2),t=V(e-1/Math.pow(10,2),2),c.TPLimitLabel.AbovePercent(t),e}),c.TPLimitLabel.MaxPercent=W.pureComputed(function(){var e,t=c.orderDir(),a=W.toJS(d.minValidation),i=W.toJS(d.maxValidation),o=L(),n=o.bid(),r=o.ask();if(!(isEmptyValue(n)||isEmptyValue(r)||isEmptyValue(a)||isEmptyValue(i)))return e=t===eOrderDir.Sell?Y.CalculatePercentFromRate(n,a):Y.CalculatePercentFromRate(r,i),e=k(e,2)}),c.stopLossAmount=W.observable("").extend({dirty:!1}),c.displaySLAmount=W.observable("").extend({toNumericLength:{ranges:[{from:0,to:Number.MAX_SAFE_INTEGER,decimalDigits:0}],isAllowNAValue:!0}}),c.takeProfitAmount=W.observable("").extend({dirty:!1}),c.displayTPAmount=W.observable("").extend({toNumericLength:{ranges:[{from:0,to:Number.MAX_SAFE_INTEGER,decimalDigits:0}],isAllowNAValue:!0}}),c.stopLossRate=W.observable("").extend({dirty:!1}),c.takeProfitRate=W.observable("").extend({dirty:!1}),c.stopLossPercent=W.observable("").extend({dirty:!1,toNumericLength:{ranges:[{from:0,to:Number.MAX_SAFE_INTEGER,decimalDigits:2}],isForceCeil:!0,isAllowNAValue:!0},incremental:{ranges:[{from:0,to:.1,step:.01},{from:.1,to:.5,step:.05},{from:.5,to:5,step:.1},{from:5,to:10,step:.5},{from:10,to:Number.MAX_VALUE,step:1}]}}),c.takeProfitPercent=W.observable("").extend({dirty:!1,toNumericLength:{ranges:[{from:0,to:Number.MAX_SAFE_INTEGER,decimalDigits:2}],isForceCeil:!0,isAllowNAValue:!0},incremental:{ranges:[{from:0,to:.1,step:.01},{from:.1,to:.5,step:.05},{from:.5,to:5,step:.1},{from:5,to:10,step:.5},{from:10,to:Number.MAX_VALUE,step:1}]}}),c.ccySLAmount=W.observable(""),c.ccyTPAmount=W.observable(""),c.customerCcyName=W.observable(""),c.curSlActiveTab=W.observable(eSetLimitsTabs.NoTabs),c.curTpActiveTab=W.observable(eSetLimitsTabs.NoTabs),c.visibleTab=W.observable(eSetLimitsTabs.NoTabs),c.isShowTabs=W.observable(!1),c.isAmountAvailable=!isDefinedType(o.getSettings(i).showSetLimitsAmountTab)||o.getSettings(i).showSetLimitsAmountTab,c.State=W.observable(""),c.displaySLLimit=W.observable(""),c.displayTPLimit=W.observable(""),c.SLRange=new LimitRange,c.TPRange=new LimitRange,c.SetActiveTab=H,c.SetSlActiveTab=Q,c.SetTpActiveTab=j,c.ChangeTabVisibility=K,c.decimalDigit=W.observable(0),c.displaySLSummary=W.observable(!1),c.displayTPSummary=W.observable(!1)},x=function(){c.stopLossRate.markClean(),c.takeProfitRate.markClean(),c.stopLossAmount.markClean(),c.takeProfitAmount.markClean(),c.stopLossPercent.markClean(),c.takeProfitPercent.markClean()},N=function(e){if(c.State()==eViewState.Start){var t=L(),a=t.bid,i=t.ask;switch(e){case b:var o=Y.CalculateValuesFromAmount(a(),i(),c.stopLossAmount(),c.orderDir(),eLimitType.StopLoss,c.selectedDealAmount(),c.SLRange,c.quoteForOtherCcyToAccountCcy(),c.instrumentId());c.stopLossRate(o.rate),c.stopLossPercent(o.percent),c.ccySLAmount(o.value);break;case p:var n=Y.CalculateValuesFromRate(a(),i(),c.stopLossRate(),c.orderDir(),eLimitType.StopLoss,c.selectedDealAmount(),c.SLRange,c.quoteForOtherCcyToAccountCcy(),c.instrumentId(),c.additionalPL());c.stopLossAmount(n.amount),c.stopLossPercent(n.percent),c.ccySLAmount(n.value);break;case f:var r=Y.CalculateValuesFromPercent(a(),i(),c.stopLossPercent(),c.orderDir(),eLimitType.StopLoss,c.selectedDealAmount(),c.SLRange,c.quoteForOtherCcyToAccountCcy(),c.instrumentId());c.stopLossRate(r.rate),c.stopLossAmount(r.amount),c.ccySLAmount(r.value);break;case g:var s=Y.CalculateValuesFromAmount(a(),i(),c.takeProfitAmount(),c.orderDir(),eLimitType.TakeProfit,c.selectedDealAmount(),c.TPRange,c.quoteForOtherCcyToAccountCcy(),c.instrumentId());c.takeProfitRate(s.rate),c.takeProfitPercent(s.percent),c.ccyTPAmount(s.value);break;case v:var l=Y.CalculateValuesFromRate(a(),i(),c.takeProfitRate(),c.orderDir(),eLimitType.TakeProfit,c.selectedDealAmount(),c.TPRange,c.quoteForOtherCcyToAccountCcy(),c.instrumentId(),c.additionalPL());c.takeProfitAmount(l.amount),c.takeProfitPercent(l.percent),c.ccyTPAmount(l.value);break;case D:var u=Y.CalculateValuesFromPercent(a(),i(),c.takeProfitPercent(),c.orderDir(),eLimitType.TakeProfit,c.selectedDealAmount(),c.TPRange,c.quoteForOtherCcyToAccountCcy(),c.instrumentId());c.takeProfitRate(u.rate),c.takeProfitAmount(u.amount),c.ccyTPAmount(u.value)}}},O=function(){c.curSlActiveTab()===eSetLimitsTabs.Amount&&isNumber(c.stopLossAmount())&&N(b),c.curTpActiveTab()===eSetLimitsTabs.Amount&&isNumber(c.takeProfitAmount())&&N(g),c.curSlActiveTab()===eSetLimitsTabs.Rate&&isNumber(c.stopLossRate())&&N(p),c.curTpActiveTab()===eSetLimitsTabs.Rate&&isNumber(c.takeProfitRate())&&N(v),c.curSlActiveTab()===eSetLimitsTabs.Percent&&isNumber(c.stopLossPercent())&&N(f),c.curTpActiveTab()===eSetLimitsTabs.Percent&&isNumber(c.takeProfitPercent())&&N(D)},E=function(){var e=c.bid(),t=c.ask();if(isEmptyValue(e)||isEmptyValue(t))return c.displayTPLimit(""),"";var a=!u.openLimit||u.openLimit.isValid(),i=c.orderDir(),o=$instrumentsManager.GetInstrument(c.instrumentId());if(!o)return"";G()?$.CalculateIfDoneRanges(e,t,c.orderDir(),c.SLRange,c.TPRange,u.openLimit(),o,$csFlagsManager.CSFlags.limitMultiplier):$.CalculateClosingRanges(e,t,c.orderDir(),c.SLRange,c.TPRange,o,$csFlagsManager.CSFlags.limitMultiplier),c.decimalDigit(o.DecimalDigit);var n=parseFloat(Format.toRate(c.TPRange.near(),!0,o.id)),r=parseFloat(Format.toRate(c.TPRange.far(),!0,o.id));d.precision(o.DecimalDigit),d.pipDigit(o.PipDigit),d.min(i==eOrderDir.Sell?r:n),d.max(i==eOrderDir.Sell?n:r);var s=addSign(c.orderDir(),eLimitType.TakeProfit),l=s+Format.toRate(c.TPRange.near(),!0,o.id);return">"===s?(d.startSpinFrom(eStartSpinFrom.Above),d.near(">"+n),d.far("<"+r)):(d.startSpinFrom(eStartSpinFrom.Below),d.near("<"+n),d.far(">"+r)),void 0!==u.openLimit&&(i!==eOrderDir.None&&u.openLimit.isValid()||d.startSpinFrom(eStartSpinFrom.None)),a?(c.displayTPLimit(l),l):(c.displayTPLimit(""),"")},B=function(){var e=c.bid(),t=c.ask();if(isEmptyValue(e)||isEmptyValue(t))return c.displaySLLimit(""),"";var a=!u.openLimit||u.openLimit.isValid(),i=c.orderDir(),o=$instrumentsManager.GetInstrument(c.instrumentId());if(!o)return"";G()?$.CalculateIfDoneRanges(e,t,c.orderDir(),c.SLRange,c.TPRange,u.openLimit(),o,$csFlagsManager.CSFlags.limitMultiplier):$.CalculateClosingRanges(e,t,c.orderDir(),c.SLRange,c.TPRange,o,$csFlagsManager.CSFlags.limitMultiplier),c.decimalDigit(o.DecimalDigit);var n=parseFloat(Format.toRate(c.SLRange.near(),!0,o.id)),r=parseFloat(Format.toRate(c.SLRange.far(),!0,o.id));m.precision(o.DecimalDigit),m.pipDigit(o.PipDigit),m.min(i==eOrderDir.Sell?n:r),m.max(i==eOrderDir.Sell?r:n);var s=addSign(i,eLimitType.StopLoss),l=s+Format.toRate(c.SLRange.near(),!0,o.id);return">"===s?(m.startSpinFrom(eStartSpinFrom.Above),m.near(">"+n),m.far("<"+r)):(m.startSpinFrom(eStartSpinFrom.Below),m.near("<"+n),m.far(">"+r)),void 0!==u.openLimit&&(i!==eOrderDir.None&&u.openLimit.isValid()||m.startSpinFrom(eStartSpinFrom.None)),a?(c.displaySLLimit(l),l):(c.displaySLLimit(""),"")},G=function(){return u.PageName===eDealPage.NewLimitViewModel||u.PageName===eDealPage.EditLimitViewModel||u.PageName===eDealPage.EditIfDoneLimit};function U(){return c.stopLossRate.isValid()?[]:[z.GetItem("slLeveInvalid")]}function q(){return c.takeProfitRate.isValid()?[]:[z.GetItem("tpLeveInvalid")]}function H(e){Q(e),j(e)}function Q(e){(e=e||eSetLimitsTabs.None)==eSetLimitsTabs.None&&(u.slRate&&W.isWriteableObservable(u.slRate)&&u.slRate(z.GetItem("setLimit")),c.stopLossRate(""),c.stopLossAmount(""),c.stopLossPercent(""),c.ccySLAmount(""),u.tpRate&&W.isWriteableObservable(u.tpRate)&&u.tpRate(z.GetItem("setLimit")),W.postbox.publish("stop-loss-changed","none")),c.curSlActiveTab(e)}function j(e){(e=e||eSetLimitsTabs.None)==eSetLimitsTabs.None&&(u.tpRate&&W.isWriteableObservable(u.tpRate)&&u.tpRate(z.GetItem("setLimit")),c.takeProfitRate(""),c.takeProfitAmount(""),c.takeProfitPercent(""),c.ccyTPAmount(""),W.postbox.publish("take-profit-changed","none")),c.curTpActiveTab(e)}function K(e){(e=e||eSetLimitsTabs.None)==eSetLimitsTabs.None?(H(e),c.isShowTabs(!1)):c.isShowTabs(!0),W.postbox.publish("deal-slip-toggle",{limit:e===eSetLimitsTabs.None?"minimized":"maximized"}),c.visibleTab(e)}var _=function(){c.customerCcyName($customer.prop.defaultCcy()),c.isShowTabs(!1),e.isAdvancedView(!1),c.defaultTab=o.getSettings(i).defaultTab,H(c.defaultTab),c.stopLossAmount(""),c.stopLossPercent(""),c.ccySLAmount(""),c.displaySLSummary(!1),c.takeProfitAmount(""),c.takeProfitPercent(""),c.ccyTPAmount(""),c.displayTPSummary(!1),u.slRate&&!isEmptyType(u.slRate())&&toNumeric(u.slRate())?c.stopLossRate(u.slRate()):c.stopLossRate(""),u.tpRate&&!isEmptyType(u.tpRate())&&toNumeric(u.tpRate())?c.takeProfitRate(u.tpRate()):c.takeProfitRate(""),x(),W.postbox.publish("stop-loss-changed","none"),W.postbox.publish("take-profit-changed","none")};return{TPField:d,SLField:m,Data:c,ObservableSetLimitsObject:c,ViewProperties:e,Init:function(e,t){i=this;var a={AdvancedMode:!0,isAvalibleSetLimits:!0,defaultTab:eSetLimitsTabs.Amount,defaultDataState:eViewState.Initial,parentView:eViewTypes.vNewDeal};o.setSettings(i,t,a),u=e,h(),M(),F(),r(),c.State(eViewState.Initial),l()},Validate:function(){return[].concat(U(),q())},ValidateSlRate:U,ValidateTpRate:q,SetInitial:_,MarkClean:x,SetActiveTab:H,SetSlActiveTab:Q,SetTpActiveTab:j,ChangeTabVisibility:K,State:function(){return c.State()},Start:function(e){c.State(eViewState.Start),isFunctionType(e)&&e()},Stop:function(){c.State(eViewState.Stop)}}}}),define("viewModels/BaseSearchCountryViewModel",["require","knockout","KoComponentViewModel","Dictionary","SystemInfo"],function(e){var l=e("knockout"),u=e("Dictionary"),t=e("KoComponentViewModel"),c=e("SystemInfo");return extendClass(t,function(r){var s=this.parent.Data;return{Init:function(){if(!1===(r&&r.countries&&!isEmptyValue(r.countries)&&(!isEmptyValue(r.countryId)||!isEmptyValue(r.country))))throw new Error("Params is empty");var e,t,a,i,o;s.countries=l.observableArray(),s.selectedCountry=l.observable(),s.selectedCountry.subscribe(function(e){var t;t=e,isFunctionType(r.country)&&r.country(t),isFunctionType(r.countryId)&&r.countryId(t.id),isFunctionType(r.onClick)&&r.onClick()}),t=function(e){var t=[],a=c.get("uiExclusionCountries")||[];if(isArrayType(e))t=e.slice();else{var i=Object.keys(e);i.forEach(function(e){t.push({id:e})})}return t.filter(function(t){return!Object.keys(a).find(function(e){return e==t.id})})}(isFunctionType(r.countries)?r.countries():r.countries),a=[],t&&t.forEach(function(e){var t=u.GetItem("cntr_"+e.id,"country_names");a.push(Object.assign({},e,{text:t,label:t,fullText:latinizeString(t)}))}),e=a,s.countries(e),s.countries&&s.countries.sort(function(e,t){return e.text.localeCompare(t.text)}),n=null,isFunctionType(r.country)&&!isEmptyValue(r.country().id)?n=r.country().id:isFunctionType(r.countryId)&&!isEmptyValue(r.countryId())&&(n=r.countryId()),i=n,o=s.countries().find(function(e){return parseInt(e.id)===parseInt(i)}),s.selectedCountry(o||s.countries()[0]);var n},SetCountry:function(e){s.selectedCountry(e)},Data:s}})}),define("FxNet/LogicLayer/Signals/SignalsGridsHandler",["require","dalTradingSignals","Q"],function(e){var a=e("dalTradingSignals"),i=e("Q"),o=0,n={};function r(i){n={};var e=[];for(var t in i)i.hasOwnProperty(t)&&e.push(JSON.stringify(i[t].params));a.getSignalsForGrids(e).then(function(e){return JSONHelper.STR2JSON("getSignalsForGrids/onLoadComplete",e)}).then(function(e){e=e||[];for(var t=0;t<e.length;t++){var a=e[t].type;void 0!==i[a]&&void 0!==i[a].defer&&i[a].defer.resolve(e[t])}}).done()}return{LoadData:function(e,t){var a=i.defer();return o&&(clearTimeout(o),o=0),n[e.type]={params:e,defer:a},o=setTimeout(r,300,n),a.promise.then(function(e){return isFunctionType(t)&&t(e),e})}}}),define("webViewModels/MarketInfoToolViewModel",["require","viewModels/Deals/BaseMarketInfoToolViewModel"],function(e){var t=e("viewModels/Deals/BaseMarketInfoToolViewModel"),a=extendClass(t,function(e){var t=this.parent;return{init:t.init,dispose:t.dispose,NewDealData:t.NewDealData,ViewSentimentsButtonHandler:t.ViewSentimentsButtonHandler}});return{viewModel:{createViewModel:function(e){var t=new a(e);return t.init(),t}}}}),define("webViewModels/Signals/SignalsAlertGridViewModel",["ViewModelsManager","knockout","KoComponentViewModel","Dictionary","FxNet/LogicLayer/Signals/SignalsGridsHandler","initConfiguration","InstrumentsManager","InstrumentTranslationsManager","LoadDictionaryContent!controls_ctlsignalalert"],function(e,s,t,a,l,u,c,d){var i=extendClass(t,function(t){var a=this,i=a.Data,o=a.parent,n={columns:[{name:"ma20",dataIndex:eAlertSignal.ma20},{name:"ma50",dataIndex:eAlertSignal.ma50},{name:"ma20_50",dataIndex:eAlertSignal.ma20_50},{name:"macd_sl",dataIndex:eAlertSignal.macd_sl},{name:"macd_0",dataIndex:eAlertSignal.macd_0},{name:"bollinger",dataIndex:eAlertSignal.bollinger},{name:"rsi70",dataIndex:eAlertSignal.rsi70},{name:"rsi30",dataIndex:eAlertSignal.rsi30},{name:"volume",dataIndex:eAlertSignal.volume},{name:"periodUnit",dataIndex:eAlertSignal.periodUnit},{name:"periodValue",dataIndex:eAlertSignal.periodValue},{name:"id",dataIndex:eAlertSignal.id},{name:"symbol",transform:function(e,t,a,i){var o=c.GetInstrumentBySignalName(i[eAlertSignal.symbol]);return o?d.Long(o.id):i[eAlertSignal.symbol]}},{name:"dateTime",dataIndex:eAlertSignal.dateTime},{name:"title",dataIndex:eAlertSignal.title}],pageSizes:5,statusField:"status",totalField:"totalRecords",dataField:"result",pagination:{pagesPerPage:5,pageIndexField:"page",pageSizeField:"pageSize"},DAL:{reference:l.LoadData,callerName:"SignalsAlertGrid/onLoadComplete",errorSeverity:eErrorSeverity.medium,onLoad:function(){}},Filter:{type:eSignalType.Alert,page:u.TradingSignalsConfig.defaultPage,days:s.observable(u.TradingSignalsConfig.durationFilterBySignalType.generic.nondetailed),pageSize:u.TradingSignalsConfig.rowsPerGridPage.alerts,symbol:t.symbol||""}},r=new ObservableDataSet(n);return r.Init(),r.Load().done(),{init:function(e){o.init.call(a,e),i.rowsPerGridPage=u.TradingSignalsConfig.rowsPerGridPage.alerts,i.days=n.Filter.days,a.subscribeTo(t.symbol,function(e){""===e?i.days(u.TradingSignalsConfig.durationFilterBySignalType.generic.nondetailed):(i.days(u.TradingSignalsConfig.durationFilterBySignalType.generic.detailed),r.Paging.CurrentPage(u.TradingSignalsConfig.defaultPage)),r.Load().done()})},IsLoadingData:r.IsLoadingData,gridData:r.DataRows,pager:r.Paging,gridVisibilityFlag:s.observable(!1),gridVisibilityFlagChangeCallback:function(){this.gridVisibilityFlag(!this.gridVisibilityFlag())}}});return{viewModel:{createViewModel:function(e){var t=new i(e||{});return t.init(),t}}}}),define("webViewModels/Signals/SignalsCandleStickGridViewModel",["ViewModelsManager","knockout","KoComponentViewModel","Dictionary","FxNet/LogicLayer/Signals/SignalsGridsHandler","initConfiguration","InstrumentsManager","InstrumentTranslationsManager","LoadDictionaryContent!controls_ctlsignalcandlestick"],function(e,s,t,a,l,u,c,d){var i=extendClass(t,function(t){var a=this,i=a.Data,o=a.parent,n={columns:[{name:"candlestick",dataIndex:eCandlestickSignal.candlestick},{name:"last",dataIndex:eCandlestickSignal.last},{name:"opinion",dataIndex:eCandlestickSignal.opinion},{name:"invalidation",dataIndex:eCandlestickSignal.invalidation},{name:"id",dataIndex:eCandlestickSignal.id},{name:"symbol",transform:function(e,t,a,i){var o=c.GetInstrumentBySignalName(i[eCandlestickSignal.symbol]);return o?d.Long(o.id):i[eCandlestickSignal.symbol]}},{name:"dateTime",dataIndex:eCandlestickSignal.dateTime},{name:"title",dataIndex:eCandlestickSignal.title}],pageSizes:5,statusField:"status",totalField:"totalRecords",dataField:"result",pagination:{pagesPerPage:5,pageIndexField:"page",pageSizeField:"pageSize"},DAL:{reference:l.LoadData,callerName:"SignalsCandlestickGrid/onLoadComplete",errorSeverity:eErrorSeverity.medium,onLoad:function(){}},Filter:{type:eSignalType.CandleStick,page:u.TradingSignalsConfig.defaultPage,days:s.observable(u.TradingSignalsConfig.durationFilterBySignalType.generic.nondetailed),pageSize:u.TradingSignalsConfig.rowsPerGridPage.candleStick,symbol:t.symbol||""}},r=new ObservableDataSet(n);return r.Init(),r.Load().done(),{init:function(e){o.init.call(a,e),i.rowsPerGridPage=u.TradingSignalsConfig.rowsPerGridPage.candleStick,i.days=n.Filter.days,a.subscribeTo(t.symbol,function(e){""===e?i.days(u.TradingSignalsConfig.durationFilterBySignalType.generic.nondetailed):(i.days(u.TradingSignalsConfig.durationFilterBySignalType.generic.detailed),r.Paging.CurrentPage(u.TradingSignalsConfig.defaultPage)),r.Load().done()})},IsLoadingData:r.IsLoadingData,gridData:r.DataRows,pager:r.Paging,gridVisibilityFlag:s.observable(!1),gridVisibilityFlagChangeCallback:function(){this.gridVisibilityFlag(!this.gridVisibilityFlag())}}});return{viewModel:{createViewModel:function(e){var t=new i(e||{});return t.init(),t}}}}),define("webViewModels/Signals/SignalsDisclamerViewModel",["KoComponentViewModel"],function(e){var t=extendClass(e,function(){});return{viewModel:{createViewModel:function(){return new t}}}}),define("webViewModels/Signals/SignalsServiceViewModel",["KoComponentViewModel"],function(e){var a=extendClass(e,function(e){var t=this,a=this.parent,i=this.Data,o=e;return{init:function(e){a.init.call(t,e),i.signalsEndDate=ko.observable(o.signalsEndDate||"")},Data:i}});return{viewModel:{createViewModel:function(e){var t=new a(e||{});return t.init(),t}}}}),define("webViewModels/Signals/SignalsTechnicalAnalisisGridViewModel",["ViewModelsManager","knockout","KoComponentViewModel","Dictionary","FxNet/LogicLayer/Signals/SignalsGridsHandler","initConfiguration","InstrumentsManager","InstrumentTranslationsManager","LoadDictionaryContent!controls_ctlsignaltechanalysis"],function(e,s,t,a,l,u,c,d){var i=extendClass(t,function(a){var t=this,i=t.Data,o=t.parent,n={columns:[{name:"id",dataIndex:eTechAnalysisSignal.id},{name:"week",dataIndex:eTechAnalysisSignal.week},{name:"weekDelta",dataIndex:eTechAnalysisSignal.weekDelta},{name:"month",dataIndex:eTechAnalysisSignal.month},{name:"monthDelta",dataIndex:eTechAnalysisSignal.monthDelta},{name:"",dataIndex:eTechAnalysisSignal.id},{name:"symbol",dataIndex:eTechAnalysisSignal.symbol},{name:"instrument",transform:function(e,t,a,i){var o=c.GetInstrumentBySignalName(i[eTechAnalysisSignal.symbol]);return o?d.Long(o.id):i[eTechAnalysisSignal.symbol]}},{name:"dateTime",dataIndex:eTechAnalysisSignal.dateTime},{name:"title",dataIndex:eTechAnalysisSignal.title}],pageSizes:10,statusField:"status",totalField:"totalRecords",dataField:"result",pagination:{pagesPerPage:10,pageIndexField:"page",pageSizeField:"pageSize"},DAL:{reference:l.LoadData,callerName:"SignalsTechnicalAnalisisGrid/onLoadComplete",errorSeverity:eErrorSeverity.medium,onLoad:function(){}},Filter:{type:eSignalType.TechnicalAnalysis,page:u.TradingSignalsConfig.defaultPage,days:s.observable(u.TradingSignalsConfig.durationFilterBySignalType.technicalAnalisys.nondetailed),pageSize:u.TradingSignalsConfig.rowsPerGridPage.technicalAnalisys,symbol:a.symbol}},r=new ObservableDataSet(n);return r.Init(),r.Load().done(),{init:function(e){o.init.call(t,e),i.rowsPerGridPage=u.TradingSignalsConfig.rowsPerGridPage.technicalAnalisys,i.days=n.Filter.days,i.signalId=s.observable(),i.symbol=s.observable(a.symbol()||""),i.isFullSignal=s.observable(!isEmpty(i.symbol())),t.subscribeTo(i.signalId,function(e){isEmptyValue(e)?i.isFullSignal(!1):i.isFullSignal(!0)}),t.subscribeTo(a.symbol,function(e){""===e?i.days(u.TradingSignalsConfig.durationFilterBySignalType.technicalAnalisys.nondetailed):(i.days(u.TradingSignalsConfig.durationFilterBySignalType.technicalAnalisys.detailed),r.Paging.CurrentPage(u.TradingSignalsConfig.defaultPage)),r.Load().done()})},gridData:r.DataRows,pager:r.Paging,SelectSignal:function(e,t){i.signalId(e),i.symbol(t),a.symbol(t)},IsLoadingData:r.IsLoadingData,Data:i}});return{viewModel:{createViewModel:function(e){var t=new i(e||{});return t.init(),t}}}}),define("webViewModels/Signals/SignalsToolViewModel",["require","viewModels/BaseSignalsViewModel","CustomerProfileManager","LoadDictionaryContent!deals_DealSignalsTool","StateObject!Transaction","InstrumentsManager","dalTradingSignals"],function(e){var t=e("viewModels/BaseSignalsViewModel"),l=e("CustomerProfileManager"),u=e("StateObject!Transaction"),c=e("InstrumentsManager"),d=e("dalTradingSignals"),a=extendClass(t,function(t){var a=this,i=this.parent,o=this.parent.Data,n=this.Handlers,r=[];function s(){if(o.hasAgreedDisclaimer()&&t.instrumentId){var e=c.GetInstrument(t.instrumentId());e.hasSignal&&(o.fetchingData(!0),d.getLatestTradingSignal({symbol:e.signalName}).then(function(e){!function(e){e.status==eResult.Success&&0==e.resultStatus&&e.result.length&&o.currentSignal(i.toSignalObject(e.result[0]));o.signalsAreAvailable(e.status==eResult.Success&&0==e.resultStatus),o.fetchingData(!1)}(JSONHelper.STR2JSON("getLatestTradingSignal/onLoadComplete",e))}).done())}}return{init:function(e){i.init.call(a,e),function(){if(!u.containsKey(eStateObjectTopics.SignalChartToggle)){var e=l.ProfileCustomer();u.set(eStateObjectTopics.SignalChartToggle,Boolean(e.showSignalsCharts))}o.showSignals=ko.observable(u.get(eStateObjectTopics.SignalChartToggle)).extend({notify:"always"}),o.currentSignal=ko.observable(null)}(),r.push({unsubscribe:u.subscribe(eStateObjectTopics.SignalChartToggle,o.showSignals)}),a.subscribeTo(t.instrumentId,function(){s()}),a.subscribeTo(o.hasAgreedDisclaimer,function(e){e&&s()}),a.subscribeTo(o.showSignals,function(e){var t=l.ProfileCustomer();t.showSignalsCharts=Number(e),l.ProfileCustomer(t)}),n.toggleSignalsClick=function(){var e=!!u.get(eStateObjectTopics.SignalChartToggle);u.update(eStateObjectTopics.SignalChartToggle,!e)},s()},dispose:function(){for(n.toggleSignalsClick=null;0<r.length;)r.pop().unsubscribe();i.dispose.call(a)},Data:o,Handlers:n,PermissionsModule:i.permissionsModule}});return{viewModel:{createViewModel:function(e){var t=new a((e=e||{}).filterData||{});return t.init(),t}}}}),define("webViewModels/Signals/SignalTechAnalysisFullViewModel",["knockout","KoComponentViewModel","dalTradingSignals","Customer","JSONHelper","LoadDictionaryContent!controls_ctlsignaltechanalysisfull"],function(s,e,l,t,u){function c(e){this.signalId=e[eTradingSignal.signalId],this.signalTitle=e[eTradingSignal.signalTitle],this.signalDate=e[eTradingSignal.signalDate],this.imagePath=e[eTradingSignal.imagePath],this.weekText=e[eTradingSignal.weekText],this.weekDelta=e[eTradingSignal.weekDelta],this.monthText=e[eTradingSignal.monthText],this.monthDelta=e[eTradingSignal.monthDelta],this.summary=e[eTradingSignal.summary],this.story=e[eTradingSignal.story],this.symbol=e[eTradingSignal.symbol]}var a=extendClass(e,function(e){var t=this,a=this.parent,i=this.Data,o=function(){i.signalsList=new ObservableHashTable("signalId",{enabled:!0,sortProperty:"signalId",asc:!1}),i.isLoading=s.observable(!1)},n=function(){var t;e.signalId?(i.isLoading(!0),l.getTradingSignal({signalId:e.signalId}).then(function(e){t=u.STR2JSON("getTradingSignal/onLoadComplete",e),r(t)}).done()):e.symbol&&l.getLatestTradingSignal({symbol:e.symbol}).then(function(e){t=u.STR2JSON("getLatestTradingSignal/onLoadComplete",e),r(t)}).done()},r=function(e){if(e.status==eResult.Success&&0==e.resultStatus)for(var t=0;t<e.result.length;t++)i.signalsList.Add(new c(e.result[t]));i.isLoading(!1)};return{init:function(e){a.init.call(t,e),o(),n()},dispose:function(){i.signalsList.Clear(),a.dispose.call(t)}}});return{viewModel:{createViewModel:function(e){var t=new a(e||{});return t.init(),t}}}}),define("webViewModels/Signals/TradingSignalsViewModel",["require","knockout","KoComponentViewModel","Customer","AlertsManager","dalCustomer","CookieHandler","DialogViewModel","Dictionary","JSONHelper","LoadDictionaryContent!controls_ctlsignalservice","LoadDictionaryContent!controls_ctlsignaldisclaimer","LoadDictionaryContent!controls_ctlsignalrequest","LoadDictionaryContent!controls_ctlsignals","LoadDictionaryContent!controls_ctlsignalcompliance"],function(e){var m=e("knockout"),t=e("KoComponentViewModel"),b=e("Customer"),p=e("AlertsManager"),f=e("dalCustomer"),g=e("CookieHandler"),v=e("DialogViewModel"),D=e("Dictionary"),S=e("JSONHelper"),a=extendClass(t,function(e){var t=this,a=this.parent,o=this.Data,n=e,i={},r=function(){i.handleSignalTutorialSelection=function(e){var t,a=e.Data.signalstutorials.options(),i=e.Data.signalstutorials.value();if(isNullOrUndefined(a)||isNullOrUndefined(i)||(t=a[parseInt(i)-1]),isNullOrUndefined(t))return!1;var o={width:900,height:670,title:t.text},n=eViewTypes.vTradingSignalsTutorials,r={url:t.url};return v.open(eDialog.TradingSignalsTutorials,o,n,r),!0}},s=function(){var e,i;o.hasAgreedDisclaimer=m.observable(!1),o.areSignalsAllowed=m.observable(!1),o.signalsEndDate=m.observable(""),o.isLoading=m.observable(!1),o.symbol=m.observable(n.symbol||""),o.signalstutorials={options:(e=7,i="ddlSignalTutorials",m.observableArray(Array.apply(0,Array(e)).map(function(e,t){var a=++t;return{index:a,url:systemInfo.signalsTutorialsDomainUrl+D.GetItem("ddlSignalTutorials_Href"+a,"controls_ctlsignals"),text:D.GetItem(i+a,"controls_ctlsignals")}}))),optiontext:"text",optionvalue:"index",value:m.observable(),caption:D.GetItem("ddlSignalTutorials0","controls_ctlsignals")}},l=function(){o.isShowSignal=t.createComputed(function(){return o.hasAgreedDisclaimer()&&o.areSignalsAllowed()&&!o.isLoading()}),o.signalsAreDissallowed=t.createComputed(function(){return!o.areSignalsAllowed()&&!o.isLoading()})},u=function(){t.subscribeTo(o.areSignalsAllowed,function(e){e&&(null!==g.ReadCookie("TsComplianceDate")||n.isDealer?o.hasAgreedDisclaimer(!0):(p.UpdateAlert(AlertTypes.SignalsDisclaimerAlert),p.PopAlert(AlertTypes.SignalsDisclaimerAlert),c()))})},c=function(){p.GetAlert(AlertTypes.SignalsDisclaimerAlert).isSetComplianceDate&&t.subscribeTo(p.GetAlert(AlertTypes.SignalsDisclaimerAlert).isSetComplianceDate,function(e){e&&o.hasAgreedDisclaimer(!0)})},d=function(){isEmptyValue(b.prop.AreSignalsAllowed)?(o.isLoading(!0),f.getCustomerSignalsPermissions().then(function(e){o.isLoading(!1);var t=S.STR2JSON("getLatestTradingSignal/onLoadComplete",e);t=t||{},b.prop.AreSignalsAllowed=t.status==eResult.Success&&"True"==t.result,b.prop.signalsEndDate=b.prop.AreSignalsAllowed?str2Date(t.signalsEndDate).ExtractDate():"",o.areSignalsAllowed(b.prop.AreSignalsAllowed),o.signalsEndDate(b.prop.signalsEndDate)}).done()):(o.areSignalsAllowed(b.prop.AreSignalsAllowed),o.signalsEndDate(b.prop.signalsEndDate))};return{init:function(e){a.init.call(t,e),s(),r(),l(),u(),d()},dispose:function(){a.dispose.call(t)},Data:o,Handlers:i}});return{viewModel:{createViewModel:function(e){var t=new a(e||{});return t.init(),t}}}}),define("webViewModels/AccountCardRecordsViewModel",["knockout","KoComponentViewModel","viewModels/AccountCardRecordsBaseViewModel"],function(e,t,a){var i=extendClass(a,function(){var e=this.parent,t=this.Data;return{init:e.init,dispose:e.dispose,Data:t,BalanceInfo:e.BalanceInfo,Handlers:{},GetNextBalance:e.GetNextBalance,VisibleShowMore:e.VisibleShowMore,DataSet:e.DataSet,Filter:e.Filter,EnableApplyButton:e.enableApplyButton,HasRecords:e.HasRecords,DsColumns:e.DsColumns}});return{viewModel:{createViewModel:function(){var e=new i;return e.init(),e}}}}),define("webViewModels/AccountClosedDealsViewModel",["require","KoComponentViewModel","viewModels/Deals/ClosedDealsModule","ViewModelsManager","closedDealsGridSettings"],function(e){var t=e("KoComponentViewModel"),n=e("viewModels/Deals/ClosedDealsModule"),r=e("ViewModelsManager"),s=e("closedDealsGridSettings"),a=extendClass(t,function(){var a,i=this,o=this.parent;return{init:function(){var e,t;o.init.call(i),e=r.VManager.GetViewArgsByKeyName(eViewTypes.vClosedDealsDialog,"posNum"),t=n.Filter,isDefinedType(e)&&(a={position:t.Position(),instrument:t.Instrument(),from:t.From(),to:t.To()},n.ViewData.isOpenedInDialog(!0),t.Position(e),t.InstrumentId(Number.MAX_SAFE_INTEGER),t.Instrument(),t.From(""),t.To("")),n.ApplyFilter()},dispose:function(){a&&(n.Filter.Position(a.position),n.Filter.Instrument(a.instrument),n.Filter.From(a.from),n.Filter.To(a.to),n.ViewData.isOpenedInDialog(!1)),o.dispose.call(i)},model:n,scrollMaxVisible:s.scrollMaxVisible,IsPrintingNow:function(){return!1}}});return{viewModel:{createViewModel:function(e){var t=new a(e);return t.init(),t}}}}),define("webViewModels/ChartToolViewModel",["require","knockout","HistoryManager","DialogViewModel","DealSlipChart","StateObject!Transaction"],function(e){var b=e("knockout"),t=e("DealSlipChart"),p=e("HistoryManager"),f=e("StateObject!Transaction"),a=extendClass(t,function(){var o=this,n=this.parent,r=n.Data,s=f.getAll(),a=[];function l(){for(var t=f.getAll(),e=0;e<a.length;e++)a[e].dispose();a.length=0,t.stopLossRate&&b.isObservable(t.stopLossRate)&&a.push(o.subscribeAndNotify(t.stopLossRate,function(e){n.DrawPriceLine(eChartPriceLineType.StopLoss,e,t.chart.keys.stopLoss)})),t.takeProfitRate&&b.isObservable(t.takeProfitRate)&&a.push(o.subscribeAndNotify(t.takeProfitRate,function(e){n.DrawPriceLine(eChartPriceLineType.TakeProfit,e,t.chart.keys.takeProfit)})),t.dealRate&&n.DrawPriceLine(eChartPriceLineType.OpenRate,t.dealRate,t.chart.keys.openRate),t.openLimit&&b.isObservable(t.openLimit)&&a.push(o.subscribeAndNotify(t.openLimit,function(e){n.DrawPriceLine(eChartPriceLineType.LimitLevel,e,t.chart.keys.limitLevel)}))}function u(e){e.type!==eHistoryStateType.ExitFullscren&&e.type!==eHistoryStateType.CloseDialog||r.isFullScreen(!1),e.type===eHistoryStateType.EnterFullscren&&r.isFullScreen(!0)}function c(e){var t=e===eOrderDir.None?eOrderDir.Buy:e;return s.chart.direction===eChartDirection.Opposite&&(t=t===eOrderDir.Sell?eOrderDir.Buy:eOrderDir.Sell),t}function d(e,t){var a=f.getAll();switch(a.switchToRate&&isFunctionType(a.switchToRate)&&a.switchToRate(),e){case eChartPriceLineType.LimitLevel:a.openLimit&&b.isObservable(a.openLimit)&&a.openLimit(t);break;case eChartPriceLineType.StopLoss:a.stopLossRate&&b.isObservable(a.stopLossRate)&&a.stopLossRate(t);break;case eChartPriceLineType.TakeProfit:a.takeProfitRate&&b.isObservable(a.takeProfitRate)&&a.takeProfitRate(t)}}function m(){r.isFullScreen(!r.isFullScreen()),r.isFullScreen()&&p.PushPopupState(ePopupType.Dialog,eFullScreenControl.TransactionSwitcher)}return{init:function(e){var t;r.isChartReady=b.observable(!1),r.isLoadingData=b.observable(!1),r.isFullScreen=f.set("isFullScreen",b.observable(!1)),e=extendType(e,(t=c(s.orderDir()),{additionalStartArgs:{instrumentId:s.selectedInstrument(),orderDir:t,currentRateKey:s.chart.keys.currentRate,instanceType:eChartInstanceType.newDealSlip,containerSuffix:String.empty,isLoadingData:r.isLoadingData,toggleDealSlipViewCallback:m,isExpandedMode:r.isFullScreen(),isFullScreen:r.isFullScreen(),tracking:{eventName:"deal-slip-chart-interaction"},onPriceLineDragged:d,allowDragLine:s.chart.allowDragLine}})),n.init.call(o,e),a=o.subscribeTo(r.isLoadingData,function(e){e||(r.isChartReady(!0),a.dispose())}),i=f.getAll(),o.subscribeTo(i.selectedInstrument,function(e){n.ChangeSymbol(e,c(i.orderDir()))}),i.orderDir&&o.subscribeTo(i.orderDir,function(e){isFunctionType(i.switchToRate)&&i.switchToRate(),b.isObservable(i.stopLossRate)&&i.stopLossRate()&&i.stopLossRate(""),b.isObservable(i.takeProfitRate)&&i.takeProfitRate()&&i.takeProfitRate(""),n.ChangeSymbol(i.selectedInstrument(),c(e))}),f.containsKey("transactionType")?o.subscribeAndNotify(i.transactionType,l):l(),o.subscribeTo(r.isFullScreen,n.ChangeMode),p.OnStateChanged.Add(u);var a,i},dispose:function(){r.isFullScreen(!1),p.OnStateChanged.Remove(u),n.dispose.call(o)},Data:r,NewDealData:s,ToggleDealSlipView:m}});return{viewModel:{createViewModel:function(e){var t=new a;return t.init(e),t}}}}),define("webViewModels/ChartViewModel",["require","knockout","KoComponentViewModel","DealSlipChart","StateObject!Transaction","ChartLayoutSettings","defaultChartConfiguration"],function(e){var t,v=e("knockout"),a=e("KoComponentViewModel"),i=e("DealSlipChart"),D=e("StateObject!Transaction"),S=e("ChartLayoutSettings"),o=e("defaultChartConfiguration");t=Q.defer(),D.set("stateObjectIsReadyDefer",t)!==t&&(t.reject(),t=null),D.set("selectedInstrument",v.observable()),D.set("orderDir",v.observable()),D.set("openLimit",v.observable("").extend({dirty:!1,rate:!0})),D.set("stopLossRate",v.observable()),D.set("takeProfitRate",v.observable()),D.set("switchToRate",emptyFn),D.set("chart",o);var n=extendClass(a,function(o){var n,r=this,s=new i,l=this.parent,u=l.Data,c={},t={},a=[];function d(){c=D.getAll(),r.subscribeAndNotify(c.transactionType,p)}function m(){}function b(){s.ChangeMode(u.isFullScreen()||u.isSingleMode())}function p(){for(var e=0;e<a.length;e++)a[e].dispose();a.length=0,t={},s.DeletePriceLine(eChartPriceLineType.LimitLevel),s.DeletePriceLine(eChartPriceLineType.StopLoss),s.DeletePriceLine(eChartPriceLineType.TakeProfit),u.isActive()&&((c=D.getAll()).selectedInstrument(u.currentInstrumentId()),a.push(c.selectedInstrument.subscribe(u.currentInstrumentId)),c.orderDir&&v.isObservable(c.orderDir)&&(c.orderDir(isDefinedType(t.orderDir)?t.orderDir:eOrderDir.None),a.push(c.orderDir.subscribe(function(e){isFunctionType(c.switchToRate)&&c.switchToRate(),v.isObservable(c.stopLossRate)&&c.stopLossRate()&&c.stopLossRate(""),v.isObservable(c.takeProfitRate)&&c.takeProfitRate()&&c.takeProfitRate(""),t.orderDir=e,s.ChangeSymbol(u.currentInstrumentId(),e)}))),c.openLimit&&v.isObservable(c.openLimit)&&(t.openLimit!=c.openLimit()&&c.openLimit(t.openLimit||""),a.push(c.openLimit.subscribe(function(e){t.openLimit=e,s.DrawPriceLine(eChartPriceLineType.LimitLevel,e,c.chart.keys.limitLevel)}))),c.stopLossRate&&v.isObservable(c.stopLossRate)&&(c.stopLossRate(t.stopLossRate||""),a.push(c.stopLossRate.subscribe(function(e){t.stopLossRate=e,s.DrawPriceLine(eChartPriceLineType.StopLoss,e,c.chart.keys.stopLoss)}))),c.takeProfitRate&&v.isObservable(c.takeProfitRate)&&(c.takeProfitRate(t.takeProfitRate||""),a.push(c.takeProfitRate.subscribe(function(e){t.takeProfitRate=e,s.DrawPriceLine(eChartPriceLineType.TakeProfit,e,c.chart.keys.takeProfit)}))))}function f(){return S.GetSettings(u.chartId)}function g(e,t){var a=D.getAll();switch(a.switchToRate&&isFunctionType(a.switchToRate)&&a.switchToRate(),e){case eChartPriceLineType.LimitLevel:a.openLimit&&v.isObservable(a.openLimit)&&a.openLimit(t);break;case eChartPriceLineType.StopLoss:a.stopLossRate&&v.isObservable(a.stopLossRate)&&a.stopLossRate(t);break;case eChartPriceLineType.TakeProfit:a.takeProfitRate&&v.isObservable(a.takeProfitRate)&&a.takeProfitRate(t)}}return{init:function(e){var t,a,i;l.init.call(r,e),S.Init(),u.chartId=o.index,u.isActive=o.isActive,u.isFullScreen=o.isFullScreen,u.isSingleMode=o.isSingleMode,t=f(),u.isChartReady=v.observable(!1),u.isLoadingData=v.observable(!1),u.currentInstrumentId=v.observable(t.instrumentId),a=f().instrumentId,c=D.getAll(),n={additionalStartArgs:{instrumentId:a,orderDir:function(){c=D.getAll();var e=v.utils.unwrapObservable(c.orderDir),t=e===eOrderDir.None?eOrderDir.Buy:e;return c.chart.direction===eChartDirection.Opposite&&(t=eOrderDir.Buy-t),t}(),currentRateKey:c.chart.keys.currentRate,instanceType:eChartInstanceType.newDealSlip,containerSuffix:u.chartId,isLoadingData:u.isLoadingData,toggleDealSlipViewCallback:emptyFn,isExpandedMode:u.isSingleMode(),isFullScreen:u.isFullScreen(),tracking:{eventName:"chart-interaction"},onPriceLineDragged:g,allowDragLine:c.chart.allowDragLine}},s.init.call(r,n),D.update("skipReset",!0),i=r.subscribeTo(u.isLoadingData,function(e){e||(u.isChartReady(!0),i.dispose())}),r.subscribeTo(u.isActive,function(e){if(e){var t=D.getAll();t.selectedInstrument(u.currentInstrumentId()),t.switchToRate()}p()}),r.subscribeTo(u.isFullScreen,b),r.subscribeTo(u.isSingleMode,b),r.subscribeTo(u.currentInstrumentId,function(e){var t=D.getAll();t.selectedInstrument(e),t.orderDir(eOrderDir.None),s.ChangeSymbol(u.currentInstrumentId(),eOrderDir.None)}),c.stateObjectIsReadyDefer.promise.then(d).fail(m).done()},dispose:function(){for(var e=0;e<a.length;e++)a[e].dispose();a.length=0,s.dispose(),l.dispose.call(r),D.containsKey("skipReset")&&D.unset("skipReset")},Data:u,ChartData:s.Data}});return{viewModel:{createViewModel:function(e){var t=new n(e);return t.init(),t}}}}),define("webViewModels/ClosedDealsInstrumentSearchViewModel",["require","Dictionary","viewModels/BaseInstrumentSearchViewModel"],function(e){var n=e("Dictionary"),t=e("viewModels/BaseInstrumentSearchViewModel"),a=extendClass(t,function(){var a=this,i=this.parent,o=this.Data;return a.searchFocus=ko.observable(!0),a.onFocus=function(){a.searchFocus(!0)},{init:function(e){var t;i.init.call(a,e),(t=o.list()).unshift({id:Number.MAX_SAFE_INTEGER,name:n.GetItem("All_Instruments"),shortTranslation:n.GetItem("All_Instruments")}),o.list(t)}}});return{viewModel:{createViewModel:function(e){var t=new a;return t.init(e),t}}}}),define("webViewModels/ClosedDealsViewModel",["require","knockout","KoComponentViewModel","viewModels/Deals/ClosedDealsModule","ViewModelsManager","closedDealsGridSettings","Dictionary","StateObject!Positions","PrintExportManager"],function(e){var t=e("KoComponentViewModel"),c=e("knockout"),d=e("viewModels/Deals/ClosedDealsModule"),a=e("ViewModelsManager"),m=e("closedDealsGridSettings"),b=e("Dictionary"),p=e("StateObject!Positions"),f=e("PrintExportManager"),i=extendClass(t,function(){var i=this,o=this.parent,n=o.Data,r=[];function s(e){n.selectedOFHPositionNumber(e)}function l(e){n.selectedPLPositionNumber(e)}function u(e){c.postbox.publish("printableDataAvailable",{dataAvailable:e,viewType:a.VManager.ActiveFormType(),viewModel:"ClosedDealsViewModel"})}return{init:function(e){var t,a;o.init.call(i,e),e.isHeaderComponent||(t=p.set("ofhPositionNumber",null),a=p.set("plPositionNumber",null),n.selectedOFHPositionNumber=c.observable(t),n.selectedPLPositionNumber=c.observable(a),r.push({dispose:p.subscribe("ofhPositionNumber",s)}),r.push({dispose:p.subscribe("plPositionNumber",l)}),i.subscribeTo(d.DataSet.HasRecords,u),u(d.DataSet.HasRecords())),d.ApplyFilter()},dispose:function(){for(p.unset("ofhPositionNumber"),p.unset("plPositionNumber");0<r.length;)r.pop().dispose();o.dispose.call(i)},Data:n,model:d,scrollMaxVisible:m.scrollMaxVisible,GetOvernightFinancingHistoryParams:function(e){var t=b.ValueIsEmpty("FinanceAdjustHistoryCosts")?"FinanceAdjustHistory":"FinanceAdjustHistoryCosts",a={title:String.format(b.GetItem(t),e.positionNumber)},i={posNum:e.positionNumber};return isEmptyValue(e.valueDate)&&(i.fromDate=e.positionStart,i.instrumentId=e.instrumentID,i.closedDate=e.executionTime,i.showCosts=!0),{options:a,args:i}},IsPrintingNow:f.IsWorkingNow}});return{viewModel:{createViewModel:function(e){var t=new i;return t.init(e),t}}}}),define("webViewModels/CloseDealViewModel",["require","knockout","dalOrders","closeDealSettings","CustomerProfileManager","InstrumentsManager","StatesManager","StateObject!Transaction","viewModels/Deals/CloseDealBaseViewModel"],function(e){var r=e("knockout"),s=e("dalOrders"),t=e("closeDealSettings"),a=e("viewModels/Deals/CloseDealBaseViewModel"),l=e("InstrumentsManager"),u=e("StatesManager"),c=e("StateObject!Transaction"),d=e("CustomerProfileManager"),i=extendClass(a,function(){var a=this,i=this.parent,o=this.Data,n=i.BaseOrder;function e(e,t,a){o.isProcessing(!1);var i=l.GetInstrument(o.selectedInstrument());i&&n.OnActionReturn(e,t,i,{requestData:a})}function t(){o.isProcessing(!1)}return{init:function(e){var t;c.containsKey("stateObjectIsReadyDefer")||c.set("stateObjectIsReadyDefer",Q.defer()),i.init.call(a,e),o.showTools=c.set("showTools",r.observable(!1)),o.showForwardPips=a.createComputed(function(){if(!o.HasPosition())return!1;var e=r.utils.unwrapObservable(o.SelectedPosition),t=r.utils.unwrapObservable(e.fwPips);return 0!==parseFloat(t)}),a.subscribeTo(o.showTools,function(e){var t=d.ProfileCustomer();t.closeDealTools=Number(e),d.ProfileCustomer(t)}),t=d.ProfileCustomer(),o.showTools(1===t.closeDealTools),c.get("stateObjectIsReadyDefer").resolve()},Data:o,ToggleView:function(){o.isCollapsed(!o.isCollapsed())},CloseDeal:function(){if(o.CloseDealReady()){if(o.isProcessing(!0),1==u.States.fxDenied())return n.ValidateOnlineTradingUser(),void o.isProcessing(!1);s.CloseDeals([{positionNumber:o.SelectedPosition().positionNumber,spotRate:o.SelectedPosition().spotRate,fwPips:o.SelectedPosition().fwPips,dealRate:o.SelectedPosition().dealRate,instrumentID:o.SelectedPosition().instrumentID}],e,{failCallback:t})}}}});return{viewModel:{createViewModel:function(){var e=new i;return e.init(t),e}}}}),define("webViewModels/ContractRolloverViewModel",["require","viewModels/ContractRolloverBaseViewModel","contractRolloverSettings"],function(e){var t=e("viewModels/ContractRolloverBaseViewModel"),a=e("contractRolloverSettings"),i=extendClass(t,function(){var e=this.parent;return{init:e.init,dispose:e.dispose,Handlers:e.handlers,Data:e.Data,BalanceInfo:e.BalanceInfo,DataSet:e.DataSet,GetNextBalance:e.GetNextBalance,VisibleShowMore:e.VisibleShowMore,ScrollMaxVisible:a.scrollMaxVisible}});return{viewModel:{createViewModel:function(e){var t=new i(e);return t.init(),t}},ContractRolloverViewModel:i}}),define("webViewModels/DealToolsViewModel",["require","viewModels/Deals/DealToolsBaseViewModel","StateObject!TradingEnabled","StateObject!Transaction"],function(e){var n=e("StateObject!Transaction"),r=e("StateObject!TradingEnabled"),t=e("viewModels/Deals/DealToolsBaseViewModel"),a=extendClass(t.DealToolsViewModel,function(){var t=this,a=this.parent,i=this.Data;function o(){n.update(eStateObjectTopics.ReadyForUse,!0)}return{init:function(e){a.init.call(t,e),n.set("stateObjectIsReadyDefer",Q.defer()).promise.then(o).done(),i.showToolsWhenTradingDisabled=r.containsKey("TradingEnabled")?ko.observable(r.get("TradingEnabled")):ko.observable(!1)},Handlers:a.Handlers,DealData:a.DealData}});return{viewModel:{createViewModel:function(e){var t=new a(e);return t.init(e),t}}}}),define("webViewModels/DropdownInstrumentSearchViewModel",["require","viewModels/BaseInstrumentSearchViewModel"],function(e){var t=e("viewModels/BaseInstrumentSearchViewModel"),a=extendClass(t,function(){var t=this,a=this.parent;return t.searchFocus=ko.observable(!0),t.onFocus=function(){t.searchFocus(!0)},{init:function(e){a.init.call(t,e)}}});return{viewModel:{createViewModel:function(e){var t=new a;return t.init(e),t}}}}),define("webViewModels/EditClosingLimitViewModel",["require","Dictionary","knockout","editClosingLimitSettings","CustomerProfileManager","ActiveLimitsManager","StateObject!Transaction","viewModels/Deals/EditClosingLimitBaseViewModel"],function(e){var m=e("knockout"),b=e("Dictionary"),t=e("editClosingLimitSettings"),p=e("CustomerProfileManager"),f=e("ActiveLimitsManager"),g=e("StateObject!Transaction"),a=e("viewModels/Deals/EditClosingLimitBaseViewModel"),i=extendClass(a,function(){var i=this,o=this.parent,n=this.Data,e={},t=o.ExpirationDate,r=o.SetLimitsModel,a=function(){n.enableSLLimit=m.observable(!1),n.enableTPLimit=m.observable(!1),n.showTools=g.set("showTools",m.observable(!1))},s=function(){n.focusOnSlRate=i.createComputed(function(){return r.Data.curSlActiveTab()===eSetLimitsTabs.Rate}),n.focusOnTpRate=i.createComputed(function(){return r.Data.curTpActiveTab()===eSetLimitsTabs.Rate})},l=function(){i.subscribeTo(n.showTools,function(e){var t=p.ProfileCustomer();t.editClosingLimitTools=Number(e),p.ProfileCustomer(t)})},u=function(){var e;(o.updateViewModelData(),n.selectedDeal())&&(e=n.limitType()===eLimitType.StopLoss?n.selectedDeal().slID:n.selectedDeal().tpID,n.closingLimit(f.limits.GetItem(e)),isNullOrUndefined(n.closingLimit())||isEmptyValue(n.closingLimit().expirationDate)||t.SetOrder(e))},c=function(){var e=p.ProfileCustomer();n.showTools(1===e.editClosingLimitTools)},d=function(){e.Limits=o.getLimitsValidationModel(),o.createAmountFieldsWrappers();var t=m.observable(!1),a=m.observable(!1);r.Data.stopLossRate.extend({tooltipValidation:{message:b.GetItem("txtRateValidationTooltip"),showTooltip:function(){return(r.Data.curSlActiveTab()===eSetLimitsTabs.Rate||r.Data.curSlActiveTab()===r.Data.defaultTab)&&t()}}}),i.subscribeTo(r.Data.stopLossRate.tooltipClosed,function(e){e&&t(!1)}),i.subscribeTo(r.Data.stopLossRate,function(){t(!1)}),r.Data.takeProfitRate.extend({tooltipValidation:{message:b.GetItem("txtRateValidationTooltip"),showTooltip:function(){return(r.Data.curTpActiveTab()===eSetLimitsTabs.Rate||r.Data.curTpActiveTab()===r.Data.defaultTab)&&a()}}}),i.subscribeTo(r.Data.takeProfitRate.tooltipClosed,function(e){e&&a(!1)}),i.subscribeTo(r.Data.takeProfitRate,function(){a(!1)}),i.addDisposable(m.postbox.subscribe("edit-deal-limit-show-validation-tooltips",function(){t(!0),a(!0)})),i.subscribeTo(r.Data.stopLossPercent,function(e){n.displaySlPercentSymbol(!isEmptyValue(e)&&"NA"!==e)}),i.subscribeTo(n.stopLossInCustomerCcy,function(e){n.displaySlAmountCcySymbol(!isEmptyValue(e)&&"NA"!==e)}),i.subscribeTo(r.Data.takeProfitPercent,function(e){n.displayTpPercentSymbol(!isEmptyValue(e)&&"NA"!==e)}),i.subscribeTo(n.takeProfitInCustomerCcy,function(e){n.displayTpAmountCcySymbol(!isEmptyValue(e)&&"NA"!==e)}),n.limitsReady(!0)};return{init:function(e){g.containsKey("stateObjectIsReadyDefer")||g.set("stateObjectIsReadyDefer",Q.defer()),o.init.call(i,e),a(),s(),l(),u(),r.Start(d),c(),g.get("stateObjectIsReadyDefer").resolve()},dispose:function(){o.dispose.call(i)},Data:n,TPField:r.TPField,SLField:r.SLField,SetLimitsInfo:r.Data,SetLimitsViewProperties:r.ViewProperties}});return{viewModel:{createViewModel:function(){var e=new i;return e.init(t),e}}}}),define("webViewModels/EditLimitViewModel",["require","knockout","editLimitSettings","CustomerProfileManager","Dictionary","StateObject!Transaction","viewModels/Limits/EditLimitBaseViewModel","ActiveLimitsManager","ViewsManager","DialogViewModel"],function(e){var m=e("knockout"),t=e("editLimitSettings"),b=e("CustomerProfileManager"),p=e("Dictionary"),f=e("StateObject!Transaction"),a=e("viewModels/Limits/EditLimitBaseViewModel"),i=e("ActiveLimitsManager"),o=e("ViewsManager"),n=e("DialogViewModel"),r=extendClass(a,function(){var s=this,l=this.parent,u=this.Data,e=l.ValidationModel,t=m.observable(!1),c=l.FieldWrappers,d=l.SetLimitsViewModel,a=function(){u.showLimitsSlideCompleted=m.observable(!1),u.toggleLimitsSection=function(){var e=!!u.showLimits();u.showLimits(!e)},u.showTools=f.set("showTools",m.observable(!1))},i=function(){u.showSLSummary=s.createComputed(function(){var e=!!m.utils.unwrapObservable(d.Data.displaySLSummary);return!u.showLimits()&&u.enableSLLimit()&&e}),u.showTPSummary=s.createComputed(function(){var e=!!m.utils.unwrapObservable(d.Data.displayTPSummary);return!u.showLimits()&&u.enableTPLimit()&&e}),u.showLimitsSummary=s.createComputed(function(){return u.showSLSummary()||u.showTPSummary()})},o=function(){s.subscribeTo(u.showTools,function(e){var t=b.ProfileCustomer();t.editLimitTools=Number(e),b.ProfileCustomer(t)}),s.subscribeTo(u.EditLimitReady,function(e){t(e)}),s.subscribeTo(u.showLimits,function(e){var t=b.ProfileCustomer();t.editLimitIfDoneExpanded=Number(e),b.ProfileCustomer(t),u.showLimitsSlideCompleted(!1),!e&&u.ViewModelReady()&&(d.Data.stopLossRate.closeTooltip(),c.Data.stopLossInCustomerCcy.closeTooltip(),d.Data.stopLossPercent.closeTooltip(),d.Data.takeProfitRate.closeTooltip(),c.Data.takeProfitInCustomerCcy.closeTooltip(),d.Data.takeProfitPercent.closeTooltip())}),s.subscribeTo(u.showLimitsSlideCompleted,function(e){e&&u.showLimits()&&(d.Data.stopLossRate.resetTooltip(),c.Data.stopLossInCustomerCcy.resetTooltip(),d.Data.stopLossPercent.resetTooltip(),d.Data.takeProfitRate.resetTooltip(),c.Data.takeProfitInCustomerCcy.resetTooltip(),d.Data.takeProfitPercent.resetTooltip())})},n=function(){var e=b.ProfileCustomer();u.showTools(1===e.editLimitTools)},r=function(){e.Limits=m.validatedObservable({stopLossAmount:d.Data.stopLossAmount,takeProfitAmount:d.Data.takeProfitAmount,ccySLAmount:d.Data.ccySLAmount,ccyTPAmount:d.Data.ccyTPAmount,stopLossRate:d.Data.stopLossRate,takeProfitRate:d.Data.takeProfitRate,stopLossPercent:d.Data.stopLossPercent,takeProfitPercent:d.Data.takeProfitPercent});var t=m.observable(!1),a=m.observable(!1),i=m.observable(!1),o=m.observable(!1),n=m.observable(!1),r=m.observable(!1);c.Data.stopLossInCustomerCcy.extend({tooltipValidation:{message:p.GetItem("txtRateValidationTooltip"),showTooltip:function(){return(d.Data.curSlActiveTab()==eSetLimitsTabs.Amount||d.Data.curSlActiveTab()==d.Data.defaultTab)&&t()}}}),s.subscribeTo(c.Data.stopLossInCustomerCcy.tooltipClosed,function(e){e&&t(!1)}),s.subscribeTo(c.Data.stopLossInCustomerCcy,function(){t(!1)}),d.Data.stopLossRate.extend({tooltipValidation:{message:p.GetItem("txtRateValidationTooltip"),showTooltip:function(){return(d.Data.curSlActiveTab()==eSetLimitsTabs.Rate||d.Data.curSlActiveTab()==d.Data.defaultTab)&&a()}}}),s.subscribeTo(d.Data.stopLossRate.tooltipClosed,function(e){e&&a(!1)}),s.subscribeTo(d.Data.stopLossRate,function(){a(!1)}),d.Data.stopLossPercent.extend({tooltipValidation:{message:p.GetItem("txtRateValidationTooltip"),showTooltip:function(){return(d.Data.curSlActiveTab()===eSetLimitsTabs.Percent||d.Data.curSlActiveTab()===d.Data.defaultTab)&&i()}}}),s.subscribeTo(d.Data.stopLossPercent.tooltipClosed,function(e){e&&i(!1)}),s.subscribeTo(d.Data.stopLossPercent,function(){i(!1)}),c.Data.takeProfitInCustomerCcy.extend({tooltipValidation:{message:p.GetItem("txtRateValidationTooltip"),showTooltip:function(){return(d.Data.curTpActiveTab()===eSetLimitsTabs.Amount||d.Data.curTpActiveTab()==d.Data.defaultTab)&&o()}}}),s.subscribeTo(c.Data.takeProfitInCustomerCcy.tooltipClosed,function(e){e&&o(!1)}),s.subscribeTo(c.Data.takeProfitInCustomerCcy,function(){o(!1)}),d.Data.takeProfitRate.extend({tooltipValidation:{message:p.GetItem("txtRateValidationTooltip"),showTooltip:function(){return(d.Data.curTpActiveTab()==eSetLimitsTabs.Rate||d.Data.curTpActiveTab()==d.Data.defaultTab)&&n()}}}),s.subscribeTo(d.Data.takeProfitRate.tooltipClosed,function(e){e&&n(!1)}),s.subscribeTo(d.Data.takeProfitRate,function(){n(!1)}),d.Data.takeProfitPercent.extend({tooltipValidation:{message:p.GetItem("txtRateValidationTooltip"),showTooltip:function(){return(d.Data.curTpActiveTab()===eSetLimitsTabs.Percent||d.Data.curTpActiveTab()===d.Data.defaultTab)&&r()}}}),s.subscribeTo(d.Data.takeProfitPercent.tooltipClosed,function(e){e&&r(!1)}),s.subscribeTo(d.Data.takeProfitPercent,function(){r(!1)}),s.addDisposable(m.postbox.subscribe("deal-slip-show-validation-tooltips",function(){t(!0),a(!0),i(!0),o(!0),n(!0),r(!0)})),s.subscribeTo(u.enableSLLimit,function(e){e||(d.Data.stopLossRate(""),d.Data.stopLossAmount(""),d.Data.stopLossPercent(""),c.Data.stopLossInCustomerCcy(""))}),s.subscribeTo(d.Data.curSlActiveTab,function(e){u.isSlRateActiveTab(e===eSetLimitsTabs.Rate),u.isSlAmountActiveTab(e===eSetLimitsTabs.Amount),u.isSlPercentActiveTab(e===eSetLimitsTabs.Percent)}),s.subscribeTo(d.Data.stopLossPercent,function(e){u.displaySlPercentSymbol(!isEmptyValue(e)&&"NA"!==e)}),s.subscribeTo(c.Data.stopLossInCustomerCcy,function(e){u.displaySlAmountCcySymbol(!isEmptyValue(e)&&"NA"!==e)}),s.subscribeTo(u.enableTPLimit,function(e){e||(d.Data.takeProfitRate(""),d.Data.takeProfitAmount(""),d.Data.takeProfitPercent(""),c.Data.takeProfitInCustomerCcy(""))}),s.subscribeTo(d.Data.curTpActiveTab,function(e){u.isTpRateActiveTab(e===eSetLimitsTabs.Rate),u.isTpAmountActiveTab(e===eSetLimitsTabs.Amount),u.isTpPercentActiveTab(e===eSetLimitsTabs.Percent)}),s.subscribeTo(d.Data.takeProfitPercent,function(e){u.displayTpPercentSymbol(!isEmptyValue(e)&&"NA"!==e)}),s.subscribeTo(c.Data.takeProfitInCustomerCcy,function(e){u.displayTpAmountCcySymbol(!isEmptyValue(e)&&"NA"!==e)}),u.limitsReady(!0),l.setLimitTabsFromClientProfile()};return{init:function(e){f.containsKey("stateObjectIsReadyDefer")||f.set("stateObjectIsReadyDefer",Q.defer()),l.init.call(s,e),a(),i(),o(),d.Start(r),n(),f.get("stateObjectIsReadyDefer").resolve()},Data:u,dispose:function(){l.dispose.call(s)},IsValid:t}});return{viewModel:{createViewModel:function(){if(null==i.limits.GetItem(o.GetViewArgs(eViewTypes.vEditLimit).orderId))return AlertsManager.UpdateAlert(AlertTypes.ServerResponseAlert,p.GetItem("GenericAlert"),p.GetItem("OrderError7")),AlertsManager.PopAlert(AlertTypes.ServerResponseAlert),n.close(),{_valid:!1};var e=new r;return e.init(t),e}}}}),define("webViewModels/LimitsViewModel",["require","knockout","KoComponentViewModel","viewModels/Limits/ActiveLimitsModule","ViewsManager","Dictionary","DialogViewModel","PrintExportManager"],function(e){var o=e("knockout"),t=e("KoComponentViewModel"),n=e("viewModels/Limits/ActiveLimitsModule"),r=e("ViewsManager"),s=e("DialogViewModel"),l=e("Dictionary"),u=e("PrintExportManager"),a=extendClass(t,function(){var t=this,a=this.parent;function i(e){o.postbox.publish("printableDataAvailable",{dataAvailable:e,viewType:r.ActiveFormType(),viewModel:"LimitsViewModel"})}return{init:function(e){a.init.call(t,e),e.isHeaderComponent||t.subscribeAndNotify(n.HasRecords,i)},dispose:function(){a.dispose.call(t)},model:n,updateRemoveLimit:function(e){u.IsWorkingNow()||s.open(eDialog.EditLimit,{title:l.GetItem("EditDeleteOpeningLimit")+" "+e.orderID,width:700,persistent:!1,dialogClass:"deal-slip"},eViewTypes.vEditLimit,{orderId:e.orderID,pageName:eDealPage.EditLimitViewModel,chart:{direction:eChartDirection.Same,allowDragLine:!0,keys:{stopLoss:"chartline_IfDoneStopLoss",takeProfit:"chartline_IfDoneTakeProfit",currentRate:"chartline_CurrentRate",limitLevel:"chartline_LimitLevel"}}})}}});return{viewModel:{createViewModel:function(e){var t=new a;return t.init(e),t}}}}),define("webViewModels/MainChartViewModel",["require","knockout","KoComponentViewModel","ChartSettingManager","AdvinionChartsManager"],function(e){var s=e("knockout"),t=e("KoComponentViewModel"),l=e("AdvinionChartsManager"),u=e("ChartSettingManager"),a=extendClass(t,function(){var a=this,i=this.parent,o=i.Data,n=!0;function r(e){u.Chart().isTransactionContainerExpanded=e,u.SaveChart()}return{init:function(e){var t;i.init.call(a,e),o.isTransactionContainerExpanded=s.observable((t=u.Chart().isTransactionContainerExpanded,isBooleanType(t)?t:(r(n),n))),a.subscribeTo(o.isTransactionContainerExpanded,r)},Data:o,ToggleTransactionContainer:function(){o.isTransactionContainerExpanded(!o.isTransactionContainerExpanded())},AdvinionChartsManager:l}});return{viewModel:{createViewModel:function(e){var t=new a;return t.init(e),t}}}}),define("webViewModels/NewDealSlipViewModel",["require","knockout","Q","newDealSettings","Dictionary","Customer","StatesManager","InstrumentsManager","ViewModelsManager","CustomerProfileManager","PermissionsModule","FxNet/LogicLayer/Deal/DealLifeCycle","viewModels/Limits/AmountFieldsWrapper","FxNet/LogicLayer/Deal/NewDealValidator","viewModels/Deals/DealBaseViewModel","UserFlowManager","StateObject!Transaction","LoadDictionaryContent!deals_newdeal","StateObject!userFlow"],function(e){var m=e("knockout"),r=e("Q"),b=e("newDealSettings"),p=e("Dictionary"),f=e("Customer"),g=e("StatesManager"),v=e("InstrumentsManager"),D=e("CustomerProfileManager"),S=e("PermissionsModule"),y=e("FxNet/LogicLayer/Deal/NewDealValidator"),T=e("FxNet/LogicLayer/Deal/DealLifeCycle"),C=e("viewModels/Limits/AmountFieldsWrapper"),t=e("viewModels/Deals/DealBaseViewModel"),h=e("StateObject!userFlow"),w=e("StateObject!Transaction"),i=extendClass(t,function(){var t,a,s=this,l=this.parent,u=this.Data,e={},i=l.BaseOrder,c=new C,d=l.SetLimitsModel;function o(){e.Limits=m.validatedObservable({stopLossAmount:d.Data.stopLossAmount,takeProfitAmount:d.Data.takeProfitAmount,ccySLAmount:d.Data.ccySLAmount,ccyTPAmount:d.Data.ccyTPAmount,stopLossRate:d.Data.stopLossRate,takeProfitRate:d.Data.takeProfitRate,stopLossPercent:d.Data.stopLossPercent,takeProfitPercent:d.Data.takeProfitPercent}),c.init(d,u);var t=m.observable(!1),a=m.observable(!1),i=m.observable(!1),o=m.observable(!1),n=m.observable(!1),r=m.observable(!1);c.Data.stopLossInCustomerCcy.extend({tooltipValidation:{message:p.GetItem("txtRateValidationTooltip"),showTooltip:function(){return(d.Data.curSlActiveTab()==eSetLimitsTabs.Amount||d.Data.curSlActiveTab()==d.Data.defaultTab)&&t()}}}),s.subscribeTo(c.Data.stopLossInCustomerCcy.tooltipClosed,function(e){e&&t(!1)}),s.subscribeTo(c.Data.stopLossInCustomerCcy,function(){t(!1)}),d.Data.stopLossRate.extend({tooltipValidation:{message:p.GetItem("txtRateValidationTooltip"),showTooltip:function(){return(d.Data.curSlActiveTab()==eSetLimitsTabs.Rate||d.Data.curSlActiveTab()==d.Data.defaultTab)&&a()}}}),s.subscribeTo(d.Data.stopLossRate.tooltipClosed,function(e){e&&a(!1)}),s.subscribeTo(d.Data.stopLossRate,function(){a(!1)}),d.Data.stopLossPercent.extend({tooltipValidation:{message:p.GetItem("txtRateValidationTooltip"),showTooltip:function(){return(d.Data.curSlActiveTab()===eSetLimitsTabs.Percent||d.Data.curSlActiveTab()===d.Data.defaultTab)&&i()}}}),s.subscribeTo(d.Data.stopLossPercent.tooltipClosed,function(e){e&&i(!1)}),s.subscribeTo(d.Data.stopLossPercent,function(){i(!1)}),c.Data.takeProfitInCustomerCcy.extend({tooltipValidation:{message:p.GetItem("txtRateValidationTooltip"),showTooltip:function(){return(d.Data.curTpActiveTab()===eSetLimitsTabs.Amount||d.Data.curTpActiveTab()==d.Data.defaultTab)&&o()}}}),s.subscribeTo(c.Data.takeProfitInCustomerCcy.tooltipClosed,function(e){e&&o(!1)}),s.subscribeTo(c.Data.takeProfitInCustomerCcy,function(){o(!1)}),d.Data.takeProfitRate.extend({tooltipValidation:{message:p.GetItem("txtRateValidationTooltip"),showTooltip:function(){return(d.Data.curTpActiveTab()==eSetLimitsTabs.Rate||d.Data.curTpActiveTab()==d.Data.defaultTab)&&n()}}}),s.subscribeTo(d.Data.takeProfitRate.tooltipClosed,function(e){e&&n(!1)}),s.subscribeTo(d.Data.takeProfitRate,function(){n(!1)}),d.Data.takeProfitPercent.extend({tooltipValidation:{message:p.GetItem("txtRateValidationTooltip"),showTooltip:function(){return(d.Data.curTpActiveTab()===eSetLimitsTabs.Percent||d.Data.curTpActiveTab()===d.Data.defaultTab)&&r()}}}),s.subscribeTo(d.Data.takeProfitPercent.tooltipClosed,function(e){e&&r(!1)}),s.subscribeTo(d.Data.takeProfitPercent,function(){r(!1)}),s.addDisposable(m.postbox.subscribe("deal-slip-show-validation-tooltips",function(){t(!0),a(!0),i(!0),o(!0),n(!0),r(!0)})),s.subscribeTo(u.enableSLLimit,function(e){e||(d.Data.stopLossRate(""),d.Data.stopLossAmount(""),d.Data.stopLossPercent(""),c.Data.stopLossInCustomerCcy(""))}),s.subscribeTo(d.Data.curSlActiveTab,function(e){u.isSlRateActiveTab(e===eSetLimitsTabs.Rate),u.isSlAmountActiveTab(e===eSetLimitsTabs.Amount),u.isSlPercentActiveTab(e===eSetLimitsTabs.Percent)}),s.subscribeTo(d.Data.stopLossPercent,function(e){u.displaySlPercentSymbol(!isEmptyValue(e)&&"NA"!==e)}),s.subscribeTo(c.Data.stopLossInCustomerCcy,function(e){u.displaySlAmountCcySymbol(!isEmptyValue(e)&&"NA"!==e)}),s.subscribeTo(u.enableTPLimit,function(e){e||(d.Data.takeProfitRate(""),d.Data.takeProfitAmount(""),d.Data.takeProfitPercent(""),c.Data.takeProfitInCustomerCcy(""))}),s.subscribeTo(d.Data.curTpActiveTab,function(e){u.isTpRateActiveTab(e===eSetLimitsTabs.Rate),u.isTpAmountActiveTab(e===eSetLimitsTabs.Amount),u.isTpPercentActiveTab(e===eSetLimitsTabs.Percent)}),s.subscribeTo(d.Data.takeProfitPercent,function(e){u.displayTpPercentSymbol(!isEmptyValue(e)&&"NA"!==e)}),s.subscribeTo(c.Data.takeProfitInCustomerCcy,function(e){u.displayTpAmountCcySymbol(!isEmptyValue(e)&&"NA"!==e)}),u.limitsReady(!0),l.setLimitTabsFromClientProfile()}function n(){d.SetActiveTab(eSetLimitsTabs.Rate)}return{init:function(e){w.containsKey("stateObjectIsReadyDefer")||w.set("stateObjectIsReadyDefer",r.defer()),l.init.call(s,e),u.chartStationPage=e.chartStationPage,y.Init(i),u.expirationDate=m.observable(""),u.sharesDividendDate=m.observable(),u.corporateActionDate=m.observable(),u.showShareCorporateActionDealInfo=m.observable(),u.showShareDividendDealInfo=m.observable(),u.showFutureRolloverDealInfo=m.observable(""),u.futuresRolloverDate=m.observable(""),u.showLimits=m.observable(1===D.ProfileCustomer().limits).extend({notify:"always"}),u.showLimitsSlideCompleted=m.observable(!1),u.toggleLimitsSection=function(){var e=!!u.showLimits();u.showLimits(!e)},u.activationRequired=m.observable(!0),u.DealButtonEnabled=s.createComputed(function(){var e=g.States.IsMarketClosed(),t=u.selectedInstrument.isValid(),a=u.hasInstrument()&&u.limitsReady()&&u.quotesAvailable(),i=u.isActiveQuote(),o=u.isShowBuyBox()||u.isShowSellBox(),n=0<u.dealMinMaxAmounts().length;return!u.isProcessing()&&n&&!e&&i&&o&&t&&a&&!u.activationRequired()}),u.showForexNonIslamicDealInfo=s.createComputed(function(){return u.isForex()&&f.prop.dealPermit!==eDealPermit.Islamic}),u.isOvernightOnForex=s.createComputed(function(){return f.prop.isOvernightOnForex}),u.showSLSummary=s.createComputed(function(){var e=!!m.utils.unwrapObservable(d.Data.displaySLSummary);return!u.showLimits()&&u.enableSLLimit()&&e}),u.showTPSummary=s.createComputed(function(){var e=!!m.utils.unwrapObservable(d.Data.displayTPSummary);return!u.showLimits()&&u.enableTPLimit()&&e}),u.showLimitsSummary=s.createComputed(function(){return u.showSLSummary()||u.showTPSummary()}),u.focusOnSlRate=s.createComputed(function(){return u.enableSLLimit()&&d.Data.curSlActiveTab()===eSetLimitsTabs.Rate}),u.focusOnSlAmount=s.createComputed(function(){return u.enableSLLimit()&&(d.Data.curSlActiveTab()===eSetLimitsTabs.Amount||d.Data.curSlActiveTab()===d.Data.defaultTab)}),u.focusOnSlPercent=s.createComputed(function(){return u.enableSLLimit()&&d.Data.curSlActiveTab()===eSetLimitsTabs.Percent}),u.focusOnTpRate=s.createComputed(function(){return u.enableTPLimit()&&d.Data.curTpActiveTab()===eSetLimitsTabs.Rate}),u.focusOnTpAmount=s.createComputed(function(){return u.enableTPLimit()&&(d.Data.curTpActiveTab()===eSetLimitsTabs.Amount||d.Data.curTpActiveTab()===d.Data.defaultTab)}),u.focusOnTpPercent=s.createComputed(function(){return u.enableTPLimit()&&d.Data.curTpActiveTab()===eSetLimitsTabs.Percent}),t=s.createComputed(function(){return u.selectedInstrument()}),function(){s.subscribeAndNotify(t,function(e){var t=v.GetInstrument(e);t&&(l.setLimitTabsFromClientProfile(),u.expirationDate(t.expirationDate),u.sharesDividendDate(str2Date(t.eventDate,"d/m/Y H:M")),u.corporateActionDate(str2Date(t.getCorporateActionDate(),"d/m/Y H:M")),u.futuresRolloverDate(str2Date(t.eventDate,"d/m/Y H:M")),u.showShareCorporateActionDealInfo(T.sharesIsCorporateActionDateSignificant_BeforeDeal(f.prop.dealPermit,t.assetTypeId,t.getCorporateActionDate())),u.showShareDividendDealInfo(T.sharesIsDividendDateSignificant_BeforeDeal(f.prop.dealPermit,t.assetTypeId,t.getCorporateActionDate(),t.getInstrumentDividendDate())),u.showFutureRolloverDealInfo(T.futuresIsRolloverDateSignificant_BeforeDeal(f.prop.dealPermit,t.assetTypeId,t.getInstrumentRolloverDate()))),u.ViewModelReady()&&m.postbox.publish("deal-slip-switch-instrument",{id:u.selectedInstrument(),instrument:u.ccyPair()})}),s.subscribeTo(u.showLimits,function(e){var t=D.ProfileCustomer();t.limits=Number(e),D.ProfileCustomer(t),u.showLimitsSlideCompleted(!1),!e&&u.ViewModelReady()&&(d.Data.stopLossRate.closeTooltip(),c.Data.stopLossInCustomerCcy.closeTooltip(),d.Data.stopLossPercent.closeTooltip(),d.Data.takeProfitRate.closeTooltip(),c.Data.takeProfitInCustomerCcy.closeTooltip(),d.Data.takeProfitPercent.closeTooltip())}),s.subscribeTo(u.showLimitsSlideCompleted,function(e){e&&u.showLimits()&&(d.Data.stopLossRate.resetTooltip(),c.Data.stopLossInCustomerCcy.resetTooltip(),d.Data.stopLossPercent.resetTooltip(),d.Data.takeProfitRate.resetTooltip(),c.Data.takeProfitInCustomerCcy.resetTooltip(),d.Data.takeProfitPercent.resetTooltip())}),s.subscribeTo(u.showTools,function(e){var t=D.ProfileCustomer();t.tools=Number(e),D.ProfileCustomer(t)}),a=h.subscribe(eStateObjectTopics.UserFlowChanged,function(e){e&&u.activationRequired(e.activationRequired)});var e=h.get(eStateObjectTopics.UserFlowChanged);e&&u.activationRequired(e.activationRequired)}(),u.selectedInstrument.extend({validatable:!1}),u.selectedInstrument.extend({validation:{validator:function(e){var t=u.isActiveQuote();return isEmptyValue(e)||isEmptyValue(t)||!g.States.IsMarketClosed()&&t},message:p.GetItem("InstrumentInactive")}}),u.selectedInstrument.extend({tooltipValidation:{notify:"always"}}),l.registerToDispatcher(),d.Start(o),w.update("stopLossRate",d.Data.stopLossRate),w.update("takeProfitRate",d.Data.takeProfitRate),w.update("switchToRate",n),w.update("chart",b.chart),w.set("transactionType",m.observable()),w.get("transactionType")(eTransactionSwitcher.NewDeal),w.get("stateObjectIsReadyDefer").resolve(),w.update("currentRateDirectionSwitch",b.currentRateDirectionSwitch),m.postbox.publish("deal-slip-view",{instrument:u.ccyPair(),instrumentStatus:u.isActiveQuote()?"live":"disabled",tabName:getKeyByValue(eNewDealTool,u.initialToolTab()),limit:u.showLimits()?"maximized":"minimized",tools:u.showTools()?"maximized":"minimized",id:u.selectedInstrument(),orderDir:u.orderDir()})},dispose:function(){w.unset("currentRateDirectionSwitch"),d.Stop(),c.dispose(),c=null,a&&a(),l.dispose.call(s)},Data:u,BaseOrder:i,DealButtonHandler:function(){if(u.DealButtonEnabled())if(!isDefinedType(i.ViewProperties)||u.isActiveQuote()){if(y.Validate(u.selectedInstrument())&&S.CheckActionAllowed("newDeal",!0,{register:registerParams.traderInstrumentId+u.selectedInstrument()+registerParams.traderOrderDir+(0===u.orderDir()?"Sell":"Buy")})){var e=!!isFunctionType(u.selectedDealAmount.isValid)&&u.selectedDealAmount.isValid(),t=d.Validate();if(t.length||!e)return t.length&&u.showLimits(!0),void m.postbox.publish("deal-slip-show-validation-tooltips");l.openDeal()}}else i.ViewProperties.InactiveInstrumentAlert(u.selectedInstrument())},TPField:d.TPField,SLField:d.SLField,SetLimitsInfo:d.ObservableSetLimitsObject,SetLimitsViewProperties:d.ViewProperties,FieldWrappers:c}});return{viewModel:{createViewModel:function(e){var t=new i,a=$.extend(b,e);return t.init(a),t}}}}),define("webViewModels/NewLimitViewModel",["require","knockout","Q","newLimitSettings","dalOrders","ViewModelsManager","Customer","CustomerProfileManager","PermissionsModule","InstrumentsManager","StatesManager","FxNet/LogicLayer/Deal/DealLifeCycle","viewModels/Limits/AmountFieldsWrapper","viewModels/Limits/LimitBaseViewModel","StateObject!Transaction","LoadDictionaryContent!deals_newlimit","UserFlowManager","StateObject!userFlow","AlertsManager"],function(e){var p=e("knockout"),f=e("newLimitSettings"),g=e("Q"),v=e("dalOrders"),D=e("Customer"),S=e("CustomerProfileManager"),y=e("PermissionsModule"),T=e("InstrumentsManager"),C=e("StatesManager"),h=e("FxNet/LogicLayer/Deal/DealLifeCycle"),w=e("viewModels/Limits/AmountFieldsWrapper"),t=e("viewModels/Limits/LimitBaseViewModel"),L=e("StateObject!userFlow"),A=e("StateObject!Transaction"),I=e("AlertsManager"),i=extendClass(t,function(){var t,a,s=this,l=this.parent,u=this.Data,e={},c=new w,o=l.BaseOrder,d=l.ExpirationDate,m=l.SetLimitsModel;function i(){e.Limits=p.validatedObservable({stopLossAmount:m.Data.stopLossAmount,takeProfitAmount:m.Data.takeProfitAmount,ccySLAmount:m.Data.ccySLAmount,ccyTPAmount:m.Data.ccyTPAmount,stopLossRate:m.Data.stopLossRate,takeProfitRate:m.Data.takeProfitRate,stopLossPercent:m.Data.stopLossPercent,takeProfitPercent:m.Data.takeProfitPercent}),c.init(m,u);var t=p.observable(!1),a=p.observable(!1),i=p.observable(!1),o=p.observable(!1),n=p.observable(!1),r=p.observable(!1);c.Data.stopLossInCustomerCcy.extend({tooltipValidation:{message:Dictionary.GetItem("txtRateValidationTooltip"),showTooltip:function(){return(m.Data.curSlActiveTab()==eSetLimitsTabs.Amount||m.Data.curSlActiveTab()==m.Data.defaultTab)&&t()}}}),s.subscribeTo(c.Data.stopLossInCustomerCcy.tooltipClosed,function(e){e&&t(!1)}),s.subscribeTo(c.Data.stopLossInCustomerCcy,function(){t(!1)}),m.Data.stopLossRate.extend({tooltipValidation:{message:Dictionary.GetItem("txtRateValidationTooltip"),showTooltip:function(){return(m.Data.curSlActiveTab()==eSetLimitsTabs.Rate||m.Data.curSlActiveTab()==m.Data.defaultTab)&&a()}}}),s.subscribeTo(m.Data.stopLossRate.tooltipClosed,function(e){e&&a(!1)}),s.subscribeTo(m.Data.stopLossRate,function(){a(!1)}),m.Data.stopLossPercent.extend({tooltipValidation:{message:Dictionary.GetItem("txtRateValidationTooltip"),showTooltip:function(){return(m.Data.curSlActiveTab()===eSetLimitsTabs.Percent||m.Data.curSlActiveTab()===m.Data.defaultTab)&&i()}}}),s.subscribeTo(m.Data.stopLossPercent.tooltipClosed,function(e){e&&i(!1)}),s.subscribeTo(m.Data.stopLossPercent,function(){i(!1)}),c.Data.takeProfitInCustomerCcy.extend({tooltipValidation:{message:Dictionary.GetItem("txtRateValidationTooltip"),showTooltip:function(){return(m.Data.curTpActiveTab()===eSetLimitsTabs.Amount||m.Data.curTpActiveTab()==m.Data.defaultTab)&&o()}}}),s.subscribeTo(c.Data.takeProfitInCustomerCcy.tooltipClosed,function(e){e&&o(!1)}),s.subscribeTo(c.Data.takeProfitInCustomerCcy,function(){o(!1)}),m.Data.takeProfitRate.extend({tooltipValidation:{message:Dictionary.GetItem("txtRateValidationTooltip"),showTooltip:function(){return(m.Data.curTpActiveTab()==eSetLimitsTabs.Rate||m.Data.curTpActiveTab()==m.Data.defaultTab)&&n()}}}),s.subscribeTo(m.Data.takeProfitRate.tooltipClosed,function(e){e&&n(!1)}),s.subscribeTo(m.Data.takeProfitRate,function(){n(!1)}),m.Data.takeProfitPercent.extend({tooltipValidation:{message:Dictionary.GetItem("txtRateValidationTooltip"),showTooltip:function(){return(m.Data.curTpActiveTab()===eSetLimitsTabs.Percent||m.Data.curTpActiveTab()===m.Data.defaultTab)&&r()}}}),s.subscribeTo(m.Data.takeProfitPercent.tooltipClosed,function(e){e&&r(!1)}),s.subscribeTo(m.Data.takeProfitPercent,function(){r(!1)}),s.addDisposable(p.postbox.subscribe("deal-slip-show-validation-tooltips",function(){t(!0),a(!0),i(!0),o(!0),n(!0),r(!0)})),s.subscribeTo(u.enableSLLimit,function(e){e||(m.Data.stopLossRate(""),m.Data.stopLossAmount(""),m.Data.stopLossPercent(""),c.Data.stopLossInCustomerCcy(""))}),s.subscribeTo(m.Data.curSlActiveTab,function(e){u.isSlRateActiveTab(e===eSetLimitsTabs.Rate),u.isSlAmountActiveTab(e===eSetLimitsTabs.Amount),u.isSlPercentActiveTab(e===eSetLimitsTabs.Percent)}),s.subscribeTo(m.Data.stopLossPercent,function(e){u.displaySlPercentSymbol(!isEmptyValue(e)&&"NA"!==e)}),s.subscribeTo(c.Data.stopLossInCustomerCcy,function(e){u.displaySlAmountCcySymbol(!isEmptyValue(e)&&"NA"!==e)}),s.subscribeTo(u.enableTPLimit,function(e){e||(m.Data.takeProfitRate(""),m.Data.takeProfitAmount(""),m.Data.takeProfitPercent(""),c.Data.takeProfitInCustomerCcy(""))}),s.subscribeTo(m.Data.curTpActiveTab,function(e){u.isTpRateActiveTab(e===eSetLimitsTabs.Rate),u.isTpAmountActiveTab(e===eSetLimitsTabs.Amount),u.isTpPercentActiveTab(e===eSetLimitsTabs.Percent)}),s.subscribeTo(m.Data.takeProfitPercent,function(e){u.displayTpPercentSymbol(!isEmptyValue(e)&&"NA"!==e)}),s.subscribeTo(c.Data.takeProfitInCustomerCcy,function(e){u.displayTpAmountCcySymbol(!isEmptyValue(e)&&"NA"!==e)}),u.limitsReady(!0),l.setLimitTabsFromClientProfile()}function n(){if(u.OrderButtonEnabled()){var e,t=!!isFunctionType(u.selectedDealAmount.isValid)&&u.selectedDealAmount.isValid(),a=m.Validate();if(a.length||!t)return a.length&&u.showLimits(!0),void p.postbox.publish("deal-slip-show-validation-tooltips");if(y.CheckActionAllowed("newLimit",!0,{register:registerParams.traderInstrumentId+u.selectedInstrument()+registerParams.traderOrderDir+(0===u.orderDir()?"Sell":"Buy")}))if(1!=C.States.fxDenied()){if(o.LimitValidateQuote(u.selectedInstrument())){var i=new TLimit;if(l.fillData(i),e=i,u.enableSLLimit()&&0===e.ifDoneSLRate||u.enableTPLimit()&&0===e.ifDoneTPRate)return I.UpdateAlert(AlertTypes.GeneralOkAlert,Dictionary.GetItem("pleaseNoteTitle"),Dictionary.GetItem("sltpValidationMsg","deals_NewLimit"),null,{okButtonCallback:r}),void I.PopAlert(AlertTypes.GeneralOkAlert);u.isProcessing(!0),u.hasInstrument(!1),v.AddLimit(i,l.onOpenLimit),p.postbox.publish("new-limit-details",{tradingDirection:i.orderDir===eOrderDir.Buy?"Buy":i.orderDir===eOrderDir.Sell?"Sell":"None",dealSize:i.amount,isAdvancedView:m.ViewProperties.isAdvancedView().toString(),expirationType:d.Data.expirationDateSelector.IsGoodTillCancelChecked()?"Good Till Cancel":"Specific Date"})}}else o.ValidateOnlineTradingUser()}}function r(){u.enableSLLimit(!1),u.enableTPLimit(!1),n()}function b(){m.SetActiveTab(eSetLimitsTabs.Rate)}return{init:function(e){A.containsKey("stateObjectIsReadyDefer")||A.set("stateObjectIsReadyDefer",g.defer()),l.init.call(s,e),u.chartStationPage=e.chartStationPage,u.sharesDividendDate=p.observable(),u.corporateActionDate=p.observable(),u.showShareCorporateActionDealInfo=p.observable(),u.showShareDividendDealInfo=p.observable(),u.showFutureRolloverDealInfo=p.observable(""),u.futuresRolloverDate=p.observable(""),u.showLimits=p.observable(1===S.ProfileCustomer().newLimitOrders).extend({notify:"always"}),u.showLimitsSlideCompleted=p.observable(!1),u.toggleLimitsSection=function(){var e=!!u.showLimits();u.showLimits(!e)},u.activationRequired=p.observable(!0),u.showForexNonIslamicDealInfo=s.createComputed(function(){return u.isForex()&&D.prop.dealPermit!==eDealPermit.Islamic}),u.isOvernightOnForex=s.createComputed(function(){return D.prop.isOvernightOnForex}),u.showSLSummary=s.createComputed(function(){var e=!!p.utils.unwrapObservable(m.Data.displaySLSummary);return!u.showLimits()&&u.enableSLLimit()&&e}),u.showTPSummary=s.createComputed(function(){var e=!!p.utils.unwrapObservable(m.Data.displayTPSummary);return!u.showLimits()&&u.enableTPLimit()&&e}),u.showLimitsSummary=s.createComputed(function(){return u.showSLSummary()||u.showTPSummary()}),u.focusOnSlRate=s.createComputed(function(){return u.enableSLLimit()&&m.Data.curSlActiveTab()===eSetLimitsTabs.Rate}),u.focusOnSlAmount=s.createComputed(function(){return u.enableSLLimit()&&(m.Data.curSlActiveTab()===eSetLimitsTabs.Amount||m.Data.curSlActiveTab()===m.Data.defaultTab)}),u.focusOnSlPercent=s.createComputed(function(){return u.enableSLLimit()&&m.Data.curSlActiveTab()===eSetLimitsTabs.Percent}),u.focusOnTpRate=s.createComputed(function(){return u.enableTPLimit()&&m.Data.curTpActiveTab()===eSetLimitsTabs.Rate}),u.focusOnTpAmount=s.createComputed(function(){return u.enableTPLimit()&&(m.Data.curTpActiveTab()===eSetLimitsTabs.Amount||m.Data.curTpActiveTab()===m.Data.defaultTab)}),u.focusOnTpPercent=s.createComputed(function(){return u.enableTPLimit()&&m.Data.curTpActiveTab()===eSetLimitsTabs.Percent}),u.OrderButtonEnabled=s.createComputed(function(){var e=C.States.IsMarketClosed(),t=u.selectedInstrument.isValid(),a=u.hasInstrument()&&u.limitsReady()&&u.quotesAvailable(),i=!!u.openLimit&&u.openLimit.isValid(),o=u.isActiveQuote(),n=D.prop.brokerAllowLimitsOnNoRates,r=d.IsValid(),s=u.isShowBuyBox()||u.isShowSellBox(),l=0<u.dealMinMaxAmounts().length;return!u.isProcessing()&&(n||!e&&o)&&s&&t&&a&&r&&i&&l&&!u.activationRequired()}),t=s.createComputed(function(){return u.selectedInstrument()}),function(){s.subscribeAndNotify(t,function(e){var t=T.GetInstrument(e);t&&(l.setLimitTabsFromClientProfile(),u.sharesDividendDate(str2Date(t.eventDate,"d/m/Y H:M")),u.corporateActionDate(str2Date(t.getCorporateActionDate(),"d/m/Y H:M")),u.futuresRolloverDate(str2Date(t.eventDate,"d/m/Y H:M")),u.showShareCorporateActionDealInfo(h.sharesIsCorporateActionDateSignificant_BeforeDeal(D.prop.dealPermit,t.assetTypeId,t.getCorporateActionDate())),u.showShareDividendDealInfo(h.sharesIsDividendDateSignificant_BeforeDeal(D.prop.dealPermit,t.assetTypeId,t.getCorporateActionDate(),t.getInstrumentDividendDate())),u.showFutureRolloverDealInfo(h.futuresIsRolloverDateSignificant_BeforeDeal(D.prop.dealPermit,t.assetTypeId,t.getInstrumentRolloverDate())))}),s.subscribeTo(u.showTools,function(e){var t=S.ProfileCustomer();t.tools=Number(e),S.ProfileCustomer(t)}),s.subscribeTo(u.showLimits,function(e){var t=S.ProfileCustomer();t.newLimitOrders=Number(e),S.ProfileCustomer(t),u.showLimitsSlideCompleted(!1),!e&&u.ViewModelReady()&&(m.Data.stopLossRate.closeTooltip(),c.Data.stopLossInCustomerCcy.closeTooltip(),m.Data.stopLossPercent.closeTooltip(),m.Data.takeProfitRate.closeTooltip(),c.Data.takeProfitInCustomerCcy.closeTooltip(),m.Data.takeProfitPercent.closeTooltip())}),s.subscribeTo(u.showLimitsSlideCompleted,function(e){e&&u.showLimits()&&(m.Data.stopLossRate.resetTooltip(),c.Data.stopLossInCustomerCcy.resetTooltip(),m.Data.stopLossPercent.resetTooltip(),m.Data.takeProfitRate.resetTooltip(),c.Data.takeProfitInCustomerCcy.resetTooltip(),m.Data.takeProfitPercent.resetTooltip())}),a=L.subscribe(eStateObjectTopics.UserFlowChanged,function(e){e&&u.activationRequired(e.activationRequired)});var e=L.get(eStateObjectTopics.UserFlowChanged);e&&u.activationRequired(e.activationRequired)}(),u.selectedInstrument.extend({validatable:!1}),u.selectedInstrument.extend({validation:{validator:function(e){var t=u.isActiveQuote(),a=D.prop.brokerAllowLimitsOnNoRates||!C.States.IsMarketClosed()&&t;return isEmptyValue(e)||isEmptyValue(t)||a},message:Dictionary.GetItem("InstrumentInactive")}}),u.selectedInstrument.extend({tooltipValidation:{notify:"always"}}),l.registerToDispatcher(),m.Start(i),A.update("stopLossRate",m.Data.stopLossRate),A.update("takeProfitRate",m.Data.takeProfitRate),A.update("switchToRate",b),A.update("chart",f.chart),A.set("transactionType",p.observable()),A.get("transactionType")(eTransactionSwitcher.NewLimit),A.get("stateObjectIsReadyDefer").resolve(),p.postbox.publish("new-limit-view",{instrument:u.ccyPair(),instrumentStatus:u.isActiveQuote()?"live":"disabled"})},dispose:function(){m.Stop(),c.dispose(),c=null,A.containsKey("openLimit")&&(A.get("openLimit")(""),A.unset("openLimit")),a&&a(),l.dispose.call(s)},Data:u,BaseOrder:o,OrderButtonHandler:n,ExpirationDate:d,TPField:m.TPField,SLField:m.SLField,SetLimitsInfo:m.ObservableSetLimitsObject,LimitLevelField:l.LimitLevelField,FieldWrappers:c}});return{viewModel:{createViewModel:function(e){var t=new i,a=$.extend(f,e);return t.init(a),t}}}}),define("webViewModels/OpenDealsViewModel",["require","knockout","KoComponentViewModel","viewModels/Deals/OpenDealsModule","ViewsManager","Dictionary","DialogViewModel","PrintExportManager","StateObject!Positions","openDealsGridSettings"],function(e){var c=e("knockout"),t=e("KoComponentViewModel"),a=e("viewModels/Deals/OpenDealsModule"),d=e("ViewsManager"),m=e("DialogViewModel"),b=e("Dictionary"),p=e("PrintExportManager"),f=e("StateObject!Positions"),i=e("openDealsGridSettings"),g=new a;g.Init(i);var o=extendClass(t,function(){var i=this,o=this.parent,n=o.Data,r=[];function s(e){n.selectedOFHPositionNumber(e)}function l(e){n.selectedPLPositionNumber(e)}function u(e){c.postbox.publish("printableDataAvailable",{dataAvailable:e,viewType:d.ActiveFormType(),viewModel:"OpenDealsViewModel"})}return{init:function(e){var t,a;o.init.call(i,e),e.isHeaderComponent||(t=f.set("ofhPositionNumber",null),a=f.set("plPositionNumber",null),n.selectedOFHPositionNumber=c.observable(t),n.selectedPLPositionNumber=c.observable(a),r.push({dispose:f.subscribe("ofhPositionNumber",s)}),r.push({dispose:f.subscribe("plPositionNumber",l)}),i.subscribeTo(g.HasRecords,u),u(g.HasRecords()))},dispose:function(){for(f.unset("ofhPositionNumber"),f.unset("plPositionNumber");0<r.length;)r.pop().dispose();o.dispose.call(i)},Data:n,model:g,closeDeal:function(e){e.quoteIsActive()&&!g.FlagsState.isMarketClosed()&&window.componentsLoaded()&&!p.IsWorkingNow()&&m.open(eDialog.CloseDeal,{title:b.GetItem("CloseDeal")+":",customTitle:"CloseDealPosNum",width:555,persistent:!1,dialogClass:"deal-slip closeDeal"},eViewTypes.vCloseDeal,{orderId:e.orderID,isStartNavigator:!1})}}});return{viewModel:{createViewModel:function(e){var t=new o;return t.init(e),t}}}}),define("webViewModels/BackOffice/OpenDealsViewModel",["require","knockout","KoComponentViewModel","viewModels/BackOffice/Deals/OpenDealsModule","ViewsManager","Dictionary","DialogViewModel","PrintExportManager","StateObject!Positions","LoadDictionaryContent!datagrids_opendeals"],function(e){var c=e("knockout"),t=e("KoComponentViewModel"),d=e("viewModels/BackOffice/Deals/OpenDealsModule"),a=e("ViewsManager"),m=e("DialogViewModel"),b=e("Dictionary"),p=e("PrintExportManager"),f=e("StateObject!Positions"),i=extendClass(t,function(){var i=this,o=this.parent,n=o.Data,r=[];function s(e){n.selectedOFHPositionNumber(e)}function l(e){n.selectedPLPositionNumber(e)}function u(e){c.postbox.publish("printableDataAvailable",{dataAvailable:e,viewType:a.ActiveFormType(),viewModel:"ExtendedOpenDealsViewModel"})}return{init:function(e){var t,a;o.init.call(i,e),e.isHeaderComponent||(t=f.set("ofhPositionNumber",null),a=f.set("plPositionNumber",null),n.selectedOFHPositionNumber=c.observable(t),n.selectedPLPositionNumber=c.observable(a),r.push({dispose:f.subscribe("ofhPositionNumber",s)}),r.push({dispose:f.subscribe("plPositionNumber",l)}),i.subscribeTo(d.HasRecords,u),u(d.HasRecords()))},dispose:function(){for(f.unset("ofhPositionNumber"),f.unset("plPositionNumber");0<r.length;)r.pop().dispose();o.dispose.call(i)},Data:n,model:d,closeDeal:function(e){d.FlagsState.isMarketClosed()||!window.componentsLoaded()||p.IsWorkingNow()||m.open(eDialog.CloseDeal,{title:b.GetItem("CloseDeal")+":",customTitle:"CloseDealPosNum",width:555,persistent:!1,dialogClass:"deal-slip closeDeal"},eViewTypes.vCloseDeal,{orderId:e.orderID,isStartNavigator:!1})}}});return{viewModel:{createViewModel:function(e){var t=new i;return t.init(e),t}}}}),define("viewModels/PersonalDetailsViewModel",["require","knockout","Customer","ViewModelsManager","StatesManager","StateObject!Setting","UserFlowManager","StateObject!userFlow"],function(e){var s=e("knockout"),l=e("Customer"),u=e("ViewModelsManager"),c=e("StateObject!Setting"),d=e("StatesManager"),m=e("StateObject!userFlow");function t(){var e,t,a=s.observable(!0),i={brokerID:s.observable(""),contactFirstName:s.observable(""),contactLastName:s.observable(""),contactFullName:s.observable(""),contactInitials:s.observable(""),contactUserName:s.observable(""),phone:s.observable(""),mobile:s.observable(""),country:s.observable(""),expiryDate:s.observable(""),updateInfoVisible:d.States.IsCddOrKycRequired,generalStatusColor:s.observable(""),generalStatusName:s.observable(""),generalStatusIcon:s.observable(""),generalStatusClick:function(){s.postbox.publish("action-source","StatusRow"),$viewModelsManager.VManager.SwitchViewVisible(eForms.UserFlowMap)},showCta:!1};function o(e){if(e){switch(i.generalStatusName("flow_"+getEnumName(eUserStatus,e.userStatus)),e.userStatus){case eUserStatus.ReadyToTrade:case eUserStatus.ActiveLimited:i.generalStatusColor("yellow");break;case eUserStatus.Active:i.generalStatusColor("green");break;case eUserStatus.Locked:case eUserStatus.NotActivated:case eUserStatus.Restricted:i.generalStatusColor("red");break;default:i.generalStatusColor("blue")}switch(e.userStatus){case eUserStatus.NotActivated:i.generalStatusIcon("ico-not-active redColor");break;case eUserStatus.ReadyToTrade:case eUserStatus.ActiveLimited:i.generalStatusIcon("ico-limited orangeColor");break;case eUserStatus.Active:i.generalStatusIcon("ico-active greenColor");break;case eUserStatus.Restricted:i.generalStatusIcon("ico-restricted redColor");break;case eUserStatus.Locked:i.generalStatusIcon("ico-locked redColor")}}}function n(e){return isNullOrUndefined(e)?"":e}function r(){u.VManager.GetViewArgs(eViewTypes.vPersonalDetails)===eViewTypes.vPersonalDetails&&a(!1)}return{viewModel:i,isOpenCollapsed:r,collapsedToggle:function(){a(!a())},isCollapsed:a,init:function(){c.get("AccountHubSetting")||c.set("AccountHubSetting",null),t=c.subscribe("AccountHubSetting",function(e){a(e!==eViewTypes.vPersonalDetails)}),r(),i.showCta=!1,i.showCta&&(o(m.get(eStateObjectTopics.UserFlowChanged)),e=m.subscribe(eStateObjectTopics.UserFlowChanged,function(e){o(e)})),l.GetCustomerDetails().then(function(e){var t=JSON.parse(e);i.contactFirstName(n(t.contactFirst)),i.contactLastName(n(t.contactLast)),i.brokerID(t.brokerID),i.contactFullName(i.contactFirstName()+" "+i.contactLastName()),i.phone(t.phone),i.mobile(t.mobile),i.country("cntr_"+l.prop.countryID),i.expiryDate(t.expiryDate),i.contactInitials(i.contactFirstName().charAt(0)+i.contactLastName().charAt(0)),i.contactUserName(l.prop.userName)}).done()},dispose:function(){e&&e(),t&&t()},goToUploaddocuments:function(){u.VManager.RedirectToForm(eForms.UploadDocuments)},goToClientQuestionnaire:function(){u.VManager.RedirectToForm(eForms.ClientQuestionnaire)}}}return{viewModel:{createViewModel:function(){var e=new t;return e.init(),e}}}}),define("webViewModels/PresetInstrumentSearchViewModel",["require","ViewModelsManager","viewModels/BaseInstrumentSearchViewModel"],function(e){var o=e("ViewModelsManager"),t=e("viewModels/BaseInstrumentSearchViewModel"),a=extendClass(t,function(){var t=this,a=this.parent,i=this.Data;return{init:function(e){a.init.call(t,e),t.subscribeTo(i.selected,function(e){o.VmQuotesPreset.SelectPreset(e.presetId)})}}});return{viewModel:{createViewModel:function(e){var t=new a;return t.init(e),t}}}}),define("webViewModels/ScrollComponentViewModel",["require","knockout","KoComponentViewModel"],function(e){var s=e("knockout"),t=e("KoComponentViewModel");return extendClass(t,function(e){var t=this.parent,a=this,i=e;function o(e){var t=i.element.querySelector("div.scrolling-div");t&&0!==e.deltaY&&(t.scrollTop+=e.deltaY),e.preventDefault&&e.preventDefault(),e.returnValue=!1}function n(e){var t=Math.min(r.scrollContext.maxVisibles,e);r.scrollContext.scrollData().length!==t&&(0!==r.scrollContext.startIndex()&&r.scrollContext.startIndex(0),r.scrollContext.scrollData(new Array(t)))}var r={scrollContext:{startIndex:s.observable(0),maxVisibles:i.maxVisibles,recordsCount:i.recordsCount,onScroll:function(e){r.scrollContext.startIndex(e)},scrollData:s.observable([]),divWithScrollOnScroll:function(e,t){var a=t.srcElement||t.target,i=Math.round((a.scrollTop+a.clientHeight)/a.scrollHeight*r.scrollContext.recordsCount());i=Math.min(r.scrollContext.recordsCount()-r.scrollContext.maxVisibles,i-r.scrollContext.maxVisibles),isNaN(i)||i===r.scrollContext.startIndex()||r.scrollContext.startIndex(i)}},afterContentRendered:function(){!function(){if(a.subscribeTo(r.scrollContext.recordsCount,n),i.refScrollAreaElementId){var e=document.getElementById(i.refScrollAreaElementId);e&&e.addEventListener("wheel",o)}}()},contentTemplate:i.contentTemplate,contentContext:i.contentContext,dispose:function(){if(i.refScrollAreaElementId){var e=document.getElementById(i.refScrollAreaElementId);e&&e.removeEventListener("wheel",o)}t.dispose.call(a)}};return n(r.scrollContext.recordsCount()),r})}),define("webViewModels/TileLayoutViewModel",["require","knockout","HistoryManager","KoComponentViewModel","TileSettingsManager","ChartLayoutSettings","StateObject!AccountHub"],function(){var l=require("knockout"),e=require("KoComponentViewModel"),u=require("HistoryManager"),c=require("TileSettingsManager"),d=require("ChartLayoutSettings"),m=require("StateObject!AccountHub"),a=extendClass(e,function(e){var a=this,i=this.parent,o=this.Data,n=extendType({},e),r=n.selectedLayout||eTileLayout.FourSplit;function s(e){(e.type===eHistoryStateType.ExitFullscren||e.type===eHistoryStateType.CloseDialog&&"ChartPageFullScreen"==e.popupId)&&o.isFullScreen(!1),e.type===eHistoryStateType.EnterFullscren&&o.isFullScreen(!0)}return{init:function(e){var t;i.init.call(a,e),c.Init({initialLayout:r}),o.layouts=n.layouts||[1],o.templates=(n.templates||[]).slice(0,Math.max.apply(null,o.layouts)).map(function(e){return{name:e}}),o.selectedLayout=l.observable(c.GetLayout()),o.isFullScreen=l.observable(!1),o.isLayoutSelectorExpanded=l.observable(!1),o.activeTileId=l.observable((t=c.GetActiveTileId(),r<=t&&(function(e){var t=c.GetActiveTileId(),a=d.GetSettings(t);a.isActive=!1,d.UpdateSettings(t,a);var i,o=(i=a,JSON.parse(JSON.stringify(i)));o.isActive=!0,d.UpdateSettings(e,o)}(t=r-1),c.UpdateActiveTileId(t),o.selectedLayout(r)),t)),o.isSingleMode=l.pureComputed(function(){return o.selectedLayout()===eTileLayout.Single}),a.subscribeTo(o.selectedLayout,function(e){c.UpdateLayout(e),n.activeChangedHandler&&(o.activeTileId()>=e&&1<e?o.activeTileId(0):n.activeChangedHandler(o.activeTileId(),e))}),a.subscribeTo(o.activeTileId,function(e){n.activeChangedHandler&&n.activeChangedHandler(e,o.selectedLayout())}),a.subscribeTo(o.isFullScreen,function(e){m.update("displayNone",e)}),u.OnStateChanged.Add(s)},dispose:function(){u.OnStateChanged.Remove(s),i.dispose.call(a)},SelectLayout:function(e){o.selectedLayout(e),o.isLayoutSelectorExpanded(!1)},SetActiveTile:function(e){o.activeTileId()!=e&&(o.activeTileId(-1),setTimeout(function(e,t,a){t.activeTileId(e),a.UpdateActiveTileId(e)},10,e,o,c))},ToggleFullScreen:function(){o.isFullScreen()?u.Back():u.PushPopupState(ePopupType.Dialog,n.fullscreenPageId)},ToggleLayoutSelector:function(){o.isLayoutSelectorExpanded(!o.isLayoutSelectorExpanded())}}});return{viewModel:{createViewModel:function(e){var t=new a(e);return t.init(),t}}}}),define("webViewModels/TileTransactionSwitcherViewModel",["require","knockout","KoComponentViewModel","Dictionary","ViewsManager","StatesManager","InstrumentsManager","QuotesManager","Customer","BuilderForInBetweenQuote","StateObject!Transaction","RegistrationManager","ChartSettingManager","ChartLayoutSettings"],function(e){var m=e("knockout"),t=e("KoComponentViewModel"),n=e("Dictionary"),b=e("ViewsManager"),p=e("StatesManager"),r=e("InstrumentsManager"),f=e("QuotesManager"),g=e("Customer"),s=e("BuilderForInBetweenQuote"),v=e("StateObject!Transaction"),l=e("RegistrationManager"),D=e("ChartSettingManager"),S=e("ChartLayoutSettings"),a=extendClass(t,function(){var t=this,a=t.parent,c=this.Data||{},i=47,d=[{transactionName:"fx-component-new-deal-slip",transactionLabel:n.GetItem("newdeal"),transactionType:eTransactionSwitcher.NewDeal},{transactionName:"fx-component-new-limit",transactionLabel:n.GetItem("newlimit"),transactionType:eTransactionSwitcher.NewLimit}],o=[];return{init:function(e){a.init.call(t,e),S.Init(),l.Update(eRegistrationListName.ContractQuotesTable,S.GetTileInstruments()),c.quoteForOtherCcyToAccountCcy=v.set("quoteForOtherCcyToAccountCcy",m.observable("")),c.quoteForBaseCcyToAccountCcy=v.set("quoteForBaseCcyToAccountCcy",m.observable("")),c.quoteForUsdCcyToAccountCcy=v.set("quoteForUsdCcyToAccountCcy",m.observable("")),c.instrumentId=v.set("selectedInstrument",m.observable("")),c.transactionsList=m.observableArray(d),c.selectedTransactionTab=m.observable(),c.selectedTransactionTab(v.update("selectedTransactionTab",{})),o.push({unsubscribe:v.subscribe("selectedTransactionTab",function(e){c.selectedTransactionTab(e)})}),c.isReady=m.observable(!1),c.isNewDealVisible=t.createComputed(function(){return c.selectedTransactionTab().transactionType===eTransactionSwitcher.NewDeal}),c.isNewLimitVisible=t.createComputed(function(){return c.selectedTransactionTab().transactionType===eTransactionSwitcher.NewLimit}),t.subscribeTo(c.instrumentId,function(e){var t,a=r.GetInstrument(e);t=a,s.GetInBetweenQuote(t.otherSymbol,g.prop.baseCcyId()).then(function(e){c.quoteForOtherCcyToAccountCcy(e)}),s.GetInBetweenQuote(t.baseSymbol,g.prop.baseCcyId()).then(function(e){c.quoteForBaseCcyToAccountCcy(e)})}),function(){var e,l=(e=(D.Chart().tileSettings||{}).activeTileId||0,(S.GetSettings(e)||{}).instrumentId);function u(){var e,t,a,i,o,n,r,s=f.Quotes.GetItem(l);s&&(c.instrumentId(l),f.OnChange.Remove(u),e=s.state!==eQuoteStates.NotActive,a=e,o=b.GetViewArgsByKeyName(eViewTypes.vTransactionSwitcher,"transactionType")||eTransactionSwitcher.NewDeal,n=isDefinedType(o)&&objectContainsValue(eTransactionSwitcher,o)?o:eTransactionSwitcher.NewDeal,r=p.States.IsMarketClosed(),!g.prop.brokerAllowLimitsOnNoRates||a&&!r||(n=eTransactionSwitcher.NewLimit),i=n,t=m.utils.arrayFirst(d,function(e){return e.transactionType===i}),v.update("selectedTransactionTab",t),c.isReady(!0))}f.OnChange.Add(u),u()}(),s.GetInBetweenQuote(i,g.prop.baseCcyId()).then(function(e){c.quoteForUsdCcyToAccountCcy(e)}).done()},dispose:function(){for(;0<o.length;)o.pop().unsubscribe();a.dispose.call(t)},Data:c}});return{viewModel:{createViewModel:function(e){var t=new a;return t.init(e),t}}}}),define("webViewModels/TransactionSwitcherViewModel",["require","knockout","KoComponentViewModel","Dictionary","ViewsManager","InstrumentsManager","Customer","BuilderForInBetweenQuote","StateObject!Transaction"],function(e){var c=e("knockout"),t=e("KoComponentViewModel"),a=e("Dictionary"),d=e("ViewsManager"),m=e("InstrumentsManager"),b=e("Customer"),p=e("BuilderForInBetweenQuote"),f=e("StateObject!Transaction"),i=extendClass(t,function(){var o=this,n=o.parent,r=this.Data||{},s=47,l=[{transactionName:"fx-component-new-deal-slip",transactionLabel:a.GetItem("newdeal"),transactionType:eTransactionSwitcher.NewDeal},{transactionName:"fx-component-new-limit",transactionLabel:a.GetItem("newlimit"),transactionType:eTransactionSwitcher.NewLimit}],u=[];return{init:function(e){n.init.call(o,e),r.quoteForOtherCcyToAccountCcy=f.set("quoteForOtherCcyToAccountCcy",c.observable("")),r.quoteForBaseCcyToAccountCcy=f.set("quoteForBaseCcyToAccountCcy",c.observable("")),r.quoteForUsdCcyToAccountCcy=f.set("quoteForUsdCcyToAccountCcy",c.observable("")),r.instrumentId=f.set("selectedInstrument",c.observable("")),r.transactionsList=c.observableArray(l),r.selectedTransactionTab=c.observable(),r.selectedTransactionTab(f.update("selectedTransactionTab",{})),u.push({unsubscribe:f.subscribe("selectedTransactionTab",function(e){r.selectedTransactionTab(e)})}),r.isNewDealVisible=o.createComputed(function(){return r.selectedTransactionTab().transactionType===eTransactionSwitcher.NewDeal}),r.isNewLimitVisible=o.createComputed(function(){return r.selectedTransactionTab().transactionType===eTransactionSwitcher.NewLimit}),o.subscribeTo(r.instrumentId,function(e){var t,a=m.GetInstrument(e);a&&(t=a,p.GetInBetweenQuote(t.otherSymbol,b.prop.baseCcyId()).then(function(e){r.quoteForOtherCcyToAccountCcy(e)}).done(),p.GetInBetweenQuote(t.baseSymbol,b.prop.baseCcyId()).then(function(e){r.quoteForBaseCcyToAccountCcy(e)}).done())}),p.GetInBetweenQuote(s,b.prop.baseCcyId()).then(function(e){r.quoteForUsdCcyToAccountCcy(e)}).done(),i=d.GetViewArgs(eViewTypes.vTransactionSwitcher)||{},!isNullOrUndefined(i.orderDir)&&i.instrumentId&&m.GetInstrument(i.instrumentId).isStock&&i.orderDir===eOrderDir.Sell&&(i.orderDir=eOrderDir.None),f.update("selectedTransactionTab",(t=d.GetViewArgsByKeyName(eViewTypes.vTransactionSwitcher,"transactionType")||eTransactionSwitcher.NewDeal,a=isDefinedType(t)&&objectContainsValue(eTransactionSwitcher,t)?t:eTransactionSwitcher.NewDeal,c.utils.arrayFirst(l,function(e){return e.transactionType===a})));var t,a,i},dispose:function(){var e=f.get("selectedDealAmount");for(e&&e("");0<u.length;)u.pop().unsubscribe();f.clear(),n.dispose.call(o)},Data:r}});return{viewModel:{createViewModel:function(e){var t=new i;return t.init(e),t}}}}),define("webViewModels/SearchCountryViewModel",["require","viewModels/BaseSearchCountryViewModel"],function(e){var t=e("viewModels/BaseSearchCountryViewModel"),a=extendClass(t,function(){var e=this.parent,t=this.Data;return self.searchFocus=ko.observable(!0),self.onFocus=function(){self.searchFocus(!0)},{SetCountry:e.SetCountry,Data:t}});return{viewModel:{createViewModel:function(e){var t=new a(e);return t.Init(),t}}}}),define("currentAppFolder/UILayer/uiBehavior",["require","DialogViewModel"],function(e){var t=e("DialogViewModel");return{closeAmlPepForm:function(){t.close()}}}),define("viewModels/deposit/DepositConfirmationViewModel",["require","knockout","KoComponentViewModel","SymbolsManager","Customer","ErrorManager","dalWithdrawal","fxnet/uilayer/Modules/HtmlToCanvas","fxnet/uilayer/Modules/DomHelper","depositConfirmationConfiguration"],function(e){var d=e("knockout"),t=e("KoComponentViewModel"),m=e("SymbolsManager"),b=e("Customer"),p=e("ErrorManager"),f=e("dalWithdrawal"),g=e("fxnet/uilayer/Modules/HtmlToCanvas"),v=e("fxnet/uilayer/Modules/DomHelper"),D=e("depositConfirmationConfiguration"),a=extendClass(t,function(a){var t=this,i=this.parent,o=this.Data,n={},r={elementToPrint:null,topOffset:emptyFn};function s(e){var t=JSONHelper.STR2JSON("ViewAndPrintWithdrawalViewModel/onLoadCCDepositsComplete",e,eErrorSeverity.medium);n.deposits(t.Deposits),n.depositsTotal(t.DepositsTotal),n.firstDepositDate(t.FirstDepositDate),n.lastDepositDate(t.LastDepositDate)}function l(e){return v.NodeExists(e,D.excludeList)}function u(e){var t={content:e.toDataURL(),fileName:"DC_"+o.accountNumber+"_"+o.dateNow.toISOString().replace(/(-|T|:)/g,"").slice(0,12)+".png"};isFunctionType(a.uploadStringImage)&&a.uploadStringImage(t)}function c(e){o.isLoading(!1),o.hasErrors(!0),p.onError("DepositConfirmationVM/sendDepositConfirmation",e.message,eErrorSeverity.medium)}return{init:function(e){i.init.call(t,e),o.isEmailClicked=d.observable(!1),o.fullName=b.prop.firstName+" "+b.prop.lastName,o.accountNumber=b.prop.accountNumber,o.userName=b.prop.userName,o.dateNow=new Date,o.isLoading=d.observable(!1),o.drawStatus=d.observable(!1),o.editFullName=d.observable(""),o.editPhoneNumber=d.observable(""),o.hasErrors=d.observable(!1),n.depositsTotal=d.observableArray(),n.deposits=d.observableArray(),n.firstDepositDate=d.observable(""),n.lastDepositDate=d.observable(""),f.getCCDeposits(s)},DepositsInfo:n,data:o,sendDepositConfirmation:function(){if(o.hasErrors(!1),0!==o.editFullName().length&&0!==o.editPhoneNumber().length&&o.drawStatus()&&!o.isLoading()){o.isLoading(!0);var e={scrollX:0,scrollY:r.topOffset(),ignoreElements:l,useCORS:!0};g.convert(r.elementToPrint,e).then(u).catch(c)}},getTranslatedSymbolByName:function(e){return m.GetTranslatedSymbolByName(e)},setPrintSettings:function(e,t){r.elementToPrint=e,r.topOffset=t}}});return{viewModel:{createViewModel:function(e){var t=new a(e);return t.init(e),t}}}}),define("webViewModels/PriceAlertsViewModel",["require","knockout","KoComponentViewModel","viewModels/Limits/PriceAlertsModule","ViewsManager","DialogViewModel","PrintExportManager","ActiveLimitsConfiguration","InstrumentsManager"],function(e){var o=e("knockout"),t=e("KoComponentViewModel"),n=e("viewModels/Limits/PriceAlertsModule"),r=e("ViewsManager"),s=e("DialogViewModel"),l=e("InstrumentsManager"),a=extendClass(t,function(){var t=this,a=this.parent;function i(e){o.postbox.publish("printableDataAvailable",{dataAvailable:e,viewType:r.ActiveFormType(),viewModel:"PriceAlertsViewModel"})}return{init:function(e){a.init.call(t,e),e.isHeaderComponent||t.subscribeAndNotify(n.HasRecords,i)},dispose:function(){a.dispose.call(t)},model:n,openNewDeal:function(e,t,a){l.IsInstrumentStock(e)&&(t=eOrderDir.None);var i,o={instrumentId:e,orderDir:t,tab:a,transactionType:eTransactionSwitcher.NewDeal};i=o,s.open(eDialog.TransactionSwitcher,{title:"",customTitle:"TransactionDropDown",width:700,persistent:!1,dialogClass:"deal-slip"},eViewTypes.vTransactionSwitcher,i)},openNewPriceAlert:function(e,t,a){isNullOrUndefined(e)&&(e=l.GetUserDefaultInstrumentId());var i={instrumentId:e,orderDir:t,tab:a,transactionType:eTransactionSwitcher.NewPriceAlert};s.open(eDialog.NewPriceAlert,{title:"",customTitle:"TransactionDropDown",width:700,persistent:!1,dialogClass:"deal-slip"},eViewTypes.vNewPriceAlert,i)}}});return{viewModel:{createViewModel:function(e){var t=new a;return t.init(e),t}}}}),define("viewModels/deposit/ElectronicSignatureViewModel",["require","knockout","KoComponentViewModel","SignaturePad"],function(e){var r=e("knockout"),t=e("KoComponentViewModel"),s=e("SignaturePad"),a=extendClass(t,function(e){var t,a=this,i=this.parent,o=this.Data;function n(){o.drawStatus(!0)}return{init:function(){i.init.call(a),o.drawStatus=r.observable(!1),o.isLoading=isFunctionType(e.isLoading)?e.isLoading:emptyFn,a.subscribeTo(o.drawStatus,function(){isFunctionType(e.callback)&&e.callback(o.drawStatus())})},InitCanvas:function(e){t=new s(e,{onBegin:n,throttle:0})},ClearSignature:function(){t.clear(),o.drawStatus(!1)},Data:o}});return{viewModel:{createViewModel:function(e){var t=new a(e);return t.init(),t}}}}),define(["require","KoComponentViewModel","ViewsManager","UrlResolver"],function(e){var n=e("ViewsManager"),r=e("UrlResolver"),t=e("KoComponentViewModel"),a=extendClass(t,function(){var a=this,i=this.parent,o=this.Data,e=r.getImagePath("Withdrawal-Logo.png",!1,!0);return{Data:o,LogoImagePath:e,init:function(e){var t;i.init.call(a,e),e.data?(t=e.data,Object.assign(o,t)):n.RedirectToURL(r.getRedirectUrl("Deals"))},dispose:function(){i.dispose.call(a)}}});return{viewModel:{createViewModel:function(e){var t=new a;return t.init(e||{}),t}}}}),define("viewModels/accounthub/AccountHeaderViewModel",["require","knockout","KoComponentViewModel","Customer","UserFlowManager","StateObject!userFlow","StateObject!AccountHub","StateObject!IM","PermissionsModule"],function(e){var t=e("KoComponentViewModel"),l=e("knockout"),u=e("Customer"),c=e("StateObject!userFlow"),d=e("StateObject!AccountHub"),m=e("StateObject!IM"),b=e("PermissionsModule"),a=extendClass(t,function(e){var t=this,a=this.parent,i=this.Data,o=[],n=l.observable(!1),r=20;function s(e){if(e)switch(!u.prop.isDemo&&u.prop.abTestings.configuration["account-hub-map"]?i.userStatusName(getEnumName(eUserStatus,e.userStatus)):i.userStatusName(getEnumName(eUserStatus,eUserStatus.Active)),i.generalStatusName("flow_"+getEnumName(eUserStatus,e.userStatus)),e.userStatus){case eUserStatus.ReadyToTrade:case eUserStatus.ActiveLimited:i.generalStatusColor("yellow");break;case eUserStatus.Active:i.generalStatusColor("green");break;case eUserStatus.Locked:case eUserStatus.NotActivated:case eUserStatus.Restricted:i.generalStatusColor("red");break;default:i.generalStatusColor("blue")}}return{init:function(){i.generalStatusColor=l.observable(""),i.userStatusName=l.observable(getEnumName(eUserStatus,eUserStatus.Active)),i.generalStatusName=l.observable(""),i.onClose=e.onClose,s(c.get(eStateObjectTopics.UserFlowChanged)),i.userName=function(){if(!u.prop.firstName&&!u.prop.lastName)return"";var e=u.prop.firstName?u.prop.firstName:"",t=u.prop.lastName?u.prop.lastName.charAt(0):"",a=(e+" "+t+".").trim();if(a.length>r&&0<(a=e).length)if(a="",e.length>r)a=e.substr(0,r).trim()+"...";else for(var i=e.split(" "),o=0;o<i.length;o++)(a+i[o]).length<=r&&(a+=i[o]+" ");return a=a.trim()}(),m.get("message")||m.set("message","empty"),i.MessageCSS=l.observable(m.get("message")),d.get("visible")||d.set("visible",!1),n(d.get("visible")),o.push({unsubscribe:m.subscribe("message",function(e){i.MessageCSS(e)})},{unsubscribe:d.subscribe("visible",function(e){n(e)})},{unsubscribe:c.subscribe(eStateObjectTopics.UserFlowChanged,function(e){s(e)})})},dispose:function(){for(;0<o.length;)o.pop().unsubscribe();a.dispose.call(t)},Data:i,toggleAccountHub:function(){var e=d.get("visible");d.update("visible",!e),e?l.postbox.publish("hub-menu-close"):l.postbox.publish("hub-menu-open")},AccountButtonSelected:n,Customer:u,permissionsModule:b,generalStatusClick:function(){l.postbox.publish("action-source","StatusRow"),$viewModelsManager.VManager.SwitchViewVisible(eForms.UserFlowMap)}}});return{viewModel:{createViewModel:function(e){var t=new a(e||{});return t.init(),t}}}}),define("viewModels/accounthub/AccountHubCardViewModel",["require","knockout","KoComponentViewModel","StateObject!AccountHub","StateObject!userFlow","ViewsManager","PermissionsModule","AlertsManager","Customer","dalCommon","CustomerProfileManager","StatesManager","StateObject!Setting","Dictionary"],function(e){var t=e("KoComponentViewModel"),d=e("knockout"),m=e("StateObject!AccountHub"),b=e("ViewsManager"),p=e("PermissionsModule"),f=e("AlertsManager"),g=e("Customer"),v=e("dalCommon"),D=e("CustomerProfileManager"),S=e("StatesManager"),y=e("StateObject!Setting"),T=e("StateObject!userFlow"),C=e("Dictionary"),a=extendClass(t,function(e){var t,a,i,o=this,n=this.parent,r=this.Data,s=0;function l(e){if(!s){if(s=1,!0===g.prop.isDemo)return;if(e!==eUserStatus.Active)m.update("visible",!0);else{var t=D.ProfileCustomer();t.activeFirstLogin?1===t.activeFirstLogin&&(t.activeFirstLogin=-1,D.ProfileCustomer(t)):(t.activeFirstLogin=1,m.update("visible",!0),D.ProfileCustomer(t))}}}function u(e,t){b.RedirectToForm(e,t),y.update("AccountHubSetting",t),c()}function c(){r.visible(!1),m.update("visible",!1)}return{init:function(){y.get("AccountHubSetting")||y.set("AccountHubSetting",null),r.visible=d.observable(!1),r.none=d.observable(!1),m.set("visible",!1),m.set("displayNone",!0);var e=T.get(eStateObjectTopics.UserFlowChanged);t=m.subscribe("visible",function(e){r.visible(e)}),a=m.subscribe("displayNone",function(e){r.none(e)}),i=T.subscribe(eStateObjectTopics.UserFlowChanged,function(e){!0===g.prop.abTestings.configuration["account-hub-map"]&&l(e.userStatus)}),!0===g.prop.abTestings.configuration["account-hub-map"]&&e&&l(e.userStatus)},dispose:function(){t&&t(),i&&i(),a&&a(),n.dispose.call(o)},Data:r,Close:function(){d.postbox.publish("hub-menu-close"),m.update("visible",!1)},SwitchView:u,Logout:function(){c(),p.CheckPermissions("commonLogout")&&(f.UpdateAlert(AlertTypes.ExitAlert),f.PopAlert(AlertTypes.ExitAlert))},Register:function(){p.RegisterLeadType()},permissionsModule:p,switchFromDemoToReal:function(){g.prop.isDemo&&v.SwitchAccount()},switchFromRealToDemo:function(){g.prop.isDemo||v.SwitchAccount()},IsDemo:S.States.IsDemo,hasDemoBlock:function(){return g.prop.hasActiveDemo||g.prop.isDemo},showLogoutButton:function(){return p.CheckActionAllowed("logout")},showRegisterButton:function(){return!(!0===g.prop.abTestings.configuration["account-hub-map"]||p.CheckActionAllowed("logout"))},ChangePassword:function(){p.CheckPermissions("changePassword")?u(eForms.Settings,eViewTypes.vChangePassword):(f.UpdateAlert(AlertTypes.ServerResponseAlert,C.GetItem("GenericAlert"),C.GetItem("Forbidden"),null),f.PopAlert(AlertTypes.ServerResponseAlert))}}});return{viewModel:{createViewModel:function(e){var t=new a(e||{});return t.init(),t}}}}),define("viewModels/InstrumentPriceAlertViewModel",["require","ActiveLimitsManager","KoComponentViewModel","knockout"],function(e){var n=e("ActiveLimitsManager"),r=e("knockout"),t=e("KoComponentViewModel"),a=extendClass(t,function(e){var t=this,a=this.parent,i=this.Data;if(!e.instrumentId)throw new Error("Missing instrument id paramerter");function o(){i.isOn(n.HasPriceAlerts(r.unwrap(e.instrumentId)))}return i.isOn=e.isOnObservable||r.observable(),i.isOn(n.HasPriceAlerts(r.unwrap(e.instrumentId))),n.OnChange.Add(o),r.isObservable(e.instrumentId)&&e.instrumentId.subscribe(function(){o()}),{dispose:function(){a.dispose.call(t),n.OnChange.Remove(o)},Data:i}});return{viewModel:{createViewModel:function(e){return new a(e)}}}}),define("viewModels/NewPriceAlertViewModel",["require","knockout","Q","newLimitSettings","dalOrders","ViewModelsManager","Customer","CustomerProfileManager","PermissionsModule","InstrumentsManager","StatesManager","viewModels/Limits/AmountFieldsWrapper","viewModels/Limits/LimitBaseViewModel","StateObject!Transaction"],function(e){var l=e("knockout"),i=e("newLimitSettings"),u=e("Q"),c=e("dalOrders"),d=e("Customer"),m=e("CustomerProfileManager"),b=e("PermissionsModule"),p=e("InstrumentsManager"),f=e("StatesManager"),t=e("viewModels/Limits/LimitBaseViewModel"),g=e("StateObject!Transaction"),v=e("LimitValuesCalculator"),o=extendClass(t,function(){var t,a=this,i=this.parent,r=this.Data,n=i.BaseOrder,s=0;var e=i.updateDistances;function o(e,t,a,i){switch(r.hasInstrument(!0),r.isProcessing(!1),s=r.orderDir()+r.openLimit(),e[0].msgKey){case"OrderError20":l.postbox.publish("price-alert-error",{message:environmentData.maxPriceAlertsCount+" price alert limit reached"}),e[0].result=eResult.Success;break;case"OrderError21":return l.postbox.publish("price-alert-error",{message:"price alert exist"}),void r.priceAlertExist(!0);case"OrderError22":l.postbox.publish("price-alert-error",{message:"general server error"}),e[0].result=eResult.Success;break;case"SuccessPriceAlertAdd":l.postbox.publish("price-alert-create")}var o=p.GetInstrument(a);n.OnActionReturn(e,t,o,{redirectToView:eForms.PriceAlerts,requestData:i,backFormTarget:eForms.Quotes}),o&&p.SetInstrumentDealAmount(a,o.defaultDealSize)}return i.updateDistances=a.updateDistances=function(){e(),r.openLimit()?r.orderDir()===eOrderDir.Sell?r.percentageFromMarketRate(Format.toPercent(v.CalculatePercentFromRate(r.openLimit(),r.activeQuote.ask))):r.orderDir()===eOrderDir.Buy?r.percentageFromMarketRate(Format.toPercent(v.CalculatePercentFromRate(r.openLimit(),r.activeQuote.bid))):r.percentageFromMarketRate(""):r.percentageFromMarketRate(""),s!=r.orderDir()+r.openLimit()&&r.priceAlertExist(!1)},{init:function(e){g.containsKey("stateObjectIsReadyDefer")||g.set("stateObjectIsReadyDefer",u.defer()),r.showLimits=l.observable(1===m.ProfileCustomer().newLimitOrders).extend({notify:"always"}),r.showLimitsSlideCompleted=l.observable(!1),r.toggleLimitsSection=function(){var e=!!r.showLimits();r.showLimits(!e)},r.priceAlertExist=l.observable(!1),r.priceAlertExceedAmount=l.observable(!1),r.percentageFromMarketRate=l.observable(),i.init.call(a,e),r.selectedInstrument.extend({validatable:!1}),r.selectedInstrument.extend({validation:{validator:function(e){var t=r.isActiveQuote(),a=d.prop.brokerAllowLimitsOnNoRates||!f.States.IsMarketClosed()&&t;return isEmptyValue(e)||isEmptyValue(t)||a},message:Dictionary.GetItem("InstrumentInactive")}}),r.selectedInstrument.extend({tooltipValidation:{notify:"always"}}),a.parent.subscribeTo(r.openLimit,a.updateDistances),r.showForexNonIslamicDealInfo=a.createComputed(function(){return r.isForex()&&d.prop.dealPermit!==eDealPermit.Islamic}),r.OrderButtonEnabled=a.createComputed(function(){var e=r.selectedInstrument.isValid(),t=r.hasInstrument()&&r.quotesAvailable(),a=r.isActiveQuote(),i=d.prop.brokerAllowLimitsOnNoRates,o=r.isShowBuyBox()||r.isShowSellBox(),n=0<r.dealMinMaxAmounts().length;return r.openLimit.isValid()&&!r.isProcessing()&&(i||a)&&o&&e&&t&&n}),t=a.createComputed(function(){return r.selectedInstrument()}),a.subscribeAndNotify(t,function(e){var t=p.GetInstrument(e);t&&i.setLimitTabsFromClientProfile()}),i.registerToDispatcher(),g.get("stateObjectIsReadyDefer").resolve(),r.showTools(!1),r.orderDir(eOrderDir.Buy)},dispose:function(){i.dispose.call(a)},Data:r,BaseOrder:n,OrderButtonHandler:function(){if(r.OrderButtonEnabled()&&b.CheckActionAllowed("newLimit",!0,{register:registerParams.traderInstrumentId+r.selectedInstrument()+registerParams.traderOrderDir+(0===r.orderDir()?"Sell":"Buy")}))if(1!=f.States.fxDenied()){if(n.LimitValidateQuote(r.selectedInstrument())){var e=new TLimit;i.fillData(e),e.mode=eLimitMode.PriceAlert,e.amount=0,r.isProcessing(!0),r.hasInstrument(!1),c.AddLimit(e,o)}}else n.ValidateOnlineTradingUser()}}});return{viewModel:{createViewModel:function(e){var t=new o,a=Object.assign(i,e);return t.init(a),t}}}}),define("viewModels/ActivationSlipViewModel",["require","KoComponentViewModel","UserFlowManager","StateObject!userFlow","UserFlowCTA"],function(e){var t=e("KoComponentViewModel"),l=e("StateObject!userFlow"),u=e("UserFlowCTA"),a=extendClass(t,function(e){var t,a=this,i=this.parent,o=this.Data,n=null,r="";function s(e){e?(o.ctaText(e.ctaText),n=e.cta,r=e.ctaText,o.userFlowMsg(e.userMessage),o.isVisible(e.activationRequired)):o.isVisible(!1)}return{init:function(){o.isVisible=ko.observable(!1),o.ctaText=ko.observable(""),o.userFlowMsg=ko.observable(""),t=l.subscribe(eStateObjectTopics.UserFlowChanged,function(e){s(e)}),s(l.get(eStateObjectTopics.UserFlowChanged))},dispose:function(){t&&t(),i.dispose.call(a)},data:o,ctaClick:function(){"contactUs"!==r&&ko.postbox.publish("action-source","DealSlip"),u.getUserFlowAction(n)()}}});return{viewModel:{createViewModel:function(e){var t=new a(e||{});return t.init(),t}}}}),define("UserFlowBaseViewModel",["require","UserFlowManager","StateObject!userFlow","KoComponentViewModel","Customer"],function(e){var t=e("KoComponentViewModel"),h=e("StateObject!userFlow"),w=e("Customer"),L=e("UserFlowManager");return extendClass(t,function(){var a,i,o,n,r,s=this,e=s.parent,l=this.Data||{},u="collapsedContent";function c(e){e&&e.userStatus!==eUserStatus.NA&&(e.userFlowStepsStatuses.forEach(function(e,t){i()[t](e)}),l.userStatus(e.userStatus),l.generalStatusName("flow_"+getEnumName(eUserStatus,e.userStatus)),l.isLocked(e.userStatus===eUserStatus.Locked),l.isRestricted(e.userStatus===eUserStatus.Restricted),l.userMessage(e.userMessage),o(e.currentStep),l.ctaTxt(e.ctaText),n(e.documentProofOfResidenceStatus),r(e.documentProofOfIDStatus),l.maxDaysCounter(e.maxDaysCounter),l.daysCounter(e.daysCounter),l.cta=e.cta)}function d(){switch(l.userStatus()){case eUserStatus.NotActivated:return"ico-not-active redColor";case eUserStatus.ReadyToTrade:case eUserStatus.ActiveLimited:return"ico-limited orangeColor";case eUserStatus.Active:return"ico-active greenColor";case eUserStatus.Restricted:return"ico-restricted redColor";case eUserStatus.Locked:return"ico-locked redColor"}}function m(){switch(l.userStatus()){case eUserStatus.ReadyToTrade:case eUserStatus.ActiveLimited:return"yellowBackground";case eUserStatus.Active:return"greenBackground";case eUserStatus.Locked:case eUserStatus.NotActivated:case eUserStatus.Restricted:return"redBackground"}}function b(e){switch(i()[eUserFlowSteps[e]]()){case eStepStatus.Error:return"ico-milestone-error redColor";case eStepStatus.Restricted:return"ico-milestone-restricted redColor";case eStepStatus.Available:return"ico-milestone blueColor";case eStepStatus.Complete:return 0===eUserFlowSteps[e]||eUserFlowSteps[e]===i().length-1?"ico-milestone-dot greenColor":"ico-milestone-done greenColor";case eStepStatus.Seamless:return 0===eUserFlowSteps[e]?"ico-milestone-dot blueColor":"ico-milestone grayColor";case eStepStatus.Hidden:case eStepStatus.NotActive:default:return 0===eUserFlowSteps[e]||eUserFlowSteps[e]===i().length-1?"ico-milestone-dot grayColor":"ico-milestone grayColor"}}function p(e){return l.userStatus()!==eUserStatus.Locked&&i()[eUserFlowSteps[e]]()===eStepStatus.Available}function f(e){return eUserFlowSteps[e]===o()}function g(e){return i()[eUserFlowSteps[e]]()===eStepStatus.Complete}function v(e){return i()[eUserFlowSteps[e]]()===eStepStatus.Hidden}function D(e){var t=-1;switch(e){case"id":t=r();break;case"addr":t=n()}switch(t){case eUploadDocumentStatus.Approved:return"ico-poi-"+e+"-done greenColor";case eUploadDocumentStatus.Incomplete:return"ico-poi-"+e+"-error redColor";case eUploadDocumentStatus.Processing:return"ico-poi-"+e+"-pending orangeColor";case eUploadDocumentStatus.AwaitingDocument:if(i()[eUserFlowSteps.ProofOfIdentity]()===eStepStatus.NotActive)break;return"ico-poi-"+e+" blueColor";case eUploadDocumentStatus.AwaitingSignature:return"ico-poi-"+e+" blueColor"}return"ico-poi-"+e+" grayColor"}function S(){var e=!l.userFlowToggle();l.userFlowToggle(e),h.update(u,l.userStatus()===eUserStatus.Active?!e:e),!1===l.userFlowToggle()?(ko.postbox.publish("hub-map-expand"),L.startGetDocumentsStatus()):ko.postbox.publish("hub-map-collapse")}function y(){return""!==l.ctaTxt()}function T(e){}function C(){}return{init:function(e){var t;l.cta=eCta.None,t=h.get(u),i=ko.observableArray([ko.observable(),ko.observable(),ko.observable(),ko.observable(),ko.observable(),ko.observable()]),o=ko.observable(),n=ko.observable(),r=ko.observable(),l.userMessage=ko.observable(""),l.ctaTxt=ko.observable(""),l.userStatus=ko.observable(),l.generalStatusName=ko.observable(""),l.isLocked=ko.observable(!1),l.isRestricted=ko.observable(!1),l.stepStatus=b,l.isAvailable=p,l.isCurrent=f,l.isHidden=v,l.isComplete=g,l.poiState=D,l.generalStatusIcon=d,l.generalStatusColor=m,l.userFlowToggle=ko.observable(!isNullOrUndefined(t)&&t),l.toggleUserFlow=S,l.ctaVisible=y,l.stepClick=T,l.ctaClick=C,l.tooltipIdToggle=ko.observable(!1),l.tooltipAddrToggle=ko.observable(!1),l.tooltipNumToggle=ko.observable(!1),l.daysCounter=ko.observable(),l.maxDaysCounter=ko.observable(14),l.isVisible=!w.prop.isDemo,l.daysCounterProgress=s.createComputed(function(){return 4<l.daysCounter()?"":"redProgress"}),l.daysCounterBar=s.createComputed(function(){return 4<l.daysCounter()?"":"redBar"}),l.daysCounterText=s.createComputed(function(){return 4<l.daysCounter()?"":"redDays"}),c(h.get(eStateObjectTopics.UserFlowChanged)),l.userStatus()===eUserStatus.Active?S():L.startGetDocumentsStatus(),a=h.subscribe(eStateObjectTopics.UserFlowChanged,function(e){c(e)})},dispose:function(){a&&a(),e.dispose.call(s)},data:l}})}),define("UserFlowCTA",["require","PermissionsModule","ViewsManager","AlertsManager"],function(e){var t=e("PermissionsModule"),a=e("ViewsManager"),i=e("AlertsManager");return{getUserFlowAction:function(e){switch(e){case eCta.Seamless:return t.RegisterLeadType;case eCta.ContactUs:return i.PopAlert.bind(null,AlertTypes.ContactUsCTAAlert);case eCta.ClientQuestionnaire:return a.SwitchViewVisible.bind(null,eForms.ClientQuestionnaire);case eCta.Deposit:return a.SwitchViewVisible.bind(null,eForms.Deposit);case eCta.UploadDocuments:return a.SwitchViewVisible.bind(null,eForms.UploadDocuments);case eCta.None:default:return function(){}}}}}),define("webViewModels/account/UserFlowViewModel",["require","UserFlowManager","StateObject!userFlow","UserFlowBaseViewModel","UserFlowCTA"],function(e){var t=e("UserFlowBaseViewModel"),a=e("UserFlowCTA"),i=extendClass(t,function(){var t=this.parent;return{init:function(e){t.init(e),t.data.stepClick=function(e){ko.postbox.publish("action-source","HubMap"),a.getUserFlowAction(e)()},t.data.ctaClick=function(){t.data.cta!==eCta.ContactUs&&ko.postbox.publish("action-source","HubCTA"),a.getUserFlowAction(t.data.cta)()}},dispose:t.dispose,data:t.data}});return{viewModel:{createViewModel:function(e){var t=new i;return t.init(e),t}}}}),define("LanguageSettings",[],function(){return function(e,t,a){CookieHandler.CreateCookie("LID",e,(new Date).AddMonths(6)),CookieHandler.CreateCookie("Language",t,(new Date).AddMonths(6)),a||window.location.reload(!0)}}),define("viewModels/InstrumentNotAvailableViewModel",["require","KoComponentViewModel","StateObject!Transaction","StatesManager"],function(e){var t=e("KoComponentViewModel"),n=e("StateObject!Transaction"),r=e("StatesManager"),a=extendClass(t,function(){var o,e=this,t=this.Data;return{Data:t,init:function(){var a,i;a=n.get("isActiveQuote"),i=n.get("selectedInstrument"),t.instrumentData=e.createComputed(function(){var e=!r.States.IsMarketClosed()&&a(),t=o!==i();return o=i(),{isAvailable:e,isChanged:t}},null,!1)}}});return{viewModel:{createViewModel:function(){var e=new a;return e.init(),e}}}});
//# sourceMappingURL=webviewmodels.js.map