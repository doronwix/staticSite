define("FxNet/DataAccessLayer/DalTradingInfoSrv",["ErrorManager"],function(l){var u=-1,c=($.signalR.connectionState.connecting,$.signalR.connectionState.connected),d=($.signalR.connectionState.reconnecting,3),m=$.signalR.connectionState.disconnected;return function(e){var t,a=e,o=[],r=[],n=u,i=new TDelegate;function s(e,t,a,i){r[e](t,a,i)}return{CreateHub:function(i){var e=t.createHubProxy(i);e&&(e.on("onUpdateClient",function(e,t,a){s(i,e,t,a)}),e.on("empty",function(e,t){s(i,null,e)})),o[i]=e},UpdateCallbacks:function(e,t,a){a(n===c),i.Add(a),r[e]=t},InitConnection:function(e){(t=$.hubConnection(a)).stateChanged(function(e){n=e.newState}),t.reconnected(function(){i.Invoke(!0)}),t.error(function(e){i.Invoke(!1),l.onError("dalTradingInfoSrv/connect failed",e,eErrorSeverity.warning)}),t.disconnected(function(){e()})},Connect:function(e){t.qs={authToken:e},t.start().done(function(){i.Invoke(!0)}).fail(function(e){i.Invoke(!1),l.onError("dalTradingInfoSrv/connect failed",e,eErrorSeverity.warning)})},Disconnect:function(){n=d,t.stop(),t.disconnected()},Subscribe:function(t,e){var a=o[t];a&&n===c&&a.invoke("subscribe",e).done(function(){}).fail(function(e){n!==m&&n!==d&&l.onError("dalTradingInfoSrv/subscribe failed for hub "+t,e,eErrorSeverity.warning)})},SubscribeByGroup:function(t,e,a){var i=o[t];i&&n===c&&i.invoke("subscribe",a,e).done(function(){}).fail(function(e){n!==m&&n!==d&&l.onError("dalTradingInfoSrv/subscribeByGroup failed for hub "+t,e,eErrorSeverity.warning)})},Unsubscribe:function(t,e){var a=o[t];n===c&&a.invoke("unsubscribe",e).done(function(){}).fail(function(e){n!==m&&n!==d&&l.onError("dalTradingInfoSrv/unsubscribe failed for hub"+t,e,eErrorSeverity.warning)})}}}}),define("FxNet/LogicLayer/GeneralManager/TradingInfoConnManager",["FxNet/DataAccessLayer/DalTradingInfoSrv","economicCalendarConfig","sentimentsConfig","SystemInfo","Customer"],function(e,t,a,i,o){var r,n,s,l=!1,u=0,c=function(e){r=e,s.Connect(r)},d=function(){o.GetToken().then(c)};return(s=new e(i.get("tradingInfoSrvUrl"))).InitConnection(function(){l||(n&&clearTimeout(n),n=setTimeout(function(){++u<1e3&&o.GetToken().then(c)},5e3))}),s.CreateHub(t.hubname),s.CreateHub(a.hubname),d(),{UpdateCallbacks:function(e,t,a){s.UpdateCallbacks(e,t,a)},Subscribe:function(e,t){s.Subscribe(e,t)},SubscribeByGroup:function(e,t,a){s.SubscribeByGroup(e,t,a)},Unsubscribe:function(e,t){s.Unsubscribe(e,t)},Dispose:function(){l=!0,s.Disconnect()},Connect:d}}),define("FxNet/LogicLayer/EconomicCalendar/EconomicCalendarHandler",[],function(){return{DateInterval:function(e){var t,a,i=this.GetToday();switch(e){case eDateFilter.Yesterday:t=new Date(Date.UTC(i.getUTCFullYear(),i.getUTCMonth(),i.getUTCDate()-1)),a=new Date(Date.UTC(i.getUTCFullYear(),i.getUTCMonth(),i.getUTCDate()-1,23,59,59));break;case eDateFilter.Today:t=new Date(Date.UTC(i.getUTCFullYear(),i.getUTCMonth(),i.getUTCDate())),a=new Date(Date.UTC(i.getUTCFullYear(),i.getUTCMonth(),i.getUTCDate(),23,59,59));break;case eDateFilter.Tomorrow:t=new Date(Date.UTC(i.getUTCFullYear(),i.getUTCMonth(),i.getUTCDate()+1)),a=new Date(Date.UTC(i.getUTCFullYear(),i.getUTCMonth(),i.getUTCDate()+1,23,59,59));break;case eDateFilter.ThisWeek:t=new Date(Date.UTC(i.getUTCFullYear(),i.getUTCMonth(),i.getUTCDate()-i.getUTCDay()+1)),a=new Date(Date.UTC(i.getUTCFullYear(),i.getUTCMonth(),i.getUTCDate()-i.getUTCDay()+7,23,59,59));break;case eDateFilter.NextWeek:t=new Date(Date.UTC(i.getUTCFullYear(),i.getUTCMonth(),i.getUTCDate()-i.getUTCDay()+8)),a=new Date(Date.UTC(i.getUTCFullYear(),i.getUTCMonth(),i.getUTCDate()-i.getUTCDay()+14,23,59,59));break;default:return}return{FromDate:t,ToDate:a}},GetToday:function(){return new Date}}}),define("FxNet/LogicLayer/EconomicCalendar/EconomicCalendarConnManager",["Q","economicCalendarConfig","FxNet/LogicLayer/GeneralManager/TradingInfoConnManager","StateObject!EconomicCalendarConnManager"],function(e,t,i,o){var r=t.hubname,n={},s={},a=function(e,t,a){if(s[t]){var i=s[t].name,o=n[i];s[t].done=!0,"function"==typeof o&&o(e,a)}},l=function(e){var t=o.get("IsServiceAvailable"),a=!!e;o.update("IsServiceAvailable",a),!t&&a&&function(){for(var e in s)s.hasOwnProperty(e)&&(s[e].done=!1,i.SubscribeByGroup(r,s[e].args,e))}()},u=function(){o.set("IsServiceAvailable",!1),i.UpdateCallbacks(r,a,l)};return u(),{Init:u,WhenAvailable:function(){var t,a=e.defer();return o.get("IsServiceAvailable")?a.resolve(!0):t=o.subscribe("IsServiceAvailable",function(e){t(),e?a.resolve(!0):a.resolve(!1)}),a.promise},SetMessageReceivedCallback:function(e,t){n[e]=t},Subscribe:function(e,t){t=t||{};var a=createGuid();return s[a]={name:e,args:t,done:!1},i.SubscribeByGroup(r,t,a),a},Unsubscribe:function(e){delete s[e],i.Unsubscribe(r,e)},Dispose:function(){o.unset("IsServiceAvailable"),i.Dispose()}}}),define("viewModels/AccountCardRecordsBaseViewModel",["require","knockout","KoComponentViewModel","ViewsManager","Customer","InstrumentsManager","SymbolsManager","dalAccountingActions","initConfiguration","Dictionary","StateObject!Positions"],function(e){var d=e("knockout"),t=e("KoComponentViewModel"),m=e("ViewsManager"),b=e("Customer"),p=e("InstrumentsManager"),v=e("SymbolsManager"),f=e("dalAccountingActions"),g=e("Dictionary"),D=e("initConfiguration"),S=e("StateObject!Positions");return extendClass(t,function(){var t,a=this,i=this.parent,o=this.Data,e={},r=new function(){var e=this;e.SymbolId=d.observable(0),e.SymbolName=d.observable(""),e.ActionCategory=d.observable(eAccountingActionsCategory.OvernightHistory),e.From=d.observable((new Date).AddWeeks(-1).ExtractDate()),e.To=d.observable((new Date).ExtractDate()),e.Position=d.observable(""),e.Page=d.observable(1),e.PageSize=D.AccountCardRecordsConfiguration.pageSize,e.ShowCosts=!1,e.ClosedDate=d.observable((new Date).AddWeeks(-1).ExtractDate())};var n={idField:"actionNumber",columns:[{name:"rowNumber",transform:function(e,t){return t}},{name:"actionNumber",dataIndex:eAccountingAction.actionID},{name:"date",dataIndex:eAccountingAction.date},{name:"credit",dataIndex:eAccountingAction.credit},{name:"debit",dataIndex:eAccountingAction.debit},{name:"symbolId",dataIndex:eAccountingAction.symbolID},{name:"symbolName",transform:function(e,t,a,i){return v.GetTranslatedSymbolById(i[eAccountingAction.symbolID])}},{name:"type",transform:function(e,t,a,i){return g.GetItem("acctype"+i[eAccountingAction.actionTypeID])}},{name:"comment",dataIndex:eAccountingAction.comment},{name:"totalsum",dataIndex:eAccountingAction.totalsum}],pageSizes:20,statusField:"status",totalField:"totalItems",dataField:"actions",pagination:{pagesPerPage:5,pageIndexField:"Page",pageSizeField:"PageSize"},Filter:r,DAL:{reference:f.LoadAccountingActions,callerName:"StatementControl/onLoadComplete",errorSeverity:eErrorSeverity.medium,onLoad:function(e){if(d.postbox.publish(eAppEvents.accountCardRecordsDataLoaded),0<s.DataRows().length&&o.totalSum(s.DataRows()[0].totalsum),o.showZeroCosts=e.showZeroCosts,e.costs){var t={};t.SpreadCost=e.costs.SpreadCostInAccountBase,t.SpreadDiscount=e.costs.SpreadDiscount,t.Commission=e.costs.CommissionInAccountBase,t.RolloverSpreadCost=e.costs.RolloverSpreadCostInAccountBase,t.ConversionCost=e.costs.ConversionCostInAccountBase,o.showSpreadCost=!!t.SpreadCost,o.showSpreadDiscount=!!t.SpreadDiscount,o.showCommision=!!t.Commission||0===t.Commission&&0===t.SpreadCost,o.showRolloverSpreadCost=!!t.RolloverSpreadCost,o.showConversionCost=!!t.ConversionCost,t.OvernightFinancing=Number.fromStr(o.totalSum()),t.TotalCosts=(null===t.SpreadCost?0:t.SpreadCost)+(null===t.SpreadDiscount?0:t.SpreadDiscount)+(null===t.Commission?0:t.Commission)+(null===t.RolloverSpreadCost?0:t.RolloverSpreadCost)+(null===t.ConversionCost?0:t.ConversionCost),o.showTotalCosts=o.showSpreadCost||o.showSpreadDiscount||o.showCommision||o.showRolloverSpreadCost||o.showConversionCost,t.TotalWithOvernightFinancing=t.TotalCosts+t.OvernightFinancing,o.costValues(t)}S.containsKey("ofhPositionNumber")&&S.update("ofhPositionNumber",null),o.isDataReady(!0)}}},s=new ObservableDataSet(n);function l(){r.From((new Date).AddWeeks(-1).toShortISOString()),r.To((new Date).toShortISOString()),r.Position(""),r.PageSize=D.AccountCardRecordsConfiguration.pageSize,o.totalSum("0"),o.isDataReady(!1)}var u=a.createComputed(function(){return!s.IsLoadingData()},a);function c(e){return e&&str2Date(e)?str2Date(e).toShortISOString():null}return{init:function(e){i.init.call(a,e),o.totalSum=d.observable(0),o.isDataReady=d.observable(!1),o.costs=d.observable(null),o.costValues=d.observable(null),l(),t=m.GetViewArgs(eViewTypes.vAccountCardRecords),t=m.GetViewArgs(eViewTypes.vAccountCardRecords),l(),b.prop.autoConvert?r.SymbolId(b.prop.baseCcyId()):r.SymbolId(p.GetInstrument(t.instrumentId).otherSymbol),r.SymbolName(v.GetTranslatedSymbolById(r.SymbolId())),r.Position(t.posNum),r.From(c(t.fromDate)),r.ShowCosts=!!t.showCosts,r.ClosedDate(c(t.closedDate)),s.SetFilter(r),s.Load()},dispose:function(){s.Clean(),e.scrolled=null,i.dispose.call(a)},Data:o,BalanceInfo:s.DataRows,GetNextBalance:s.Paging.ShowMore,VisibleShowMore:s.Paging.HasNextPage,DataSet:s,Filter:r,EnableApplyButton:u,HasRecords:s.HasRecords,DsColumns:n,IsLoadingData:s.IsLoadingData}})}),define("viewModels/AmlViewModel",["require","knockout","KoComponentViewModel","JSONHelper","ViewModelsManager","FxNet/DataAccessLayer/dalCompliance","currentAppFolder/UILayer/uiBehavior","Customer","SystemInfo","initConfiguration"],function(e){var n=e("knockout"),t=e("KoComponentViewModel"),s=e("JSONHelper"),l=e("ViewModelsManager"),u=e("FxNet/DataAccessLayer/dalCompliance"),c=e("currentAppFolder/UILayer/uiBehavior"),m=e("Customer"),b=e("SystemInfo"),p=e("initConfiguration");return extendClass(t,function(){var e=this,t=this.parent,d=this.Data;d.pepAnswersDisplay=e.createComputed(function(){return"p3"!==d.pepAnsweredValue()});var a=function(){t.init.call(e),i(),r(),o()},i=function(){d.pepAnsweredValue=n.observable("p3"),d.isPepRequiredCsmLess=n.observable(!1),d.hasUploadDocs=n.observable(!0),d.hasVideoIdentification=n.observable(!1),d.hasAlternativeDocSend=n.observable(!0)},o=function(){var a=b.get("countries"),e=Object.keys(a),i=p.AmlConfiguration.countriesWithDisabledUpload,o=p.AmlConfiguration.countriesWithVideoId,r=p.AmlConfiguration.countriesWithDisabledAlternativeSend,n=[],s=[],l=[],u=function(e,t){return-1!==e.indexOf(t)},c=function(e,t){return-1===e.indexOf(t)};e.forEach(function(e){var t=a[e];c(i,t)&&n.push(e),u(o,t)&&s.push(e),c(r,t)&&l.push(e)}),d.hasUploadDocs(u(n,m.prop.countryID)),d.hasVideoIdentification(u(s,m.prop.countryID)),d.hasAlternativeDocSend(u(l,m.prop.countryID))},r=function(){u.getPepStatus(function(e){(e=s.STR2JSON("AmlStatusViewModel/getPepStatus",e,eErrorSeverity.medium)).Status==eResult.Success&&d.isPepRequiredCsmLess(e.Result==ePEPStatus.Required)})};return a(),{Init:a,SetPepStatus:function(){u.setPepStatus(d.pepAnsweredValue(),function(e){e==eResult.Success&&c.closeAmlPepForm()})},isPepRequiredCsmLess:d.isPepRequiredCsmLess,pepAnsweredValue:d.pepAnsweredValue,PepAnswersDisplay:d.pepAnswersDisplay,goToUploadDocuments:function(){l.VManager.RedirectToForm(eForms.UploadDocuments),DialogViewModel&&DialogViewModel.close()},hasVideoIdentification:d.hasVideoIdentification,hasUploadDocs:d.hasUploadDocs,hasAlternativeDocSend:d.hasAlternativeDocSend}})}),define("viewModels/BaseInstrumentSearchViewModel",["require","knockout","KoComponentViewModel","InstrumentsManager","ViewModelsManager","Dictionary"],function(e){var l=e("knockout"),t=e("KoComponentViewModel"),u=e("InstrumentsManager"),c=e("ViewModelsManager").VmQuotesPreset;return extendClass(t,function(e){var a=this,i=this.parent,o=this.Data,r=2;function n(e){!e||!e.id||e.id<=-1||isFunctionType(o.selectedInstrumentId)&&o.selectedInstrumentId(e.id)}function s(){var e,t=u.GetFavoriteInstruments();0===t.length?(t=u.GetMainMostPopularInstruments(),e=u.GetPresetInstruments(u.GetMainMostPopularPresetId())):(e=u.GetCustomizedUiOrder(),o.favouritePreset(!0)),u.SetQuotesUIOrder(e,!1,eRegistrationListName.Search),o.instrumentsList(function(e){for(var t=0;t<e.length;t++){var a,i=e[t],o=u.GetPresetsForInstrument(i.id),r=o.some(function(e){if(c.IsSearchPreset(e))return a=parseInt(e),!0});a=r?a:i.presetId,i.presetLabel=c.GetPreset(a).Label}return e}(t))}return{init:function(e){var t;i.init.call(a,e),o.list=c.SearchInstrumentsObservable,o.searchMinLength=l.observable(c.SingleCharSearch()?1:r),o.selected=l.observable({}),o.instrumentsList=l.observableArray([]),o.favouritePreset=l.observable(!1),t=e,s(),o.selectedInstrumentId=t.selectedInstrumentId,o.suffixId=t.suffixId,o.searchPostBoxTopic=t.searchPostBoxTopic,a.subscribeTo(o.selected,n),u.OnFavoritesPresetChanged.Add(s)},dispose:function(){u.OnFavoritesPresetChanged.Remove(s),i.dispose.call(a)}}})}),define("viewModels/BaseSignalsViewModel",["require","knockout","Dictionary","KoComponentViewModel","dalTradingSignals","Customer","InstrumentsManager","AlertsManager","CookieHandler","JSONHelper","InstrumentTranslationsManager","PermissionsModule","ViewsManager","UrlResolver","RegistrationManager"],function(e){var d=e("knockout"),m=e("Dictionary"),t=e("KoComponentViewModel"),b=e("dalTradingSignals"),p=e("Customer"),v=e("InstrumentsManager"),f=e("AlertsManager"),g=e("CookieHandler"),D=e("JSONHelper"),S=e("InstrumentTranslationsManager"),y=e("PermissionsModule"),T=e("ViewsManager"),w=e("UrlResolver"),h=e("RegistrationManager");return extendClass(t,function(e){var a=this,i=e,o=this.parent,r=this.Data,n={};function s(){var t;r.isLoading()||!r.hasAgreedDisclaimer()||i.instrumentId||i.signalId||(r.fetchingData(1!==r.pageIndex()),r.isLoading(1==r.pageIndex()),b.getSignalsDetailsForTechAnalysis({symbol:null,pageIndex:r.pageIndex()}).then(function(e){t=D.STR2JSON("getSignalsDetailsForTechAnalysis/onLoadComplete",e),r.totalRecords(Number(t.totalRecords)),function(e,t){var a=[];if(e.status==eResult.Success&&0==e.resultStatus)for(var i=0;i<e.result.length;i++){var o=u(e.result[i]);r.signalsList.Add(o),a.push(o.instrument.id)}r.signalsAreAvailable(e.status==eResult.Success&&0==e.resultStatus||t),r.fetchingData(!1),r.isLoading(!1),a.length&&l(a)}(t,1<r.pageIndex())}).done())}function l(e){h.Update(eRegistrationListName.TradingSignals,e)}function u(e){var t=v.GetInstrumentBySignalName(e[eTradingSignal.symbol]);return{signalId:e[eTradingSignal.signalId],signalTitle:e[eTradingSignal.signalTitle],signalDate:e[eTradingSignal.signalDate],imagePath:e[eTradingSignal.imagePath],shortTermLevel:e[eTradingSignal.shortTerm],shortTermText:c(e[eTradingSignal.shortTerm],!0),mediumTermLevel:e[eTradingSignal.mediumTermLevel],mediumTermText:c(e[eTradingSignal.mediumTermLevel],!1),weekDelta:e[eTradingSignal.weekDelta],longTermLevel:e[eTradingSignal.longTermLevel],longTermText:c(e[eTradingSignal.longTermLevel],!1),monthDelta:e[eTradingSignal.monthDelta],summary:e[eTradingSignal.summary],instrument:t,symbol:t?S.Long(t.id):e[eTradingSignal.symbol]}}function c(e,t){var a;switch(e){case eSignalTrendsValues.StrongBuy:a="lblStrongBuy";break;case eSignalTrendsValues.Buy:a="lblBuy";break;case eSignalTrendsValues.Sell:a="lblSell";break;case eSignalTrendsValues.StrongSell:a="lblStrongSell";break;default:a=t?"lblNotAvailable":"lblNeutral"}return a}return{init:function(e){var t;o.init.call(a,e),r.hasAgreedDisclaimer=d.observable(!1),r.signalsAreAvailable=d.observable(!1),r.isLoading=d.observable(!1),r.fetchingData=d.observable(!1),r.signalsList=new ObservableHashTable("signalId",{enabled:!0,sortProperty:"signalId",asc:!1}),r.signalsEndDate=d.observable(""),r.areSignalsAllowed=d.observable(!1),r.pageIndex=d.observable(1),r.totalRecords=d.observable(0),n.disclaimerClick=function(){f.UpdateAlert(AlertTypes.ServerResponseAlert,m.GetItem("DisclaimerTitle"),m.GetItem("lblDisclaimerText"),null,{}),f.PopAlert(AlertTypes.ServerResponseAlert)},n.clickDisclaimerAgree=function(){g.CreateCookie("TsComplianceDate",(new Date).toDateString(),(new Date).AddMonths(12)),r.hasAgreedDisclaimer(!0),s()},a.subscribeTo(r.areSignalsAllowed,function(e){e&&s()}),a.subscribeTo(r.isLoading,function(e){d.postbox.publish(ePostboxTopic.SetSpinnerVisibility,e)}),r.isShowAgreement=a.createComputed(function(){return!this.hasAgreedDisclaimer()&&this.areSignalsAllowed()&&!this.isLoading()},a.Data),r.isShowSignal=a.createComputed(function(){return this.hasAgreedDisclaimer()&&this.signalsAreAvailable()&&this.areSignalsAllowed()&&!this.isLoading()},a.Data),r.isShowSignalUnavailable=a.createComputed(function(){return this.hasAgreedDisclaimer()&&!this.signalsAreAvailable()&&this.areSignalsAllowed()&&!(this.isLoading()||this.fetchingData())},a.Data),r.signalsAreDissallowed=a.createComputed(function(){return!this.areSignalsAllowed()&&!this.isLoading()},a.Data),t=g.ReadCookie("TsComplianceDate"),r.hasAgreedDisclaimer(null!==t),r.areSignalsAllowed(p.prop.AreSignalsAllowed),r.signalsEndDate(p.prop.signalsEndDate)},dispose:function(){o.dispose.call(a),r.signalsList.Clear()},Handlers:n,FilterData:i,toSignalObject:u,registerInstruments:l,openDeal:function(e){e&&e.instrument?T.RedirectToURL(w.getRedirectUrl("NewDeal","instrumentId="+e.instrument.id)):T.SwitchViewVisible(eForms.Quotes,{})},updateSignalsList:s,permissionsModule:y}})}),define("viewModels/BonusViewModel",["knockout","BonusManager"],function(i,o){function t(e){var t=this.Data||{};function a(){var e=o.bonus();t.CashBack(e.accumulatedVolumeUsd/e.volumeUsd*e.amountBase),t.MaxCashBack(e.amountBase),t.SpreadDiscount(e.amountGivenBase),t.MaxSpreadDiscount(e.amountGivenBase+e.amountBase),t.isDataLoaded(0<e.amountBase)}return t.CashBack=i.observable(""),t.MaxCashBack=i.observable(""),t.isDataLoaded=i.observable(!1),t.SpreadDiscount=i.observable(""),t.MaxSpreadDiscount=i.observable(""),o.onChange.Add(a),a(),{Data:t,Params:e||{},dispose:function(){o.onChange.Remove(a)}}}return{viewModel:{createViewModel:function(e){return new t(e)}}}}),define("viewModels/CashBackViewModel",["require","knockout","Q","dalOrders","Customer","KoComponentViewModel","InstrumentsManager","InstrumentTranslationsManager","ViewsManager","DialogViewModel","PortfolioStaticManager","UrlResolver"],function(e){var l=e("knockout"),t=e("Q"),u=e("dalOrders"),m=e("Customer"),a=e("KoComponentViewModel"),b=e("InstrumentsManager"),p=e("InstrumentTranslationsManager"),v=e("ViewsManager"),o=e("DialogViewModel"),f=e("PortfolioStaticManager"),g=e("UrlResolver"),i=extendClass(a,function(e){var r=this,n=this.parent,c=this.Data;function d(i){i.forEach(function(e,t){var a=e.USDAmountWeighted/c.Summary.MaxVolume()*c.Summary.MaxCashBack();isNaN(a)&&(a=0),i[t].usdAmount=formatNumber(String(e.USDAmount)),i[t].usdAmountWeighted=formatNumber(String(e.USDAmountWeighted)),i[t].estimatedCashBack=parseFloat(a).toFixed(2)})}function s(e){var t,a,i,o,r;t=e[0].Summary,a=toNumeric(t.WeightedVolume),i=toNumeric(t.PendingBonusAmount),o=toNumeric(t.ConditionalVolume),r=0===o?0:i*a/o,r=Math.min(r,i),c.Summary.CashBack(r),c.Summary.MaxCashBack(i),c.Summary.Volume(a),c.Summary.MaxVolume(o),c.Summary.EndDate(t.PendingBonusEnd),d(e[0].EnhancedInstruments);for(var n=0;n<e[0].EnhancedInstruments.length;n++){var s=b.GetInstrument(e[0].EnhancedInstruments[n].InstrumentId);e[0].EnhancedInstruments[n].baseSymbolId=s.baseSymbol,e[0].EnhancedInstruments[n].otherSymbolId=s.otherSymbol}c.Enhanced(e[0].EnhancedInstruments),d(e[0].RegularInstruments);for(var l=0;l<e[0].RegularInstruments.length;l++){var u=b.GetInstrument(e[0].RegularInstruments[l].InstrumentId);e[0].RegularInstruments[l].baseSymbolId=u.baseSymbol,e[0].RegularInstruments[l].otherSymbolId=u.otherSymbol}c.Regular(e[0].RegularInstruments)}function a(){return t.fcall(function(){isDefinedType(o)&&o.close&&o.close()}).delay(10)}function i(e,t){i.enabled()&&e&&e.id&&a().then(function(){v.RedirectToURL(g.combine(g.getRedirectPath(),"/NewDeal?instrumentId="+e.id))}).done()}return i.enabled=l.observable(!!e.enableNewDeal),{init:function(e){var t,a,i,o;f.Portfolio.pendingBonusType===ePendingBonusType.cashBack?(n.init.call(r,e),c.Summary={EndDate:l.observable(""),CashBack:l.observable(""),Volume:l.observable(""),MaxCashBack:l.observable(""),MaxVolume:l.observable("")},c.Enhanced=l.observableArray(),c.Regular=l.observableArray(),c.isDataLoaded=l.observable(!1),c.customerSymbolId=l.observable(m.prop.baseCcyId()),c.hasWeightedVolumeFactor=l.observable(m.prop.hasWeightedVolumeFactor),c.hasEnhancedInstruments=l.computed(function(){return c.Enhanced()&&0<c.Enhanced().length}),c.hasRegularInstruments=l.computed(function(){return c.Regular()&&0<c.Regular().length}),c.hasVolumes=l.computed(function(){return c.hasEnhancedInstruments()||c.hasRegularInstruments()}),u.CashBackVolumesInfo().then(function(e){s(e),c.isDataLoaded(!0)}).done(),0!==(t=b.GetEnhancedInstruments().map(function(e){return{id:e.id,name:p.Short(e.id),multiplier:e.weightedVolumeFactor}})).length&&(o=t.map(function(e){return e.name}).join(", "),a=Math.round(100*Math.max.apply(Math,t.map(function(e){return e.multiplier}))),i=t[Math.floor(Math.random()*t.length)],c.enhancedInstruments=t,c.maxMultiplier=a,c.randomEnhancedInstrument={name:i.name,equivalentVolume:Math.round(100*i.multiplier)},c.enhancedInstrumentNames=o)):v.SwitchViewVisible($customer.prop.mainPage,{})},dispose:function(){n.dispose.call(r)},Data:c,ClosePopup:a,StartNewDeal:i}});return{viewModel:{createViewModel:function(e){var t=new i(e||{});return t.init(),t}}}}),define("viewModels/ChangePasswordViewModel",["require","assets/js/jquery.validator","registration/ChangePasswordModule","PermissionsModule","Customer","ViewModelsManager","StateObject!Setting"],function(e){var a=e("registration/ChangePasswordModule"),i=e("PermissionsModule"),o=e("Customer"),r=e("ViewModelsManager"),n=e("StateObject!Setting");return{viewModel:{createViewModel:function(){var t=ko.observable(!0);return a.init(!0),$viewModelsManager.VManager.GetViewArgs(eViewTypes.vChangePassword)===eViewTypes.vChangePassword&&t(!1),n.get("AccountHubSetting")||n.set("AccountHubSetting",null),n.subscribe("AccountHubSetting",function(e){t(e!==eViewTypes.vChangePassword)}),{dispose:function(){a.unsetDomEvents()},CollapsedToggle:function(){o.prop.isDemo?r.VManager.RedirectToForm(eForms.Settings,eViewTypes.vChangePassword):i.CheckPermissions("changePassword")?t(!t()):(AlertsManager.UpdateAlert(AlertTypes.ServerResponseAlert,Dictionary.GetItem("GenericAlert"),Dictionary.GetItem("Forbidden"),null),AlertsManager.PopAlert(AlertTypes.ServerResponseAlert))},isCollapsed:t}}}}}),define("viewModels/ContractRolloverBaseViewModel",["require","knockout","KoComponentViewModel","ViewModelsManager","dalAccountingActions","LoadDictionaryContent!deals_ContractRollover","StateObject!Positions"],function(e){var n=e("knockout"),t=e("KoComponentViewModel"),s=e("ViewModelsManager"),l=e("dalAccountingActions"),u=e("StateObject!Positions");return extendClass(t,function(){var t=this,a=this.parent,o=this.Data,i={},e={idField:"actionNumber",columns:[{name:"rowNumber",transform:function(e,t){return t}},{name:"actionID",dataIndex:eContractRollover.actionID},{name:"posNum",dataIndex:eContractRollover.posNum},{name:"date",dataIndex:eContractRollover.date},{name:"credit",dataIndex:eContractRollover.credit},{name:"debit",dataIndex:eContractRollover.debit},{name:"symbolName",dataIndex:eContractRollover.symbol},{name:"openMidRate",transform:function(e,t,a,i){return Format.toRate(i[eContractRollover.openMidRate],!0,o.instrumentID())}},{name:"closeMidRate",transform:function(e,t,a,i){return Format.toRate(i[eContractRollover.closeMidRate],!0,o.instrumentID())}},{name:"gap",transform:function(e,t,a,i){return Format.toRate(i[eContractRollover.gap],!0,o.instrumentID())}},{name:"spread",transform:function(e,t,a,i){return Format.toRate(i[eContractRollover.spread],!0,o.instrumentID())}}],pageSizes:20,statusField:"status",totalField:"totalItems",dataField:"actions",pagination:{pagesPerPage:5,pageIndexField:"Page",pageSizeField:"PageSize"},Filter:i,DAL:{reference:l.GetContractRollover,callerName:"ContractRollover/onLoadComplete",errorSeverity:eErrorSeverity.medium,onLoad:function(e){n.postbox.publish(eAppEvents.contractRolloverDataLoaded),o.totalSum(e.totalAmount),isEmptyValue(e.actions)||isEmptyValue(e.actions[0])||o.currency(e.actions[0][eContractRollover.symbol]),u.containsKey("plPositionNumber")&&u.update("plPositionNumber",null),o.isDataReady(!0)}}},r=new ObservableDataSet(e);return{init:function(e){a.init.call(t,e),function(){o.totalSum=n.observable(0),o.totalSumFormatted=n.computed(function(){return Format.toNumberWithThousandsSeparator(n.utils.unwrapObservable(o.totalSum),2)}),o.isDataReady=n.observable(!1),o.currency=n.observable(""),o.instrumentID=n.observable(s.VManager.GetViewArgs(eViewTypes.vContractRollover).instrumentID),o.dealAmount=s.VManager.GetViewArgs(eViewTypes.vContractRollover).dealAmount;var e=s.VManager.GetViewArgs(eViewTypes.vContractRollover).posNum;i.Position=n.observable(e),i.Page=n.observable(InitConfiguration.ContractRolloverConfiguration.defaultPage),i.PageSize=InitConfiguration.ContractRolloverConfiguration.pageSize}(),r.Init(),r.SetFilter(i),r.Load()},dispose:function(){r.Clean(),a.dispose.call(t)},Data:o,BalanceInfo:r.DataRows,DataSet:r,GetNextBalance:r.Paging.ShowMore,VisibleShowMore:r.Paging.HasNextPage}})}),define("viewModels/CustomDropDown",[],function(){return{viewModel:{createViewModel:function(e){var t=e.value;return isEmptyValue(t())&&t(e.options()[0]),{options:e.options,value:t,optionText:e.optionText}}}}}),define("viewModels/DemoBannerViewModel",["require","knockout","KoComponentViewModel","Customer","Dictionary","UrlResolver","LoadDictionaryContent!demo_banners"],function(e){var i=e("knockout"),t=e("KoComponentViewModel"),n=e("Customer"),s=e("Dictionary"),l=e("UrlResolver"),a=extendClass(t,function(){var t=this,a=this.parent,o=this.Data,r=2;return{init:function(e){a.init.call(t),o.isVisible=i.observable(n.prop.isDemo),o.message=i.observable(String.empty),o.buttonMessage=i.observable(String.empty),o.urlToRedirect=i.observable(String.empty),function(e){var t,a=e.dataRecords.length,i=e.dataRecords.reduce(function(e,t){return e+Number(t.pandLCalc)},0);switch(e.alertName){case"DealAddServerResponseAlert":t=e.dataRecords[0].instrumentId,o.message(s.GetItem("OpenDealMessage","demo_banners")),o.buttonMessage(s.GetItem("OpenDealButtonMessage","demo_banners")),o.urlToRedirect(l.getRedirectUrl("NewDeal",String.format("Mode={0}&instrumentId={1}",r,t)));break;case"DealsClosedServerResponseAlert":if(1!=e.dataRecords[0].status)return o.isVisible(!1);1===a?0<=i?(o.message(s.GetItem("CloseOneDealWithProfitMessage","demo_banners")),o.buttonMessage(s.GetItem("CloseOneDealWithProfitButtonMessage","demo_banners")),o.urlToRedirect(l.getRedirectUrl("Deals",String.format("Mode={0}",r)))):(o.message(s.GetItem("CloseOneDealWithLossOrNoProfitMessage","demo_banners")),o.buttonMessage(String.empty),o.urlToRedirect(String.empty)):(o.message(s.GetItem("CloseMultipleDealsMessage","demo_banners")),o.buttonMessage(s.GetItem("CloseMultipleDealsButtonMessage","demo_banners")),o.urlToRedirect(l.getRedirectUrl("Deals",String.format("Mode={0}",r))));break;default:o.isVisible(!1)}}(e)},dispose:function(){a.dispose.call(t)},Data:o}});return{viewModel:{createViewModel:function(e){var t=new a;return t.init(e),t}}}}),define("viewModels/EconomicCalendarViewModel",["knockout","economicCalendarConfig","KoComponentViewModel","FxNet/LogicLayer/EconomicCalendar/EconomicCalendarConnManager","StateObject!EconomicCalendarConnManager","LoadDictionaryContent!economicCalendarLongData","LoadDictionaryContent!economicCalendar"],function(f,g,e,D,S){var y,T=function(e){var t;return!isEmptyValue(e)&&(t=e.split("/"),!isEmptyValue(t)&&2===t.length)&&{FirstCurrency:t[0],SecondCurrency:t[1]}},o=extendClass(e,function(e){var t,a=this,i=this.parent,s=this.Data,o=e.viewName,r=function(){s.filters={FirstCurrency:f.observable(),SecondCurrency:f.observable(),FromDate:f.observable(),ToDate:f.observable(),TimeZoneId:f.observable(),TimeZoneOffset:f.observable(),CountryCodes:f.observableArray([]),Importance:f.observableArray([]),CountryCodesMandatory:f.observable(),ImportanceMandatory:f.observable(),Count:f.observable()}},n=function(){s.ccyPair=a.createComputed(function(){return isDefinedType(e.ccyPair)?e.ccyPair():""}),s.isShowEventsUnavailable=a.createComputed(function(){return!s.hasEvents()&&!s.isLoading()}),s.isShowLoader=a.createComputed(function(){return s.isLoading()}),s.isShowEvents=a.createComputed(function(){return s.hasEvents()&&!s.isLoading()})},l=debounce(function(){t=D.Subscribe(o,f.toJS(s.filters))}),u=function(){s.events([]),s.mapEvents([]),s.hasEvents(!1),t&&D.Unsubscribe(t)},c=function(e,t){var a,i;return{EventTime:e.EventTime.trim()+"Z",CountryCode:e.CountryCode.toLowerCase(),Symbol:isArrayType(e.Symbols)?e.Symbols.shift():"",ImportanceActive:e.Importance,ImportanceInactive:g.eventsMaxImportance-e.Importance,Title:Dictionary.GetItem("ec"+e.ContentId,"economicCalendar").trim(),Previous:e.Previous,Actual:e.Actual,ActualDirection:(a=e.Forecast,i=e.Actual,""!==a?extractNumberFromString(a)>extractNumberFromString(i)?eDirections.Down:extractNumberFromString(a)<extractNumberFromString(i)?eDirections.Up:eDirections.Bold:""),Forecast:e.Forecast,ContentKey:g.contentKeySection+e.ContentId,RecordId:e.RecordId,Description:Dictionary.GetItem("eclong"+e.ContentId,"economicCalendarLongData"),isDescriptionExpanded:f.observable(!1),ContentId:e.ContentId,TotalCount:t}},d=function(e,t){if(e){for(var a,i=s.events(),o=s.mapEvents(),r=0,n=e.length;r<n;r++)a=null,1===t&&(a=o[e[r].RecordId]),a||0==a?i[a]=c(e[r],i[a].TotalCount):(i.push(c(e[r],e[r].TotalCount)),o[e[r].RecordId]=i.length-1);s.events(i),s.hasEvents(!0)}else 1===s.pageIndex()&&s.hasEvents(!1);s.isLoading(!1)},m=function(){s.hasEvents=f.observable(!1),s.isLoading=f.observable(!0),s.events=f.observableArray([]),s.newEvents=f.observableArray([]),s.mapEvents=f.observableArray([]),s.showFilters=f.observable(!1),s.pageIndex=f.observable(1)},b=function(a){a=a||{},1===s.pageIndex()&&(s.isLoading(!0),u()),D.WhenAvailable().then(function(e){if(!e)return s.hasEvents(!1),void s.isLoading(!1);for(var t in a)a.hasOwnProperty(t)&&s.filters.hasOwnProperty(t)&&s.filters[t](a[t]);l()}).done()},p=function(e){e===eAvailabilityState.NotAvailable&&(s.hasEvents(!1),s.isLoading(!1),s.events([]),s.mapEvents([]))},v=function(){a.subscribeTo(s.ccyPair,function(e){var t=T(e);!1!==t&&b(t)}),y=S.subscribe("IsServiceAvailable",p)};return{ApplyFilter:b,init:function(e){i.init.call(a,e),r(),m(),n(),v(),D.SetMessageReceivedCallback(o,d)},dispose:function(){y(),u(),i.dispose.call(a)}}});return{viewModel:{createViewModel:function(e){var t=new o(e);t.init();var a,i=e.ccyPair;return isDefinedType(i)&&!1!==(a=T(f.utils.unwrapObservable(i)))&&t.ApplyFilter(a),t}},EconomicCalendarViewModel:o}}),define("viewModels/MarketClosedViewModel",["require","knockout","KoComponentViewModel","StatesManager","ErrorManager","dalMarketState"],function(e){var s=e("knockout"),t=e("KoComponentViewModel"),l=e("StatesManager"),u=e("ErrorManager"),c=e("dalMarketState"),a=extendClass(t,function(t){var a=this,i=this.parent,o=this.Data;function r(e){o.marketState=e,o.isReady(!0)}function n(e){throw u.onError("MarketClosedViewModel.getData","",eErrorSeverity.high),e}return{init:function(e){i.init.call(a,e),o.postboxTopic=t.postboxTopic,o.marketState=null,o.isReady=s.observable(!1),o.isVisibleMarketClosedBanner=a.createComputed(function(){var e=l.States.IsMarketClosed()&&!l.States.IsPortfolioInactive();return e&&c.GetData().then(r).fail(n).done(),e})}}});return{viewModel:{createViewModel:function(e){var t=new a(e);return t.init(),t}}}}),define("viewModels/MissingCustomerInformationViewModel",["require","knockout","Customer","dalCustomer","PaymentSelectionBehaviors","Dictionary","AlertsManager","JSONHelper"],function(e){var o=e("knockout"),r=e("Customer"),n=e("dalCustomer"),s=e("PaymentSelectionBehaviors"),l=e("Dictionary"),u=e("AlertsManager"),c=e("JSONHelper");return{viewModel:{createViewModel:function(){var t={firstName:{required:!0},lastName:{required:!0},phone:{required:!0,pattern:/^( ?-?\d){5,}$/},signAgreementDate:{equal:!0},gender:{required:!0,in:[eGender.Female,eGender.Male,eGender.Female.toLowerCase(),eGender.Male.toLowerCase()]},dateOfBirth:{required:!0},idNumber:{required:!0,number:!0,minLength:9,maxLength:9,asyncValidation:{asyncFunction:n.IsIdNumberValid}},address:{required:!0,pattern:/^.*[^0-9].*$/}},a={customerForm:{firstName:o.observable("").extend({initialyVisible:!1}),lastName:o.observable("").extend({initialyVisible:!1}),phone:o.observable("").extend({initialyVisible:!1}),signAgreementDate:o.observable(!r.HasMissingAgreement()).extend({initialyVisible:!1}),gender:o.observable("").extend({initialyVisible:!1}),dateOfBirth:o.observable("").extend({initialyVisible:!1}),idNumber:o.observable("").extend({initialyVisible:!1}),isLoading:o.observable(!0).extend({equal:!1}),address:o.observable("").extend({initialyVisible:!1})}};function e(){var e=new Date;return e.setFullYear(e.getFullYear()-18),e}function i(){var e=new Date;return e.setFullYear(e.getFullYear()-150),e}return n.GetCustomerDetails().then(function(e){var t=JSON.parse(e);a.customerForm.firstName(t.contactFirst),a.customerForm.lastName(t.contactLast),a.customerForm.phone(t.phone),a.customerForm.gender(t.gender),a.customerForm.dateOfBirth(t.dateOfBirth),a.customerForm.idNumber(t.idNumber),a.customerForm.address(t.address)}).done(),a.firstFieldInteractionDone=!1,a.fieldInteraction=function(){!1===a.firstFieldInteractionDone&&(o.postbox.publish("trading-event","agreement-first-interaction"),a.firstFieldInteractionDone=!0)},a.formValidation=o.validatedObservable(a.customerForm),a.dateOfBirthInfo={minDate:i(),maxDate:e(),yearRange:i().getFullYear()+":"+e().getFullYear()},a.agreementPhrase=o.observable(""),n.GetCustomerAgreementPhrase(function(e){a.agreementPhrase(e)}),a.updateMissingFields=function(){if(o.postbox.publish("trading-event","agreement-submit"),a.formValidation.isValid()){var e={FirstName:a.customerForm.firstName(),LastName:a.customerForm.lastName(),Phone:a.customerForm.phone(),HasSignedAgreement:a.customerForm.signAgreementDate(),Gender:a.customerForm.gender(),DateOfBirth:a.customerForm.dateOfBirth(),IdNumber:a.customerForm.idNumber(),Address:a.customerForm.address()};n.UpdateMissingInformation(e,function(e){var t=c.STR2JSON("updateMissingCustomerInformation",e);t.Status!==eOperationStatus.ValidationFailed?(r.UpdateMissingInformation(t.CustomerUpdated),s.OnCustomerSuccessfullUpdate()):u.ShowAlert(AlertTypes.ServerResponseAlert,l.GetItem("GenericAlert"),l.GetItem("ServerError"),null)})}else a.formValidation.errors.showAllMessages()},a.formValidation.errors.showAllMessages(),n.GetRequiredFieldsForDeposit(function(e){c.STR2JSON("getRequiredFieldsForDeposit",e).forEach(function(e){a.customerForm[e].extend(t[e]),a.customerForm[e].isVisible(!0)}),a.customerForm.isLoading(!1)}),a}}}}),define("viewModels/NotificationsSettingsViewModel",["knockout","KoComponentViewModel","FxNet/DataAccessLayer/dalCompliance","ViewModelsManager","Customer","Dictionary","PermissionsModule","StateObject!Setting","AlertsManager"],function(v,e,f,g,D,S,y,T,w){var a=extendClass(e,function(){var a=this,t=this.parent,r=this.Data,e={},n={Other:0,Legal:1,AccountInformation:2,MovementsAndEvents:3,PromotionsOffers:4,Informative:5,EconomicCalendar:6,PriceAlert:7,LimitExecution:8,LowMarginAlert:9,AccountLiquidation:10,Support:11},i=[n.LimitExecution,n.LowMarginAlert,n.AccountLiquidation],o=[n.MovementsAndEvents,n.EconomicCalendar,n.Support,n.PromotionsOffers],s={CCID_8:0,CCID_9:1,CCID_10:2},l={CCID_3:0,CCID_6:1,CCID_11:2,CCID_4:3},u={TradingInformation:1,Marketing:2};function c(){var e=r.notificationCategories().find(function(e){return e.CampaignCategoryID===n.LowMarginAlert});if(e){for(var t=!isNullOrUndefined(r.lowMarginAlertValue())&&""!==r.lowMarginAlertValue()&&r.lowMarginAlertValueValid(),a=!1,i=0,o=e.CategoryMethods.length;i<o;i++)e.CategoryMethods[i].Enable&&(a=a||e.CategoryMethods[i].ObservableAllowed());r.spinnerEnabled(a),r.saveMarginButtonEnabled(t&&a&&r.lowMarginAlertValue.isDirty())}}var d=function(e){var t=JSONHelper.STR2JSON("NotificationsSettingsViewModel/getNotificationsSettings",e,eErrorSeverity.medium);t&&t.Status===eOperationStatus.Success&&(0!==t.Result.MinExposureCoverage&&0!==t.Result.MaxExposureCoverage&&(r.minMargin(t.Result.MinExposureCoverage),r.maxMargin(t.Result.MaxExposureCoverage),r.lowMarginAlertMinMax([r.minMargin(),r.maxMargin()])),r.lowMarginAlertValue()||0===t.Result.MinPctEQXP||(r.lowMarginAlertValue(t.Result.MinPctEQXP),r.lowMarginAlertValue.markClean()),t.Result.SendingCategoryList.forEach(function(e){-1<i.indexOf(e.CampaignCategoryID)&&(e.groupId=u.TradingInformation,e.order=s["CCID_"+e.CampaignCategoryID]),-1<o.indexOf(e.CampaignCategoryID)&&(e.groupId=u.Marketing,e.order=l["CCID_"+e.CampaignCategoryID]),e.subscriptions=e.subscriptions||[];for(var t=0,a=e.CategoryMethods.length;t<a;t++)e.CategoryMethods[t].Enable&&(e.CategoryMethods[t].ObservableAllowed=v.observable(e.CategoryMethods[t].Allowed),b()||e.subscriptions.push(m(e.CategoryMethods[t].ObservableAllowed,{categoryId:e.CampaignCategoryID,methodId:e.CategoryMethods[t].SendingMethodId})))}),r.notificationCategories().forEach(function(e){e.subscriptions.forEach(function(e){e.dispose()})}),r.notificationCategories(t.Result.SendingCategoryList),r.areNotificationsChanging(!1),c());r.updated.resolve()},m=function(e,t){return a.subscribeTo(e,function(e){var t=this.categoryId,a=this.methodId;if(!r.areNotificationsChanging()){var i=r.notificationCategories().find(function(e){return e.CampaignCategoryID===t});if(i){var o=i.CategoryMethods.find(function(e){return e.SendingMethodId===a});o&&(o.Allowed=e,v.postbox.publish("notifications-settings-change",i.CampaignCategoryName+"+"+o.SendingMethodName+"+"+o.Allowed),r.areNotificationsChanging(!0),f.setNotificationsSettings(r.notificationCategories()).then(d).done())}}},t)};T.get("AccountHubSetting")||T.set("AccountHubSetting",null),T.subscribe("AccountHubSetting",function(e){r.isCollapsed(e!==eViewTypes.vNotificationsSettings)});function b(){return!y.CheckPermissions("notificationsSettings")}function p(){w.UpdateAlert(AlertTypes.ServerResponseAlert,Dictionary.GetItem("GenericAlert"),Dictionary.GetItem("Forbidden"),null),w.PopAlert(AlertTypes.ServerResponseAlert)}return{init:function(e){t.init.call(a,e),r.isReady=v.observable(!1),r.areNotificationsChanging=v.observable(!1),r.notificationCategories=v.observableArray([]),r.lowMarginAlertValue=v.observable(),r.minMargin=v.observable(.25),r.maxMargin=v.observable(10),r.step=.25,r.lowMarginAlertMinMax=v.observable([r.minMargin(),r.maxMargin()]),r.lowMarginAlertValue.extend({amountValidation:r.lowMarginAlertMinMax,dirty:!1}),r.lowMarginAlertValue.extend({notify:"always"}),r.lowMarginAlertValueValid=v.observable(!0),r.isCollapsed=v.observable(!0),r.saveMarginButtonEnabled=v.observable(!1),r.spinnerEnabled=v.observable(!1),r.updated=Q.defer(),r.isProcessing=v.observable(!1),r.lowMarginAlertValueValid.subscribe(c),r.lowMarginAlertValue.subscribe(c),r.updated.promise.then(function(){r.isReady(!0)}),f.getNotificationsSettings().then(d).done(),g.VManager.GetViewArgs(eViewTypes.vNotificationsSettings)===eViewTypes.vNotificationsSettings&&r.isCollapsed(!1)},dispose:function(){e.notificationSettingChanged=null,t.dispose.call(a)},Handlers:e,Data:r,Dictionary:S,GetDataByGroup:function(t){var e=r.notificationCategories().filter(function(e){return e.groupId===t});return e=e.sort(function(e,t){return e.order>t.order?1:-1})},eNotificationsSettingsGroups:u,eCampaignCategories:n,CollapsedToggle:function(){D.prop.isDemo?g.VManager.RedirectToForm(eForms.Settings,eViewTypes.vNotificationsSettings):r.isCollapsed(!r.isCollapsed())},SaveButtonHandler:function(){b()?p():(r.isProcessing(!0),D.prop.minPctEQXP=r.lowMarginAlertValue(),f.sendExposureCoverage(r.lowMarginAlertValue(),function(){r.isProcessing(!1),r.lowMarginAlertValue.markClean(),c()}))},IsRestricted:b,CheckPermissions:function(){b()&&p()}}});return{viewModel:{createViewModel:function(e){var t=new a(e);return t.init(),t}},NotificationsSettingsViewModel:a}}),define("viewModels/SortStateViewModel",["knockout","KoComponentViewModel"],function(c,e){var a=extendClass(e,function(e){var t=this,a=this.parent,i=e.sortPropertiesObs,o=e.sortProperty,r=e.setSorting||function(){},n=c.observable(""),s=e.defaultAsc||!1;function l(e){var t="";isBooleanType(e)&&(t=e?"up":"down"),n(t)}function u(e){r(!0,o,e)}return a.init.call(t),t.parent.subscribeTo(e.sortPropertiesObs,function(e){e.sortProperty===o?l(e.asc):l()},t),l(i().sortProperty===o?i().asc:null),{sortDir:n,changeSort:function(){var e=i().sortProperty===o?i().asc:null;isBooleanType(e)?u(!e):u(s)}}});return{viewModel:{createViewModel:function(e){var t=new a(e);return t.init(),t}}}}),define("viewModels/fields/AmountSpinnerFieldViewModel",["require","knockout","Dictionary"],function(e){var f=e("knockout"),g=e("Dictionary");return function(a){var i,e,t,o,r,n,s,l=f.observable(1),u=f.pureComputed(function(){return(l().toString().split(".")[1]||"").length}),c=f.observable(),d=f.observable(),m=f.observable(!1),b=f.observable(!0);function p(e){var t=a.forceNonFractionalValue();e&&(i.dispose(),a.value.extend({toNumericLength:!1}),a.value.extend({incremental:!1})),a.value.extend({toNumericLength:{ranges:[{from:0,to:10,decimalDigits:t?0:1},{from:10,to:Number.MAX_SAFE_INTEGER,decimalDigits:0}]}}),a.value.extend({incremental:{ranges:[{from:0,to:10,step:t?1:.1},{from:10,to:100,step:1},{from:100,to:1e3,step:10},{from:1e3,to:1e4,step:100},{from:1e4,to:1e5,step:1e3},{from:1e5,to:1e6,step:1e4},{from:1e6,to:1e7,step:1e5},{from:1e7,to:1e8,step:1e6},{from:1e8,to:1e9,step:1e7},{from:1e9,to:1e10,step:1e8},{from:1e10,to:1e11,step:1e9}]}}),l(a.value.step()),i=a.value.step.subscribe(function(e){l(e)})}function v(e){c((e=e||[])[0]||0),d(e[1]||1e10)}return a.value.extend({tooltipValidation:{message:g.GetItem("txtRateValidationTooltip"),notify:"always",showTooltip:function(){return m()}}}),p(!1),v(f.utils.unwrapObservable(a.options)),t=a.options.subscribe(function(){v(this._target())},null,"arrayChange"),n=a.value.tooltipClosed.subscribe(function(e){e&&m(!1)}),e=a.value.subscribe(function(){m(!1)}),o=f.postbox.subscribe("deal-slip-show-validation-tooltips",function(){a.value.resetTooltip(),m(!0)}),r=a.value.isValid.subscribe(function(e){b(e)}),s=a.forceNonFractionalValue.subscribe(function(){p(!0)}),{id:a.id,name:a.name,value:a.value,isSelectedAmountValid:b,min:c,max:d,step:l,format:u,dispose:function(){u.dispose(),i.dispose(),n.dispose(),e.dispose(),o.dispose(),r.dispose(),a.value.extend({incremental:!1}),a.value.extend({tooltipValidation:!1}),a.value.extend({toDealAmount:!1}),t.dispose(),s.dispose()}}}}),define("viewModels/fields/LowMarginSpinnerViewModel",["require","knockout"],function(e){var d=e("knockout");return function(e){var t,a,i,o=d.observable(1),r=d.observable(),n=d.observable(),s=d.observable(!1),l=d.observable(!0),u=d.observable(!0);function c(e){r((e=e||[])[0]||0),n(e[1]||1e10)}return e.value.extend({toNumericLength:{ranges:[{from:0,to:10,decimalDigits:2},{from:10,to:Number.MAX_SAFE_INTEGER,decimalDigits:0}]}}),e.value.extend({incremental:{ranges:[{from:0,to:10,step:.25}]}}),o(e.step),d.isObservable(e.enabled)&&(u=e.enabled),d.isObservable(e.amountValidSubscriber)&&(l=e.amountValidSubscriber),c(d.utils.unwrapObservable(e.options)),a=e.options.subscribe(function(){c(this._target())},null,"arrayChange"),t=e.value.subscribe(function(){s(!1)}),i=e.value.isValid.subscribe(function(e){l(e)}),{id:e.id,name:e.name,value:e.value,isSelectedAmountValid:l,min:r,max:n,step:o,dispose:function(){t.dispose(),i.dispose(),e.value.extend({toDealAmount:!1}),e.value.extend({incremental:!1}),a.dispose()},enabled:u}}}),define("viewModels/TransactionsReportViewModel",["require","require","knockout","KoComponentViewModel","ViewModelsManager","LoadDictionaryContent!TransactionsReport"],function(e){var s=e("knockout"),t=e("KoComponentViewModel"),l=e("ViewModelsManager"),a=extendClass(t,function(){var a=this,i=this.parent,o=s.observable(),r=s.observable(),n=new ObservableDataSet({columns:[{name:"PositionNumber",dataIndex:eTransactionsReports.PositionNumber},{name:"TranactionNumber",dataIndex:eTransactionsReports.TransactionNumber},{name:"ExecutionDate",dataIndex:eTransactionsReports.ExecutionDate},{name:"BuySell",dataIndex:eTransactionsReports.BuySell},{name:"Item",dataIndex:eTransactionsReports.Item},{name:"InstrumentId",dataIndex:eTransactionsReports.InstrumentId},{name:"ItemBase",transform:function(e,t,a,i,o){return o.Item.split(/\//)[0]}},{name:"QuantityTraded",dataIndex:eTransactionsReports.QuantityTraded},{name:"UnitPrice",dataIndex:eTransactionsReports.UnitPrice},{name:"QuantityTradedAndOtherCcy",transform:function(e,t,a,i,o){return o.QuantityTraded}},{name:"TotalAmountCurrency",dataIndex:eTransactionsReports.TotalAmountCurrency},{name:"USDVolume",dataIndex:eTransactionsReports.USDVolume},{name:"TypeOfOrder",dataIndex:eTransactionsReports.TypeOfOrder},{name:"OpenRolloverClose",dataIndex:eTransactionsReports.OpenRolloverClose},{name:"BaseCur",dataIndex:eTransactionsReports.BaseCur},{name:"OtherCur",dataIndex:eTransactionsReports.OtherCur},{name:"Commission",dataIndex:eTransactionsReports.Commission}],statusField:"status",totalField:"totalItems",dataField:"Transactions",pagination:{pagesPerPage:5,pageIndexField:"page",pageSizeField:"pagesize"},Filter:{page:1,pagesize:20,to:r,from:o},DAL:{reference:dalTransactionsReport.LoadTransactions,callerName:"TransactionsReportViewModel/getTransactions",errorSeverity:eErrorSeverity.medium}});return{init:function(e){var t;i.init.call(a,e),t=new Date,o(new Date(t.getFullYear(),t.getMonth(),1).ExtractDate()),r((new Date).ExtractDate()),a.subscribeTo(l.VManager.GetActiveFormViewProperties(eViewTypes.vTransactionsReport).state,function(e){switch(e){case eViewState.Refresh:n.Load(),l.VManager.GetActiveFormViewProperties(eViewTypes.vTransactionsReport).state(eViewState.Initial)}}),a.subscribeTo(n.HasRecords,function(e){s.postbox.publish("printableDataAvailable",{dataAvailable:e,viewType:l.VManager.ActiveFormType(),viewModel:"TransactionsReportsViewModel"})}),n.Init(),n.ApplyFilter()},dispose:function(){n.Clean(),i.dispose.call(a)},Transactions:n.DataRows,HasRecords:n.HasRecords,DataSet:n,EnableApplyButton:n.IsLoadingData,Filter:{From:o,To:r,Apply:function(){n.IsLoadingData()||n.ApplyFilter()}}}});return{viewModel:{createViewModel:function(e){var t=new a;return t.init(e),t}}}}),define("viewModels/demoDeposit/demo-deposit-icon",["require","KoComponentViewModel","Customer","CustomerProfileManager","dalDemoAccount","dalCommon","AmountConverter","Dictionary","BuilderForInBetweenQuote","SystemInfo"],function(e){var t=e("KoComponentViewModel"),g=e("Customer"),D=e("CustomerProfileManager"),S=e("dalDemoAccount"),y=e("AmountConverter"),T=e("Dictionary"),w=e("BuilderForInBetweenQuote"),h=e("SystemInfo"),a=extendClass(t,function(e){var t,a=this,i=this.parent,o=e,r={quoteForUSDCcyToSelectedAccuntCcy:ko.observable(""),isProcessing:ko.observable(!1),shouldWaitForInBetweenQuote:ko.observable(!1)},n=a.createComputed(function(){return y.Convert(D.ProfileCustomer().demoDepositAmount,r.quoteForUSDCcyToSelectedAccuntCcy())}).extend({deferred:!0}),s=a.createComputed(function(){return e="demoDepositToolTip",String.format(T.GetItem(e),Format.toNumberWithCurrency(n(),{currencyId:g.prop.selectedCcyId()}));var e}),l=g.prop.isDemo,u=!1,c=!1,d=!1,m=function(){d||(t&&clearInterval(t),r.shouldWaitForInBetweenQuote(!1))},b=a.createComputed(function(){return!0!==c&&(!0===u&&!r.isProcessing()||!(!l||r.isProcessing())&&(!0!==r.shouldWaitForInBetweenQuote()&&(u=Number.fromStr(o.equity())<(!0===d?(r.shouldWaitForInBetweenQuote(!0),t=setInterval(m,500),0):y.Convert(h.get("config").MaxEquityForDemoDepositInUsd,r.quoteForUSDCcyToSelectedAccuntCcy.peek())))))}).extend({deferred:!0}),p=function(e){!0===JSON.parse(e).isSuccessful&&(c=!0),r.isProcessing(!1)},v=function(e){e&&(r.quoteForUSDCcyToSelectedAccuntCcy(e),d=!1)},f=function(){d=!0,w.GetInBetweenQuote(47,g.prop.selectedCcyId()).then(v).done()};return{init:function(e){i.init.call(a,e),f(),a.subscribeTo(g.prop.selectedCcyId,function(){f()})},dispose:function(){i.dispose.call(a)},tooltipMessage:s,isCustomerDemo:l,isEligableToDemoDeposit:b,onClick:function(){r.isProcessing(!0),S.processDemoDeposit(p)},obs:r}});return{createViewModel:function(e){var t=new a(e||{});return t.init(),t}}}),define("FxNet/UILayer/ViewModels/UploadDocumentsPopUpsManager",["Dictionary","AlertsManager","StatesManager"],function(e,i,s){var l="UploadDocumentsStatusPopUpMessages";return new function(){function a(e){var t=[];return function(e,t){var a,i,o=getEnumName(eUploadDocumentType,t);switch(t){case eUploadDocumentType.OtherDocuments:(a=Dictionary.GetItem("doc_load_success",l))&&(i=a);break;default:var r=Dictionary.GetItem("docname_"+o,l);(a=Dictionary.GetItem("docname_load_success",l))&&(i=a.replace("{0}",r))}i&&e.push(i)}(t,e),function(e,t){var a,i=[eUploadDocumentStatus.Incomplete,eUploadDocumentStatus.AwaitingDocument];if(!(s.States.AmlStatus()===eAMLStatus.Approved||t!==eUploadDocumentType.ProofOfID&&t!==eUploadDocumentType.ProofOfResidence||i.indexOf(s.States.docProofOfID())<0&&i.indexOf(s.States.docProofOfResidence())<0)){var o,r,n=Dictionary.GetItem("doc_shuld_be_provided",l);if(n.trim()){switch(t){case eUploadDocumentType.ProofOfID:0<=i.indexOf(s.States.docProofOfResidence())&&(o=getEnumName(eUploadDocumentType,eUploadDocumentType.ProofOfResidence));break;case eUploadDocumentType.ProofOfResidence:0<=i.indexOf(s.States.docProofOfID())&&(o=getEnumName(eUploadDocumentType,eUploadDocumentType.ProofOfID));break;default:return}o&&(r=Dictionary.GetItem("docname_"+o,l),(a=n.replace("{0}",r))&&e.push(a))}}}(t,e),function(e,t){if(s.States.AmlStatus()!==eAMLStatus.Approved&&(t===eUploadDocumentType.ProofOfID||t===eUploadDocumentType.ProofOfResidence)){var a=Dictionary.GetItem("notify_when_doc_reviewed",l);a.trim()&&e.push(a)}}(t,e),{title:Dictionary.GetItem("popup_title",l),messages:t}}return{showPopUp:function(e){var t=a(e);0<t.messages.length&&(i.UpdateAlert(AlertTypes.GeneralOkAlert,t.title,t.body,t.messages,{theme:"alerts-white-theme alerts-no-close-x spaced-list"}),i.PopAlert(AlertTypes.GeneralOkAlert))}}}}),define("viewModels/UploadDocumentsComponentViewModel",["require","knockout","postbox","Q","environmentData","Dictionary","Customer","UrlResolver","FxNet/DataAccessLayer/dalClaims","fxnet/dataaccesslayer/dalcommon","StatesManager","FxNet/DataAccessLayer/dalCompliance","FxNet/UILayer/Managers/InterWindowsCommunicator","PermissionsModule","initConfiguration","FxNet/UILayer/ViewModels/UploadDocumentsPopUpsManager"],function(e){var T=e("knockout"),w=e("Q"),h=e("environmentData"),C=e("Dictionary"),A=e("Customer"),M=e("UrlResolver"),L=e("FxNet/DataAccessLayer/dalClaims"),I=e("fxnet/dataaccesslayer/dalcommon"),P=e("FxNet/DataAccessLayer/dalCompliance"),V=e("FxNet/UILayer/Managers/InterWindowsCommunicator"),R=e("StatesManager"),F=e("PermissionsModule"),k=e("initConfiguration").UploadDocumentsConfiguration,x=e("FxNet/UILayer/ViewModels/UploadDocumentsPopUpsManager");return{viewModel:{createViewModel:function(t){var a,i,o=t.id||"unknown",r=V(window,o.toString()+(t.hashTag?t.hashTag:"")),e=w.defer(),n=0,s=createGuid(),l=t.recordType?t.recordType:eClaimRecordType.generalDocument;R.startGetDocumentsStatus();var u={progressVisible:T.observable(!1),textFileUpload:T.observable(),iframeReady:T.observable(!1),autoUpload:t.autoUpload||!1,iframeElement:T.observable(),canBrowse:T.observable(!0),canUpload:T.observable(!1),files:T.observableArray(),iframeSrc:T.observable(c()+d()).extend({notify:"always"}),successFirst:T.observable(!1)};function c(){return h.pciPath+h.pciFileUploadPage+"?id="+o+"&v="+window.versionPCI+"&d="+window.location.host.replace(/\./g,"_")}function d(){var e="an="+A.prop.accountNumber+"&guid="+s;return void 0!==t.hashTag?"#"+o+t.hashTag+"&"+e:"#"+e}function m(){if(n>k.uploadFrameRetryCount){clearInterval(i);var e=u.iframeSrc();I.LogFrameNotLoadedMessage(eTokenizationError.frameNotLoaded,encodeURI(e),extractGuid(e))}else{var t;n++,u.iframeSrc((t=c(),M.getUrlWithRndKeyValue(t)+d()))}}function b(){isFunctionType(t.uploadResponseCallback)&&t.uploadResponseCallback()}function p(){u.canUpload(!1),u.canBrowse(!1),u.files.push(a),L.getClaim(eClaimActionType.Save,l,A.prop.accountNumber).then(f).then(g).fail(D).done()}function v(e){r.postMessage(u.iframeElement(),e,h.pciPath)}function f(e){var t=JSON.parse(e);if(!t||t.error)throw new Error(e);return t}function g(e){v({msg:"upload",value:e}),u.successFirst()||u.successFirst(!0)}function D(e){u.canBrowse(!0),u.canUpload(!1),u.textFileUpload("");var t=u.files().length-1,a=$.extend({},u.files()[t]);a.errorText=y("uploadError"),a.errorType="uploadError",a.isSuccessfull=!1,a.showProgress=!1,a.isFinished=!0,u.files.replace(u.files()[t],a),S(a,eTokenizationError.claimError,e.status?"Claim request failed with status "+e.status:e),u.canUpload(!1),u.canBrowse(!0),b()}function S(e,t,a){var i,o;!e.isSuccessfull&&(i=e).errorType&&F.CheckPermissions("uploadDocuments")&&"uploadError"===i.errorType&&I.LogUploadActivityMessage(t,encodeURI(u.iframeSrc())+" "+((o=a)?o instanceof Error?o.message+" StackTrace: "+(o.stack?o.stack:""):JSON.stringify(o):""))}function y(e){if(e)switch(e){case"noFileToUpload":case"uploadError":return C.GetItem("lblErrMsgSendindFaildTitle");case"fileTypeError":return C.GetItem("lblFileTypeError");case"fileNumberError":return C.GetItem("lblFileCountError");case"invalidFileName":return C.GetItem("lblFileNameError");case"maxSize":return C.GetItem("lblFileSizeError");default:return e}return C.GetItem("lblSuccessfullyUploaded")}return I.LogUploadCommunication("VM load","load promise timeout started","written"),e.promise.timeout(k.interWindowsCommunicationLimit).then(function(e){I.LogUploadCommunication("VM load","load promise timeout was resolved with result: "+e,"written")},function(){i=setInterval(m,k.uploadFrameReloadTimeout)}).done(),u.isBrowseEnabled=T.computed(function(){return u.iframeReady()&&u.canBrowse()}),u.isBrowseUploadOneClickEnabled=T.computed(function(){return u.iframeReady()&&u.canBrowse()&&F.CheckPermissions("uploadDocuments")}),u.isUploadEnabled=T.computed(function(){return u.iframeReady()&&u.canUpload()&&F.CheckPermissions("uploadDocuments")}),T.postbox.subscribe(eAppEvents.dialogClosed,function(){t.isCloseable&&u.iframeSrc("")}),r.registerMessageHandler(h.pciPath,{uploadStatus:function(e){u.canBrowse(!0),u.canUpload(!1);var t=e.data,a=u.files().length-1;t.errorText=y(t.errorType),t.name=u.files()[a].name,u.files.replace(u.files()[a],t),S(t,eTokenizationError.uploadError,e),t.errorType&&b(),e.result&&u.textFileUpload("")},ready:function(){clearInterval(i),e.resolve("ready"),u.iframeReady(!0),v({msg:"ready"})},logUploadData:function(e){var t=e.uploadResult&&e.uploadResult.guid?e.uploadResult.guid:void 0,a=e.uploadResult&&e.uploadResult.name?e.uploadResult.name:u.textFileUpload(),i=e.uploadResult&&e.uploadResult.size?e.uploadResult.size:"",o=e.uploadResult&&e.uploadResult.contenttype?e.uploadResult.contenttype:"",r=-1;e.uploadResult&&e.uploadResult.validationErrorCode&&/^\d+$/.test(e.uploadResult.validationErrorCode)?r=e.uploadResult.validationErrorCode:e.uploadResult&&!e.uploadResult.validationErrorCode&&(r=0<i&&a.length&&0<o.length?0:r),b(),0===r&&(l===eUploadDocumentType.ProofOfID?R.States.docProofOfID(eUploadDocumentStatus.Processing):l===eUploadDocumentType.ProofOfResidence&&R.States.docProofOfResidence(eUploadDocumentStatus.Processing),x.showPopUp(l)),P.logUploadResult({ErrNum:r,ErrType:e.errType,FileName:a,FileSize:i,ContType:o,GuId:t,RecType:l})},fileData:function(e){e.errorText=y(e.errorType),u.textFileUpload(e.name),u.canUpload(!e.isFinished),(a=e).isFinished&&(u.files.push(a),S(a,eTokenizationError.uploadError,e)),e.errorType&&b(),!e.isFinished&&u.autoUpload&&p()}}),{upload:p,uploadStringImage:function(e){v({msg:"uploadStringImage",value:{base64Image:e.content,fileName:e.fileName}})},browse:function(){v({msg:"browse"})},removeFileLog:function(e){u.files.remove(e)},dispose:function(){u.iframeSrc(""),r.unregisterMessageHandler(),e.resolve("dispose"),i&&clearInterval(i)},form:u}}}}}),define("viewModels/UploadDocumentsViewModel",["require","JSONHelper","knockout","ViewsManager","Customer","FxNet/DataAccessLayer/dalCompliance","viewModels/UploadDocumentsComponentViewModel","PermissionsModule","AlertsManager","DepositConfirmationActions"],function(e){var c=e("knockout"),d=e("JSONHelper"),m=e("FxNet/DataAccessLayer/dalCompliance"),b=e("ViewsManager"),p=e("Customer"),v=e("viewModels/UploadDocumentsComponentViewModel"),f=e("PermissionsModule"),g=e("AlertsManager"),D=e("DepositConfirmationActions");return{viewModel:{createViewModel:function(){var a=c.observable(),i=c.observable([]),e=c.observable(!1),o=c.observable(!1),r=f.CheckPermissions("uploadDocuments"),n=0,s=new THashTable;if(!p.prop.isDemo)return a(s),m.getUploadDocumentsData(t),{documentsData:a,notApprovedCreditCards:i,ccTooltipVisible:e,showCCTooltip:function(){e(!e())},getIndexInc:function(e){return e?++n:0},getIndex:function(){return n},getStatusColor:function(e){return e===eUploadDocumentStatus.Processing?"status-orange":e===eUploadDocumentStatus.Approved||e===eUploadDocumentStatus.NotRequired?"status-green":e===eUploadDocumentStatus.Incomplete||e===eUploadDocumentStatus.AwaitingSignatureHighAmount?"status-red":"status-gray"},dispose:function(){a().ForEach(u),s.Clear()},openDepositconfirmationPopup:D.OpenConfirmation,sendEmail:function(){if(r&&!o()){m.sendDepositConfirmation();var e=Dictionary.GetItem("depositConfirmationEmail"),t=Dictionary.GetItem("PleaseNote");o(!0),g.UpdateAlert(AlertTypes.DepositConfirmationEmailSentAlert,t,e),g.PopAlert(AlertTypes.DepositConfirmationEmailSentAlert)}},isEmailClicked:o,isPermitted:r};function t(e){var t=d.STR2JSON("UploadDocumentsViewModel/getUploadDocumentsData",e,eErrorSeverity.medium);t&&(t.Data&&function(e){s=a(),e.forEach(l);var t=s.GetItem(eUploadDocumentType.OtherDocuments);s.OverrideItem(eUploadDocumentType.OtherDocuments,t),n=0,a(s)}(t.Data),t.NotApprovedCreditCards&&i(t.NotApprovedCreditCards))}function l(e,t){[eUploadDocumentType.ProofOfID,eUploadDocumentType.ProofOfResidence,eUploadDocumentType.CreditCardCopy,eUploadDocumentType.DepositConfirmation,eUploadDocumentType.WithdrawalPendingRequest,eUploadDocumentType.TaxCard,eUploadDocumentType.OtherDocuments].contains(e.DocumentTypeID)&&(e.IsVisible=!0,e.uploadVm=v.viewModel.createViewModel({recordType:e.DocumentTypeID,autoUpload:!0,id:"upload",hashTag:t+1,uploadResponseCallback:e.DocumentTypeID===eUploadDocumentType.DepositConfirmation?D.CloseConfirmation:emptyFn}),e.dispose=e.uploadVm.dispose,s.OverrideItem(e.DocumentTypeID,e))}function u(e,t){t&&isFunctionType(t.dispose)&&t.dispose()}b.SwitchViewVisible(p.prop.mainPage,{})}}}}),define("FxNet/LogicLayer/Deal/DealAmountLabel",["require","Dictionary","DealAmountPrefixKey","SymbolsManager"],function(e){var n=e("Dictionary"),s=e("DealAmountPrefixKey"),l=e("SymbolsManager");return{Translate:function(e,t){if(e){var a,i=!1,o=isNullOrUndefined(t)?s:t,r=o+e.id;return n.ValueIsEmpty(r)&&(e.isFuture?r=o+"future":e.isShare?r=o+"share":(r=o+"default",i=!0)),a=n.GetItem(r),i&&(a+=" "+l.GetTranslatedSymbolById(e.baseSymbol)),{label:a}}}}}),define("FxNet/LogicLayer/Deal/DealLifeCycle",["require","CacheManager"],function(e){var a=e("CacheManager"),o=function(e,t){return(e===eAssetType.Share||e===eAssetType.Future)&&t===eDealPermit.Islamic?new Date(a.ServerTime().getTime()).toLaterDate().skipWeekendDays():null};return{getIslamicValueDateBeforeDeal:o,sharesIsCorporateActionDateSignificant_BeforeDeal:function(e,t,a){return t===eAssetType.Share&&(e!==eDealPermit.Islamic&&!!a||e===eDealPermit.Islamic&&!!a&&str2Date(a,"d/m/Y H:M")<o(t,e))},sharesIsDividendDateSignificant_BeforeDeal:function(e,t,a,i){return t===eAssetType.Share&&(e!==eDealPermit.Islamic&&!a&&!!i||e===eDealPermit.Islamic&&!a&&!!i&&str2Date(i,"d/m/Y H:M")<o(t,e))},futuresIsRolloverDateSignificant_BeforeDeal:function(e,t,a){return t===eAssetType.Future&&(e!==eDealPermit.Islamic&&!!a||e===eDealPermit.Islamic&&!!a&&str2Date(a,"d/m/Y H:M")<o(t,e))},futuresIsRolloverDateSignificant_AfterDeal:function(e,t,a){return!(e!==eAssetType.Future||!t)&&(!a||str2Date(t,"d,m,y,H,M,S")<str2Date(a,"d,m,y,H,M,S"))},sharesIsCorporateActionDateSignificant_AfterDeal:function(e,t,a){return!(e!==eAssetType.Share||!t)&&(!a||str2Date(t,"d,m,y,H,M,S")<str2Date(a,"d,m,y,H,M,S"))},sharesIsDividendDateSignificant_AfterDeal:function(e,t,a,i){return!(e!==eAssetType.Share||!t||a)&&(!i||str2Date(t,"d,m,y,H,M,S")<str2Date(i,"d,m,y,H,M,S"))}}}),define("FxNet/LogicLayer/Deal/DealMarginCalculator",["require","Customer","AmountConverter"],function(e){var t=e("Customer"),m=e("AmountConverter");function b(e,t){var a=Math.pow(10,t);return Math.round(e*a)/a}var n=function(e,t){return m.Convert(e,t)},s=function(e){return e&&(e=parseFloat(e.toFixed(2))),e},p=function(e){return(e.orderDir===eOrderDir.Sell||e.orderDir===eOrderDir.Buy)&&isNumber(e.requiredMarginPercentage)&&isNumber(e.dealRate)&&isNumber(e.dealAmount)};return{DealMargin:function(e){if(p(e)){var t,a,i=toNumeric(e.otherSymbolAmount),o=toNumeric(e.baseSymbolAmount),r=toNumeric(e.requiredMarginPercentage),n=e.dealAmount*toNumeric(e.dealRate);e.hasPosition?a=-1*(t=e.orderDir===eOrderDir.Sell?-1:1):t=a=1;var s=b(m.Convert(Math.abs(i),e.quoteForOtherCcyToAccountCcy,!0),2),l=b(m.Convert(Math.abs(o),e.quoteForBaseCcyToAccountCcy,!0),2),u=Math.max(s,l)*r,c=b(m.Convert(Math.abs(i+n*a),e.quoteForOtherCcyToAccountCcy,!0),2),d=b(m.Convert(Math.abs(o+e.dealAmount*t),e.quoteForBaseCcyToAccountCcy,!0),2);return b(Math.max(c,d)*r-u,2)}},PipWorth:function(e,t,a,i){var o=e*(1/Math.pow(10,t)),r=n(o,a);return 10<i&&r?r.toFixed(0):s(r)},DealAmount:function(e){return e.quoteForOtherCcyToAccountCcy?e.baseSymbol==t.prop.baseCcyId()?e.dealAmount:n(e.dealRate*e.dealAmount,e.quoteForOtherCcyToAccountCcy):""},SpreadWorthInAcountCCY:function(e){var t=e.ask-e.bid,a=e.dealAmount*t,i=0;return isNumber(a)&&(i=Math.abs(n(-a,e.quoteForOtherCcyToAccountCcy))),b(i,2)},Convert:n}}),define("FxNet/LogicLayer/Deal/NewDealValidator",["require","Dictionary","InstrumentsManager","AlertsManager","QuotesManager","StatesManager"],function(e){var s,l=e("Dictionary"),u=e("InstrumentsManager"),c=e("AlertsManager"),d=e("QuotesManager"),m=e("StatesManager");return{Init:function(e){s=e},Validate:function(e,t){var a,i=u.GetInstrument(e),o=s.CheckTradingAgreement(i);if(1==m.States.fxDenied())return s.ValidateOnlineTradingUser(),!1;if(o!==eTradingAgreement.NotNeeded)return a=String.format(l.GetItem("rcFuturesRedirect"),i.ccyPair),c.UpdateAlert(AlertTypes.ServerResponseAlert,null,a,""),c.PopAlert(AlertTypes.ServerResponseAlert),!1;var r=d.Quotes.GetItem(i.id);if(r&&r.state==eQuoteStates.NotActive)return a=String.format(l.GetItem("InstrumentInactive"),i.ccyPair),c.UpdateAlert(AlertTypes.ServerResponseAlert,null,a,""),c.PopAlert(AlertTypes.ServerResponseAlert),!1;var n=t||"";return!(0<n.length&&(a=n,c.UpdateAlert(AlertTypes.ServerResponseAlert,null,a,""),c.PopAlert(AlertTypes.ServerResponseAlert),1))}}}),define("FxNet/LogicLayer/Deal/SentimentsConnManager",["initConfiguration","FxNet/LogicLayer/GeneralManager/TradingInfoConnManager","StateObject!SentimentsConnManager"],function(e,i,o){var a,r=e.MarketInfoConfiguration.hubname,n={},t=function(e,t){n[t]&&(n[t].done=!0,e&&"function"==typeof a&&a(e))},s=function(e){var t=o.get("IsServiceAvailable"),a=!!e;o.update("IsServiceAvailable",a),!t&&a&&function(){for(var e in n)n.hasOwnProperty(e)&&(n[e].done=!1,i.Subscribe(r,n[e].args))}()};return o.set("IsServiceAvailable",!1),i.UpdateCallbacks(r,t,s),{SetMessageReceivedCallback:function(e){a=e},Subscribe:function(e,t){var a=[e,t];n[t]={args:a,done:!1},i.Subscribe(r,a)},Unsubscribe:function(e,t){var a=[e,t];i.Unsubscribe(r,a)},Dispose:function(){o.unset("IsServiceAvailable"),i.Dispose()}}}),define("FxNet/LogicLayer/Deal/InstrumentInfoLines",["require","Dictionary","LoadDictionaryContent!deals_InstrumentInfoTool"],function(e){var u,c,d=e("Dictionary"),i=[{id:instrumentInfoProps.pipValue,available:!0,label:"txtPipValue",labelMobile:"lblPipValue",tooltip:"txtPipValueInfo",attrIdOfValue:"lblPipValue",attrIdOfValueMobile:"lblPipValue",value:"pipValue"},{id:instrumentInfoProps.pipWorth,available:!0,label:"lblPipWorth",labelMobile:"lblPipWorth",tooltip:"txtPipWorthInfo",attrIdOfValue:"lblPipWorth",attrIdOfValueMobile:"lblPipWorth",value:"pipWorth"},{id:instrumentInfoProps.requiredMargin,available:!0,label:"lblRequiredMargin",labelMobile:"lblRequiredMargin",tooltip:"txtRequiredMarginInfo",attrIdOfValue:"lblRequiredMargin",attrIdOfValueMobile:"lblRequiredMargin",value:"requiredMargin"},{id:instrumentInfoProps.offHoursRequiredMargin,available:!0,label:"lblOffHoursRequiredMargin",labelMobile:"lblOffHoursRequiredMargin",tooltip:"txtOffHoursRequiredMarginInfo",attrIdOfValue:"lblOffHoursRequiredMargin",attrIdOfValueMobile:"lblOffHoursRequiredMargin",value:"offHoursRequiredMargin"},{id:instrumentInfoProps.maximumLeverage,available:!0,label:"lblMaximumLeverage",labelMobile:"lblMaximumLeverage",tooltip:null,attrIdOfValue:"lblMaximumLeverage",attrIdOfValueMobile:"lblMaximumLeverage",value:"maximumLeverage"},{id:instrumentInfoProps.minDealAmount,available:!0,label:"minDealAmountLabel",labelMobile:"minDealAmountLabel",tooltip:"txtMinAmountToTrade",attrIdOfValue:"lblMinAmount",attrIdOfValueMobile:"lblMinAmount",value:"minAmount"},{id:instrumentInfoProps.maxDealAmount,available:!0,label:"maxDealAmountLabel",labelMobile:"maxDealAmountLabel",tooltip:"txtMaxAmountToTrade",attrIdOfValue:"lblMaxAmount",attrIdOfValueMobile:"lblMaxAmount",value:"maxAmount"},{id:instrumentInfoProps.marketPriceTolerance,available:!0,label:"lblMaketPriceTolerance",labelMobile:"lblMraketPriceTolerance",tooltip:"txtMaketPriceToleranceInfo",attrIdOfValue:"lblMaketPriceTolerance",attrIdOfValueMobile:"lblMarketPriceTolerance",value:"marketPriceTolerance"},{id:instrumentInfoProps.ofSell,available:!0,label:"lblOFSell",labelMobile:"lblOFSell",tooltip:"txtShortOvernightFinancingInfo",attrIdOfValue:"lblovernightFinancingShort",attrIdOfValueMobile:"lblovernightFinancingShort",value:"overnightFinancingShort"},{id:instrumentInfoProps.ofBuy,available:!0,label:"lblOFBuy",labelMobile:"lblOFBuy",tooltip:"txtLongOvernightFinancingInfo",attrIdOfValue:"lblovernightFinancingLong",attrIdOfValueMobile:"lblovernightFinancingLong",value:"overnightFinancingLong"},{id:instrumentInfoProps.ofPercentageSell,available:!0,label:"lblOFPercentageSell",labelMobile:"lblOFPercentageSell",tooltip:"txtOvernightFinancingPercent",attrIdOfValue:"lblOFPercentageSell",attrIdOfValueMobile:"lblOFPercentageSell",value:"overnightFinancingPercentageSell"},{id:instrumentInfoProps.ofPercentageBuy,available:!0,label:"lblOFPercentageBuy",labelMobile:"lblOFPercentageBuy",tooltip:"txtOvernightFinancingPercent",attrIdOfValue:"lblOFPercentageBuy",attrIdOfValueMobile:"lblOFPercentageBuy",value:"overnightFinancingPercentageBuy"},{id:instrumentInfoProps.overnightFinancingGMT,available:!0,label:"lblOvernightFinancingGMT",labelMobile:"lblOvernightFinancingGMT",tooltip:null,attrIdOfValue:"lblOFGMT",attrIdOfValueMobile:"lblOvernightFinancingGMT",value:"overnightFinancingTimeGMT"},{id:instrumentInfoProps.rolloverDate,available:!0,label:"lblRolloverDate",labelMobile:"lblRolloverDate",tooltip:null,attrIdOfValue:"lblRolloverDate",attrIdOfValueMobile:"lblRolloverDate",value:"rolloverDate"},{id:instrumentInfoProps.dividendDate,available:!0,label:"lblDividendDate",labelMobile:"lblDividendDate",tooltip:null,attrIdOfValue:"lblDividendDate",attrIdOfValueMobile:"lblDividendDate",value:"dividendDate"},{id:instrumentInfoProps.dividendAmount,available:!0,label:"lblDividendAmount",labelMobile:"lblDividendAmount",tooltip:null,attrIdOfValue:"lblDividendAmount",attrIdOfValueMobile:"lblDividendAmount",value:"dividendAmount"},{id:instrumentInfoProps.weekendFinancing,available:!0,label:"lblWeekendFinancing",labelMobile:"lblWeekendFinancing",tooltip:null,attrIdOfValue:"",attrIdOfValueMobile:"",value:""}];return{GetInfoLines:function(e,t){var a=[];return u=e,c=t,i.forEach(function(e){var t=function(e){var t,a,i=instrumentInfoProps,o="deals_InstrumentInfoTool",r={id:e.id,available:e.available,label:"",labelm:"",value:"",tooltip:e.tooltip?d.GetItem(e.tooltip,o):null,tooltipConfig:{tooltipClass:"tooltip tooltipBottom",position:{my:"center bottom-18",at:"center center"}},attr:(t=e,a={},t.attrIdOfValue&&(a.id=t.attrIdOfValue),t.attrIdOfValueMobile&&(a.idm=t.attrIdOfValueMobile),a)};switch(e.id){case i.pipWorth:r.label=d.GetItem(e.label,o),r.labelm=d.GetItem(e.labelMobile,o),r.value=Format.toNumberWithCurrency(c[e.value](),{currencyId:c.customerSymbolId()});break;case i.offHoursRequiredMargin:r.available=r.available&&c.displayOffHoursRequiredMargin(),r.label=d.GetItem(e.label,o),r.labelm=d.GetItem(e.labelMobile,o),r.value=c[e.value]();break;case i.maxDealAmount:case i.minDealAmount:var n=e.id===i.minDealAmount?Math.ceil:Math.floor;r.label=c[e.label](),r.labelm=c[e.label](),r.value=c.isStock()?formatNumberWithThousandsSeparator(n(toNumeric(c[e.value]()))):c[e.value]();break;case i.ofSell:case i.ofBuy:r.available=r.available&&!c.isStock()&&c.isNotIslamicDealPermit&&u.isOvernightFinancing(),r.label=d.GetItem(e.label,o),r.labelm=d.GetItem(e.labelMobile,o),r.value=Format.toNumberWithCurrency(c[e.value](),{currencyId:c.customerSymbolId()});break;case i.ofPercentageSell:case i.ofPercentageBuy:case i.overnightFinancingGMT:r.available=r.available&&!c.isStock()&&c.isNotIslamicDealPermit&&u.isOvernightFinancing(),r.label=d.GetItem(e.label,o),r.labelm=d.GetItem(e.labelMobile,o),r.value=c[e.value]();break;case i.rolloverDate:r.available=r.available&&u.isFuture&&c.rolloverDate(),r.label=d.GetItem(e.label,o),r.labelm=d.GetItem(e.labelMobile,o),r.value=c[e.value]();break;case i.dividendDate:r.available=r.available&&u.isShare&&c.dividendDate(),r.label=d.GetItem(e.label,o),r.labelm=d.GetItem(e.labelMobile,o),r.value=c[e.value]();break;case i.dividendAmount:r.available=r.available&&u.isShare&&c.dividendDate()&&c.dividendAmount(),r.label=d.GetItem(e.label,o),r.labelm=d.GetItem(e.labelMobile,o),r.value=Format.toNumberWithCurrency(c[e.value](),{currencyId:c.otherInstrumentSymbol()});break;case i.weekendFinancing:if(r.available=r.available&&!c.isStock()&&c.weekendFinancingType()!=eWeekendFinancingTypes.None&&c.isNotIslamicDealPermit,!r.available)return r;var s=c.weekendFinancingType()==eWeekendFinancingTypes.Thursday?"txtThursday":c.weekendFinancingType()==eWeekendFinancingTypes.Friday?"txtFriday":null,l=c.weekendFinancingType()==eWeekendFinancingTypes.Thursday?"lblWeekendFinancingThursday":c.weekendFinancingType()==eWeekendFinancingTypes.Friday?"lblWeekendFinancingFriday":null;l&&(r.attr.dataAutomation=l),r.label=d.GetItem(e.label,o),r.labelm=d.GetItem(e.labelMobile,o),r.value=s?d.GetItem(s,o):"";break;default:r.label=d.GetItem(e.label,o),r.labelm=d.GetItem(e.labelMobile,o),r.value=c[e.value]()}return r}(e);t.available&&a.push(t)}),a}}}),define("viewModels/Deals/ClosedDealsModule",["require","knockout","Customer","closedDealsGridSettings","InstrumentTranslationsManager","SymbolsManager","ViewModelBase","dalClosedDeals","FxNet/LogicLayer/Deal/DealPermissions","InstrumentsManager"],function(e){var u=e("knockout"),c=e("Customer"),t=e("closedDealsGridSettings"),d=e("InstrumentTranslationsManager"),m=e("SymbolsManager"),b=e("ViewModelBase"),p=e("dalClosedDeals"),v=e("FxNet/LogicLayer/Deal/DealPermissions"),f=e("InstrumentsManager");var a=new function(){var t,a=clone(b),i={},o={positionNumber:u.observable(),instrumentId:u.observable(),instrument:u.observable(),from:u.observable(),to:u.observable(),page:u.observable(1),pagesize:40},e={idField:"positionNumber",columns:[{name:"rowNumber",transform:function(e,t){return t}},{name:"positionNumber",dataIndex:eClosedDealsBase.positionNumber},{name:"orderID",dataIndex:eClosedDealsBase.orderID},{name:"instrumentID",dataIndex:eClosedDealsBase.instrumentID},{name:"instrumentName",transform:function(e,t,a,i){var o=i[eClosedDealsBase.instrumentID],r=i[eClosedDealsBase.instrumentEnglishName],n=d.Short(o);return isEmptyValue(n)?r:n}},{name:"specialFontStart",dataIndex:eClosedDealsBase.specialFontStart},{name:"specialFontLength",dataIndex:eClosedDealsBase.specialFontLength},{name:"buyAmount",dataIndex:eClosedDealsBase.buyAmount},{name:"buySymbol",transform:function(e,t,a,i){var o=m.ExtractSymbolsNames(i[eClosedDealsBase.instrumentID]);return o?i[eClosedDealsBase.orderDir]==eOrderDir.Buy?o.base:o.other:""}},{name:"sellAmount",dataIndex:eClosedDealsBase.sellAmount},{name:"sellSymbol",transform:function(e,t,a,i){var o=m.ExtractSymbolsNames(i[eClosedDealsBase.instrumentID]);return o?i[eClosedDealsBase.orderDir]==eOrderDir.Buy?o.other:o.base:""}},{name:"orderDir",dataIndex:eClosedDealsBase.orderDir},{name:"dealAmount",transform:function(e,t,a,i){return i[eClosedDealsBase.orderDir]==eOrderDir.Sell?i[eClosedDealsBase.sellAmount]:i[eClosedDealsBase.buyAmount]}},{name:"dealType",dataIndex:eClosedDealsBase.dealType},{name:"valueDate",dataIndex:eClosedDealsBase.valueDate},{name:"positionStart",dataIndex:eClosedDealsSummaries.positionStart},{name:"positionStartFormatted",dataIndex:eClosedDealsSummaries.positionStart,transform:function(e){return l(e)}},{name:"positionStartNormalized",dataIndex:eClosedDealsSummaries.positionStart,transform:function(e){return s(e)}},{name:"executionTime",dataIndex:eClosedDealsBase.executionTime},{name:"executionTimeFormatted",dataIndex:eClosedDealsBase.executionTime,transform:function(e){return l(e)}},{name:"executionTimeNormalized",dataIndex:eClosedDealsBase.executionTime,transform:function(e){return s(e)}},{name:"forwardPips",dataIndex:eClosedDealsBase.forwardPips},{name:"originalPosNum",dataIndex:eClosedDealsSummaries.originalPosNum},{name:"orderRateOpen",dataIndex:eClosedDealsSummaries.orderRateOpen,transform:function(e,t,a,i){var o=i[eClosedDealsBase.instrumentID],r=i[eClosedDealsBase.decimalDigit];return Format.toRate(e,!0,o,r)}},{name:"orderRateOpenNumeric",dataIndex:eClosedDealsSummaries.orderRateOpen,transform:function(e){return toNumeric(e)}},{name:"orderRateClosed",dataIndex:eClosedDealsSummaries.orderRateClosed,transform:function(e,t,a,i){var o=i[eClosedDealsBase.instrumentID],r=i[eClosedDealsBase.decimalDigit];return Format.toRate(e,!0,o,r)}},{name:"orderRateClosedNumeric",dataIndex:eClosedDealsSummaries.orderRateClosed,transform:function(e){return toNumeric(e)}},{name:"pl",dataIndex:eClosedDealsSummaries.pl},{name:"plAsNumber",dataIndex:eClosedDealsSummaries.pl,transform:function(e){return toNumeric(e)}},{name:"plCCY",dataIndex:eClosedDealsSummaries.plCCY},{name:"plCCYAsNumber",dataIndex:eClosedDealsSummaries.plCCY,transform:function(e){return toNumeric(e)}},{name:"plSymbol",transform:function(e,t,a,i){var o=m.ExtractSymbolsNames(i[eClosedDealsBase.instrumentID]);return o?o.other:""}},{name:"hasAdditionalPL",transform:function(e,t,a,i){return 0!==Number(i[eClosedDealsSummaries.additionalPL])}},{name:"plSign",dataIndex:eClosedDealsSummaries.pl,transform:function(e){return e.sign()}},{name:"adj",dataIndex:eClosedDealsSummaries.originalPosNum,transform:function(e,t,a,i){return c.prop.dealPermit!=eDealPermit.Islamic&&(!i[eClosedDealsBase.valueDate]||isPos(e))}},{name:"instrumentShortName",transform:function(e,t,a,i){return d.Short(i[eClosedDealsBase.instrumentID])}},{name:"spreadDiscount",dataIndex:eClosedDealsSummaries.spreadDiscount},{name:"commission",dataIndex:eClosedDealsSummaries.commission},{name:"grossPL",transform:function(e,t,a,i){return v.CustomerDealPermit()===eDealPermit.ZeroSpread?(toNumeric(i[eClosedDealsSummaries.pl])+toNumeric(i[eClosedDealsSummaries.commission])).toFixed(2).toString():v.HasSpreadDiscount()?(toNumeric(i[eClosedDealsSummaries.pl])-toNumeric(i[eClosedDealsSummaries.spreadDiscount])).toFixed(2).toString():i[eClosedDealsSummaries.pl]}},{name:"isStock",transform:function(e,t,a,i){var o=i[eClosedDealsBase.instrumentID];return f.IsInstrumentStock(o)}}],statusField:"status",totalField:"totalItems",dataField:"closedDealSummary",pagination:{pagesPerPage:5,pageIndexField:"page",pageSizeField:"pagesize"},Filter:o,DAL:{reference:p.LoadClosedDealsSummariesWithThreshold,callerName:"ClosedDealsViewModel/getLastClosedDeals",errorSeverity:eErrorSeverity.medium}},r=new ObservableDataSet(e,{enabled:!0,sortProperty:"executionTimeNormalized",asc:!1});function n(){o.positionNumber(""),o.instrumentId(Number.MAX_SAFE_INTEGER),o.instrument(),o.from((new Date).AddWeeks(-1).ExtractDateUTC()),o.to((new Date).ExtractDateUTC()),o.page(1),o.pagesize=a.getSettings(t).pageSize||o.pagesize,a.getSettings(t).threshold&&(o.threshold=a.getSettings(t).threshold)}function s(e){var t=e.split(" "),a=t[0].split("/");return t[0]=a[2]+a[1]+a[0],t.join("").replace(/[/\|:| ]/g,"")}function l(e){var t=SplitDateTime(e);return t.date+" "+t.time}return{init:function(e){t=this,a.setSettings(t,e),i.isOpenedInDialog=u.observable(!1),i.ccyPairs=u.observableArray([]),i.isApplyButtonEnabled=u.computed(function(){return!r.IsLoadingData()},t),o.positionNumber=o.positionNumber.extend({toNumericLength:{ranges:[{from:0,to:Number.MAX_SAFE_INTEGER,decimalDigits:0}]}}),n(),r.Init()},DataSet:r,HasRecords:r.HasRecords,ViewData:i,ClosedDeals:r.DataRows,Filter:{Position:o.positionNumber,InstrumentId:o.instrumentId,Instrument:o.instrument,From:o.from,To:o.to},ApplyFilter:function(e){i.isApplyButtonEnabled()&&(e&&n(),r.ApplyFilter())},DsColumns:e,SetSorting:r.SetSorting,SortProperties:r.SortProperties,DealPermissions:v}};return a.init(t),a}),define("viewModels/Deals/CloseDealBaseViewModel",["require","knockout","KoComponentViewModel","closeDealSettings","DealsManager","ViewModelsManager","FxNet/LogicLayer/Deal/DealAmountLabel","BaseOrder","QuotesSubscriber","InstrumentsManager","InstrumentTranslationsManager","StatesManager","Customer","CustomerProfileManager","QuotesManager","StateObject!Transaction","BuilderForInBetweenQuote","FxNet/LogicLayer/Deal/DealPermissions"],function(e){var p=e("knockout"),t=e("KoComponentViewModel"),v=e("closeDealSettings"),f=e("DealsManager"),g=e("ViewModelsManager"),D=e("FxNet/LogicLayer/Deal/DealAmountLabel"),S=e("BaseOrder"),y=e("QuotesSubscriber"),T=e("InstrumentsManager"),w=e("InstrumentTranslationsManager"),h=e("StatesManager"),C=e("Customer"),A=e("CustomerProfileManager"),M=e("QuotesManager"),L=e("StateObject!Transaction"),I=e("BuilderForInBetweenQuote"),P=e("FxNet/LogicLayer/Deal/DealPermissions");return extendClass(t,function(){var a=this,i=this.parent,o=this.Data,r=new S,n=new y,s=new ObservableHashTable("orderID",{enabled:!0,sortProperty:"orderID",asc:!1});function l(){var e=M.Quotes.GetItem(o.selectedInstrument());e&&(o.changePips(e.changePips),o.tradeTime(e.tradeTime),o.close(e.close),o.open(e.open),o.change(Format.toPercent(e.change)),o.highBid(e.highBid),o.lowAsk(e.lowAsk),o.bid(e.bid),o.ask(e.ask),o.quoteIsActive(e.state!==eQuoteStates.NotActive))}function u(e){e&&(function(e){for(var t=0;t<e.length;t++)s.Remove(e[t])}(e.removedItems),function(e){for(var t=0,a=e.length;t<a;t++){var i=m(f.Deals.GetItem(e[t]));i&&s.Update(i.orderID,i)}}(e.editedItems),function(e){for(var t=0,a=e.length;t<a;t++){var i=m(f.Deals.GetItem(e[t]));i&&s.Add(i)}}(e.newItems))}function c(e){var t=P.HasSpreadDiscount()?-toNumeric(e.spreadDiscount):P.CustomerDealPermit()===eDealPermit.ZeroSpread?toNumeric(e.commission):0;return(toNumeric(e.pl)+t).toFixed(2)}function d(e){for(var t=0,a=e.length;t<a;t++){var i=s.Get(e[t]);if(i){var o=f.Deals.GetItem(e[t]);if(o){var r={prevSpotRate:i.spotRate(),spotRate:o.spotRate,spotRateLabel:b(o.spotRate,o.instrumentID),closingRateLabel:b(o.closingRate,o.instrumentID),fwPips:o.fwPips,closingRate:o.closingRate,pl:o.pl,lastUpdate:n.GetQuote(o.instrumentID).time(),commission:o.commission,grosspl:c(o)};s.Update(e[t],r)}}}}function m(e){var t=T.GetInstrument(e.instrumentID),a={positionNumber:e.positionNumber,instrumentID:e.instrumentID||0,orderDir:e.orderDir,dealAmount:e.orderDir==eOrderDir.Sell?e.sellAmount:e.buyAmount,orderID:e.orderID,prevSpotRate:p.observable(e.spotRate),spotRate:p.observable(e.spotRate),closingRate:p.observable(e.closingRate),fwPips:p.observable(e.fwPips),exeTime:p.observable(e.exeTime),valueDate:p.observable(function(e){var t=T.GetInstrument(e.instrumentID);if(t.isShare){var a=t.getCorporateActionDate();if(a)return e.valueDate?{isValueDateEmpty:!1,date:str2Date(e.valueDate,"d/m/y H:M")<str2Date(a,"d/m/y H:M")?e.valueDate:a}:{isValueDateEmpty:!0,date:a}}return e.valueDate?{isValueDateEmpty:!1,date:e.valueDate}:{isValueDateEmpty:!0,date:null}}(e)),pl:p.observable(e.pl),dealRate:e.orderRate,dealRateLabel:b(e.orderRate,e.instrumentID),spotRateLabel:p.observable(b(e.spotRate,e.instrumentID)),closingRateLabel:p.observable(b(e.closingRate,e.instrumentID)),slRate:e.slRate,tpRate:e.tpRate,slRateLabel:b(e.slRate,e.instrumentID),tpRateLabel:b(e.tpRate,e.instrumentID),Instrument:{ccyPairLong:w.Long(e.instrumentID),ccyPair:t.ccyPair,baseSymbol:w.GetTranslatedInstrumentById(e.instrumentID).baseSymbolName,dealAmountLbl:D.Translate(t).label,amountSymbol:t.otherSymbol,isFuture:t.isFuture,isShare:t.isShare,isStock:t.isStock,baseSymbolId:t.baseSymbol,otherSymbolId:t.otherSymbol}};return a.commission=p.observable(isStringType(e.commission)?e.commission:Number.toStr(e.commission)),a.spreadDiscount=p.observable(isStringType(e.spreadDiscount)?e.spreadDiscount:Number.toStr(e.spreadDiscount)),a.grosspl=p.observable(c(e)),a.hasAdditionalPL=p.observable(0!==Number(e.additionalPL)),a.adj=p.computed(function(){return C.prop.dealPermit!=eDealPermit.Islamic&&(0===e.valueDate.length||e.positionNumber!=e.orderID)}),a.isProfit=p.computed(function(){return 0<=toNumeric(this.pl())},a),a.isLoss=p.computed(function(){return toNumeric(this.pl())<0},a),a.isUp=p.computed(function(){return this.spotRate()>this.prevSpotRate()},a),a.isDown=p.computed(function(){return this.spotRate()<this.prevSpotRate()},a),a}function b(e,t){var a={First:0,Middle:0,Last:0},i=Format.tenthOfPipSplitRate(e,t);return a.First=i.button.first,a.Middle=i.button.middle,a.Last=i.button.last,a}return{init:function(e){var t;i.init.call(a,e),r.Init({},o),o.PageName=eDealPage.CloseDeal,o.orderID=p.observable(""),o.selectedInstrument=L.set("selectedInstrument",p.observable("")),o.ccyPairLong=p.observable(""),o.orderDir=L.set("orderDir",p.observable(eOrderDir.None)),o.ccyPair=L.set("ccyPair",p.observable("")),o.customerSymbolName=L.set("customerSymbolName",p.observable("")),o.customerSymbolId=p.observable(C.prop.baseCcyId()),o.selectedCcyId=p.observable(C.prop.selectedCcyId()),o.changePips=p.observable(""),o.selectedDealAmount=L.set("selectedDealAmount",p.observable("")),o.quoteForOtherCcyToAccountCcy=L.set("quoteForOtherCcyToAccountCcy",p.observable("")),o.amountSymbol=L.set("amountSymbol",p.observable("")),o.baseSymbol=L.set("baseSymbol",p.observable("")),o.bidPips=p.observable(""),o.askPips=p.observable(""),o.isFuture=L.set("isFuture",p.observable("")),o.isShare=L.set("isShare",p.observable("")),o.change=L.set("change",p.observable("")),o.tradeTime=L.set("tradeTime",p.observable("")),o.open=L.set("open",p.observable("")),o.close=L.set("close",p.observable("")),o.highBid=L.set("highBid",p.observable("")),o.lowAsk=L.set("lowAsk",p.observable("")),o.isProcessing=p.observable(!1),o.isCollapsed=p.observable(!1),o.SelectedPosition=p.observable(""),o.profileKeyForDefaultTab=p.observable(v.profileKeyForDefaultTab),o.initialToolTab=L.set("initialToolTab",p.observable("")),o.selectedCcyName=p.observable(C.prop.selectedCcyName()),o.bid=L.set("bid",p.observable("")),o.ask=L.set("ask",p.observable("")),o.slRate=p.observable("").extend({dirty:!1}),o.tpRate=p.observable("").extend({dirty:!1}),o.quoteIsActive=L.set("isActiveQuote",p.observable(!1)),o.customerSymbolName(C.prop.baseCcyName()),o.initialToolTab(A.ProfileCustomer()[v.profileKeyForDefaultTab]||eNewDealTool.Chart),o.HasPosition=a.createComputed(function(){var e=p.utils.unwrapObservable(o.SelectedPosition);return!isEmptyValue(e)}),o.CloseDealReady=a.createComputed(function(){var e=!o.isProcessing(),t=!!isDefinedType(h.States.IsMarketClosed())&&h.States.IsMarketClosed(),a=o.quoteIsActive()&&!t&&e&&o.HasPosition();return a}),a.subscribeTo(o.SelectedPosition,function(e){e&&(o.selectedInstrument(e.instrumentID),o.ccyPairLong(e.Instrument.ccyPairLong),o.ccyPair(e.Instrument.ccyPair),o.selectedDealAmount(e.dealAmount),o.amountSymbol(e.Instrument.amountSymbol),o.baseSymbol(e.Instrument.baseSymbolId),o.isFuture(e.Instrument.isFuture),o.isShare(e.Instrument.isShare),o.orderDir(e.orderDir),o.slRate(e.slRate),o.tpRate(e.tpRate),l())}),a.subscribeTo(o.selectedInstrument,function(e){var t=T.GetInstrument(e);t&&I.GetInBetweenQuote(t.otherSymbol,C.prop.baseCcyId()).then(function(e){o.quoteForOtherCcyToAccountCcy(e)}).done()}),f.OnDealsChange.Add(u),f.OnDealsPLChange.Add(d),M.OnChange.Add(l),o.isProcessing(!1),o.SelectedPosition(""),f.Deals.ForEach(function(e,t){var a=m(t);s.Add(a)}),(t=g.VManager.GetViewArgsByKeyName(eViewTypes.vCloseDeal,"orderId"))&&(o.SelectedPosition(s.Get(t)),o.orderID(t)),L.update("stopLossRate",p.observable(o.SelectedPosition().slRate)),L.update("takeProfitRate",p.observable(o.SelectedPosition().tpRate)),L.update("dealRate",o.SelectedPosition().dealRate),L.update("chart",v.chart),L.update("currentRateDirectionSwitch",v.currentRateDirectionSwitch),n.Start()},Data:o,ChangeSelectedPosition:function(){o.SelectedPosition(s.Values()[0])},OpenDeals:s.Values,BaseOrder:r,DealPermissions:P,dispose:function(){L.unset("stopLossRate"),L.unset("takeProfitRate"),L.unset("dealRate"),L.unset("chart"),f.OnDealsPLChange.Remove(d),f.OnDealsChange.Remove(u),M.OnChange.Remove(l),s.Clear(),n.Stop(),L.unset("cachedOvernightFinancing"),L.unset("currentRateDirectionSwitch"),i.dispose.call(a)}}})}),define("viewModels/Deals/DealBaseViewModel",["require","knockout","KoComponentViewModel","newDealSettings","Customer","BaseOrder","SetLimitsViewModel","dalOrders","RegistrationManager","QuotesManager","InstrumentsManager","CustomerProfileManager","ViewsManager","FxNet/LogicLayer/Deal/DealAmountLabel","SymbolsManager","DealTypeManager","StateObject!Transaction","BuilderForInBetweenQuote","PortfolioStaticManager","AlertsManager"],function(e){var v=e("knockout"),t=e("KoComponentViewModel"),f=e("newDealSettings"),g=e("Customer"),D=e("BaseOrder"),S=e("SetLimitsViewModel"),y=e("dalOrders"),T=e("RegistrationManager"),w=e("QuotesManager"),h=e("InstrumentsManager"),C=e("CustomerProfileManager"),A=e("ViewsManager"),M=e("FxNet/LogicLayer/Deal/DealAmountLabel"),L=e("SymbolsManager"),I=e("DealTypeManager"),P=e("StateObject!Transaction"),V=e("BuilderForInBetweenQuote"),R=e("PortfolioStaticManager"),F=e("AlertsManager");return extendClass(t,function(){var s=this,n=this.parent,l=this.Data,u=new D,c=47,d=new S;function m(){var e=A.GetActiveFormViewProperties(eViewTypes.vTransactionSwitcher);return!(!e||!e.visible())&&(e.args||{})}function b(e){e!=eOrderDir.Buy&&e!=eOrderDir.Sell&&e!=eOrderDir.None&&(e=eOrderDir.None),l.orderDir(e)}function e(){w.OnChange.Remove(p),R.OnChange.Remove(t)}function t(){l.pendingBonusType(R.Portfolio.pendingBonusType)}function p(){l.activeQuote=w.Quotes.GetItem(l.selectedInstrument()),l.activeQuote&&(l.isActiveQuote(l.activeQuote.state!=eQuoteStates.NotActive),l.bid(l.activeQuote.bid),l.ask(l.activeQuote.ask),l.open(l.activeQuote.open),l.close(l.activeQuote.close),l.change(Format.toPercent(l.activeQuote.change)),l.formattedChange(Format.toSignedPercent(l.activeQuote.change,"")),l.changePips(l.activeQuote.changePips),l.highBid(l.activeQuote.highBid),l.lowAsk(l.activeQuote.lowAsk),l.tradeTime(l.activeQuote.tradeTime),l.activeQuoteState(l.activeQuote.state),l.quotesAvailable(!0))}function a(){var e=new TDeal;if(e.dealType=I.GetStatus(),e.instrumentID=l.selectedInstrument(),e.amount=l.selectedDealAmount(),e.marketRate=l.orderDir()===eOrderDir.Sell?l.activeQuote.bid:l.activeQuote.ask,e.otherRateSeen=l.orderDir()===eOrderDir.Sell?l.activeQuote.ask:l.activeQuote.bid,e.orderDir=l.orderDir(),e.slRate=0,e.tpRate=0,l.enableSLLimit()){if(""===d.Data.stopLossRate())return r();e.slRate=d.Data.stopLossRate()}if(l.enableTPLimit()){if(""===d.Data.takeProfitRate())return r();e.tpRate=d.Data.takeProfitRate()}l.hasInstrument(!1),l.isProcessing(!0),y.OpenDeal(e,i)}function i(e,t,a,i){l.hasInstrument(!0),l.isProcessing(!1);var o,r=h.GetInstrument(a),n=s.getSettings().onSuccessRedirectTo;r&&(u.ResultStatusSuccess(e)&&(h.SetInstrumentDealAmount(a,i.amount),v.postbox.publish("deal-slip-success",{instrument:l.ccyPair()}),(o=C.ProfileCustomer()).defaultSlLimitTab=d.Data.curSlActiveTab(),o.defaultTpLimitTab=d.Data.curTpActiveTab(),C.ProfileCustomer(o),d.Data.stopLossRate(String.empty),d.Data.takeProfitRate(String.empty),l.enableSLLimit(!1),l.enableTPLimit(!1),b(eOrderDir.None)),n?u.OnActionReturn(e,t,r,{redirectToView:n,requestData:i}):u.OnActionReturn(e,t,r,{requestData:i}),u.RaiseErrorEvent(e,"deal-slip-error-details",{}))}function o(){l.enableSLLimit(!1),l.enableTPLimit(!1),a()}function r(){F.UpdateAlert(AlertTypes.GeneralOkAlert,Dictionary.GetItem("pleaseNoteTitle"),Dictionary.GetItem("sltpValidationMsg","deals_NewDeal"),null,{okButtonCallback:o}),F.PopAlert(AlertTypes.GeneralOkAlert)}return{init:function(e){n.init.call(s,e),u.Init({},l),l.PageName=eDealPage.NewDeal,l.ready=v.observable(!1),l.customerSymbolName=P.set("customerSymbolName",v.observable(g.prop.baseCcyName())),l.customerSymbolId=P.set("customerSymbolId",v.observable(g.prop.baseCcyId())),l.orderDir=P.set("orderDir",v.observable(eOrderDir.None).extend({dirty:!1})),l.selectedInstrument=P.set("selectedInstrument",v.observable()),l.selectedDealAmount=P.set("selectedDealAmount",v.observable()),l.selectedDealAmount.extend({notify:"always"}),l.selectedDealAmount.extend({amountValidation:[]}),l.amountSymbol=P.set("amountSymbol",v.observable("")),l.quoteForOtherCcyToAccountCcy=P.get("quoteForOtherCcyToAccountCcy"),l.quoteForBaseCcyToAccountCcy=P.get("quoteForBaseCcyToAccountCcy"),l.quoteForUsdCcyToAccountCcy=P.get("quoteForUsdCcyToAccountCcy"),l.bid=P.set("bid",v.observable("")),l.ask=P.set("ask",v.observable("")),l.initialToolTab=P.set("initialToolTab",v.observable("")),l.showTools=P.set("showTools",v.observable(!0)),l.bidPips=P.set("bidPips",v.observable("")),l.askPips=P.set("askPips",v.observable("")),l.changePips=P.set("changePips",v.observable("")),l.tradeTime=P.set("tradeTime",v.observable("")),l.highBid=P.set("highBid",v.observable("")),l.lowAsk=P.set("lowAsk",v.observable("")),l.open=P.set("open",v.observable("")),l.close=P.set("close",v.observable("")),l.change=P.set("change",v.observable("")),l.isForex=P.set("isForex",v.observable(!1)),l.isFuture=P.set("isFuture",v.observable(!1)),l.isShare=P.set("isShare",v.observable(!1)),l.isStock=P.set("isStock",v.observable(!1)),l.isNonForex=v.observable(!0),l.hasInstrument=v.observable(!1),l.baseSymbolName=v.observable(""),l.otherSymbolName=v.observable(""),l.dealAmountLabel=v.observable(""),l.dealMinMaxAmounts=v.observableArray([]),l.originalSymbolName=v.observable(""),l.baseSymbol=v.observable(""),l.ccyPair=P.set("ccyPair",v.observable("")),l.quotesAvailable=v.observable(!1),l.isProcessing=v.observable(!1),l.limitsReady=v.observable(!1),l.activeQuote=null,l.isActiveQuote=P.set("isActiveQuote",v.observable(!1)),l.activeQuoteState=v.observable(),l.formattedChange=v.observable(""),l.bid10K=v.observable(""),l.bid100K=v.observable(""),l.ask10K=v.observable(""),l.ask100K=v.observable(""),l.bidLabel={First:v.observable(""),Middle:v.observable(""),Last:v.observable("")},l.askLabel={First:v.observable(""),Middle:v.observable(""),Last:v.observable("")},l.profileKeyForDefaultTab=P.set("profileKeyForDefaultTab",v.observable(f.profileKeyForDefaultTab)),l.enableSLLimit=v.observable(!1),l.enableTPLimit=v.observable(!1),l.isSlRateActiveTab=v.observable(!1),l.isSlAmountActiveTab=v.observable(!1),l.isSlPercentActiveTab=v.observable(!1),l.isTpRateActiveTab=v.observable(!1),l.isTpAmountActiveTab=v.observable(!1),l.isTpPercentActiveTab=v.observable(!1),l.displaySlPercentSymbol=v.observable(!1),l.displayTpPercentSymbol=v.observable(!1),l.displaySlAmountCcySymbol=v.observable(!1),l.displayTpAmountCcySymbol=v.observable(!1),l.quoteForAccountCcyToUSDCcy=v.observable(""),l.quoteForBaseCcyToUSDCcy=v.observable(""),l.quoteForAccountCcyToOtherCcy=v.observable(""),l.buyBtnClick=function(){b(eOrderDir.Buy)},l.sellBtnClick=function(){b(eOrderDir.Sell)},s.subscribeAndNotify(l.ask,function(e){var t=Format.tenthOfPipSplitRate(e,l.selectedInstrument());l.askLabel.First(t.button.first),l.askLabel.Middle(t.button.middle),l.askLabel.Last(t.button.last)}),s.subscribeAndNotify(l.bid,function(e){var t=Format.tenthOfPipSplitRate(e,l.selectedInstrument());l.bidLabel.First(t.button.first),l.bidLabel.Middle(t.button.middle),l.bidLabel.Last(t.button.last)}),s.subscribeChanged(l.selectedInstrument,function(e,t){t&&e!==t&&(l.selectedDealAmount(""),P.containsKey("skipReset")&&P.get("skipReset")||l.orderDir(eOrderDir.None))}),s.subscribeTo(l.baseSymbol,function(e){var t;t=e,V.GetInBetweenQuote(g.prop.baseCcyId(),c).then(function(e){l.quoteForAccountCcyToUSDCcy(e)}).done(),V.GetInBetweenQuote(t,c).then(function(e){l.quoteForBaseCcyToUSDCcy(e)}).done()}),s.subscribeTo(l.selectedInstrument,function(e){var t,a,i,s=h.GetInstrument(e);if(s){l.quotesAvailable(!1),l.dealMinMaxAmounts([]),P.containsKey("skipReset")&&P.get("skipReset")||(l.enableSLLimit(!1),l.enableTPLimit(!1)),h.GetUpdatedInstrumentWithDealMinMaxAmounts(e).then(function(e){var t,a,i,o,r=s.isStock&&e.dealMinMaxAmounts&&1<e.dealMinMaxAmounts.length?(o=e.dealMinMaxAmounts,[Math.ceil(o[0]),Math.floor(o[1])]):e.dealMinMaxAmounts,n=s.isStock&&r&&1<r.length?(t=e.defaultDealSize,a=r,(i=Math.ceil(t))<a[1]?i:Math.floor(t)):e.defaultDealSize;l.dealMinMaxAmounts(r),l.selectedDealAmount.extend({amountValidation:r}),l.selectedDealAmount(l.selectedDealAmount()||n)}).done(),l.amountSymbol(s.otherSymbol),l.baseSymbolName(L.GetTranslatedSymbolById(s.baseSymbol)),l.otherSymbolName(L.GetTranslatedSymbolById(s.otherSymbol)),l.originalSymbolName(s.baseSymbolName),l.baseSymbol(s.baseSymbol),l.ccyPair(s.ccyPair),l.isNonForex(s.instrumentTypeId!==eInstrumentType.Currencies),l.isForex(s.isForex),l.isShare(s.isShare),l.isFuture(s.isFuture),l.isStock(s.isStock),i=e,T.Update(eRegistrationListName.SingleQuote,i);var o=M.Translate(s);l.dealAmountLabel(o.label),I.Init(),s.isFuture?I.ConsumeEvent("future"):s.isShare?I.ConsumeEvent("share"):I.ConsumeEvent(),l.pendingBonusType=v.observable(R.Portfolio.pendingBonusType),l.spreadDiscount=v.observable(R.Portfolio.spreadDiscountVolumePercentage),p(),V.GetInBetweenQuote(g.prop.baseCcyId(),s.otherSymbol).then(function(e){l.quoteForAccountCcyToOtherCcy(e)}).done(),l.hasInstrument(!0),t=e,a=m(),isNullOrUndefined(a)||!1===a||(a.instrumentId=t,A.ChangeViewState(eViewTypes.vTransactionSwitcher,eViewState.Update,a))}else l.hasInstrument(!1)}),l.isShowBuyBox=s.createComputed(function(){return l.orderDir()===eOrderDir.Buy}),l.isShowSellBox=s.createComputed(function(){return l.orderDir()===eOrderDir.Sell}),l.ViewModelReady=s.createComputed(function(){if(l.ready())return!0;var e=l.hasInstrument(),t=l.limitsReady(),a=e&&t;return l.ready(a),a}),l.isUp=v.pureComputed(function(){return l.activeQuoteState()===eQuoteStates.Up}),l.isDown=v.pureComputed(function(){return l.activeQuoteState()===eQuoteStates.Down});var t=s.getSettings().setlimitsConfiguration;d.Init(l,t),a=m()||{},i=a.tab,o=l.selectedInstrument(),r=a.instrumentId||l.selectedInstrument()||h.GetUserDefaultInstrumentId(),l.selectedInstrument(r),o===r&&l.selectedInstrument.notifySubscribers(r),isInt(a.orderDir)&&b(a.orderDir),a.selectedDealAmount&&l.selectedDealAmount(a.selectedDealAmount),l.initialToolTab(isDefinedType(i)&&isDefinedType(eNewDealTool[i])?eNewDealTool[i]:C.ProfileCustomer()[f.profileKeyForDefaultTab]||eNewDealTool.Chart);var a,i,o,r},dispose:function(){e(),l.selectedDealAmount.extend({amountValidation:!1}),P.unset("cachedOvernightFinancing"),n.dispose.call(s)},Data:l,BaseOrder:u,SetLimitsModel:d,openDeal:a,unRegisterFromDispatcher:e,registerToDispatcher:function(){w.OnChange.Add(p),R.OnChange.Add(t)},setLimitTabsFromClientProfile:function(){var e=C.ProfileCustomer();e.defaultSlLimitTab?d.SetSlActiveTab(e.defaultSlLimitTab):d.SetSlActiveTab(eSetLimitsTabs.Amount),e.defaultTpLimitTab?d.SetTpActiveTab(e.defaultTpLimitTab):d.SetTpActiveTab(eSetLimitsTabs.Amount)}}})}),define("viewModels/Deals/ConvertedAmountViewModel",["require","knockout","KoComponentViewModel","FxNet/LogicLayer/Deal/DealMarginCalculator","Customer"],function(e){var s=e("knockout"),t=e("KoComponentViewModel"),l=e("FxNet/LogicLayer/Deal/DealMarginCalculator"),u=e("Customer"),a=extendClass(t,function(e){var t=this,a=this.parent,i=this.Data,o=e||{},r=function(){var e=s.utils.unwrapObservable(o.customerSymbolName);i.currencySymbol=s.observable(e),i.customerSymbolId=s.observable(u.prop.baseCcyId())},n=function(){i.convertedDealAmount=t.createComputed(function(){var e={dealAmount:toNumeric(o.selectedDealAmount()),dealRate:toNumeric(o.orderDir()==eOrderDir.Sell?o.bid():o.ask()),quoteForOtherCcyToAccountCcy:o.quoteForOtherCcyToAccountCcy(),otherSymbol:o.amountSymbol(),baseSymbol:o.hasOwnProperty("baseSymbol")?o.baseSymbol():o.baseSymbolId()};return l.DealAmount(e)}).extend({empty:!0}),i.isCompleted=t.createComputed(function(){return!i.convertedDealAmount.isEmpty()}),i.isBaseEqualWithCustomerCcy=t.createComputed(function(){return o.hasOwnProperty("baseSymbol")?o.baseSymbol()===u.prop.baseCcyId():o.baseSymbolId()===u.prop.baseCcyId()})};return{init:function(e){a.init.call(t,e),r(),n()},dispose:function(){a.dispose.call(t)}}});return{viewModel:{createViewModel:function(e){var t=new a(e);return t.init(),t}}}}),define("viewModels/Deals/DealMarginViewModel",["require","knockout","KoComponentViewModel","FxNet/LogicLayer/Deal/DealMarginCalculator","InstrumentVolumeManager","dalOrders","ClientStateHolderManager","Customer","PortfolioStaticManager","LoadDictionaryContent!deals_RequireMargin"],function(e){var l=e("knockout"),t=e("KoComponentViewModel"),p=e("FxNet/LogicLayer/Deal/DealMarginCalculator"),v=e("InstrumentVolumeManager"),u=e("dalOrders"),c=e("ClientStateHolderManager"),d=e("Customer"),f=e("PortfolioStaticManager"),a=extendClass(t,function(e,t){var a=this,i=this.parent,m=this.Data,b=e||{},o=function(){m.triggerDealMarginCalculation=l.observable().extend({notify:"always"}),m.requiredMarginPercentage=l.observable(""),m.displayDealMargin=l.observable(""),m.prevInstrumentId=l.observable("");var e=l.utils.unwrapObservable(b.customerSymbolName);m.currencySymbol=l.observable(e),m.customerSymbolId=l.observable(d.prop.baseCcyId()),m.isDealMarginHigher=l.observable(!1),m.spreadWorth=l.observable(),m.availableMargin=l.observable()},r=function(){m.dealMargin=a.createComputed(function(){var e,t=0,a=0,i=b.selectedInstrument(),o=v.InstrumentVolumes.GetItem(i),r=b.orderDir(),n=b.openLimit&&b.openLimit(),s=!1;o&&(t=o.OtherSymbolAmount,a=o.BaseSymbolAmount,s=!0),s||r!=eOrderDir.None||(r=eOrderDir.Buy),e=n?b.openLimit()<b.bid()?Format.toMidRate(b.bid(),b.ask()):b.openLimit():r==eOrderDir.Sell?b.bid():b.ask();var l={orderDir:r,dealAmount:toNumeric(b.selectedDealAmount()),dealRate:toNumeric(e),ask:toNumeric(b.ask()),bid:toNumeric(b.bid()),quoteForBaseCcyToAccountCcy:b.quoteForBaseCcyToAccountCcy(),quoteForOtherCcyToAccountCcy:b.quoteForOtherCcyToAccountCcy(),otherSymbol:b.amountSymbol(),baseSymbol:b.baseSymbol(),hasPosition:s,otherSymbolAmount:t,baseSymbolAmount:a,requiredMarginPercentage:s?toNumeric(m.requiredMarginPercentage())/100:toNumeric(m.requiredMarginPercentage())};m.triggerDealMarginCalculation();var u=p.SpreadWorthInAcountCCY(l);m.spreadWorth(u);var c=p.DealMargin(l),d=Math.round(100*(c+u))/100;return d=Math.abs(d),m.displayDealMargin(d),c}).extend({empty:!0}),m.isDealMarginPositive=a.createComputed(function(){var e=toNumeric(m.dealMargin()),t=b&&b.isStock&&b.isStock()?toNumeric(f.Portfolio.tradingBonus):0;return 0<e||e<=0&&Math.abs(e)<m.spreadWorth()?(m.displayDealMargin()>=m.availableMargin()-t?m.isDealMarginHigher(!0):m.isDealMarginHigher(!1),!0):(m.isDealMarginHigher(!1),!1)}),m.isCompleted=a.createComputed(function(){return!m.dealMargin.isEmpty()&&!isNaN(m.dealMargin())}),m.selectedInstrumentId=a.createComputed(function(){return b.selectedInstrument()}),m.isBaseEqualWithCustomerCcy=a.createComputed(function(){return b.baseSymbol()===d.prop.baseCcyId()})},n=function(){a.subscribeAndNotify(m.selectedInstrumentId,function(e){var t=v.InstrumentVolumes.GetItem(e);t?m.requiredMarginPercentage(t.RequiredMarginPercentage):m.prevInstrumentId()!=e&&u.GetDealMarginDetails(b.selectedInstrument()).then(function(e){m.requiredMarginPercentage(e[0].Result.MarginPercentage)}).done(),m.prevInstrumentId(e)}),a.addDisposable(l.postbox.subscribe("deal-slip-error-details",function(e){"OrderError12"==e.reason&&m.triggerDealMarginCalculation(!0)}))};function s(){var e=c.CSHolder,t=toNumeric(e.availableMargin);if(d.prop.baseCcyId()==d.prop.selectedCcyId())m.availableMargin(t);else{var a=p.Convert(t,b.quoteForUsdCcyToAccountCcy());m.availableMargin(a)}}return{init:function(e){i.init.call(a,e),o(),r(),n(),c.OnChange.Add(s),s()},content:t,dispose:function(){c.OnChange.Remove(s),i.dispose.call(a)}}});return{viewModel:{createViewModel:function(e){var t=new a(e.data,e.content);return t.init(),t}}}}),define("viewModels/Deals/DealToolsBaseViewModel",["require","knockout","KoComponentViewModel","CustomerProfileManager","StateObject!Transaction"],function(e){var u=e("knockout"),t=e("KoComponentViewModel"),c=e("CustomerProfileManager"),d=e("StateObject!Transaction"),a=extendClass(t,function(){var a,i=this,e=this.parent,o=this.Data,r={},n={},s=[];function l(e){var t;n=extendType(n,d.getAll()),(t=n).orderDir=n.orderDir||t.orderDir,function(e){var t=c.ProfileCustomer();t?(a=t.defaultTab,o.showTools(1===t.tools)):a=n.initialToolTab?n.initialToolTab():eNewDealTool.None;e.transArgs&&(e.transArgs.transactionType===eTransactionSwitcher.NewPriceAlert?o.isVisible(!1):e.transArgs.tab&&e.transArgs.tab===eNewDealTool.Signals&&(a=eNewDealTool.Signals,o.showTools(!0)));o.selectedToolTab=u.observable(a)}(e),o.isChartToolVisible=i.createComputed(function(){return o.selectedToolTab()==eNewDealTool.Chart&&o.showTools()}),o.isMarketInfoToolVisible=i.createComputed(function(){return o.selectedToolTab()==eNewDealTool.MarketLiveInfo&&o.showTools()}),o.isCalendarToolVisible=i.createComputed(function(){return o.selectedToolTab()==eNewDealTool.EconomicCalendar&&o.showTools()}),o.isSignalsToolVisible=i.createComputed(function(){return o.selectedToolTab()==eNewDealTool.Signals&&o.showTools()}),o.isInstrumentInfoToolVisible=i.createComputed(function(){return o.selectedToolTab()==eNewDealTool.InstrumentInfo&&o.showTools()}),o.tabName=i.createComputed(function(){return getKeyByValue(eNewDealTool,o.selectedToolTab())}),i.subscribeTo(o.selectedToolTab,function(e){var t=c.ProfileCustomer(),a=isNullOrUndefined(n.profileKeyForDefaultTab)?"defaultTab":n.profileKeyForDefaultTab();t[a]=e,c.ProfileCustomer(t)}),r.chartBtnClick=function(){o.selectedToolTab(eNewDealTool.Chart)},r.marketInfoBtnClick=function(){o.selectedToolTab(eNewDealTool.MarketLiveInfo)},r.calendarBtnClick=function(){o.selectedToolTab(eNewDealTool.EconomicCalendar)},r.signalsBtnClick=function(){o.selectedToolTab(eNewDealTool.Signals)},r.instrumentInfoBtnClick=function(){o.selectedToolTab(eNewDealTool.InstrumentInfo)},r.toggleToolsClick=function(){o.showTools(!o.showTools())},o.isDataLoaded(!0)}return{init:function(t){e.init.call(i,t),o.isDataLoaded=u.observable(!1),o.showTools=d.set("showTools",u.observable(!1)),o.showChartSignals=d.set("showChartSignals",!1),o.selectedInstrument=u.observable(0),o.isVisible=u.observable(!0),d.set(eStateObjectTopics.ReadyForUse,!1)?l(t):s.push({unsubscribe:d.subscribe(eStateObjectTopics.ReadyForUse,function(e){e&&l(t)})})},dispose:function(){for(r.chartBtnClick=null,r.marketInfoBtnClick=null,r.calendarBtnClick=null,r.signalsBtnClick=null,r.instrumentInfoBtnClick=null,r.toggleToolsClick=null,d.unset("showChartSignals");0<s.length;)s.pop().unsubscribe();e.dispose.call(i)},Handlers:r,DealData:n}});return{viewModel:{createViewModel:function(e){var t=new a;return t.init(e),t}},DealToolsViewModel:a}}),define("viewModels/Deals/EditClosingLimitBaseViewModel",["require","knockout","KoComponentViewModel","editClosingLimitSettings","ExpirationDateModel","dalOrders","DealsManager","ViewModelsManager","FxNet/LogicLayer/Deal/DealAmountLabel","SymbolsManager","QuotesManager","BaseOrder","SetLimitsViewModel","Customer","CustomerProfileManager","InstrumentsManager","ActiveLimitsManager","StatesManager","InstrumentTranslationsManager","StateObject!Transaction","BuilderForInBetweenQuote"],function(e){var C=e("knockout"),t=e("KoComponentViewModel"),A=e("editClosingLimitSettings"),M=e("ExpirationDateModel"),L=e("dalOrders"),I=e("DealsManager"),P=e("ViewModelsManager"),V=e("FxNet/LogicLayer/Deal/DealAmountLabel"),R=e("SymbolsManager"),F=e("QuotesManager"),k=e("BaseOrder"),x=e("SetLimitsViewModel"),N=e("Customer"),O=e("CustomerProfileManager"),E=e("InstrumentsManager"),G=e("ActiveLimitsManager"),B=e("InstrumentTranslationsManager"),U=e("StateObject!Transaction"),q=e("StatesManager"),H=e("BuilderForInBetweenQuote");return extendClass(t,function(){var s,t=this,a=this.parent,l=this.Data,e=null,u=new x,c=new k,d=new M,i="OrderError7",r="OrderError8";function m(e){l.profitLoss(e),l.isProfit(0<=toNumeric(e))}function b(e){var t=Format.tenthOfPipSplitRate(e.spotRate,e.instrumentID);l.spotRateLabel.First(t.button.first),l.spotRateLabel.Middle(t.button.middle),l.spotRateLabel.Last(t.button.last)}function p(e){var t=Format.tenthOfPipSplitRate(e.closingRate,e.instrumentID);l.closingRateLabel.First(t.button.first),l.closingRateLabel.Middle(t.button.middle),l.closingRateLabel.Last(t.button.last)}var v=debounce(function(){(e=F.Quotes.GetItem(l.selectedInstrument()))&&(l.isActiveQuote(e.state!==eQuoteStates.NotActive),l.prevBid(l.bid()),l.prevAsk(l.ask()),l.bid(e.bid),l.ask(e.ask),l.open(e.open),l.close(e.close),l.change(Format.toPercent(e.change)),l.changePips(e.changePips),l.highBid(e.highBid),l.lowAsk(e.lowAsk),l.tradeTime(e.tradeTime),l.quotesAvailable(!0))});function o(e){var t=I.Deals.GetItem(e.editedItems[0]);t&&(l.slRate(t.slRate),l.tpRate(t.tpRate),l.slRate.markClean(),l.tpRate.markClean())}function n(e){if(0<=e.indexOf(s)){var t=I.Deals.GetItem(s);t&&(b(t),m(t.pl),p(t))}}var f=debounce(function(){var e=I.Deals.GetItem(s);if(1==q.States.fxDenied())return c.ValidateOnlineTradingUser(),!1;if(isNullOrUndefined(e))T(r);else{if(A.showValidationTooltips&&(l.limitType()===eLimitType.StopLoss?u.ValidateSlRate():u.ValidateTpRate()).length)return C.postbox.publish("edit-deal-limit-show-validation-tooltips"),!1;var t=y();!isNullOrUndefined(t)&&0<t.length&&(l.isProcessing(!0),L.SaveLimits(t,h))}},300,!0);function g(e,t){return{instrumentID:l.selectedInstrument(),positionNumber:l.positionNumber(),amount:0,orderDir:l.orderDir()===eOrderDir.Sell?eOrderDir.Buy:eOrderDir.Sell,limitRate:t,ifDoneSLRate:0,ifDoneTPRate:0,expirationDate:w(),type:e,mode:eLimitMode.CloseDeal,action:eOrderActionType.NewLimit}}function D(e,t){var a=G.limits.GetItem(e);if(!isNullOrUndefined(a))return a.limitRate=t,a.expirationDate=w(),a.ifDoneSLRate=0,a.ifDoneTPRate=0,a.amount=0,a.action=eOrderActionType.EditLimit,a;T(i)}function S(e){var t=G.limits.GetItem(e);if(!isNullOrUndefined(t))return t.action=eOrderActionType.DeleteLimit,t;T(i)}function y(){var e,t,a=[],i=I.Deals.GetItem(s),o=d.Data.isExpirationDateDirty();if(!isNullOrUndefined(i))return""!=i.slID&&0!=i.slID||!u.Data.stopLossRate.isDirty()?(u.Data.stopLossRate.isDirty()||o&&l.limitType()===eLimitType.StopLoss)&&""!=u.Data.stopLossRate()?e=D(i.slID,u.Data.stopLossRate()):""!=i.slID&&0!=i.slID&&u.Data.stopLossRate.isDirty()&&(e=S(i.slID)):e=g(eLimitType.StopLoss,u.Data.stopLossRate()),""!=i.tpID&&0!=i.tpID||!u.Data.takeProfitRate.isDirty()?(u.Data.takeProfitRate.isDirty()||o&&l.limitType()===eLimitType.TakeProfit)&&""!=u.Data.takeProfitRate()?t=D(i.tpID,u.Data.takeProfitRate()):""!=i.tpID&&0!=i.tpID&&u.Data.takeProfitRate.isDirty()&&(t=S(i.tpID)):t=g(eLimitType.TakeProfit,u.Data.takeProfitRate()),e&&a.push(e),t&&a.push(t),a;T(r)}function T(e){AlertsManager.UpdateAlert(AlertTypes.ServerResponseAlert,null,Dictionary.GetItem(e),null,{redirectToView:eForms.OpenDeals}),AlertsManager.PopAlert(AlertTypes.ServerResponseAlert)}function w(){var e=null;if(!d.Data.expirationDateSelector.IsGoodTillCancelChecked()){e=d.Data.expirationDate();var t=d.Data.selectedHoursValue();isObjectType(t)&&isEmptyType(t)?e+="  "+t.value:isStringType(t)&&!isEmptyType(t)?e+="  "+t:e+="  00:00"}return e}function h(e,t,a,i){var o=I.Deals.GetItem(s);if(o){var r=E.GetInstrument(o.instrumentID);if(r){l.isProcessing(!1);var n={};A.redirectToOpenDeals&&(n.redirectToView=eForms.OpenDeals),"valueDate"in o&&(n.valueDate=o.valueDate),c.OnActionReturn(e,t,r,extendType(n,{requestData:i}))}}}return{init:function(e){a.init.call(t,e),c.Init({},l),d.Init(),l.PageName=eDealPage.EditClosingLimit,l.dealRate="",l.dealRateLabel={First:C.observable(""),Middle:C.observable(""),Last:C.observable("")},l.spotRateLabel={First:C.observable(""),Middle:C.observable(""),Last:C.observable("")},l.closingRateLabel={First:C.observable(""),Middle:C.observable(""),Last:C.observable("")},l.orderID=C.observable(""),l.exeTime=C.observable(""),l.positionNumber=C.observable(""),l.ccyPairLong=C.observable(""),l.selectedDealAmount=U.set("selectedDealAmount",C.observable("")),l.selectedDeal=C.observable(null),l.dealAmountLabel=C.observable(""),l.isNonForex=C.observable(!0),l.baseSymbolName=C.observable(""),l.baseSymbolId=C.observable(""),l.otherSymbolId=C.observable(""),l.isActiveQuote=U.set("isActiveQuote",C.observable(!1)),l.quoteForOtherCcyToAccountCcy=U.set("quoteForOtherCcyToAccountCcy",C.observable("")),l.quoteForAccountCcyToOtherCcy=C.observable(""),l.quotesAvailable=C.observable(!1),l.isProcessing=C.observable(!1),l.limitsReady=C.observable(!1),l.customerSymbolId=C.observable(N.prop.baseCcyId()),l.customerSymbolName=U.set("customerSymbolName",C.observable("")),l.selectedCcyName=C.observable(N.prop.selectedCcyName()),l.selectedCcyId=C.observable(N.prop.selectedCcyId()),l.limitCalc=C.observable("").extend({dirty:!1}),l.selectedInstrument=U.set("selectedInstrument",C.observable("")),l.amountSymbol=U.set("amountSymbol",C.observable("")),l.ccyPair=U.set("ccyPair",C.observable("")),l.orderDir=U.set("orderDir",C.observable("")),l.bid=U.set("bid",C.observable("")),l.ask=U.set("ask",C.observable("")),l.open=U.set("open",C.observable("")),l.close=U.set("close",C.observable("")),l.change=U.set("change",C.observable("")),l.tradeTime=U.set("tradeTime",C.observable("")),l.changePips=C.observable(""),l.highBid=U.set("highBid",C.observable("")),l.lowAsk=U.set("lowAsk",C.observable("")),l.prevBid=C.observable(""),l.prevAsk=C.observable(""),l.bidPips=C.observable(""),l.bid10K=C.observable(""),l.bid100K=C.observable(""),l.askPips=C.observable(""),l.ask10K=C.observable(""),l.ask100K=C.observable(""),l.limitType=C.observable(eLimitType.None),l.stopLossInCustomerCcy=C.observable(""),l.takeProfitInCustomerCcy=C.observable(""),l.displaySlPercentSymbol=C.observable(!1),l.displayTpPercentSymbol=C.observable(!1),l.displaySlAmountCcySymbol=C.observable(!1),l.displayTpAmountCcySymbol=C.observable(!1),l.profileKeyForDefaultTab=C.observable(A.profileKeyForDefaultTab),l.initialToolTab=U.set("initialToolTab",C.observable("")),l.isForex=C.observable(""),l.isShare=U.set("isShare",C.observable("")),l.isFuture=U.set("isFuture",C.observable("")),l.isStock=U.set("isStock",C.observable("")),l.isProfit=C.observable(""),l.profitLoss=C.observable(""),l.slRate=C.observable("").extend({dirty:!1}),l.tpRate=C.observable("").extend({dirty:!1}),l.originalLimits={slRate:C.observable(""),tpRate:C.observable("")},l.setLimitsIsDirty=C.observable(!1),l.closingLimit=C.observable(null),l.valueDate=C.observable(null),l.hasAdditionalPL=C.observable(!1),l.additionalPL=C.observable(""),l.customerSymbolName(N.prop.baseCcyName()),l.initialToolTab(O.ProfileCustomer()[A.profileKeyForDefaultTab]||eNewDealTool.Chart),l.setLimitsIsDirty=t.createComputed(function(){var e=l.limitsReady(),t=l.limitType();if(!e)return!1;var a=toNumeric(l.slRate.originalValue()),i=toNumeric(u.Data.stopLossRate()||"0"),o=a!==i,r=toNumeric(l.tpRate.originalValue()),n=toNumeric(u.Data.takeProfitRate()||"0"),s=r!==n;return t===eLimitType.StopLoss?o:t===eLimitType.TakeProfit&&s}),l.UpdateButtonEnabled=t.createComputed(function(){var e=l.setLimitsIsDirty(),t=l.limitsReady()&&l.quotesAvailable(),a=l.isActiveQuote(),i=N.prop.brokerAllowLimitsOnNoRates,o=l.isProcessing(),r=d.Data.isExpirationDateDirty(),n=!isNullOrUndefined(l.closingLimit());return(i||a)&&t&&!o&&(e||r&&n)}),l.hasRateAdded=t.createComputed(function(){var e;if(l.limitType()===eLimitType.StopLoss)e=l.slRate.originalValue();else{if(l.limitType()!==eLimitType.TakeProfit)return!1;e=l.tpRate.originalValue()}return isNumber(e)&&0!=e}),l.adj=C.computed(function(){return N.prop.dealPermit!==eDealPermit.Islamic&&(!l.valueDate()||l.positionNumber()!==l.orderID())}),u.Init(l,t.getSettings().setlimitsConfiguration),F.OnChange.Add(v),I.OnDealsChange.Add(o),I.OnDealsPLChange.Add(n),U.update("stopLossRate",u.Data.stopLossRate),U.update("takeProfitRate",u.Data.takeProfitRate),U.update("chart",A.chart),U.update("currentRateDirectionSwitch",A.currentRateDirectionSwitch)},dispose:function(){F.OnChange.Remove(v),I.OnDealsChange.Remove(o),I.OnDealsPLChange.Remove(n),U.unset("cachedOvernightFinancing"),U.unset("currentRateDirectionSwitch"),a.dispose.call(t)},Data:l,TPField:u.TPField,SLField:u.SLField,SetLimitsInfo:u.Data,SetLimitsViewProperties:u.ViewProperties,ExpirationDate:d,SetLimitsModel:u,EditLimit:f,DeleteLimit:function(){if(l.hasRateAdded()){if(l.limitType()===eLimitType.StopLoss)u.Data.stopLossRate("");else{if(l.limitType()!==eLimitType.TakeProfit)return;u.Data.takeProfitRate("")}f()}},getLimitsValidationModel:function(){return l.limitType()===eLimitType.StopLoss?C.validatedObservable({stopLossAmount:u.Data.stopLossAmount,ccySLAmount:u.Data.ccySLAmount,stopLossRate:u.Data.stopLossRate,stopLossPercent:u.Data.stopLossPercent}):l.limitType()===eLimitType.TakeProfit?C.validatedObservable({takeProfitAmount:u.Data.takeProfitAmount,ccyTPAmount:u.Data.ccyTPAmount,takeProfitRate:u.Data.takeProfitRate,takeProfitPercent:u.Data.takeProfitPercent}):C.validatedObservable({stopLossAmount:u.Data.stopLossAmount,takeProfitAmount:u.Data.takeProfitAmount,ccySLAmount:u.Data.ccySLAmount,ccyTPAmount:u.Data.ccyTPAmount,stopLossRate:u.Data.stopLossRate,takeProfitRate:u.Data.takeProfitRate,stopLossPercent:u.Data.stopLossPercent,takeProfitPercent:u.Data.takeProfitPercent})},createAmountFieldsWrappers:function(){var a=C.observable(""),i=C.observable("");t.subscribeTo(u.Data.ccySLAmount,function(e){u.Data.curSlActiveTab()===eSetLimitsTabs.Amount||a(e)}),l.stopLossInCustomerCcy=t.createComputed({read:function(){var e,t="";return"NA"===(e=u.Data.curSlActiveTab()===eSetLimitsTabs.Amount?a():u.Data.ccySLAmount())?e:(""===e||isNaN(e)||(t=(t=Number(e))<0?Math.floor(t):Math.ceil(t)),t)}}),l.stopLossInCustomerCcy.extend({validation:{validator:function(){return u.Data.stopLossAmount.isValid()},params:u.Data.stopLossAmount}}),l.stopLossInCustomerCcy.extend({notify:"always"}),t.subscribeTo(u.Data.ccyTPAmount,function(e){u.Data.curTpActiveTab()===eSetLimitsTabs.Amount||i(e)}),l.takeProfitInCustomerCcy=t.createComputed({read:function(){var e,t="";return"NA"===(e=u.Data.curTpActiveTab()===eSetLimitsTabs.Amount?i():u.Data.ccyTPAmount())?e:(""===e||isNaN(e)||(t=(t=Number(e))<0?Math.floor(t):Math.ceil(t)),t)}}),l.takeProfitInCustomerCcy.extend({validation:{validator:function(){return u.Data.takeProfitAmount.isValid()},params:u.Data.takeProfitAmount}}),l.takeProfitInCustomerCcy.extend({notify:"always"})},updateViewModelData:function(){s=P.VManager.GetViewArgs(eViewTypes.vEditClosingLimit).orderId;var e,t,a,i=I.Deals.GetItem(s);if(i){l.orderID(s),l.selectedDeal(i),l.limitType(P.VManager.GetViewArgs(eViewTypes.vEditClosingLimit).limitType),l.exeTime(i.exeTime),l.positionNumber(i.positionNumber),l.orderDir(i.orderDir),l.selectedInstrument(i.instrumentID),t=i.orderDir===eOrderDir.Sell?i.sellAmount:i.buyAmount,l.selectedDealAmount(t),l.limitCalc(i.orderRate),l.slRate(i.slRate),l.slRate.markClean(),l.originalLimits.slRate(i.slRate),l.tpRate(i.tpRate),l.tpRate.markClean(),l.originalLimits.tpRate(i.tpRate),l.valueDate(i.valueDate),l.hasAdditionalPL(0!==Number(i.additionalPL)),l.additionalPL(i.additionalPL);var o=i.orderRate,r=Format.tenthOfPipSplitRate(o,i.instrumentID);if(l.dealRate=o,l.dealRateLabel.First=r.button.first,l.dealRateLabel.Middle=r.button.middle,l.dealRateLabel.Last=r.button.last,m(i.pl),b(i),p(i),e=E.GetInstrument(i.instrumentID)){l.isForex(e.isForex),l.isShare(e.isShare),l.isFuture(e.isFuture),l.isStock(e.isStock),l.ccyPairLong(B.Long(e.id)),l.isNonForex(e.instrumentTypeId!==eInstrumentType.Currencies),l.baseSymbolName(R.GetTranslatedSymbolById(e.baseSymbol)),l.amountSymbol(e.otherSymbol),l.ccyPair(e.ccyPair),l.baseSymbolId(e.baseSymbol),l.otherSymbolId(e.otherSymbol);var n=V.Translate(e);l.dealAmountLabel(n.label),a=e,H.GetInBetweenQuote(a.otherSymbol,N.prop.baseCcyId()).then(function(e){l.quoteForOtherCcyToAccountCcy(e)}).done(),H.GetInBetweenQuote(N.prop.baseCcyId(),a.otherSymbol).then(function(e){l.quoteForAccountCcyToOtherCcy(e)}).done(),v(),d.UpdateSelectedWithToday(i.instrumentID)}}},FillLimitsData:y}})}),define("viewModels/Deals/InstrumentInfoViewModel",["require","knockout","KoComponentViewModel","InstrumentsManager","Customer","dalInstruments","dalOrders","BuilderForInBetweenQuote","StateObject!Transaction","StateObject!ScheduleGroup","FxNet/LogicLayer/Deal/DealMarginCalculator","FxNet/LogicLayer/Deal/DealAmountLabel","FxNet/LogicLayer/Deal/InstrumentInfoLines"],function(e){var b=e("knockout"),t=e("KoComponentViewModel"),p=e("InstrumentsManager"),v=e("Customer"),f=e("dalInstruments"),g=e("dalOrders"),D=e("BuilderForInBetweenQuote"),S=e("StateObject!Transaction"),y=e("StateObject!ScheduleGroup"),T=e("FxNet/LogicLayer/Deal/DealMarginCalculator"),w=e("FxNet/LogicLayer/Deal/DealAmountLabel"),h=e("FxNet/LogicLayer/Deal/InstrumentInfoLines"),a=extendClass(t,function(){var e=this,t=this.parent,r=this.Data,a=47,s="cachedOvernightFinancing",n=S.getAll(),i=function(){r.principalOfLong=b.observable(),r.principalOfShort=b.observable(),r.conversionRate=b.observable();var e=b.utils.unwrapObservable(n.customerSymbolName);r.currencySymbol=b.observable(e),r.customerSymbolId=b.observable(v.prop.baseCcyId()),r.dividendDate=b.observable(""),r.dividendAmount=b.observable(""),r.displayToleranceInSecondTable=b.observable(!1),r.otherInstrumentSymbol=b.observable(),r.rolloverDate=b.observable(""),r.marketPriceTolerance=b.observable(""),r.overnightFinancingPercentageSell=b.observable(),r.overnightFinancingPercentageBuy=b.observable(),r.principalOfLongPercentage=b.observable(),r.principalOfShortPercentage=b.observable(),r.overnightFinancingTimeGMT=b.observable(""),r.weekendFinancingType=b.observable(eWeekendFinancingTypes.None),r.maxDealAmountLabel=b.observable(""),r.minDealAmountLabel=b.observable(""),r.requiredMargin=b.observable(""),r.offHoursRequiredMargin=b.observable(""),r.maximumLeverage=b.observable(""),r.pipValue=b.observable(""),r.maxAmount=b.observable(""),r.minAmount=b.observable(""),r.displayOffHoursRequiredMargin=b.observable(!1),r.isStock=b.observable(!1)};var o=function(e){var t=p.GetInstrument(e);if(t){r.dividendDate(t.getInstrumentDividendDate()),r.dividendAmount(t.getInstrumentDividendAmount()),r.otherInstrumentSymbol(t.otherSymbol),r.rolloverDate(t.getInstrumentRolloverDate()),r.pipValue(1/Math.pow(10,t.PipDigit)),r.isStock(t.isStock);var a=t.marketPriceTolerance*r.pipValue();r.marketPriceTolerance(0==a?0:Format.toRate(a,!0,e)),d(),p.GetUpdatedInstrumentWithDealMinMaxAmounts(e).then(function(e){r.minAmount(Format.formatDealAmount(e.dealMinMaxAmounts[0])),r.maxAmount(Format.formatDealAmount(e.dealMinMaxAmounts[1]))}).done();var i=w.Translate(t,"maxDealAmountLabel_");r.maxDealAmountLabel(i.label);var o=w.Translate(t,"minDealAmountLabel_");r.minDealAmountLabel(o.label)}},l=function(){e.subscribeTo(n.selectedInstrument,function(e){o(e),m()})};function u(e,t){var a,i=Q.defer(),o=null,r=t+"_"+e;if(S.containsKey(s)){var n=S.get(s);o=n&&n[r]}return(a=o)&&a.long&&a.short&&a.longPercentage&&a.shortPercentage&&a.time-(new Date).getTime()<=36e5?i.resolve(o):g.GetOvernightFinancing(t,e).then(function(e){var t={long:e[0].Result.LongOvernightFinancing,short:e[0].Result.ShortOvernightFinancing,longPercentage:e[0].Result.LongOvernightFinancingPercentage,shortPercentage:e[0].Result.ShortOvernightFinancingPercentage,time:(new Date).getTime()};!function(e,t){if(!isNullOrUndefined(e)){var a=null;S.containsKey(s)?((a=S.get(s))[t]=e,S.update(s,a)):((a={})[t]=e,S.set(s,a))}}(t,r),i.resolve(t)}).done(),i.promise}var c=function(){r.principal=e.createComputed(function(){var e=p.GetInstrument(n.selectedInstrument()),t=toNumeric(n.selectedDealAmount());isDefinedType(e)&&r.isNotIslamicDealPermit&&e.isOvernightFinancing()&&isDefinedType(t)&&!isNaN(t)&&u(t,e.id).then(function(e){r.principalOfLong(e.long),r.principalOfShort(e.short),r.principalOfLongPercentage(e.longPercentage),r.principalOfShortPercentage(e.shortPercentage)}).done()},e,!1),r.overnightFinancingLong=e.createComputed(function(){var e;return isDefinedType(r.principalOfLong())?(e=r.principalOfLong(),e=10<r.conversionRate()?-0===parseFloat(e.toFixed(0))?0:parseFloat(e.toFixed(0)):-0===parseFloat(e.toFixed(2))?0:parseFloat(e.toFixed(2))):""}),r.overnightFinancingShort=e.createComputed(function(){var e;return isDefinedType(r.principalOfShort())?(e=r.principalOfShort(),e=10<r.conversionRate()?-0===parseFloat(e.toFixed(0))?0:parseFloat(e.toFixed(0)):-0===parseFloat(e.toFixed(2))?0:parseFloat(e.toFixed(2))):""}),r.overnightFinancingPercentageSell=e.createComputed(function(){var e=p.GetInstrument(n.selectedInstrument()),t=toNumeric(n.selectedDealAmount());if(isDefinedType(e)&&isDefinedType(t))return Format.toPercentWithPrecision(r.principalOfShortPercentage(),5)}),r.overnightFinancingPercentageBuy=e.createComputed(function(){var e=p.GetInstrument(n.selectedInstrument()),t=toNumeric(n.selectedDealAmount());if(isDefinedType(e)&&isDefinedType(t))return Format.toPercentWithPrecision(r.principalOfLongPercentage(),5)}),r.OfCalculationTimeGMT=e.createComputed(function(){var a,i,e=p.GetInstrument(n.selectedInstrument());f.GetScheduleGroup(e.id).then(function(e){var t;a=e[0].GMTCloseTime,i=a.split(" ")[1],r.overnightFinancingTimeGMT(i),r.weekendFinancingType(e[0].WeekendFinancingType),d(),t=e[0],y.update("ScheduleGroupData",t)}).done()},e,!1),r.pipWorth=e.createComputed(function(){var e=p.GetInstrument(n.selectedInstrument());return T.PipWorth(toNumeric(n.selectedDealAmount()),e.PipDigit,n.quoteForOtherCcyToAccountCcy(),r.conversionRate())}).extend({empty:!0}),r.infoLines=e.createComputed(function(){var e=p.GetInstrument(n.selectedInstrument());return h.GetInfoLines(e,r)})};function d(){!isNullOrUndefined(v.prop.maintenanceMarginPercentage)&&0<v.prop.maintenanceMarginPercentage?r.displayOffHoursRequiredMargin(!1):r.displayOffHoursRequiredMargin(!0)}var m=function(){var t,a,i,o=0;g.GetDealMarginDetails(n.selectedInstrument()).then(function(e){a=e[0].Result.MaxNormalMargin,i=100*a,t=100*e[0].Result.MaxOffHoursMargin,0!=a&&(o=1/a),r.requiredMargin(parseFloat(i.toFixed(2))+"%"),r.offHoursRequiredMargin(parseFloat(t.toFixed(2))+"%"),r.maximumLeverage("1:"+o.toFixed(0))}).done()};return{init:function(){r.isNotIslamicDealPermit=v.prop.dealPermit!=eDealPermit.Islamic,i(),c(),l(),D.GetInBetweenQuote(a,v.prop.baseCcyId()).then(function(e){r.conversionRate(e.bid())}).done(),m();var e=b.utils.unwrapObservable(n.selectedInstrument);o(e)},dispose:function(){t.dispose.call(e)},NewDealData:n}});return{viewModel:{createViewModel:function(e){var t=new a(e);return t.init(),t}}}}),define("viewModels/Deals/BaseMarketInfoToolViewModel",["require","knockout","KoComponentViewModel","InstrumentsManager","Customer","CustomerProfileManager","dalInstruments","dalCustomerProfile","FxNet/LogicLayer/Deal/SentimentsConnManager","StateObject!Transaction","StateObject!SentimentsConnManager"],function(e){var m=e("knockout"),t=e("KoComponentViewModel"),b=e("InstrumentsManager"),p=e("Customer"),v=e("CustomerProfileManager"),f=e("dalInstruments"),g=e("dalCustomerProfile"),D=e("FxNet/LogicLayer/Deal/SentimentsConnManager"),S=e("StateObject!Transaction"),y=e("StateObject!SentimentsConnManager");return extendClass(t,function(e){var a=this,i=this.parent,o=this.Data,r=S.getAll(),n=0,s=function(e){var t,a;n&&(clearTimeout(n),n=0),e&&!isNullOrUndefined(e.PercentLong)?(a=100-(t=toNumeric(e.PercentLong)),o.risePercent(t/100),o.fallPercent(a/100),o.riseValue(Math.round(t)),o.fallValue(Math.round(a)),o.hasData(!0)):o.hasData(!1)},l=function(e){e&&(n&&(clearTimeout(n),n=0),n=setTimeout(s,400),D.Subscribe(p.prop.brokerID,e))},t=function(e){e&&D.Unsubscribe(p.prop.brokerID,e)},u=function(){o.hasData=m.observable(!1),o.risePercent=m.observable(""),o.fallPercent=m.observable(""),o.riseValue=m.observable(""),o.fallValue=m.observable(""),o.overnightFinancingTimeGMT=m.observable(""),o.OfCalculationTimeGMT=m.observable(),o.displayTradingSentimentsFirstView=m.observable(isEmptyType(v.ProfileCustomer().viewSentimentsDisclaimerClicked))},c=function(){a.subscribeTo(r.selectedInstrument,function(e){e&&t(e)},null,"beforeChange"),a.subscribeTo(r.selectedInstrument,function(e){l(e)})},d=function(){o.displayTradingSentiments=a.createComputed(function(){return y.get("IsServiceAvailable")&&o.hasData()}),o.change=a.createComputed(function(){var e=r.bid(),t=r.close();return Format.toRate(e-t,!0,r.selectedInstrument())}),o.OfCalculationTimeGMT=a.createComputed(function(){var t,a,e=b.GetInstrument(r.selectedInstrument());f.GetScheduleGroup(e.id).then(function(e){t=e[0].GMTCloseTime,a=t.split(" ")[1],o.overnightFinancingTimeGMT(a)}).done()},a,!1)};return{init:function(e){i.init.call(a,e),u(),d(),c();var t=m.utils.unwrapObservable(r.selectedInstrument);D.SetMessageReceivedCallback(s),setTimeout(l.bind(a,t))},dispose:function(){t(r.selectedInstrument()),i.dispose.call(a)},NewDealData:r,ViewSentimentsButtonHandler:function(){v.ProfileCustomer().viewSentimentsDisclaimerClicked=(new Date).toUTCString(),g.SaveSentimentsToProfileWebMobile({ViewSentimentsDisclaimerClicked:(new Date).toUTCString()})}}})}),define("viewModels/Deals/OpenDealsModule",["require","knockout","Customer","AlertsManager","Dictionary","ClientStateHolderManager","DealsManager","InstrumentsManager","StatesManager","VmHelpers","dalOrders","BaseOrder","QuotesSubscriber","ViewModelBase","QuotesManager","BuilderForInBetweenQuote","AmountConverter","FxNet/LogicLayer/Deal/DealPermissions","GridSelectionModule"],function(e){var k=e("knockout"),x=e("Customer"),N=e("AlertsManager"),O=e("Dictionary"),E=e("ClientStateHolderManager"),G=e("DealsManager"),B=e("InstrumentsManager"),U=e("StatesManager"),q=e("VmHelpers"),H=e("dalOrders"),Q=e("BaseOrder"),W=e("QuotesSubscriber"),K=e("ViewModelBase"),j=e("QuotesManager"),_=e("BuilderForInBetweenQuote"),z=e("AmountConverter"),J=e("FxNet/LogicLayer/Deal/DealPermissions"),Y=e("GridSelectionModule");return extendClass(OpenDealsViewModelBase,function(){var i=this,n=new ObservableHashTable("orderID",{enabled:!0,sortProperty:"positionNumber",asc:!1}),s=new W,o=k.observable(!0),r=k.observable(!0),e={},l=new Q,u={},a=clone(K),t=k.observable(0),c=k.observable(null),d=k.observable(!0),m=function(){if(a.getSettings(i).closeSelected){Y.apply(u,n.Values,function(e){return!0===e.quoteIsActive()});var t=function(){var e={failCallback:function(){r(!0)}};return 0<u.CheckedItems().length?(r(!1),H.CloseDeals(u.CheckedItems(),M,e)):ErrorManager.onError("closeDealAfterConfirmation","trying to close empty list of positions",eErrorSeverity.low)};u.CloseSelected=function(){1!=U.States.fxDenied()?u.HasSelections()&&(CookieHandler.ReadCookie("hideMultipleDealsCloseAlert")?t():function(){var e={selectedData:u.CheckedItems(),confirmationCloseDeal:t};AlertsManager.UpdateAlert(AlertTypes.MultipleDealsClosedConfirmation,this.title,this.body,[],e),AlertsManager.PopAlert(AlertTypes.MultipleDealsClosedConfirmation)}()):l.ValidateOnlineTradingUser()}}},b=function(){e.isMarketClosed=U.States.IsMarketClosed},p=function(){G.OnDealsChange.Add(f),G.OnDealsPLChange.Add(S),E.OnChange.Add(D),j.OnChange.Add(g)},v=function(){d(!0),G.Deals.ForEach(function(e,t){var a=I(t);n.Add(a)}),d(!1)},f=function(e){e&&(y(e.removedItems),T(e.editedItems),w(e.newItems))},g=function(){for(var e=0,t=n.Values().length;e<t;e++){var a=n.Values()[e].instrumentID,i=j.Quotes.GetItem(a);i&&n.Values()[e].quoteIsActive(i.state!==eQuoteStates.NotActive)}},D=function(){t(toNumeric(E.CSHolder.equity))},S=function(e){for(var t=0,a=e.length;t<a;t++){var i=n.Get(e[t]);if(i){var o=G.Deals.GetItem(e[t]);if(o){var r={prevSpotRate:i.spotRate(),spotRate:o.spotRate,fwPips:o.fwPips,prevClosingRate:i.closingRate(),closingRate:o.closingRate,pl:o.pl,plNumeric:toNumeric(o.pl),plSign:Math.floor(toNumeric(o.pl)).sign(),lastUpdate:s.GetQuote(o.instrumentID).dataTime(),commission:o.commission};n.Update(e[t],r)}}}},y=function(e){for(var t=0;t<e.length;t++)n.Remove(e[t])},T=function(e){for(var t=0,a=e.length;t<a;t++){var i=I(G.Deals.GetItem(e[t]));i&&n.Update(i.orderID,i)}},w=function(e){for(var t=0,a=e.length;t<a;t++){var i=I(G.Deals.GetItem(e[t]));i&&n.Add(i)}},h=function(e){if(N.GetAlert(AlertTypes.CloseDealAlert).DisableThisAlertByCookie()){var t=C(n.Get(e.orderID));t&&(e.OnCloseDealEnable(!1),o(!1),H.CloseDeals([t],A))}else N.UpdateAlert(AlertTypes.CloseDealAlert,null,O.GetItem("closeDealConfirmationAlert"),[],{positionNumber:e.positionNumber,orderDir:e.orderDir,dealAmount:e.dealAmount,instrumentID:e.instrumentID,closingRate:e.closingRate,deal:e,caller:F}),N.PopAlert(AlertTypes.CloseDealAlert)},C=function(e){var t=null;if(e){var a=k.toJS(e);t=q.GeneratePrimitiveTypeArray(a)}return t},A=function(e,t,a){L(e,t,{requestData:a}),n.Get(a.orderID).OnCloseDealEnable(!0)},M=function(e,t,a){u.IsProcessing(!1),L(e,t,extendType({isCloseMultipleDealsCall:!0},{requestData:a}))},L=function(e,t,a){o(!0),l.OnActionReturn(e,t,null,a),r(!0)},I=function(e){var a={};return a.positionNumber=e.positionNumber,a.exeTime=e.exeTime,a.instrumentID=e.instrumentID,a.orderDir=e.orderDir,a.dealAmount=e.orderDir==eOrderDir.Sell?e.sellAmount:e.buyAmount,a.dealType=e.dealType,a.buyAmount=e.buyAmount,a.buySymbolID=e.buySymbolID,a.sellAmount=e.sellAmount,a.sellSymbolID=e.sellSymbolID,a.orderRate=e.orderRate,a.orderRateNumeric=toNumeric(e.orderRate),a.valueDate=i.getValueDate(e),a.slRate=k.observable(0==e.slRate?cEmptyRate:e.slRate),a.typeSL=O.GetItem("limtype1_short"),a.tpRate=k.observable(0==e.tpRate?cEmptyRate:e.tpRate),a.typeTP=O.GetItem("limtype2_short"),a.orderID=e.orderID,a.prevSpotRate=k.observable(e.spotRate),a.spotRate=k.observable(e.spotRate),a.fwPips=k.observable(e.fwPips),a.hasAdditionalPL=k.observable(e.hasAdditionalPL),a.prevClosingRate=k.observable(e.closingRate),a.closingRate=k.observable(e.closingRate),a.closeDealRate=k.computed(function(){return a.closingRate()?a.closingRate().substring(0,a.closingRate().length-2):"0."}),a.closeDealRatePips=k.computed(function(){return a.closingRate()?a.closingRate().substring(a.closingRate().length-2,a.closingRate().length):"00"}),a.dialogTitleSLDealLimit=k.computed(function(){return isNumber(a.slRate())&&0!=a.slRate()?O.GetItem("UpdateRemoveStopLossTitle"):O.GetItem("AddStopLossTitle")}),a.dialogTitleTpDealLimit=k.computed(function(){return isNumber(a.tpRate())&&0!=a.tpRate()?O.GetItem("UpdateRemoveTakeProfitTitle"):O.GetItem("AddTakeProfitTitle")}),a.pl=k.observable(isStringType(e.pl)?e.pl:Number.toStr(e.pl)),a.plNumeric=toNumeric(e.pl),a.plSign=k.observable(Math.floor(toNumeric(e.pl)).sign()),a.commission=k.observable(isStringType(e.commission)?e.commission:Number.toStr(e.commission)),a.spreadDiscount=k.observable(isStringType(e.spreadDiscount)?e.spreadDiscount:Number.toStr(e.spreadDiscount)),a.spreadDiscountConverted=k.observable(isStringType(e.spreadDiscount)?e.spreadDiscount:Number.toStr(e.spreadDiscount)),a.grosspl=k.computed(function(){if(c()&&x.prop.selectedCcyId()!==x.prop.baseCcyId()){var e=z.Convert(toNumeric(a.spreadDiscount()),c());a.spreadDiscountConverted(isStringType(e)?e:Number.toStr(e.toFixed(2)))}var t=0===toNumeric(a.spreadDiscountConverted())?toNumeric(a.commission()):-toNumeric(a.spreadDiscountConverted());return(toNumeric(a.pl())+t).toFixed(2)}),a.OnCloseDealEnable=k.observable(!0),a.OnCloseDealClick=h,a.ThisDealSwipe=k.observable(!0),a.lastUpdate=k.observable(s.GetQuote(e.instrumentID).dataTime()),a.quoteIsActive=k.observable(!1),a.isStock=k.observable(B.IsInstrumentStock(e.instrumentID)),a.adj=k.computed(function(){return x.prop.dealPermit!=eDealPermit.Islamic&&(0===e.valueDate.length||e.positionNumber!=e.orderID)}),a.isChecked=k.observable(!1),a.hasAdditionalPL=k.observable(0!==Number(e.additionalPL)),a},P=function(){return B.GetUserDefaultInstrumentId()},V=k.pureComputed(function(){return k.utils.arrayFirst(n.Values(),function(e){return!e.valueDate.isValueDateEmpty})}),R=k.pureComputed(function(){return 0<n.Values().length}),F={Init:function(e){a.setSettings(i,e),m(),b(),o(!0),p();var t=x.prop.baseCcyId();47!==t?_.GetInBetweenQuote(t,47).then(function(e){c(e),v()}).done():v(),s.Start()},OpenDeals:n.Values,HasRecords:R,FlagsState:e,CloseThisDeal:h,CloseThisDealEnable:o,OnCloseDealReturn:A,OnCloseDealsEnable:r,SetSorting:n.SetSorting,Positions:u,TotalEquity:t,GetSelectedInstrument:P,IsActiveQuote:function(){var e=s.GetQuote(P());return!isNullOrUndefined(e)&&e.state()!==eQuoteStates.NotActive},IsValueDateColumnVisible:V,SortProperties:n.SortProperties,IsLoadingData:d,DealPermissions:J};return F})}),define("viewModels/Deals/ScheduleGroupViewModel",["require","knockout","KoComponentViewModel","StateObject!ScheduleGroup"],function(e){var n=e("knockout"),t=e("KoComponentViewModel"),s=e("StateObject!ScheduleGroup"),a=extendClass(t,function(){var t,a=this,i=this.parent,o=this.Data;function r(e){o.scheduleGroup(e),isNullOrUndefined(e)||(o.hasOneTradingHour(!isEmpty(e.TradingBreak1_GMT)&&isEmpty(e.TradingBreak2_GMT)),o.hasMultipleTradingHours(!isEmpty(e.TradingBreak1_GMT)&&!isEmpty(e.TradingBreak2_GMT)))}return{init:function(e){i.init.call(a,e),o.scheduleGroup=n.observable(),o.hasOneTradingHour=n.observable(),o.hasMultipleTradingHours=n.observable(),s.get("ScheduleGroupData")||s.set("ScheduleGroupData",null),t=s.subscribe("ScheduleGroupData",r),r(s.get("ScheduleGroupData"))},dispose:function(){t&&t()},Data:o}});return{viewModel:{createViewModel:function(){var e=new a;return e.init(),e}}}}),define("viewModels/Limits/ActiveLimitsModule",["require","knockout","Dictionary","ViewModelsManager","ActiveLimitsManager","InstrumentTranslationsManager","dalOrders","ActiveLimitsConfiguration","QuotesSubscriber","BaseOrder","ViewModelBase"],function(e){var f=e("knockout"),g=e("Dictionary"),D=e("ActiveLimitsManager"),S=e("InstrumentTranslationsManager"),y=e("dalOrders"),t=e("ActiveLimitsConfiguration"),T=e("QuotesSubscriber"),w=e("BaseOrder"),h=e("ViewModelBase");var a=new function(){var r,n=new ObservableHashTable("orderID",{enabled:!0,sortProperty:"orderID",asc:!1}),t=new T,i=new w,s=clone(h),a={},e=f.observable(!0),o=function(){D.OnChange.Add(u)},l=function(){e(!0);var i=s.getSettings(r).defaultLimitMode;D.limits.ForEach(function(e,t){if(i===eLimitMode.None||i==t.mode){var a=p(t);n.Add(a)}}),e(!1)},u=function(e){e&&(c(e.removedLimits),d(e.editedLimits),m(e.newLimits))},c=function(e){for(var t=0;t<e.length;t++)n.Remove(e[t])},d=function(e){for(var t=s.getSettings(r).defaultLimitMode,a=0,i=e.length;a<i;a++){var o=p(D.limits.GetItem(e[a]));t!==eLimitMode.None&&t!=o.mode||n.Update(o.orderID,o)}},m=function(e){if(e&&e.length)for(var t=0,a=e.length;t<a;t++){var i=p(D.limits.GetItem(e[t]));s.getSettings(r).defaultLimitMode!==eLimitMode.None&&s.getSettings(r).defaultLimitMode!=i.mode||n.Add(i)}},b=function(e,t,a){i.ShowMessageResult(e,t,null,a),isDefinedType(n.Get(e[0].itemId).isRemoving)&&n.Get(e[0].itemId).isRemoving(!1)},p=function(e){return{instrumentName:f.observable(S.Long(e.instrumentID)),instrumentID:e.instrumentID,isInactiveQuote:t.GetQuote(e.instrumentID).isInactive,baseSymbol:e.baseSymbol,otherSymbol:e.otherSymbol,orderID:e.orderID,positionNumber:0==e.positionNumber?"":e.positionNumber,accountNumber:e.accountNumber,orderDir:e.orderDir,orderRate:e.orderRate,orderRateNumeric:toNumeric(e.orderRate),buySymbolID:e.buySymbolID,buyAmount:e.buyAmount,sellSymbolID:e.sellSymbolID,sellAmount:e.sellAmount,limitAmount:e.orderDir==eOrderDir.Sell?e.sellAmount:e.buyAmount,type:e.type,mode:e.mode,expirationDate:isEmptyValue(e.expirationDate)?g.GetItem("GoodTillCancel"):e.expirationDate,entryTime:e.entryTime,slRate:e.slRate,tpRate:e.tpRate,otherLimitID:e.otherLimitID,ThisDealSwipe:f.observable(!0),typeTP_abrv:g.GetItem("limtype2_short"),typeTP:g.GetItem("limtype2"),typeSL_abrv:g.GetItem("limtype1_short"),typeSL:g.GetItem("limtype1"),rateDirIsUp:t.GetQuote(e.instrumentID).rateDirIsUp,rateDirIsDown:t.GetQuote(e.instrumentID).rateDirIsDown,isEditable:e.mode===eLimitMode.OpenDeal,isRemoving:f.observable(!1)}},v=f.pureComputed(function(){return 0<a.Data().length});return{init:function(e){r=this,s.setSettings(r,e),i.Init({},n),a.Data=n.Values,a.ShowPager=f.observable(!1),o(),l(),t.Start()},DataInfo:a,DataInfoExp:{},RemoveLimit:function(e){var t=D.limits.GetItem(e.orderID);t&&(e.isRemoving(!0),y.DeleteLimit(t,b))},SetSorting:n.SetSorting,SortProperties:n.SortProperties,Refresh:l,IsLoadingData:e,ApplyFilter:function(){},HasRecords:v}};return a.init(t),a}),define("viewModels/Limits/PriceAlertsModule",["require","knockout","ViewModelsManager","ActiveLimitsManager","InstrumentTranslationsManager","dalOrders","QuotesManager","BaseOrder","ViewModelBase","GridSelectionModule","InstrumentsManager"],function(e){var S=e("knockout"),y=e("ActiveLimitsManager"),T=e("InstrumentTranslationsManager"),w=e("dalOrders"),h=e("QuotesManager"),C=e("BaseOrder"),A=e("ViewModelBase"),M=e("GridSelectionModule"),L=e("InstrumentsManager");var t=new function(){var e,o=new ObservableHashTable("orderID",{enabled:!0,sortProperty:"orderID",asc:!1}),r=new C,t=clone(A),a={},n={},i=S.observable(!0),s=function(){y.OnChange.Add(m),h.OnChange.Add(u)},l=function(){M.apply(n,a.Data)},u=function(){for(var e=0,t=o.Values().length;e<t;e++){var a=o.Values()[e].instrumentID,i=h.Quotes.GetItem(a);i&&o.Values()[e].currentRate(o.Values()[e].orderDir==eOrderDir.Sell?i.bid:i.ask)}},c=function(e){return e?w.DeletePriceAlerts(e,f):ErrorManager.onError("closePriceAlertAfterConfirmation","trying to close empty list of price alerts",eErrorSeverity.low)},d=function(){i(!0),y.GetPriceAlerts().ForEach(function(e,t){var a=g(t);o.Add(a)}),i(!1)},m=function(e){e&&(b(e.removedLimits),p(e.editedLimits),v(e.newLimits))},b=function(e){for(var t=0;t<e.length;t++)o.Remove(e[t])},p=function(e){for(var t=0,a=e.length;t<a;t++){var i=g(y.GetPriceAlerts().GetItem(e[t]));i&&o.Update(i.orderID,i)}},v=function(e){if(e&&e.length)for(var t=0,a=e.length;t<a;t++){var i=g(y.GetPriceAlerts().GetItem(e[t]));i&&o.Add(i)}},f=function(e,t,a){for(var i=0;i<e.length;i++)e[i].status!==eResult.Success&&(e[i].msgKey="OrderError23",e[i].result="OrderError23");r.ShowMessageResult(e,t,null,a)},g=function(e){if(e)return{instrumentName:S.observable(T.Long(e.instrumentID)),instrumentID:e.instrumentID,orderID:e.orderID,positionNumber:0==e.positionNumber?"":e.positionNumber,orderDir:e.orderDir,orderRate:e.orderRate,orderRateNumeric:toNumeric(e.orderRate),priceAlertAmount:e.orderDir==eOrderDir.Sell?e.sellAmount:e.buyAmount,type:e.type,mode:e.mode,expirationDate:e.expirationDate,entryTime:e.entryTime,isChecked:S.observable(!1),currentRate:S.observable(e.orderDir==eOrderDir.Sell?h.Quotes.GetItem(e.instrumentID).bid:h.Quotes.GetItem(e.instrumentID).ask)}},D=S.pureComputed(function(){return 0<a.Data().length});return{init:function(){e=this,t.setSettings(e,{}),r.Init({},o),a.Data=o.Values,a.ShowPager=S.observable(!1),l(),s(),d()},DataInfo:a,RemovePriceAlert:function(e){e=null===e?n.CheckedItems():[e];for(var t=[],a=y.GetPriceAlerts(),i=0;i<e.length;i++){var o=a.GetItem(e[i].orderID);o&&(o.limitRate=o.orderRate,t.push(o))}0<t.length&&(CookieHandler.ReadCookie("hideMultiplePriceAlertsCloseAlert")?c(t):r.ShowAlert(AlertTypes.MultiplePriceAlertsClosedConfirmation,this.title,this.body,{selectedData:t,confirmationCloseDeal:function(){c(t)}}))},SetSorting:o.SetSorting,SortProperties:o.SortProperties,Refresh:d,IsLoadingData:i,ApplyFilter:function(){},HasRecords:D,Positions:n,GetSelectedInstrument:function(){return L.GetUserDefaultInstrumentId()}}};return t.init(),t}),define("viewModels/Limits/AmountFieldsWrapper",["require","knockout","KoComponentViewModel","LimitValuesCalculator"],function(e){var n=e("knockout"),t=e("KoComponentViewModel"),v=e("LimitValuesCalculator");return extendClass(t,function(){var u,c,e=this,t=this.parent,a=this.Data,d=n.observable(""),m=n.observable(""),b=n.observable(!1),p=n.observable(!1),i=function(){a.stopLossInCustomerCcy=e.createComputed({read:function(){var e,t="";return"NA"===(e=u.Data.curSlActiveTab()==eSetLimitsTabs.Amount||u.Data.curSlActiveTab()==u.Data.defaultTab?d():u.Data.ccySLAmount())?e:(""===e||isNaN(e)||(t=Math.abs(Number(e)),t=Math.ceil(t)),t)},write:function(e){var t,a=u.Data.curSlActiveTab()==eSetLimitsTabs.Amount||u.Data.curSlActiveTab()==u.Data.defaultTab,i=""===e||-1<"NA".indexOf(e)||isStringType(e)&&-1<e.indexOf("NA"),o=!isNaN(e),r=c.quoteForAccountCcyToOtherCcy(),n="",s=d(),l=u.Data.stopLossAmount();a&&(i?t="":n=o?parseFloat(e):s,i||""===n||isNaN(n)||(t=v.CalculateAmount(n,r,eLimitType.StopLoss),t=Math.abs(t)),b(!0),d(n),n===s&&d.notifySubscribers(n),u.Data.stopLossAmount(t),t===l&&u.Data.stopLossAmount.notifySubscribers(t),b(!1))}}),a.takeProfitInCustomerCcy=e.createComputed({read:function(){var e,t="";return"NA"===(e=u.Data.curTpActiveTab()==eSetLimitsTabs.Amount||u.Data.curTpActiveTab()==u.Data.defaultTab?m():u.Data.ccyTPAmount())?e:(""===e||isNaN(e)||(t=Math.abs(Number(e)),t=Math.ceil(t)),t)},write:function(e){var t,a=u.Data.curTpActiveTab()==eSetLimitsTabs.Amount||u.Data.curTpActiveTab()==u.Data.defaultTab,i=""===e||-1<"NA".indexOf(e)||isStringType(e)&&-1<e.indexOf("NA"),o=!isNaN(e),r=c.quoteForAccountCcyToOtherCcy(),n="",s=m(),l=u.Data.takeProfitAmount();a&&(i?t="":n=o?parseFloat(e):s,i||""===n||isNaN(n)||(t=v.CalculateAmount(n,r,eLimitType.TakeProfit),t=Math.abs(t)),p(!0),m(n),n===s&&m.notifySubscribers(n),u.Data.takeProfitAmount(t),t===l&&u.Data.takeProfitAmount.notifySubscribers(t),p(!1))}})},o=function(){e.subscribeTo(u.Data.ccySLAmount,function(e){var t=u.Data.curSlActiveTab()==eSetLimitsTabs.Amount||u.Data.curSlActiveTab()==u.Data.defaultTab;b()||(t&&(isEmpty(d())||isNaN(d()))||!t)&&d(e)}),e.subscribeTo(u.Data.ccyTPAmount,function(e){var t=u.Data.curTpActiveTab()==eSetLimitsTabs.Amount||u.Data.curTpActiveTab()==u.Data.defaultTab;p()||(t&&(isEmpty(m())||isNaN(m()))||!t)&&m(e)})},r=function(){a.stopLossInCustomerCcy.extend({validation:{validator:function(){return u.Data.stopLossAmount.isValid()},params:u.Data.stopLossAmount}}),a.stopLossInCustomerCcy.extend({incremental:{ranges:[{from:0,to:10,step:1},{from:10,to:100,step:5},{from:100,to:1e3,step:50},{from:1e3,to:Number.MAX_VALUE,step:500}]}}),a.stopLossInCustomerCcy.extend({notify:"always"}),a.takeProfitInCustomerCcy.extend({validation:{validator:function(){return u.Data.takeProfitAmount.isValid()},params:u.Data.takeProfitAmount}}),a.takeProfitInCustomerCcy.extend({incremental:{ranges:[{from:0,to:10,step:1},{from:10,to:100,step:5},{from:100,to:1e3,step:50},{from:1e3,to:Number.MAX_VALUE,step:500}]}}),a.takeProfitInCustomerCcy.extend({notify:"always"})};return{init:function(e,t){u=e,c=t,i(),o(),r()},Data:a,dispose:function(){t.dispose.call(e),c=u=null}}})}),define("viewModels/Limits/EditLimitBaseViewModel",["require","knockout","KoComponentViewModel","editLimitSettings","Dictionary","dalOrders","BaseOrder","SetLimitsViewModel","RateFieldModel","ViewModelsManager","ActiveLimitsManager","InstrumentTranslationsManager","InstrumentsManager","QuotesManager","ExpirationDateModel","CustomerProfileManager","Customer","SymbolsManager","AlertsManager","StateObject!Transaction","ViewsManager","BuilderForInBetweenQuote","FxNet/LogicLayer/Deal/DealAmountLabel","viewModels/Limits/AmountFieldsWrapper","ClientStateFlagsManager","LimitRangesCalculator"],function(e){var C=e("knockout"),A=e("Dictionary"),t=e("KoComponentViewModel"),M=e("editLimitSettings"),L=e("dalOrders"),I=e("BaseOrder"),P=e("SetLimitsViewModel"),V=e("ViewModelsManager"),R=e("ActiveLimitsManager"),F=e("InstrumentTranslationsManager"),k=e("InstrumentsManager"),x=e("QuotesManager"),N=e("ExpirationDateModel"),O=e("CustomerProfileManager"),E=e("Customer"),G=e("SymbolsManager"),B=e("AlertsManager"),U=e("StateObject!Transaction"),q=e("ViewsManager"),H=e("BuilderForInBetweenQuote"),Q=e("FxNet/LogicLayer/Deal/DealAmountLabel"),W=e("viewModels/Limits/AmountFieldsWrapper"),K=e("ClientStateFlagsManager"),j=e("RateFieldModel"),_=e("LimitRangesCalculator");return extendClass(t,function(){var i=this,o=this.parent,d=this.Data,l=null,r=null,u=null,e={},n=new I,s=new W,m=new N,b=new P,c=new j;function p(e,t){var a={First:0,Middle:0,Last:0},i=Format.tenthOfPipSplitRate(e,t);return a.First=i.button.first,a.Middle=i.button.middle,a.Last=i.button.last,a}function v(){u=R.limits.GetItem(l);var e=k.GetInstrument(u.instrumentID),t=d.orderDir();_.CalculateOpeningRanges(d.bid(),d.ask(),t,d.openLimitLowerRange,d.openLimitHigherRange,e,K.CSFlags.limitMultiplier);var a=t===eOrderDir.Sell?d.openLimitLowerRange.near():d.openLimitHigherRange.near();d.lowerRangeNear(Format.toRate(a,!0,d.instrumentID()));var i=t===eOrderDir.Sell?d.openLimitHigherRange.near():d.openLimitLowerRange.near();d.higherRangeNear(Format.toRate(i,!0,d.instrumentID())),d.lowerRangeNearLabel(p(d.lowerRangeNear(),d.instrumentID())),d.higherRangeNearLabel(p(d.higherRangeNear(),d.instrumentID()));var o=t===eOrderDir.Sell?d.openLimitLowerRange.far():d.openLimitHigherRange.far(),r=Math.min(d.openLimitHigherRange.near(),d.openLimitLowerRange.near()),n=Math.max(d.openLimitHigherRange.near(),d.openLimitLowerRange.near()),s=t===eOrderDir.Sell?d.openLimitHigherRange.far():d.openLimitLowerRange.far();c.pipDigit(e.PipDigit),c.precision(e.DecimalDigit),c.min1(o),c.max1(r),c.min2(n),c.max2(s)}function f(){if((u=R.limits.GetItem(l))&&(r=x.Quotes.GetItem(u.instrumentID))){d.isActiveQuote(r.state!=eQuoteStates.NotActive),d.prevBid(d.bid()),d.prevAsk(d.ask()),d.bid(r.bid),d.ask(r.ask),d.changePips(r.changePips),d.open(r.open),d.close(r.close),d.change(Format.toPercent(r.change)),d.tradeTime(r.tradeTime),d.highBid(r.highBid),d.lowAsk(r.lowAsk);var e=u.orderDir==eOrderDir.Buy?r.ask:r.bid;d.spotRateLabel(p(e,u.instrumentID)),v()}}function g(e){if(e.newLimits&&0<e.newLimits.length){l=e.newLimits[0];var t=R.limits.GetItem(l);t&&(d.openLimit(t.orderRate),d.openLimit.markClean())}}function a(){return!!(u=R.limits.GetItem(l))||(B.UpdateAlert(AlertTypes.ServerResponseAlert,null,String.format("{0}",A.GetItem("OrderError7")),null,{redirectToView:eForms.Limits}),B.PopAlert(AlertTypes.ServerResponseAlert),!1)}function t(e,t,a){d.onRemoveLimitEnable(!0),d.isProcessing(!1);var i=k.GetInstrument(d.instrumentID());i&&n.OnActionReturn(e,t,i,{redirectToView:eForms.Limits,requestData:a})}function D(e){e.positionNumber=0,e.instrumentID=d.instrumentID(),e.amount=d.selectedDealAmount(),e.orderDir=d.orderDir(),e.limitRate=d.openLimit(),e.ifDoneSLRate=""==b.ObservableSetLimitsObject.stopLossRate()?0:b.ObservableSetLimitsObject.stopLossRate(),e.ifDoneTPRate=""==b.ObservableSetLimitsObject.takeProfitRate()?0:b.ObservableSetLimitsObject.takeProfitRate(),e.expirationDate=function(){var e=null;if(!m.Data.expirationDateSelector.IsGoodTillCancelChecked()){e=m.Data.expirationDate();var t=m.Data.selectedHoursValue();isObjectType(t)&&isEmptyType(t)?e+="  "+t.value:isStringType(t)&&!isEmptyType(t)?e+="  "+t:e+="  00:00"}return e}(),e.mode=eLimitMode.OpenDeal,e.type=eLimitType.None}var S=debounce(function(){d.EditLimitReady()&&(b.Validate().length?M.showValidationTooltips&&(C.postbox.publish("deal-slip-show-validation-tooltips"),d.showLimits(!0)):y())});function y(){if(a()&&(u=R.limits.GetItem(l),n.LimitValidate(u.instrumentID,b.Validate())&&n.LimitValidateQuote(u.instrumentID))){var e=new TLimit(u.orderID);if(D(e),t=e,d.enableSLLimit()&&0===t.ifDoneSLRate||d.enableTPLimit()&&0===t.ifDoneTPRate)return B.UpdateAlert(AlertTypes.GeneralOkAlert,A.GetItem("pleaseNoteTitle"),A.GetItem("sltpValidationMsg","deals_EditLimit"),null,{okButtonCallback:w}),void B.PopAlert(AlertTypes.GeneralOkAlert);e.removedIfDoneSLRate=0==parseFloat(e.ifDoneSLRate)&&0<parseFloat(u.slRate),e.removedIfDoneTPRate=0==parseFloat(e.ifDoneTPRate)&&0<parseFloat(u.tpRate),d.onSaveLimitEnable(!1),d.isProcessing(!0),L.EditLimit(e,T)}var t}function T(e,t,a){d.onSaveLimitEnable(!0),u=R.limits.GetItem(l);var i,o=k.GetInstrument(u.instrumentID);o&&(n.ResultStatusSuccess(e)&&((i=O.ProfileCustomer()).defaultEditSlLimitTab=b.Data.curSlActiveTab(),i.defaultEditTpLimitTab=b.Data.curTpActiveTab(),O.ProfileCustomer(i)),d.isProcessing(!1),d.isShowEditableRate(!1),b.MarkClean(),n.OnActionReturn(e,t,o,{redirectToView:eForms.Limits,requestData:a}))}function w(){d.enableSLLimit(!1),d.enableTPLimit(!1),y()}function h(){b.SetActiveTab(eSetLimitsTabs.Rate)}return{init:function(e){var t,a;o.init.call(i,e),n.Init({},d),m.Init(),d.PageName=V.VManager.GetViewArgs(eViewTypes.vEditLimit).pageName,d.ccyPair=U.set("ccyPair",C.observable("")),d.orderID=C.observable(""),d.entryTime=C.observable(""),d.instrumentID=C.observable(0),d.dealAmountLabel=C.observable(""),d.selectedDealAmount=U.set("selectedDealAmount",C.observable("").extend({dirty:!1})),d.buySymbol=C.observable(""),d.sellSymbol=C.observable(""),d.orderDir=U.set("orderDir",C.observable("")),d.isNonForex=C.observable(!0),d.bid=U.set("bid",C.observable("")),d.ask=U.set("ask",C.observable("")),d.spotRateLabel=C.observable(""),d.isActiveQuote=U.set("isActiveQuote",C.observable(!1)),d.openLimit=C.observable("").extend({dirty:!1,rate:!0}),d.openLimitLowerRange=new LimitRange,d.openLimitHigherRange=new LimitRange,d.lowerRangeNear=C.observable("").extend({dirty:!1}),d.higherRangeNear=C.observable("").extend({dirty:!1}),d.decimalDigit=C.observable(0),d.limitCalc=C.observable("").extend({dirty:!1}),d.onSaveLimitEnable=C.observable(""),d.setLimitsIsDirty=C.observable(!1),d.templateToUse=C.observable(""),d.isShowEditableRate=C.observable(""),d.ready=C.observable(!1),d.hasInstrument=C.observable(!1),d.customerSymbolId=C.observable(E.prop.baseCcyId()),d.onRemoveLimitEnable=C.observable(!0),d.isProcessing=C.observable(!1),d.limitType=C.observable(eLimitType.None),d.baseSymbolId=C.observable(""),d.otherSymbolId=C.observable(""),d.lowerRangeNearLabel=C.observable(""),d.higherRangeNearLabel=C.observable(""),d.expirationDate=C.observable(""),d.isStock=C.observable(!1),d.selectedInstrument=U.set("selectedInstrument",C.observable("")),d.profileKeyForDefaultTab=C.observable(M.profileKeyForDefaultTab),d.initialToolTab=U.set("initialToolTab",C.observable("")),d.customerSymbolName=U.set("customerSymbolName",C.observable("")),d.changePips=C.observable(""),d.quoteForOtherCcyToAccountCcy=U.get("quoteForOtherCcyToAccountCcy"),d.quoteForOtherCcyToAccountCcy?d.quoteForOtherCcyToAccountCcy(""):d.quoteForOtherCcyToAccountCcy=U.set("quoteForOtherCcyToAccountCcy",C.observable("")),d.quoteForAccountCcyToOtherCcy=C.observable(""),d.amountSymbol=U.set("amountSymbol",C.observable("")),d.bidPips=C.observable(""),d.askPips=C.observable(""),d.isFuture=U.set("isFuture",C.observable("")),d.isShare=U.set("isShare",C.observable("")),d.open=U.set("open",C.observable("")),d.close=U.set("close",C.observable("")),d.change=U.set("change",C.observable("")),d.tradeTime=U.set("tradeTime",C.observable("")),d.highBid=U.set("highBid",C.observable("")),d.lowAsk=U.set("lowAsk",C.observable("")),d.isForex=C.observable(""),d.prevBid=C.observable(""),d.prevAsk=C.observable(""),d.enableSLLimit=C.observable(!1),d.enableTPLimit=C.observable(!1),d.enableLimitLevel=C.observable(!1),d.showLimits=C.observable(!1).extend({notify:"always"}),d.limitsReady=C.observable(!1),d.isSlRateActiveTab=C.observable(!1),d.displaySlPercentSymbol=C.observable(!1),d.displayTpPercentSymbol=C.observable(!1),d.isSlAmountActiveTab=C.observable(!1),d.isSlPercentActiveTab=C.observable(!1),d.isTpRateActiveTab=C.observable(!1),d.isTpAmountActiveTab=C.observable(!1),d.isTpPercentActiveTab=C.observable(!1),d.displaySlAmountCcySymbol=C.observable(!1),d.displayTpAmountCcySymbol=C.observable(!1),d.slRate=C.observable("").extend({dirty:!1}),d.tpRate=C.observable("").extend({dirty:!1}),d.customerSymbolName(E.prop.baseCcyName()),d.initialToolTab(O.ProfileCustomer()[M.profileKeyForDefaultTab]||eNewDealTool.Chart),d.addSlTpType=C.observable(eLimitType.None),d.isShowBuyBox=i.createComputed(function(){return d.orderDir()===eOrderDir.Buy}),d.isShowSellBox=i.createComputed(function(){return d.orderDir()===eOrderDir.Sell}),d.setLimitsIsDirty=i.createComputed(function(){var e=d.limitsReady();if(!e)return!1;var t=toNumeric(d.slRate.originalValue()),a=toNumeric(b.Data.stopLossRate()||"0"),i=t!==a,o=toNumeric(d.tpRate.originalValue()),r=toNumeric(b.Data.takeProfitRate()||"0"),n=o!==r;return!(!i&&!n)}),d.baseSymbolName=i.createComputed(function(){return d.orderDir()==eOrderDir.Buy?d.buySymbol():d.sellSymbol()}),d.ViewModelReady=i.createComputed(function(){if(d.ready())return!0;var e=d.hasInstrument(),t=d.limitsReady(),a=e&&t;return d.ready(a),a}),d.ValidationRules=i.createComputed(function(){if(d.lowerRangeNear()==d.higherRangeNear())return d.openLimit.rules;d.openLimit.rules.removeAll();var e={};return d.orderDir()===eOrderDir.Buy?(e.minfar=toNumeric(Format.toRate(d.openLimitHigherRange.far(),!0,d.instrumentID())),e.minnear=toNumeric(Format.toRate(d.openLimitHigherRange.near(),!0,d.instrumentID())),e.maxnear=toNumeric(Format.toRate(d.openLimitLowerRange.near(),!0,d.instrumentID())),e.maxfar=toNumeric(Format.toRate(d.openLimitLowerRange.far(),!0,d.instrumentID()))):(e.minfar=toNumeric(Format.toRate(d.openLimitLowerRange.far(),!0,d.instrumentID())),e.minnear=toNumeric(Format.toRate(d.openLimitLowerRange.near(),!0,d.instrumentID())),e.maxnear=toNumeric(Format.toRate(d.openLimitHigherRange.near(),!0,d.instrumentID())),e.maxfar=toNumeric(Format.toRate(d.openLimitHigherRange.far(),!0,d.instrumentID()))),{required:!0,rangeInterval:e,rate:{message:A.GetItem("limitLevelInvalid"),params:!0},toNumericLength:{ranges:[{from:0,to:Number.MAX_SAFE_INTEGER,decimalDigits:d.decimalDigit()}]}}}).extend({notify:"always"}),d.EditLimitReady=i.createComputed(function(){var e=d.isActiveQuote(),t=d.openLimit.isDirty(),a=!!d.setLimitsIsDirty(),i=m.Data.isExpirationDateDirty(),o=!!d.openLimit&&d.openLimit.isValid(),r=!M.showValidationTooltips&&0<b.Validate().length,n=t||a||i,s=d.onSaveLimitEnable(),l=m.IsValid(),u=E.prop.brokerAllowLimitsOnNoRates,c=(u||e)&&s&&l&&n&&o&&!r;return c}).extend({notify:"always"}),i.subscribeTo(d.ValidationRules,function(){d.openLimit.extend(d.ValidationRules())}),i.subscribeTo(d.openLimit,function(e){var t=toNumeric(e);isNullOrUndefined(d.openLimitLowerRange)||isNullOrUndefined(d.openLimitHigherRange)||(InRange(t,d.openLimitLowerRange)||InRange(t,d.openLimitHigherRange))&&d.limitCalc(t)}),function(){if(l=V.VManager.GetViewArgs(eViewTypes.vEditLimit).orderId,d.onSaveLimitEnable(!0),d.onRemoveLimitEnable(!0),u=R.limits.GetItem(l)){d.orderID(l),d.entryTime(u.entryTime),d.limitType(u.type),d.instrumentID(u.instrumentID),d.ccyPair(F.Long(u.instrumentID)),d.selectedDealAmount(u.orderDir==eOrderDir.Sell?u.sellAmount:u.buyAmount),d.buySymbol(G.GetTranslatedSymbolById(u.buySymbolID)),d.sellSymbol(G.GetTranslatedSymbolById(u.sellSymbolID)),d.orderDir(u.orderDir),d.limitCalc(u.orderRate),d.selectedInstrument(u.instrumentID),d.templateToUse(eTemplateNames.editLimitNavigator),d.isShowEditableRate(!1),d.openLimit(u.orderRate),d.expirationDate(u.expirationDate),d.slRate(u.slRate),d.slRate.markClean(),d.tpRate(u.tpRate),d.tpRate.markClean();var e=k.GetInstrument(u.instrumentID);if(e){var t=Q.Translate(e);d.dealAmountLabel(t.label),d.isNonForex(e.instrumentTypeId!==eInstrumentType.Currencies),d.decimalDigit(e.DecimalDigit),c.precision(e.DecimalDigit),d.amountSymbol(e.otherSymbol),d.isFuture(e.isFuture),d.isForex(e.isForex),d.isShare(e.isShare),d.enableSLLimit(!1),d.enableTPLimit(!1),d.baseSymbolId(e.baseSymbol),d.otherSymbolId(e.otherSymbol),a=e,H.GetInBetweenQuote(a.otherSymbol,E.prop.baseCcyId()).then(function(e){d.quoteForOtherCcyToAccountCcy(e)}).done(),H.GetInBetweenQuote(E.prop.baseCcyId(),a.otherSymbol).then(function(e){d.quoteForAccountCcyToOtherCcy(e)}).done(),m.UpdateSelectedWithToday(u.instrumentID),d.hasInstrument(!0),d.isStock(e.isStock)}!isEmpty(u.expirationDate)&&M.showExpirationCalendar&&m.SetOrder(u.orderID)}var a;d.openLimit.markClean(),r&&v()}(),x.OnChange.Add(f),R.OnChange.Add(g),f(),b.Init(d,i.getSettings().setlimitsConfiguration),s.init(b,d),t=V.VManager.GetViewArgs(eViewTypes.vEditLimit).limitType,a=O.ProfileCustomer(),d.showLimits(1===a.editLimitIfDoneExpanded),(u=R.limits.GetItem(l))&&(t&&(d.showLimits(!0),d.addSlTpType(t)),t===eLimitType.StopLoss&&d.enableSLLimit(!0),t===eLimitType.TakeProfit&&d.enableTPLimit(!0),isNullOrUndefined(u.slRate)||0==u.slRate||d.enableSLLimit(!0),isNullOrUndefined(u.tpRate)||0==u.tpRate||d.enableTPLimit(!0)),U.update("stopLossRate",b.Data.stopLossRate),U.update("takeProfitRate",b.Data.takeProfitRate),U.update("openLimit",d.openLimit),U.update("chart",q.GetViewArgs(eViewTypes.vEditLimit).chart),U.update("switchToRate",h),U.update("currentRateDirectionSwitch",q.GetViewArgs(eViewTypes.vEditLimit).currentRateDirectionSwitch)},dispose:function(){b.Stop(),x.OnChange.Remove(f),R.OnChange.Remove(g),e.Limits&&e.Limits.isValid&&e.Limits.isValid.dispose(),e.Limits=null,s.dispose(),s=null,U.unset("cachedOvernightFinancing"),U.unset("currentRateDirectionSwitch"),o.dispose.call(i)},Data:d,BaseOrder:n,EditLimit:S,ExpirationDate:m,SetLimitsInfo:b.ObservableSetLimitsObject,SetLimitsViewProperties:b.ViewProperties,TPField:b.TPField,SLField:b.SLField,FieldWrappers:s,DeleteLimit:function(){if(d.onRemoveLimitEnable()&&a()&&(u=R.limits.GetItem(l),n.LimitValidate(u.instrumentID,b.Validate())&&n.LimitValidateQuote(u.instrumentID))){var e=new TLimit(u.orderID);D(e),d.isProcessing(!0),d.onRemoveLimitEnable(!1),L.DeleteLimit(e,t)}},LimitLevelField:c,ValidationModel:e,SetLimitsViewModel:b,setLimitTabsFromClientProfile:function(){var e=O.ProfileCustomer();e.defaultEditSlLimitTab?b.SetSlActiveTab(e.defaultEditSlLimitTab):b.SetSlActiveTab(eSetLimitsTabs.Amount),e.defaultEditTpLimitTab?b.SetTpActiveTab(e.defaultEditTpLimitTab):b.SetTpActiveTab(eSetLimitsTabs.Amount)},FillLimitData:D}})}),define("ExpirationDateModel",["require","knockout","CacheManager","ActiveLimitsManager","ExpirationDateSelectorModel","DialogViewModel"],function(e){var f=e("knockout"),g=e("CacheManager"),D=e("ActiveLimitsManager"),S=e("ExpirationDateSelectorModel"),y=e("DialogViewModel");return function(){var c,d={},t=[],e=function(){d.expirationDate=f.observable("").extend({dirty:!1}),d.expirationTime=f.observable("").extend({dirty:!1}),d.selectedExpirationDateTime=f.observable("").extend({dirty:!1}),d.isDateTimeApplied=f.observable(!1),d.maxExpirationDate=f.observable(""),d.minExpirationDate=f.observable(""),d.hoursList=f.observableArray([]),d.selectedHoursValue=f.observable("")},a=function(){d.expirationDate.extend({validation:{validator:u}}),d.selectedHoursValue.extend({validation:{validator:m}})},i=function(){d.expirationDateTime=f.computed(function(){return String.format("{0} {1}",pad(this.expirationDate(),2),pad(this.expirationTime(),2))},d),t.push(d.expirationDateTime),d.isDirty=f.computed(function(){return d.expirationDate.isDirty()||d.expirationTime.isDirty()}),t.push(d.isDirty),d.isExpirationDateDirty=f.computed(function(){var e=d.selectedExpirationDateTime(),t=d.selectedExpirationDateTime.originalValue();return!!d.isDateTimeApplied()&&e!==t}),t.push(d.isExpirationDateDirty)},o=function(){t.push(d.expirationDate.subscribe(function(e){isEmptyType(e)||l()})),t.push(d.selectedHoursValue.subscribe(function(e){d.expirationTime(e)}))},r=function(e){var t,a,i,o=s(e);t=o,a=String.format("{0} {1}",t.date,t.time),d.maxExpirationDate(str2Date(a,"d/m/Y H:M")),i=String.format("{0} {1}",g.ServerTime().ExtractDate(),g.ServerTime().ExtractTime()),d.minExpirationDate(str2Date(i,"d/m/Y H:M"))},n=function(){var e=new Date(g.ServerTime().getTime());return e.setHours(23),e.setMinutes(59),e.skipWeekendDays(),e},s=function(e){c=e;var t,a=$instrumentsManager.GetInstrument(c),i=new Date(g.ServerTime().getTime()).AddYear(1);return i.setHours(23),i.setMinutes(59),(t=a.isFuture?str2Date(a.expirationDate,"d/m/Y H:M"):a.expirationDate&&str2Date(a.expirationDate,"d/m/Y H:M")<i?str2Date(a.expirationDate,"d/m/Y H:M"):i)?t.skipWeekendDays():t=i,{date:SplitDateTime(t.ExtractDate()).date,time:t.ExtractTime()}},l=function(){var e=23,t=59,a=0;SplitDateTime(g.ServerTime().ExtractDate()).date==d.expirationDate()&&(a=g.ServerTime().getHours()+1);var i=$instrumentsManager.GetInstrument(c);if(i&&i.expirationDate){var o=SplitDateTime(i.expirationDate);o.date==d.expirationDate()&&(e=parseInt(o.hour,10),t=parseInt(o.min,10))}var r=d.selectedHoursValue(),n=0;if(!isEmptyType(r)){var s=r.split(":");n=60*parseInt(s[0],10)+parseInt(s[1],10)}var l=60*e+t;n<60*a?d.selectedHoursValue(String.format("{0}:00",pad(a,2))):l<n&&d.selectedHoursValue(String.format("{0}:{1}",pad(e,2),pad(t,2)));var u=[];fillHoursList(u,e,t,a),d.hoursList(u)},u=function(e){if(d.expirationDateSelector.IsGoodTillCancelChecked())return d.isDateTimeApplied(!0),d.selectedExpirationDateTime(""),!0;d.isDateTimeApplied(!1);var t=b(e,d.selectedHoursValue());return t>g.ServerTime()&&t<=d.maxExpirationDate()},m=function(e){if(d.expirationDateSelector.IsGoodTillCancelChecked())return d.isDateTimeApplied(!0),d.selectedExpirationDateTime(""),!0;d.isDateTimeApplied(!1);var t=b(d.expirationDate(),e);return t>g.ServerTime()&&t<=d.maxExpirationDate()},b=function(e,t){var a=e+" "+t,i=str2Date(a,"d/m/Y H:M");return d.selectedExpirationDateTime(a),i},p=function(){return d.selectedHoursValue.isValid()||d.expirationDateSelector.IsGoodTillCancelChecked()},v=function(){isDefinedType(y)&&y.close()};return{Data:d,SetOrder:function(e){var t=D.limits.GetItem(e);if(t){r(t.instrumentID);var a=n();!function(e,t){var a;if(isEmptyValue(e.expirationDate))d.expirationDate(t.date),d.selectedHoursValue(t.time),a=String.format("{0} {1}",pad(d.expirationDate(),2),pad(d.expirationTime(),2)),d.selectedExpirationDateTime(a),d.expirationDateSelector.ResetObservables();else{var i=SplitDateTime(e.expirationDate);d.expirationDate(i.date),d.selectedHoursValue(String.format("{0}:{1}",pad(i.hour,2),pad(i.min,2))),a=String.format("{0} {1}",pad(d.expirationDate(),2),pad(d.expirationTime(),2)),d.selectedExpirationDateTime(a),d.selectedExpirationDateTime.markClean(),d.expirationDateSelector.UpdateSelectedDateUI(d.expirationDateTime())}}(t,{date:SplitDateTime(a.ExtractDate()).date,time:a.ExtractTime()}),d.expirationDate.markClean(),d.expirationTime.markClean()}},UpdateSelectedWithToday:function(e){d.expirationDateSelector.ResetObservables(),r(e);var t=n();d.expirationDate(SplitDateTime(t.ExtractDate()).date),d.selectedHoursValue(t.ExtractTime())},IsValid:p,Init:function(){d.expirationDateSelector=new S,d.expirationDateSelector.Init(),e(),a(),i(),o()},OnExpirationDateTimeSet:function(){p()&&(d.expirationDateSelector.UpdateSelectedDateUI(d.expirationDateTime()),d.isDateTimeApplied(!0),v())},dispose:function(){if(0<t.length)for(var e=0;e<t.length;e++)t[e].dispose();t.length=0}}}}),define("ExpirationDateSelectorModel",["require","knockout","Dictionary","DialogViewModel"],function(e){var u=e("knockout"),c=e("Dictionary"),d=e("DialogViewModel");return function(e){var t={},a={title:c.GetItem("EditLimitExpirationDate"),width:420,dialogClass:"fx-dialog expPopup",onCloseCallback:function(){s()}};u.utils.extend(a,e||{});var i=function(){t.isGoodTillCancel=u.observable(!0),t.expirationDateValue=u.observable("")},o=function(){t.isGoodTillCancel.subscribe(function(){r()})},r=function(){l()||n()},n=function(){isDefinedType(d)&&d.open(eDialog.EditLimitExpirationDate,a,eViewTypes.vEditLimitExpirationDate)},s=function(){isEmpty(t.expirationDateValue())&&t.isGoodTillCancel(!0)},l=function(){return!0===t.isGoodTillCancel()};return{Init:function(){i(),o()},Data:t,IsGoodTillCancelChecked:l,OnOptionChanged:r,UpdateSelectedDateUI:function(e){t.expirationDateValue(e),t.isGoodTillCancel(!1)},ResetObservables:function(){t.isGoodTillCancel(!0),t.expirationDateValue("")}}}}),define("viewModels/Limits/LimitBaseViewModel",["require","Dictionary","knockout","KoComponentViewModel","newLimitSettings","ExpirationDateModel","ViewsManager","FxNet/LogicLayer/Deal/DealAmountLabel","SymbolsManager","QuotesManager","BaseOrder","SetLimitsViewModel","RateFieldModel","Customer","CustomerProfileManager","InstrumentsManager","RegistrationManager","BuilderForInBetweenQuote","StateObject!Transaction","ClientStateFlagsManager","LimitRangesCalculator","LimitValuesCalculator"],function(e){var f=e("knockout"),t=e("KoComponentViewModel"),g=e("newLimitSettings"),a=e("ExpirationDateModel"),D=e("ViewsManager"),S=e("FxNet/LogicLayer/Deal/DealAmountLabel"),y=e("SymbolsManager"),i=e("QuotesManager"),o=e("BaseOrder"),r=e("SetLimitsViewModel"),T=e("RateFieldModel"),w=e("Customer"),h=e("CustomerProfileManager"),C=e("InstrumentsManager"),A=e("RegistrationManager"),M=e("BuilderForInBetweenQuote"),L=e("StateObject!Transaction"),I=e("ClientStateFlagsManager"),P=e("LimitRangesCalculator");return extendClass(t,function(){var s=this,n=this.parent,l=this.Data,u=new o,c=new a,d=new r,m=new T;function b(){var e=D.GetActiveFormViewProperties(eViewTypes.vTransactionSwitcher),t=D.GetActiveFormViewProperties(eViewTypes.vNewPriceAlert);return e&&e.visible()?e.args||{}:!(!t||!t.visible())&&(t.args||{})}function p(e){e!=eOrderDir.Buy&&e!=eOrderDir.Sell&&e!=eOrderDir.None&&(e=eOrderDir.None),l.orderDir(e),l.activeQuote&&s.updateDistances()}function v(){l.activeQuote=i.Quotes.GetItem(l.selectedInstrument()),l.activeQuote&&(l.isActiveQuote(l.activeQuote.state!==eQuoteStates.NotActive),l.bid(l.activeQuote.bid),l.ask(l.activeQuote.ask),l.open(l.activeQuote.open),l.close(l.activeQuote.close),l.change(Format.toPercent(l.activeQuote.change)),l.formattedChange(Format.toSignedPercent(l.activeQuote.change,"")),l.changePips(l.activeQuote.changePips),l.highBid(l.activeQuote.highBid),l.lowAsk(l.activeQuote.lowAsk),l.tradeTime(l.activeQuote.tradeTime),l.quotesAvailable(!0),l.activeQuoteState(l.activeQuote.state),s.updateDistances())}function e(){i.OnChange.Remove(v)}return s.updateDistances=function(){var e=l.orderDir()===eOrderDir.None?eOrderDir.Buy:l.orderDir(),t=C.GetInstrument(l.selectedInstrument());if(t){P.CalculateOpeningRanges(l.bid(),l.ask(),e,l.openLimitLowerRange,l.openLimitHigherRange,t,I.CSFlags.limitMultiplier);var a=e===eOrderDir.Sell?l.openLimitLowerRange.near():l.openLimitHigherRange.near();l.lowerRangeNear(Format.toRate(a,!0,l.selectedInstrument()));var i=e===eOrderDir.Sell?l.openLimitHigherRange.near():l.openLimitLowerRange.near();l.higherRangeNear(Format.toRate(i,!0,l.selectedInstrument()));var o=l.orderDir()===eOrderDir.Sell?l.openLimitLowerRange.far():l.openLimitHigherRange.far(),r=Math.min(l.openLimitHigherRange.near(),l.openLimitLowerRange.near()),n=Math.max(l.openLimitHigherRange.near(),l.openLimitLowerRange.near()),s=l.orderDir()===eOrderDir.Sell?l.openLimitHigherRange.far():l.openLimitLowerRange.far();m.pipDigit(t.PipDigit),m.precision(t.DecimalDigit),m.min1(o),m.max1(r),m.min2(n),m.max2(s)}},{init:function(e){n.init.call(s,e),u.Init({},l),c.Init(),l.ready=f.observable(!1),l.customerSymbolName=L.set("customerSymbolName",f.observable(w.prop.baseCcyName())),l.customerSymbolId=L.set("customerSymbolId",f.observable(w.prop.baseCcyId())),l.orderDir=L.set("orderDir",f.observable(eOrderDir.None).extend({dirty:!1})),l.selectedInstrument=L.set("selectedInstrument",f.observable()),l.selectedDealAmount=L.set("selectedDealAmount",f.observable()),l.selectedDealAmount.extend({notify:"always"}),l.selectedDealAmount.extend({amountValidation:[]}),l.amountSymbol=L.set("amountSymbol",f.observable("")),l.quoteForOtherCcyToAccountCcy=L.get("quoteForOtherCcyToAccountCcy"),l.quoteForBaseCcyToAccountCcy=L.get("quoteForBaseCcyToAccountCcy"),l.quoteForUsdCcyToAccountCcy=L.get("quoteForUsdCcyToAccountCcy"),l.bid=L.set("bid",f.observable("")),l.ask=L.set("ask",f.observable("")),l.initialToolTab=L.set("initialToolTab",f.observable("")),l.showTools=L.set("showTools",f.observable(1===h.ProfileCustomer().tools)),l.bidPips=L.set("bidPips",f.observable("")),l.askPips=L.set("askPips",f.observable("")),l.changePips=L.set("changePips",f.observable("")),l.tradeTime=L.set("tradeTime",f.observable("")),l.highBid=L.set("highBid",f.observable("")),l.lowAsk=L.set("lowAsk",f.observable("")),l.open=L.set("open",f.observable("")),l.close=L.set("close",f.observable("")),l.change=L.set("change",f.observable("")),l.isForex=L.set("isForex",f.observable(!1)),l.isFuture=L.set("isFuture",f.observable(!1)),l.isShare=L.set("isShare",f.observable(!1)),l.isStock=L.set("isStock",f.observable(!1)),l.isNonForex=f.observable(!0),l.hasInstrument=f.observable(!1),l.ccyPair=L.set("ccyPair",f.observable("")),l.activeQuote=null,l.isActiveQuote=L.set("isActiveQuote",f.observable(!1)),l.activeQuoteState=f.observable(),l.PageName=eDealPage.NewLimitViewModel,l.dealMinMaxAmounts=f.observableArray([]),l.dealAmountLabel=f.observable(""),l.openLimit=L.set("openLimit",f.observable("").extend({dirty:!1,rate:!0})),l.limitCalc=f.observable("").extend({dirty:!1}),l.enableSLLimit=f.observable(!1),l.enableTPLimit=f.observable(!1),l.limitsReady=f.observable(!1),l.enableLimitLevel=f.observable(!1),l.lowerRangeNear=f.observable("").extend({dirty:!1}),l.higherRangeNear=f.observable("").extend({dirty:!1}),l.openLimitLowerRange=new LimitRange,l.openLimitHigherRange=new LimitRange,l.decimalDigit=f.observable(0),l.bidLabel={First:f.observable(""),Middle:f.observable(""),Last:f.observable("")},l.askLabel={First:f.observable(""),Middle:f.observable(""),Last:f.observable("")},l.quotesAvailable=f.observable(!1),l.formattedChange=f.observable(""),l.baseSymbol=f.observable(""),l.baseSymbolName=f.observable(""),l.profileKeyForDefaultTab=f.observable(g.profileKeyForDefaultTab),l.isSlRateActiveTab=f.observable(!1),l.isSlAmountActiveTab=f.observable(!1),l.isSlPercentActiveTab=f.observable(!1),l.isTpRateActiveTab=f.observable(!1),l.isTpAmountActiveTab=f.observable(!1),l.isTpPercentActiveTab=f.observable(!1),l.displaySlPercentSymbol=f.observable(!1),l.displayTpPercentSymbol=f.observable(!1),l.displaySlAmountCcySymbol=f.observable(!1),l.displayTpAmountCcySymbol=f.observable(!1),l.isProcessing=f.observable(!1),l.quoteForAccountCcyToOtherCcy=f.observable(""),l.buyBtnClick=function(){l.enableLimitLevel(!0),p(eOrderDir.Buy)},l.sellBtnClick=function(){l.enableLimitLevel(!0),p(eOrderDir.Sell)},l.isShowBuyBox=s.createComputed(function(){return l.orderDir()===eOrderDir.Buy}),l.isShowSellBox=s.createComputed(function(){return l.orderDir()===eOrderDir.Sell}),l.ViewModelReady=s.createComputed(function(){if(l.ready())return!0;var e=l.hasInstrument(),t=l.limitsReady(),a=e&&t;return l.ready(a),a}),l.ValidationRules=s.createComputed(function(){if(l.lowerRangeNear()==l.higherRangeNear())return l.openLimit.rules;l.openLimit.rules.removeAll();var e={};return l.orderDir()===eOrderDir.Sell?(e.minfar=toNumeric(Format.toRate(l.openLimitLowerRange.far(),!0,l.selectedInstrument())),e.minnear=toNumeric(Format.toRate(l.openLimitLowerRange.near(),!0,l.selectedInstrument())),e.maxnear=toNumeric(Format.toRate(l.openLimitHigherRange.near(),!0,l.selectedInstrument())),e.maxfar=toNumeric(Format.toRate(l.openLimitHigherRange.far(),!0,l.selectedInstrument()))):(e.minfar=toNumeric(Format.toRate(l.openLimitHigherRange.far(),!0,l.selectedInstrument())),e.minnear=toNumeric(Format.toRate(l.openLimitHigherRange.near(),!0,l.selectedInstrument())),e.maxnear=toNumeric(Format.toRate(l.openLimitLowerRange.near(),!0,l.selectedInstrument())),e.maxfar=toNumeric(Format.toRate(l.openLimitLowerRange.far(),!0,l.selectedInstrument()))),{required:!0,rangeInterval:e,rate:{message:Dictionary.GetItem("limitLevelInvalid"),params:!0},toNumericLength:{ranges:[{from:0,to:Number.MAX_SAFE_INTEGER,decimalDigits:l.decimalDigit()}]}}}).extend({notify:"always"}),l.isUp=f.pureComputed(function(){return l.activeQuoteState()===eQuoteStates.Up}),l.isDown=f.pureComputed(function(){return l.activeQuoteState()===eQuoteStates.Down}),s.subscribeAndNotify(l.ask,function(e){var t=Format.tenthOfPipSplitRate(e,l.selectedInstrument());l.askLabel.First(t.button.first),l.askLabel.Middle(t.button.middle),l.askLabel.Last(t.button.last)}),s.subscribeAndNotify(l.bid,function(e){var t=Format.tenthOfPipSplitRate(e,l.selectedInstrument());l.bidLabel.First(t.button.first),l.bidLabel.Middle(t.button.middle),l.bidLabel.Last(t.button.last)}),s.subscribeChanged(l.selectedInstrument,function(e,t){t&&e!==t&&(l.selectedDealAmount(""),L.containsKey("skipReset")&&L.get("skipReset")||l.orderDir(eOrderDir.None))}),s.subscribeTo(l.selectedInstrument,function(e){var t,s=C.GetInstrument(e);if(s){l.quotesAvailable(!1),l.dealMinMaxAmounts([]),C.GetUpdatedInstrumentWithDealMinMaxAmounts(e).then(function(e){var t,a,i,o,r=s.isStock&&e.dealMinMaxAmounts&&1<e.dealMinMaxAmounts.length?(o=e.dealMinMaxAmounts,[Math.ceil(o[0]),Math.floor(o[1])]):e.dealMinMaxAmounts,n=s.isStock&&r&&1<r.length?(t=e.defaultDealSize,a=r,(i=Math.ceil(t))<a[1]?i:Math.floor(t)):e.defaultDealSize;l.dealMinMaxAmounts(r),l.selectedDealAmount.extend({amountValidation:r}),l.selectedDealAmount(l.selectedDealAmount()||n)}).done(),l.ccyPair(s.ccyPair),l.amountSymbol(s.otherSymbol),l.baseSymbol(s.baseSymbol),l.baseSymbolName(y.GetTranslatedSymbolById(s.baseSymbol)),l.isForex(s.isForex),l.isShare(s.isShare),l.isFuture(s.isFuture),l.isStock(s.isStock),l.isNonForex(s.instrumentTypeId!==eInstrumentType.Currencies),l.decimalDigit(s.DecimalDigit),m.precision(s.DecimalDigit),L.containsKey("skipReset")&&L.get("skipReset")||(l.enableSLLimit(!1),l.enableTPLimit(!1),l.enableLimitLevel(!1),l.openLimit(""),l.openLimit.markClean(),l.openLimit.isModified(!1));var a=S.Translate(s);l.dealAmountLabel(a.label),t=e,A.Update(eRegistrationListName.SingleQuote,t),v(),c.UpdateSelectedWithToday(e),M.GetInBetweenQuote(w.prop.baseCcyId(),s.otherSymbol).then(function(e){l.quoteForAccountCcyToOtherCcy(e)}).done(),l.hasInstrument(!0),function(e){var t=b();if(!isNullOrUndefined(t)&&!1!==t){t.instrumentId=e;var a=D.GetActiveFormViewProperties(eViewTypes.vTransactionSwitcher),i=D.GetActiveFormViewProperties(eViewTypes.vNewPriceAlert);a&&a.visible()?D.ChangeViewState(eViewTypes.vTransactionSwitcher,eViewState.Update,t):i&&i.visible()&&D.ChangeViewState(eViewTypes.vNewPriceAlert,eViewState.Update,t)}}(e)}else l.hasInstrument(!1)}),s.subscribeTo(l.openLimit,function(e){l.limitCalc(e)}),s.subscribeTo(l.ValidationRules,function(e){l.openLimit.extend(e)});var t=s.getSettings().setlimitsConfiguration;d.Init(l,t),a=b()||{},i=a.tab,o=l.selectedInstrument(),r=a.instrumentId||l.selectedInstrument()||C.GetUserDefaultInstrumentId(),l.selectedInstrument(r),o===r&&l.selectedInstrument.notifySubscribers(r),isInt(a.orderDir)&&p(a.orderDir),a.selectedDealAmount&&l.selectedDealAmount(a.selectedDealAmount),l.initialToolTab(isDefinedType(i)&&isDefinedType(eNewDealTool[i])?eNewDealTool[i]:h.ProfileCustomer()[g.profileKeyForDefaultTab]||eNewDealTool.Chart);var a,i,o,r},dispose:function(){e(),l.selectedDealAmount.extend({amountValidation:!1}),L.unset("cachedOvernightFinancing"),n.dispose.call(s)},Data:l,BaseOrder:u,SetLimitsModel:d,ExpirationDate:c,LimitLevelField:m,fillData:function(e){if(e.positionNumber=0,e.instrumentID=l.selectedInstrument(),e.amount=l.selectedDealAmount(),e.orderDir=l.orderDir(),e.limitRate=l.openLimit(),e.ifDoneSLRate=0,e.ifDoneTPRate=0,l.enableSLLimit()&&(e.ifDoneSLRate=""===d.Data.stopLossRate()?0:d.Data.stopLossRate()),l.enableTPLimit()&&(e.ifDoneTPRate=""===d.Data.takeProfitRate()?0:d.Data.takeProfitRate()),c.Data.expirationDateSelector.IsGoodTillCancelChecked())e.expirationDate=null;else{e.expirationDate=c.Data.expirationDate();var t=c.Data.selectedHoursValue();isObjectType(t)&&isEmptyType(t)?e.expirationDate+="  "+t.value:isStringType(t)&&!isEmptyType(t)?e.expirationDate+="  "+t:e.expirationDate+="  00:00"}e.mode=eLimitMode.OpenDeal,e.type=eLimitType.None},onOpenLimit:function(e,t,a,i){l.hasInstrument(!0),l.isProcessing(!1);var o,r=C.GetInstrument(a),n=s.getSettings().onSuccessRedirectTo;r&&(u.ResultStatusSuccess(e)&&(C.SetInstrumentDealAmount(a,i.amount),f.postbox.publish("new-limit-success",{instrument:l.ccyPair()}),(o=h.ProfileCustomer()).defaultSlOrderTab=d.Data.curSlActiveTab(),o.defaultTpOrderTab=d.Data.curTpActiveTab(),h.ProfileCustomer(o),l.openLimit(String.empty),p(eOrderDir.None),d.Data.stopLossRate(String.empty),d.Data.takeProfitRate(String.empty),l.enableSLLimit(!1),l.enableTPLimit(!1)),n?u.OnActionReturn(e,t,r,{redirectToView:n,requestData:i}):(u.RaiseErrorEvent(e,"new-limit-error-details",{}),u.OnActionReturn(e,t,r,{requestData:i})))},unRegisterFromDispatcher:e,registerToDispatcher:function(){i.OnChange.Add(v)},setLimitTabsFromClientProfile:function(){var e=h.ProfileCustomer();e.defaultSlOrderTab?d.SetSlActiveTab(e.defaultSlOrderTab):d.SetSlActiveTab(eSetLimitsTabs.Amount),e.defaultTpOrderTab?d.SetTpActiveTab(e.defaultTpOrderTab):d.SetTpActiveTab(eSetLimitsTabs.Amount)}}})}),define("RateFieldModel",["require","knockout"],function(e){var t=e("knockout");return function(){var a=this,i=t.observable(Number.MIN_VALUE),o=t.observable(Number.MAX_VALUE),r=t.observable(Number.MIN_VALUE),n=t.observable(Number.MAX_VALUE);a.minValidation=a.minValidation1=t.observable(Number.MIN_VALUE),a.maxValidation=a.maxValidation1=t.observable(Number.MAX_VALUE),a.minValidation2=t.observable(Number.MIN_VALUE),a.maxValidation2=t.observable(Number.MAX_VALUE),a.precision=t.observable(0),a.pipDigit=t.observable(0),a.startSpinFrom=t.observable(eStartSpinFrom.None),a.near=t.observable(),a.far=t.observable(),a.min=a.min1=t.pureComputed({read:i,write:function(e){var t=Format.roundToPip(e,a.pipDigit(),a.precision(),">");!1===t&&i(Number.MIN_VALUE),i(Number(t)),a.minValidation1(e)},owner:a}),a.max=a.max1=t.pureComputed({read:o,write:function(e){var t=Format.roundToPip(e,a.pipDigit(),a.precision(),"<");!1===t&&o(Number.MAX_VALUE),o(Number(t)),a.maxValidation1(e)},owner:a}),a.min2=t.pureComputed({read:r,write:function(e){var t=Format.roundToPip(e,a.pipDigit(),a.precision(),">");!1===t&&r(Number.MIN_VALUE),r(Number(t)),a.minValidation2(e)},owner:a}),a.max2=t.pureComputed({read:n,write:function(e){var t=Format.roundToPip(e,a.pipDigit(),a.precision(),"<");!1===t&&n(Number.MAX_VALUE),n(Number(t)),a.maxValidation2(e)},owner:a}),a.format=t.pureComputed(function(){var e=parseInt(a.precision(),10);return!isNaN(e)&&0<=e?"n"+e:"n"}),a.step=t.pureComputed(function(){var e=parseInt(a.pipDigit(),10);return isNaN(e)?1:1/Math.pow(10,e)})}}),define("SetLimitsViewModel",["require","knockout","Dictionary","VmHelpers","LimitValuesCalculator","LimitRangesCalculator","ViewModelBase","RateFieldModel"],function(e){var _=e("knockout"),z=e("Dictionary"),J=e("VmHelpers"),Y=e("LimitValuesCalculator"),$=e("LimitRangesCalculator"),X=e("ViewModelBase"),Z=e("RateFieldModel");return function(){var i,u,c={SLLimitLabel:{},TPLimitLabel:{}},o=clone(X),d=new Z,m=new Z,e={},r=[],t=[],b=1,p=2,v=3,f=4,g=5,D=6,n=function(){c.State.subscribe(function(e){switch(e){case eViewState.Start:a();break;case eViewState.Stop:s()}})},a=function(){y(),w(),L(),j()},s=function(){C(),T(),J.CleanKoObservableSimpleObject(c),x()},l=function(){c.stopLossAmount.extend({positiveInteger:{message:z.GetItem("depCC_InvalidAmount"),params:!0}}),c.takeProfitAmount.extend({positiveInteger:{message:z.GetItem("depCC_InvalidAmount"),params:!0}}),c.displaySLAmount.extend({validation:{validator:function(){return c.stopLossAmount.isValid()},params:c.stopLossAmount}}),c.displayTPAmount.extend({validation:{validator:function(){return c.takeProfitAmount.isValid()},params:c.takeProfitAmount}}),c.ccySLAmount.extend({validation:{validator:function(){return c.stopLossAmount.isValid()},params:c.stopLossAmount}}),c.ccyTPAmount.extend({validation:{validator:function(){return c.takeProfitAmount.isValid()},params:c.takeProfitAmount}}),c.stopLossRate.extend({rate:{message:z.GetItem("limitLevelInvalid"),params:!0}}),c.takeProfitRate.extend({rate:{message:z.GetItem("limitLevelInvalid"),params:!0}}),c.stopLossPercent.extend({min:-.001,max:1000.001}),c.takeProfitPercent.extend({min:-.001,max:1000.001})},S=function(e){var t=$instrumentsManager.GetInstrument(e);t&&(c.decimalDigit(t.DecimalDigit),c.stopLossRate.extend({toNumericLength:{ranges:[{from:0,to:Number.MAX_SAFE_INTEGER,decimalDigits:c.decimalDigit()}],isAllowNAValue:!0}}),c.takeProfitRate.extend({toNumericLength:{ranges:[{from:0,to:Number.MAX_SAFE_INTEGER,decimalDigits:c.decimalDigit()}],isAllowNAValue:!0}}))},y=function(){S(c.instrumentId()),r.push(c.displaySLLimit.subscribe(function(e){var t=e.substring(1,e.length),a={rate:{message:z.GetItem("limitLevelInvalid"),params:!0},min:m.minValidation(),max:m.maxValidation()};c.stopLossRate.rules.removeAll(),c.stopLossRate.extend(a),c.stopLossAmount.rules.removeAll(),c.stopLossAmount.extend({validation:{validator:function(e){var t=c.SLLimitLabel.MinAmount(),a=c.SLLimitLabel.MaxAmount(),i=Math.abs(e);return isEmptyValue(e)||isEmptyValue(t)||isEmptyValue(a)?c.stopLossRate.isValid():t<=i&&i<=a&&c.stopLossRate.isValid()},params:c.stopLossRate}}),c.stopLossPercent.rules.removeAll(),c.stopLossPercent.extend({validation:{validator:function(e){var t=c.SLLimitLabel.MinPercent(),a=c.SLLimitLabel.MaxPercent();return isEmptyValue(e)||isEmptyValue(t)||isEmptyValue(a)?c.stopLossRate.isValid():t<=e&&e<=a&&c.stopLossRate.isValid()},params:c.stopLossRate}});var i=Format.tenthOfPipSplitRate(t,c.instrumentId());c.SLLimitLabel.First(i.label.first),c.SLLimitLabel.Last(i.label.last)})),r.push(c.displayTPLimit.subscribe(function(e){var t=e.substring(1,e.length),a={rate:{message:z.GetItem("limitLevelInvalid"),params:!0},min:d.minValidation(),max:d.maxValidation()};c.takeProfitRate.rules.removeAll(),c.takeProfitRate.extend(a),c.takeProfitAmount.rules.removeAll(),c.takeProfitAmount.extend({validation:{validator:function(e){var t=c.TPLimitLabel.MinAmount(),a=c.TPLimitLabel.MaxAmount(),i=Math.abs(e);return isEmptyValue(e)||isEmptyValue(t)||isEmptyValue(a)?c.takeProfitRate.isValid():t<=i&&i<=a&&c.takeProfitRate.isValid()},params:c.takeProfitRate}}),c.takeProfitPercent.rules.removeAll(),c.takeProfitPercent.extend({validation:{validator:function(e){var t=c.TPLimitLabel.MinPercent(),a=c.TPLimitLabel.MaxPercent();return isEmptyValue(e)||isEmptyValue(t)||isEmptyValue(a)?c.takeProfitRate.isValid():t<=e&&e<=a&&c.takeProfitRate.isValid()},params:c.takeProfitRate}});var i=Format.tenthOfPipSplitRate(t,c.instrumentId());c.TPLimitLabel.First(i.label.first),c.TPLimitLabel.Last(i.label.last)}))},T=function(){if(0<t.length)for(var e=0;e<t.length;e++)t[e].dispose();t.length=0},w=function(){c.SLLimit=_.computed(G,c).extend({dirty:!1}),t.push(c.SLLimit),c.TPLimit=_.computed(E,c).extend({dirty:!1}),t.push(c.TPLimit),c.isRangeChanged=_.computed(function(){var e=c.SLLimit(),t=c.TPLimit();return!isEmptyType(e)&&0<toNumeric(e.substring(1,e.length))||!isEmptyType(t)&&0<toNumeric(t.substring(1,t.length))}),t.push(c.isRangeChanged),c.showsAvalibleSetLimits=_.computed(function(){return isDefinedType(c.limitCalc())?!(0!=c.isShowTabs()||!o.getSettings(i).isAvalibleSetLimits||!c.limitCalc().isDirty()):!(0!=c.isShowTabs()||!o.getSettings(i).isAvalibleSetLimits)},c),t.push(c.showsAvalibleSetLimits),c.isSlRateDirty=_.computed(function(){var e=c.stopLossRate.isDirty()&&c.stopLossRate.isValid(),t=c.curSlActiveTab()==eSetLimitsTabs.None,a=c.curSlActiveTab()==eSetLimitsTabs.Rate;return(t||a)&&e}).extend({notify:"always"}),t.push(c.isSlRateDirty),c.isSlAmountDirty=_.computed(function(){var e=c.stopLossAmount.isDirty()&&c.stopLossAmount.isValid(),t=c.curSlActiveTab()==eSetLimitsTabs.None,a=c.curSlActiveTab()==eSetLimitsTabs.Amount;return(t||a)&&e}).extend({notify:"always"}),t.push(c.isSlAmountDirty),c.isSlPercentDirty=_.computed(function(){var e=c.stopLossPercent.isDirty()&&c.stopLossPercent.isValid(),t=c.curSlActiveTab()==eSetLimitsTabs.None,a=c.curSlActiveTab()==eSetLimitsTabs.Percent;return(t||a)&&e}).extend({notify:"always"}),t.push(c.isSlPercentDirty),c.isTpRateDirty=_.computed(function(){var e=c.takeProfitRate.isDirty()&&c.takeProfitRate.isValid(),t=c.curTpActiveTab()==eSetLimitsTabs.None,a=c.curTpActiveTab()==eSetLimitsTabs.Rate;return(t||a)&&e}).extend({notify:"always"}),t.push(c.isTpRateDirty),c.isTpAmountDirty=_.computed(function(){var e=c.takeProfitAmount.isDirty()&&c.takeProfitAmount.isValid(),t=c.curTpActiveTab()==eSetLimitsTabs.None,a=c.curTpActiveTab()==eSetLimitsTabs.Amount;return(t||a)&&e}).extend({notify:"always"}),t.push(c.isTpAmountDirty),c.isTpPercentDirty=_.computed(function(){var e=c.stopLossPercent.isDirty()&&c.stopLossPercent.isValid(),t=c.curTpActiveTab()==eSetLimitsTabs.None,a=c.curTpActiveTab()==eSetLimitsTabs.Percent;return(t||a)&&e}).extend({notify:"always"}),t.push(c.isTpPercentDirty),c.isDirty=_.computed(function(){return c.isSlRateDirty()||c.isSlAmountDirty()||c.isSlPercentDirty()||c.isTpRateDirty()||c.isTpAmountDirty()||c.isTpPercentDirty()}).extend({notify:"always"}),t.push(c.isDirty),c.isCustomerCurrency=_.computed(function(){return c.customerCcyName().toLowerCase()==c.symbolName().toLowerCase()}),t.push(c.isCustomerCurrency)},h=function(){c.instrumentId=_.computed(function(){return u.selectedInstrument?u.selectedInstrument():u.instrumentId?u.instrumentId():u.instrumentID?u.instrumentID():void 0}),c.bid=_.computed(function(){return u.bid()}),c.ask=_.computed(function(){return u.ask()}),c.open=_.computed(function(){if(u.open)return u.open()}),c.close=_.computed(function(){if(u.close)return u.close()}),c.change=_.computed(function(){if(u.change)return u.change()}),c.ccyPair=_.computed(function(){if(u.ccyPair)return u.ccyPair()}),c.orderDir=_.computed(function(){if(u.orderDir)return u.orderDir()}),c.quoteForOtherCcyToAccountCcy=_.computed(function(){if(u.quoteForOtherCcyToAccountCcy)return u.quoteForOtherCcyToAccountCcy()}).extend({empty:!0}),c.symbolName=_.computed(function(){return u.symbolName?u.symbolName():u.baseSymbolName?u.baseSymbolName():void 0}),c.amountSymbol=_.computed(function(){if(u.amountSymbol)return u.amountSymbol()}),c.selectedDealAmount=_.computed(function(){return isDefinedType(u.selectedDealAmount)?toNumeric(u.selectedDealAmount()):void 0}),c.limitCalc=_.computed(function(){return isDefinedType(u.limitCalc)?u.limitCalc:isDefinedType(u.openLimit)?u.openLimit:void 0}),c.additionalPL=_.pureComputed(function(){return isDefinedType(u.additionalPL)?toNumeric(u.additionalPL()):void 0})},C=function(){if(0<r.length)for(var e=0;e<r.length;e++)r[e].dispose();r.length=0},A=function(){return{bid:c.limitCalc()?c.limitCalc():c.bid,ask:c.limitCalc()?c.limitCalc():c.ask}},M=function(e){if(isEmptyValue(e)||"NA"===e)return e;var t=parseFloat(e);return t=Math.abs(t),t=Math.ceil(t)},L=function(){var e=A(),t=e.bid,a=e.ask,i=debounce(function(){O()},50);r.push(t.subscribe(i)),r.push(a.subscribe(i)),r.push(c.selectedDealAmount.subscribe(function(){O()})),r.push(c.orderDir.subscribe(i)),r.push(c.quoteForOtherCcyToAccountCcy.subscribe(i)),r.push(c.SLLimit.subscribe(function(e){isEmptyValue(e)||i()})),r.push(c.TPLimit.subscribe(function(e){isEmptyValue(e)||i()})),r.push(c.stopLossAmount.subscribe(function(e){isEmptyType(e)?(c.stopLossPercent(""),c.stopLossRate(""),c.ccySLAmount(""),c.displaySLAmount("")):c.curSlActiveTab()===eSetLimitsTabs.Amount?(N(b),_.postbox.publish("stop-loss-changed","amount")):c.displaySLAmount(M(e))})),r.push(c.displaySLAmount.subscribe(function(e){c.curSlActiveTab()===eSetLimitsTabs.Amount&&c.stopLossAmount(e)})),r.push(c.stopLossPercent.subscribe(function(e){isEmptyType(e)?(c.stopLossAmount(""),c.stopLossRate(""),c.ccySLAmount(""),c.displaySLAmount("")):c.curSlActiveTab()===eSetLimitsTabs.Percent&&(N(v),_.postbox.publish("stop-loss-changed","percent"))})),r.push(c.stopLossRate.subscribe(function(e){if(isEmptyType(e))return c.stopLossAmount(""),c.stopLossPercent(""),c.ccySLAmount(""),c.displaySLAmount(""),void c.displaySLSummary(!1);c.curSlActiveTab()!==eSetLimitsTabs.Rate&&c.curSlActiveTab()!=c.defaultTab||(N(p),_.postbox.publish("stop-loss-changed","rate"));var t=Format.toRate(e,!0,c.instrumentId()),a=Format.tenthOfPipSplitRate(t,c.instrumentId());c.SLRateLabel.First(a.label.first),c.SLRateLabel.Last(a.label.last),c.displaySLSummary(!0)})),r.push(c.takeProfitAmount.subscribe(function(e){isEmptyType(e)?(c.takeProfitPercent(""),c.takeProfitRate(""),c.ccyTPAmount(""),c.displayTPAmount("")):c.curTpActiveTab()===eSetLimitsTabs.Amount?(N(f),_.postbox.publish("take-profit-changed","amount")):c.displayTPAmount(M(e))})),r.push(c.displayTPAmount.subscribe(function(e){c.curTpActiveTab()===eSetLimitsTabs.Amount&&c.takeProfitAmount(e)})),r.push(c.takeProfitPercent.subscribe(function(e){isEmptyType(e)?(c.takeProfitAmount(""),c.takeProfitRate(""),c.ccyTPAmount(""),c.displayTPAmount("")):c.curTpActiveTab()===eSetLimitsTabs.Percent&&(N(D),_.postbox.publish("take-profit-changed","percent"))})),r.push(c.takeProfitRate.subscribe(function(e){if(isEmptyType(e))return c.takeProfitAmount(""),c.takeProfitPercent(""),c.ccyTPAmount(""),c.displayTPAmount(""),void c.displayTPSummary(!1);c.curTpActiveTab()!==eSetLimitsTabs.Rate&&c.curTpActiveTab()!=c.defaultTab||(N(g),_.postbox.publish("take-profit-changed","rate"));var t=Format.toRate(e,!0,c.instrumentId()),a=Format.tenthOfPipSplitRate(t,c.instrumentId());c.TPRateLabel.First(a.label.first),c.TPRateLabel.Last(a.label.last),c.displayTPSummary(!0)})),r.push(c.isShowTabs.subscribe(function(e){!0===e&&(u.slRate&&!isEmptyType(u.slRate())&&toNumeric(u.slRate())?c.stopLossRate(u.slRate()):c.stopLossRate(""),u.tpRate&&!isEmptyType(u.tpRate())&&toNumeric(u.tpRate())?c.takeProfitRate(u.tpRate()):c.takeProfitRate(""),x())})),r.push(c.instrumentId.subscribe(function(){S(c.instrumentId())}))},I=function(){e.isNewLimit=function(){return o.getSettings(i).parentView==eViewTypes.vNewLimit},e.isNewDeal=function(){return o.getSettings(i).parentView==eViewTypes.vNewDeal||o.getSettings(i).parentView==eViewTypes.vNewDealSlip}},P=function(e,t){var a,i,o,r,n=A(),s=_.utils.unwrapObservable(e);if(!s)return"";if(c.quoteForOtherCcyToAccountCcy.isEmpty())return"";if(a=s.substring(0,1),i=s.substring(1,s.length),o=parseFloat(i),t==eLimitType.StopLoss&&(r=c.SLRange),t==eLimitType.TakeProfit&&(r=c.TPRange),!isDefinedType(r))return"";">"===a&&(o+=1/Math.pow(10,c.decimalDigit())),"<"===a&&(o-=1/Math.pow(10,c.decimalDigit()));var l=Y.CalculateValuesFromRate(n.bid(),n.ask(),o,c.orderDir(),t,c.selectedDealAmount(),r,c.quoteForOtherCcyToAccountCcy(),c.instrumentId());return l.isValid?l:""},V=function(e,t){var a=Math.pow(10,t);return Math.ceil(e*a)/a},R=function(e,t){var a=Math.pow(10,t);return Math.round(e*a)/a},F=function(e,t){var a=Math.pow(10,t);return Math.floor(e*a)/a},k=function(){e.isAdvancedView=_.observable(!1),c.SLRateLabel={First:_.observable(""),Last:_.observable("")},c.TPRateLabel={First:_.observable(""),Last:_.observable("")},c.SLLimitLabel.First=_.observable(""),c.SLLimitLabel.Last=_.observable(""),c.SLLimitLabel.BaseCcyAboveAmount=_.observable("").extend({empty:!0}),c.SLLimitLabel.BaseCcyMinAmount=_.observable(""),c.SLLimitLabel.BaseCcyMaxAmount=_.observable(""),c.SLLimitLabel.MinAmount=_.computed(function(){var e=P(m.near,eLimitType.StopLoss),t="",a="",i="";return isEmptyValue(e)||(t=Math.abs(Number(e.amount))||0,i=(a=Math.ceil(Math.abs(Number(e.value)))||1)-1),c.SLLimitLabel.BaseCcyMinAmount(a),c.SLLimitLabel.BaseCcyAboveAmount(i),t}),c.SLLimitLabel.MaxAmount=_.computed(function(){var e,t,a=P(m.far,eLimitType.StopLoss);return isEmptyValue(a)||(e=Math.abs(Number(a.amount))||1,t=Math.floor(Math.abs(Number(a.value)))||1),c.SLLimitLabel.BaseCcyMaxAmount(t),e}),c.SLLimitLabel.AbovePercent=_.observable("").extend({empty:!0}),c.SLLimitLabel.MinPercent=_.pureComputed(function(){var e,t,a,i=_.toJS(c.decimalDigit),o=c.orderDir(),r=_.toJS(m.minValidation),n=_.toJS(m.maxValidation),s=A(),l=s.bid(),u=s.ask();if(!(isEmptyValue(l)||isEmptyValue(u)||isEmptyValue(r)||isEmptyValue(n)))return e=o===eOrderDir.Sell?(a=r+1/Math.pow(10,i),Y.CalculatePercentFromRate(l,a)):(a=n-1/Math.pow(10,i),Y.CalculatePercentFromRate(u,a)),e=V(e,2),t=R(e-1/Math.pow(10,2),2),c.SLLimitLabel.AbovePercent(t),e}).extend({empty:!0}),c.SLLimitLabel.MaxPercent=_.pureComputed(function(){var e,t=c.orderDir(),a=_.toJS(m.minValidation),i=_.toJS(m.maxValidation),o=A(),r=o.bid(),n=o.ask();if(!(isEmptyValue(r)||isEmptyValue(n)||isEmptyValue(a)||isEmptyValue(i)))return e=t===eOrderDir.Sell?Y.CalculatePercentFromRate(r,i):Y.CalculatePercentFromRate(n,a),e=F(e,2)}),c.TPLimitLabel.First=_.observable(""),c.TPLimitLabel.Last=_.observable(""),c.TPLimitLabel.BaseCcyAboveAmount=_.observable("").extend({empty:!0}),c.TPLimitLabel.BaseCcyMinAmount=_.observable(""),c.TPLimitLabel.BaseCcyMaxAmount=_.observable(""),c.TPLimitLabel.MinAmount=_.computed(function(){var e=P(d.near,eLimitType.TakeProfit),t="",a="",i="";return isEmptyValue(e)||(t=Math.abs(Number(e.amount))||0,i=(a=Math.ceil(Math.abs(Number(e.value)))||1)-1),c.TPLimitLabel.BaseCcyMinAmount(a),c.TPLimitLabel.BaseCcyAboveAmount(i),t}),c.TPLimitLabel.MaxAmount=_.computed(function(){var e,t,a=P(d.far,eLimitType.TakeProfit);return isEmptyValue(a)||(e=Math.abs(Number(a.amount))||1,t=Math.floor(Math.abs(Number(a.value)))||1),c.TPLimitLabel.BaseCcyMaxAmount(t),e}),c.TPLimitLabel.AbovePercent=_.observable("").extend({empty:!0}),c.TPLimitLabel.MinPercent=_.pureComputed(function(){var e,t,a,i=_.toJS(c.decimalDigit),o=c.orderDir(),r=_.toJS(d.minValidation),n=_.toJS(d.maxValidation),s=A(),l=s.bid(),u=s.ask();if(!(isEmptyValue(l)||isEmptyValue(u)||isEmptyValue(r)||isEmptyValue(n)))return e=o===eOrderDir.Sell?(a=n-1/Math.pow(10,i),Y.CalculatePercentFromRate(l,a)):(a=r+1/Math.pow(10,i),Y.CalculatePercentFromRate(u,a)),e=V(e,2),t=R(e-1/Math.pow(10,2),2),c.TPLimitLabel.AbovePercent(t),e}),c.TPLimitLabel.MaxPercent=_.pureComputed(function(){var e,t=c.orderDir(),a=_.toJS(d.minValidation),i=_.toJS(d.maxValidation),o=A(),r=o.bid(),n=o.ask();if(!(isEmptyValue(r)||isEmptyValue(n)||isEmptyValue(a)||isEmptyValue(i)))return e=t===eOrderDir.Sell?Y.CalculatePercentFromRate(r,a):Y.CalculatePercentFromRate(n,i),e=F(e,2)}),c.stopLossAmount=_.observable("").extend({dirty:!1}),c.displaySLAmount=_.observable("").extend({toNumericLength:{ranges:[{from:0,to:Number.MAX_SAFE_INTEGER,decimalDigits:0}],isAllowNAValue:!0}}),c.takeProfitAmount=_.observable("").extend({dirty:!1}),c.displayTPAmount=_.observable("").extend({toNumericLength:{ranges:[{from:0,to:Number.MAX_SAFE_INTEGER,decimalDigits:0}],isAllowNAValue:!0}}),c.stopLossRate=_.observable("").extend({dirty:!1}),c.takeProfitRate=_.observable("").extend({dirty:!1}),c.stopLossPercent=_.observable("").extend({dirty:!1,toNumericLength:{ranges:[{from:0,to:Number.MAX_SAFE_INTEGER,decimalDigits:2}],isForceCeil:!0,isAllowNAValue:!0},incremental:{ranges:[{from:0,to:.1,step:.01},{from:.1,to:.5,step:.05},{from:.5,to:5,step:.1},{from:5,to:10,step:.5},{from:10,to:Number.MAX_VALUE,step:1}]}}),c.takeProfitPercent=_.observable("").extend({dirty:!1,toNumericLength:{ranges:[{from:0,to:Number.MAX_SAFE_INTEGER,decimalDigits:2}],isForceCeil:!0,isAllowNAValue:!0},incremental:{ranges:[{from:0,to:.1,step:.01},{from:.1,to:.5,step:.05},{from:.5,to:5,step:.1},{from:5,to:10,step:.5},{from:10,to:Number.MAX_VALUE,step:1}]}}),c.ccySLAmount=_.observable(""),c.ccyTPAmount=_.observable(""),c.customerCcyName=_.observable(""),c.curSlActiveTab=_.observable(eSetLimitsTabs.NoTabs),c.curTpActiveTab=_.observable(eSetLimitsTabs.NoTabs),c.visibleTab=_.observable(eSetLimitsTabs.NoTabs),c.isShowTabs=_.observable(!1),c.isAmountAvailable=!isDefinedType(o.getSettings(i).showSetLimitsAmountTab)||o.getSettings(i).showSetLimitsAmountTab,c.State=_.observable(""),c.displaySLLimit=_.observable(""),c.displayTPLimit=_.observable(""),c.SLRange=new LimitRange,c.TPRange=new LimitRange,c.SetActiveTab=H,c.SetSlActiveTab=Q,c.SetTpActiveTab=W,c.ChangeTabVisibility=K,c.decimalDigit=_.observable(0),c.displaySLSummary=_.observable(!1),c.displayTPSummary=_.observable(!1)},x=function(){c.stopLossRate.markClean(),c.takeProfitRate.markClean(),c.stopLossAmount.markClean(),c.takeProfitAmount.markClean(),c.stopLossPercent.markClean(),c.takeProfitPercent.markClean()},N=function(e){if(c.State()==eViewState.Start){var t=A(),a=t.bid,i=t.ask;switch(e){case b:var o=Y.CalculateValuesFromAmount(a(),i(),c.stopLossAmount(),c.orderDir(),eLimitType.StopLoss,c.selectedDealAmount(),c.SLRange,c.quoteForOtherCcyToAccountCcy(),c.instrumentId());c.stopLossRate(o.rate),c.stopLossPercent(o.percent),c.ccySLAmount(o.value);break;case p:var r=Y.CalculateValuesFromRate(a(),i(),c.stopLossRate(),c.orderDir(),eLimitType.StopLoss,c.selectedDealAmount(),c.SLRange,c.quoteForOtherCcyToAccountCcy(),c.instrumentId(),c.additionalPL());c.stopLossAmount(r.amount),c.stopLossPercent(r.percent),c.ccySLAmount(r.value);break;case v:var n=Y.CalculateValuesFromPercent(a(),i(),c.stopLossPercent(),c.orderDir(),eLimitType.StopLoss,c.selectedDealAmount(),c.SLRange,c.quoteForOtherCcyToAccountCcy(),c.instrumentId());c.stopLossRate(n.rate),c.stopLossAmount(n.amount),c.ccySLAmount(n.value);break;case f:var s=Y.CalculateValuesFromAmount(a(),i(),c.takeProfitAmount(),c.orderDir(),eLimitType.TakeProfit,c.selectedDealAmount(),c.TPRange,c.quoteForOtherCcyToAccountCcy(),c.instrumentId());c.takeProfitRate(s.rate),c.takeProfitPercent(s.percent),c.ccyTPAmount(s.value);break;case g:var l=Y.CalculateValuesFromRate(a(),i(),c.takeProfitRate(),c.orderDir(),eLimitType.TakeProfit,c.selectedDealAmount(),c.TPRange,c.quoteForOtherCcyToAccountCcy(),c.instrumentId(),c.additionalPL());c.takeProfitAmount(l.amount),c.takeProfitPercent(l.percent),c.ccyTPAmount(l.value);break;case D:var u=Y.CalculateValuesFromPercent(a(),i(),c.takeProfitPercent(),c.orderDir(),eLimitType.TakeProfit,c.selectedDealAmount(),c.TPRange,c.quoteForOtherCcyToAccountCcy(),c.instrumentId());c.takeProfitRate(u.rate),c.takeProfitAmount(u.amount),c.ccyTPAmount(u.value)}}},O=function(){c.curSlActiveTab()===eSetLimitsTabs.Amount&&isNumber(c.stopLossAmount())&&N(b),c.curTpActiveTab()===eSetLimitsTabs.Amount&&isNumber(c.takeProfitAmount())&&N(f),c.curSlActiveTab()===eSetLimitsTabs.Rate&&isNumber(c.stopLossRate())&&N(p),c.curTpActiveTab()===eSetLimitsTabs.Rate&&isNumber(c.takeProfitRate())&&N(g),c.curSlActiveTab()===eSetLimitsTabs.Percent&&isNumber(c.stopLossPercent())&&N(v),c.curTpActiveTab()===eSetLimitsTabs.Percent&&isNumber(c.takeProfitPercent())&&N(D)},E=function(){var e=c.bid(),t=c.ask();if(isEmptyValue(e)||isEmptyValue(t))return c.displayTPLimit(""),"";var a=!u.openLimit||u.openLimit.isValid(),i=c.orderDir(),o=$instrumentsManager.GetInstrument(c.instrumentId());if(!o)return"";B()?$.CalculateIfDoneRanges(e,t,c.orderDir(),c.SLRange,c.TPRange,u.openLimit(),o,$csFlagsManager.CSFlags.limitMultiplier):$.CalculateClosingRanges(e,t,c.orderDir(),c.SLRange,c.TPRange,o,$csFlagsManager.CSFlags.limitMultiplier),c.decimalDigit(o.DecimalDigit);var r=parseFloat(Format.toRate(c.TPRange.near(),!0,o.id)),n=parseFloat(Format.toRate(c.TPRange.far(),!0,o.id));d.precision(o.DecimalDigit),d.pipDigit(o.PipDigit),d.min(i==eOrderDir.Sell?n:r),d.max(i==eOrderDir.Sell?r:n);var s=addSign(c.orderDir(),eLimitType.TakeProfit),l=s+Format.toRate(c.TPRange.near(),!0,o.id);return">"===s?(d.startSpinFrom(eStartSpinFrom.Above),d.near(">"+r),d.far("<"+n)):(d.startSpinFrom(eStartSpinFrom.Below),d.near("<"+r),d.far(">"+n)),void 0!==u.openLimit&&(i!==eOrderDir.None&&u.openLimit.isValid()||d.startSpinFrom(eStartSpinFrom.None)),a?(c.displayTPLimit(l),l):(c.displayTPLimit(""),"")},G=function(){var e=c.bid(),t=c.ask();if(isEmptyValue(e)||isEmptyValue(t))return c.displaySLLimit(""),"";var a=!u.openLimit||u.openLimit.isValid(),i=c.orderDir(),o=$instrumentsManager.GetInstrument(c.instrumentId());if(!o)return"";B()?$.CalculateIfDoneRanges(e,t,c.orderDir(),c.SLRange,c.TPRange,u.openLimit(),o,$csFlagsManager.CSFlags.limitMultiplier):$.CalculateClosingRanges(e,t,c.orderDir(),c.SLRange,c.TPRange,o,$csFlagsManager.CSFlags.limitMultiplier),c.decimalDigit(o.DecimalDigit);var r=parseFloat(Format.toRate(c.SLRange.near(),!0,o.id)),n=parseFloat(Format.toRate(c.SLRange.far(),!0,o.id));m.precision(o.DecimalDigit),m.pipDigit(o.PipDigit),m.min(i==eOrderDir.Sell?r:n),m.max(i==eOrderDir.Sell?n:r);var s=addSign(i,eLimitType.StopLoss),l=s+Format.toRate(c.SLRange.near(),!0,o.id);return">"===s?(m.startSpinFrom(eStartSpinFrom.Above),m.near(">"+r),m.far("<"+n)):(m.startSpinFrom(eStartSpinFrom.Below),m.near("<"+r),m.far(">"+n)),void 0!==u.openLimit&&(i!==eOrderDir.None&&u.openLimit.isValid()||m.startSpinFrom(eStartSpinFrom.None)),a?(c.displaySLLimit(l),l):(c.displaySLLimit(""),"")},B=function(){return u.PageName===eDealPage.NewLimitViewModel||u.PageName===eDealPage.EditLimitViewModel||u.PageName===eDealPage.EditIfDoneLimit};function U(){return c.stopLossRate.isValid()?[]:[z.GetItem("slLeveInvalid")]}function q(){return c.takeProfitRate.isValid()?[]:[z.GetItem("tpLeveInvalid")]}function H(e){Q(e),W(e)}function Q(e){(e=e||eSetLimitsTabs.None)==eSetLimitsTabs.None&&(u.slRate&&_.isWriteableObservable(u.slRate)&&u.slRate(z.GetItem("setLimit")),c.stopLossRate(""),c.stopLossAmount(""),c.stopLossPercent(""),c.ccySLAmount(""),u.tpRate&&_.isWriteableObservable(u.tpRate)&&u.tpRate(z.GetItem("setLimit")),_.postbox.publish("stop-loss-changed","none")),c.curSlActiveTab(e)}function W(e){(e=e||eSetLimitsTabs.None)==eSetLimitsTabs.None&&(u.tpRate&&_.isWriteableObservable(u.tpRate)&&u.tpRate(z.GetItem("setLimit")),c.takeProfitRate(""),c.takeProfitAmount(""),c.takeProfitPercent(""),c.ccyTPAmount(""),_.postbox.publish("take-profit-changed","none")),c.curTpActiveTab(e)}function K(e){(e=e||eSetLimitsTabs.None)==eSetLimitsTabs.None?(H(e),c.isShowTabs(!1)):c.isShowTabs(!0),_.postbox.publish("deal-slip-toggle",{limit:e===eSetLimitsTabs.None?"minimized":"maximized"}),c.visibleTab(e)}var j=function(){c.customerCcyName($customer.prop.defaultCcy()),c.isShowTabs(!1),e.isAdvancedView(!1),c.defaultTab=o.getSettings(i).defaultTab,H(c.defaultTab),c.stopLossAmount(""),c.stopLossPercent(""),c.ccySLAmount(""),c.displaySLSummary(!1),c.takeProfitAmount(""),c.takeProfitPercent(""),c.ccyTPAmount(""),c.displayTPSummary(!1),u.slRate&&!isEmptyType(u.slRate())&&toNumeric(u.slRate())?c.stopLossRate(u.slRate()):c.stopLossRate(""),u.tpRate&&!isEmptyType(u.tpRate())&&toNumeric(u.tpRate())?c.takeProfitRate(u.tpRate()):c.takeProfitRate(""),x(),_.postbox.publish("stop-loss-changed","none"),_.postbox.publish("take-profit-changed","none")};return{TPField:d,SLField:m,Data:c,ObservableSetLimitsObject:c,ViewProperties:e,Init:function(e,t){i=this;var a={AdvancedMode:!0,isAvalibleSetLimits:!0,defaultTab:eSetLimitsTabs.Amount,defaultDataState:eViewState.Initial,parentView:eViewTypes.vNewDeal};o.setSettings(i,t,a),u=e,h(),I(),k(),n(),c.State(eViewState.Initial),l()},Validate:function(){return[].concat(U(),q())},ValidateSlRate:U,ValidateTpRate:q,SetInitial:j,MarkClean:x,SetActiveTab:H,SetSlActiveTab:Q,SetTpActiveTab:W,ChangeTabVisibility:K,State:function(){return c.State()},Start:function(e){c.State(eViewState.Start),isFunctionType(e)&&e()},Stop:function(){c.State(eViewState.Stop)}}}}),define("viewModels/BaseSearchCountryViewModel",["require","knockout","KoComponentViewModel","Dictionary","SystemInfo"],function(e){var l=e("knockout"),u=e("Dictionary"),t=e("KoComponentViewModel"),c=e("SystemInfo");return extendClass(t,function(n){var s=this.parent.Data;return{Init:function(){if(!1===(n&&n.countries&&!isEmptyValue(n.countries)&&(!isEmptyValue(n.countryId)||!isEmptyValue(n.country))))throw new Error("Params is empty");var e,t,a,i,o;s.countries=l.observableArray(),s.selectedCountry=l.observable(),s.selectedCountry.subscribe(function(e){var t;t=e,isFunctionType(n.country)&&n.country(t),isFunctionType(n.countryId)&&n.countryId(t.id),isFunctionType(n.onClick)&&n.onClick()}),t=function(e){var t=[],a=c.get("uiExclusionCountries")||[];if(isArrayType(e))t=e.slice();else{var i=Object.keys(e);i.forEach(function(e){t.push({id:e})})}return t.filter(function(t){return!Object.keys(a).find(function(e){return e==t.id})})}(isFunctionType(n.countries)?n.countries():n.countries),a=[],t&&t.forEach(function(e){var t=u.GetItem("cntr_"+e.id,"country_names");a.push(Object.assign({},e,{text:t,label:t,fullText:latinizeString(t)}))}),e=a,s.countries(e),s.countries&&s.countries.sort(function(e,t){return e.text.localeCompare(t.text)}),r=null,isFunctionType(n.country)&&!isEmptyValue(n.country().id)?r=n.country().id:isFunctionType(n.countryId)&&!isEmptyValue(n.countryId())&&(r=n.countryId()),i=r,o=s.countries().find(function(e){return parseInt(e.id)===parseInt(i)}),s.selectedCountry(o||s.countries()[0]);var r},SetCountry:function(e){s.selectedCountry(e)},Data:s}})}),define("viewModels/InstrumentPriceAlertViewModel",["require","ActiveLimitsManager","KoComponentViewModel","knockout"],function(e){var r=e("ActiveLimitsManager"),n=e("knockout"),t=e("KoComponentViewModel"),a=extendClass(t,function(e){var t=this,a=this.parent,i=this.Data;if(!e.instrumentId)throw new Error("Missing instrument id paramerter");function o(){i.isOn(r.HasPriceAlerts(n.unwrap(e.instrumentId)))}return i.isOn=e.isOnObservable||n.observable(),i.isOn(r.HasPriceAlerts(n.unwrap(e.instrumentId))),r.OnChange.Add(o),n.isObservable(e.instrumentId)&&e.instrumentId.subscribe(function(){o()}),{dispose:function(){a.dispose.call(t),r.OnChange.Remove(o)},Data:i}});return{viewModel:{createViewModel:function(e){return new a(e)}}}}),define("mobileViewModels/MarketInfoToolViewModel",["require","knockout","CustomerProfileManager","viewModels/Deals/BaseMarketInfoToolViewModel","marketInfoSectionsConfiguration"],function(e){var d=e("knockout"),n=e("CustomerProfileManager"),m=e("StateObject!Transaction"),t=e("viewModels/Deals/BaseMarketInfoToolViewModel"),s=e("marketInfoSectionsConfiguration"),a=extendClass(t,function(e){var o=this,r=this.parent,u=this.Data;function c(e,t){var a=n.ProfileCustomer();a[e]=t?1:0,n.ProfileCustomer(a)}return{init:function(e){var t,a,i;r.init.call(o,e),u.expandHighLow=d.observable(),t=n.ProfileCustomer(),isNullOrUndefined(t.tsArea)&&isNullOrUndefined(t.iiArea)&&isNullOrUndefined(t.hlArea)&&isNullOrUndefined(t.miArea)?(i=["openTradingSentiments","openMarketInfo","openHighLow","openInstrumentInfo"],Object.keys(eMarketInfoSectionsProps).forEach(function(e){u[i[eMarketInfoSectionsProps[e]]]=s[e],c(e,s[e])})):(a=t,u.openTradingSentiments=!!a.tsArea,u.openMarketInfo=!!a.miArea,u.openHighLow=!!a.hlArea,u.openInstrumentInfo=!!a.iiArea)},OnExpandClick:function(e,t,a){var i,o,r,n,s,l;a===eMarketInfoNameEvent.HighLow&&u.expandHighLow(t),c(e,t),i=t,o=a,r=m.get("PageName"),n=i?eAccordionState.expand:eAccordionState.collapse,s=eMarketInfoPrefixEvent[r],l=String.format("{0}-{1}-{2}",s,n,o),d.postbox.publish(l)},dispose:r.dispose,NewDealData:r.NewDealData,ViewSentimentsButtonHandler:r.ViewSentimentsButtonHandler}});return{viewModel:{createViewModel:function(e){var t=new a(e);return t.init(),t}}}}),define("mobileViewModels/AccountCardRecordsViewModel",["knockout","KoComponentViewModel","viewModels/AccountCardRecordsBaseViewModel","customBindings/InfiniteScrollBinding"],function(e,t,a){var i=extendClass(a,function(){var t=this,a=this.parent;return{init:function(e){a.init.call(t,e)},BalanceInfo:a.BalanceInfo,GetNextBalance:function(){a.GetNextBalance.call(t)},VisibleShowMore:a.VisibleShowMore,DataSet:a.DataSet,Filter:a.Filter,EnableApplyButton:a.enableApplyButton,HasRecords:a.HasRecords,DsColumns:a.DsColumns}});return{viewModel:{createViewModel:function(e){var t=new i;return t.init(e),t}}}}),define("mobileViewModels/ChartToolViewModel",["require","knockout","NewDealMobileChart","StateObject!Transaction"],function(e){var m=e("knockout"),t=e("NewDealMobileChart"),b=e("StateObject!Transaction"),a=extendClass(t,function(){var o=this,r=this.parent,n=this.Data,s=b.getAll(),a=[],l=[];function u(){for(var e=0;e<a.length;e++)a[e].dispose();a.length=0,r.DeletePriceLine(eChartPriceLineType.StopLoss),r.DeletePriceLine(eChartPriceLineType.TakeProfit),r.DeletePriceLine(eChartPriceLineType.LimitLevel);var t=b.getAll();t.selectedTab?t.selectedTab===eTransactionSwitcher.NewDeal?(t.stopLossRateDeal&&m.isObservable(t.stopLossRateDeal)&&a.push(o.subscribeAndNotify(t.stopLossRateDeal,function(e){r.DrawPriceLine(eChartPriceLineType.StopLoss,e,t.chart.keys.stopLoss)})),t.takeProfitRateDeal&&m.isObservable(t.takeProfitRateDeal)&&a.push(o.subscribeAndNotify(t.takeProfitRateDeal,function(e){r.DrawPriceLine(eChartPriceLineType.TakeProfit,e,t.chart.keys.takeProfit)}))):(t.stopLossRateLimit&&m.isObservable(t.stopLossRateLimit)&&a.push(o.subscribeAndNotify(t.stopLossRateLimit,function(e){r.DrawPriceLine(eChartPriceLineType.StopLoss,e,t.chart.keys.stopLoss)})),t.takeProfitRateLimit&&m.isObservable(t.takeProfitRateLimit)&&a.push(o.subscribeAndNotify(t.takeProfitRateLimit,function(e){r.DrawPriceLine(eChartPriceLineType.TakeProfit,e,t.chart.keys.takeProfit)})),t.openLimit&&m.isObservable(t.openLimit)&&a.push(o.subscribeAndNotify(t.openLimit,function(e){r.DrawPriceLine(eChartPriceLineType.LimitLevel,e,t.chart.keys.limitLevel)}))):t.openLimit&&m.isObservable(t.openLimit)&&o.subscribeAndNotify(t.openLimit,function(e){r.DrawPriceLine(eChartPriceLineType.LimitLevel,e,t.chart.keys.limitLevel)}),t.stopLossRate&&m.isObservable(t.stopLossRate)?o.subscribeAndNotify(t.stopLossRate,function(e){r.DrawPriceLine(eChartPriceLineType.StopLoss,e,t.chart.keys.stopLoss)}):t.slRate&&(m.isObservable(t.slRate)?o.subscribeAndNotify(t.slRate,function(e){r.DrawPriceLine(eChartPriceLineType.StopLoss,e,t.chart.keys.stopLoss)}):r.DrawPriceLine(eChartPriceLineType.StopLoss,t.slRate,t.chart.keys.stopLoss)),t.takeProfitRate&&m.isObservable(t.takeProfitRate)?o.subscribeAndNotify(t.takeProfitRate,function(e){r.DrawPriceLine(eChartPriceLineType.TakeProfit,e,t.chart.keys.takeProfit)}):t.tpRate&&(m.isObservable(t.tpRate)?o.subscribeAndNotify(t.tpRate,function(e){r.DrawPriceLine(eChartPriceLineType.TakeProfit,e,t.chart.keys.takeProfit)}):r.DrawPriceLine(eChartPriceLineType.TakeProfit,t.tpRate,t.chart.keys.takeProfit)),t.dealRate&&r.DrawPriceLine(eChartPriceLineType.OpenRate,t.dealRate,t.chart.keys.openRate)}function c(e){var t=e===eOrderDir.None?eOrderDir.Buy:e;return s.chart.direction===eChartDirection.Opposite&&(t=t===eOrderDir.Sell?eOrderDir.Buy:eOrderDir.Sell),t}function d(e,t){var a=b.getAll();switch(a.switchToRate&&isFunctionType(a.switchToRate)&&a.switchToRate(),e){case eChartPriceLineType.LimitLevel:a.openLimit&&m.isObservable(a.openLimit)&&a.openLimit(t);break;case eChartPriceLineType.StopLoss:a.stopLossRate&&m.isObservable(a.stopLossRate)?a.stopLossRate(t):a.stopLossRateDeal&&m.isObservable(a.stopLossRateDeal)?a.stopLossRateDeal(t):a.slRate&&m.isObservable(a.slRate)&&a.slRate(t);break;case eChartPriceLineType.TakeProfit:a.takeProfitRate&&m.isObservable(a.takeProfitRate)?a.takeProfitRate(t):a.takeProfitRateDeal&&m.isObservable(a.takeProfitRateDeal)?a.takeProfitRateDeal(t):a.tpRate&&m.isObservable(a.tpRate)&&a.tpRate(t)}}return{init:function(e){var t,a,i;n.isChartReady=m.observable(!1),n.isLoadingData=m.observable(!1),e=$.extend(e,(t=c(m.utils.unwrapObservable(s.orderDir)),{additionalStartArgs:{instrumentId:s.selectedInstrument(),orderDir:t,currentRateKey:s.chart.keys.currentRate,instanceType:eChartInstanceType.newDealMobile,containerSuffix:String.empty,isLoadingData:n.isLoadingData,onPriceLineDragged:d,allowDragLine:s.chart.allowDragLine}})),r.init.call(o,e),a=o.subscribeTo(n.isLoadingData,function(e){e||(n.isChartReady(!0),a.dispose())}),i=b.getAll(),o.subscribeTo(i.selectedInstrument,function(e){r.ChangeSymbol(e,c(i.orderDir()))}),o.subscribeTo(i.orderDir,function(e){var t=b.getAll();switch(isFunctionType(t.switchToRate)&&t.switchToRate(),t.selectedTab){case eTransactionSwitcher.NewDeal:m.isObservable(t.stopLossRateDeal)&&t.stopLossRateDeal()&&t.stopLossRateDeal(""),m.isObservable(t.takeProfitRateDeal)&&t.takeProfitRateDeal()&&t.takeProfitRateDeal("");break;case eTransactionSwitcher.NewLimit:m.isObservable(t.stopLossRateLimit)&&t.stopLossRateLimit()&&t.stopLossRateLimit(""),m.isObservable(t.takeProfitRateLimit)&&t.takeProfitRateLimit()&&t.takeProfitRateLimit("")}r.ChangeSymbol(i.selectedInstrument(),c(e))}),isDefinedType(s.selectedTab)?(b.set(eStateObjectTopics.ReadyForUse,!1)&&u(),l.push({unsubscribe:b.subscribe(eStateObjectTopics.ReadyForUse,function(e){e&&u()})})):u()},dispose:function(){for(;0<l.length;)l.pop().unsubscribe();r.dispose.call(o)},Data:n}});return{viewModel:{createViewModel:function(e){var t=new a(e);return t.init(),t}}}}),define("mobileViewModels/ClosedDealsFilterViewModel",["require","KoComponentViewModel","viewModels/Deals/ClosedDealsModule","HistoryManager","customBindings/DatePickerRangerBinding","StateObject!ClosedDeals"],function(e){var t=e("KoComponentViewModel"),i=e("viewModels/Deals/ClosedDealsModule"),o=e("HistoryManager"),r=e("StateObject!ClosedDeals"),a=extendClass(t,function(){var t=this,a=this.parent;return{init:function(e){a.init.call(t,e)},dispose:function(){r.update(eStateObjectTopics.ClosedDealsUseFilters,!0),a.dispose.call(t)},model:i,Close:function(){o.Back()},ClearSelectedInstrument:function(){i.Filter.Instrument(null)}}});return{viewModel:{createViewModel:function(e){var t=new a;return t.init(e),t}}}}),define("mobileViewModels/ClosedDealsInstrumentSearchViewModel",["require","knockout","viewModels/BaseInstrumentSearchViewModel","LoadDictionaryContent!views_vMobileQuotes"],function(e){var t=e("viewModels/BaseInstrumentSearchViewModel"),a=extendClass(t,function(){var a=this,i=this.parent,o=this.Data;return{init:function(e){i.init.call(a,e),t=e,t.instrumentId&&isFunctionType(t.instrumentId)&&(t.instrumentId(Number.MAX_SAFE_INTEGER),a.subscribeTo(o.selected,function(e){t.instrumentId(e.id)}));var t}}});return{viewModel:{createViewModel:function(e){var t=new a;return t.init(e),t}}}}),define("mobileViewModels/ClosedDealsViewModel",["KoComponentViewModel","viewModels/Deals/ClosedDealsModule","StateObject!ClosedDeals","customBindings/InfiniteScrollBinding"],function(e,a,i){var o=extendClass(e,function(){var e=this,t=this.parent;return{init:function(){t.init.call(e),i.set(eStateObjectTopics.ClosedDealsUseFilters,!1)?(i.update(eStateObjectTopics.ClosedDealsUseFilters,!1),a.ApplyFilter()):a.ApplyFilter(!0)},model:a}});return{viewModel:{createViewModel:function(e){var t=new o(e);return t.init(),t}}}}),define("mobileViewModels/CloseDealViewModel",["require","knockout","dalOrders","closeDealSettings","DealsManager","AlertsManager","Dictionary","StatesManager","InstrumentsManager","viewModels/Deals/CloseDealBaseViewModel","StateObject!Transaction"],function(e){var n=e("knockout"),s=e("dalOrders"),t=e("closeDealSettings"),l=e("AlertsManager"),u=e("Dictionary"),c=e("InstrumentsManager"),a=e("viewModels/Deals/CloseDealBaseViewModel"),d=e("StateObject!Transaction"),m=e("StatesManager"),i=e("DealsManager"),o=e("ViewsManager"),r=extendClass(a,function(){var t=this,a=this.parent,o=this.Data,r=a.BaseOrder;function i(){return o.isProcessing(!0),s.CloseDeals([o.SelectedPosition()],e)}function e(e,t,a){o.isProcessing(!1);var i=c.GetInstrument(o.selectedInstrument());i&&r.OnActionReturn(e,t,i,{redirectToView:eForms.OpenDeals,requestData:a})}return{init:function(e){d.update(eStateObjectTopics.ReadyForUse,!1),a.init.call(t,e),o.showTools=n.observable(!0),o.isAdditionalInfoExpanded=n.observable(!1),d.update(eStateObjectTopics.ReadyForUse,!0),d.update("PageName",o.PageName)},Data:o,CloseDeal:function(){var e;o.CloseDealReady()&&(1!=m.States.fxDenied()?CookieHandler.ReadCookie("hideMultipleDealsCloseAlert")?i():(e={selectedData:[o.SelectedPosition()],confirmationCloseDeal:i},l.UpdateAlert(AlertTypes.MultipleDealsClosedConfirmation,u.GetItem("CloseDeal"),u.GetItem("closeSingleDealAlert"),[],e),l.PopAlert(AlertTypes.MultipleDealsClosedConfirmation)):r.ValidateOnlineTradingUser())},OnCloseDealReturn:e,OnCancelCloseDealReturn:function(){o.isProcessing(!1)},ToggleAdditionalInfoExpanded:function(){o.isAdditionalInfoExpanded(!o.isAdditionalInfoExpanded())}}});return{viewModel:{createViewModel:function(){if(null==i.Deals.GetItem(o.GetViewArgsByKeyName(eViewTypes.vCloseDeal,"orderId")))return l.UpdateAlert(AlertTypes.ServerResponseAlert,u.GetItem("GenericAlert"),u.GetItem("OrderError8"),null,{redirectToView:eForms.OpenDeals}),l.PopAlert(AlertTypes.ServerResponseAlert),{_valid:!1};var e=new r;return e.init(t),e}}}}),define("mobileViewModels/ContractRolloverViewModel",["require","viewModels/ContractRolloverBaseViewModel","customBindings/InfiniteScrollBinding"],function(e){var t=e("viewModels/ContractRolloverBaseViewModel"),a=extendClass(t,function(){var e=this.parent;return{init:e.init,dispose:e.dispose,Data:e.Data,BalanceInfo:e.BalanceInfo,DataSet:e.DataSet,GetNextBalance:e.GetNextBalance,VisibleShowMore:e.VisibleShowMore}});return{viewModel:{createViewModel:function(e){var t=new a(e);return t.init(),t}}}}),define("mobileViewModels/DealToolsViewModel",["require","viewModels/Deals/DealToolsBaseViewModel","StateObject!Transaction","customBindings/SwipeTabs"],function(e){var t=e("viewModels/Deals/DealToolsBaseViewModel"),s=e("StateObject!Transaction"),a=extendClass(t.DealToolsViewModel,function(e){var t=this,a=this.parent,i=this.Data;function o(e){e&&(t.Handlers.swipeLeft=r,t.Handlers.swipeRight=n,i.showTools(!0))}function r(){switch(i.selectedToolTab()){case eNewDealTool.MarketLiveInfo:return i.selectedToolTab(eNewDealTool.Signals),!0;case eNewDealTool.Signals:return i.selectedToolTab(eNewDealTool.Chart),!0}return!1}function n(){switch(i.selectedToolTab()){case eNewDealTool.MarketLiveInfo:return i.selectedToolTab(eNewDealTool.Chart),!0;case eNewDealTool.Signals:return i.selectedToolTab(eNewDealTool.MarketLiveInfo),!0}return!1}return{init:function(e){(e=e||{}).view=e.view||eViewTypes.vNewDeal,a.init.call(t,e),t.subscribeAndNotify(i.isDataLoaded,o)},NewDealData:e||s.getAll()}});return{viewModel:{createViewModel:function(e){var t=new a(e);return t.init(),t}}}}),define("mobileViewModels/DynamicHeaderViewModel",["require","knockout","KoComponentViewModel","ViewsManager","AlertsManager","UserFlowManager","StateObject!userFlow"],function(e){var n=e("knockout"),t=e("KoComponentViewModel"),s=e("ViewsManager"),l=e("StateObject!userFlow"),u=e("AlertsManager"),a=extendClass(t,function(){var t,a=this,i=this.parent,o=this.Data;function r(e){if(e)switch(e.userStatus){case eUserStatus.ReadyToTrade:case eUserStatus.ActiveLimited:o.generalStatusColor("yellow");break;case eUserStatus.Locked:case eUserStatus.NotActivated:case eUserStatus.Restricted:o.generalStatusColor("red");break;default:o.generalStatusColor("")}}return{init:function(e){i.init.call(a,e),o.isButtonVisibleForConcreteView=n.observable().subscribeTo(ePostboxTopic.PaymentButtonsVisible),o.generalStatusColor=n.observable(""),o.showDepositButton=a.createComputed(function(){return s.GetActiveFormViewProperties(eViewTypes.vCreditCardRegular).visible()||s.GetActiveFormViewProperties(eViewTypes.vCreditCard3rdParty).visible()||s.GetActiveFormViewProperties(eViewTypes.vGenericCreditCard).visible()}),o.showBackButton=a.createComputed(function(){return!s.GetActiveFormViewProperties(eForms.Menu).visible()&&(s.GetActiveFormViewProperties(eForms.Wallet).visible()&&(!s.GetActiveFormViewProperties(eForms.Wallet).args||!s.GetActiveFormViewProperties(eForms.Wallet).args.showMenuButton)||s.GetActiveFormViewProperties(eViewTypes.vBalance).visible()||s.GetActiveFormViewProperties(eViewTypes.vPendingWithdrawal).visible()||s.GetActiveFormViewProperties(eViewTypes.vNetExposure).visible()||s.GetActiveFormViewProperties(eViewTypes.vEditFavoriteInstruments).visible()||s.GetActiveFormViewProperties(eViewTypes.vWithdrawal).visible()||s.GetActiveFormViewProperties(eViewTypes.vContact).visible()||s.GetActiveFormViewProperties(eViewTypes.vInternalContactUs).visible()||s.GetActiveFormViewProperties(eViewTypes.vCreditCardRegular).visible()||s.GetActiveFormViewProperties(eViewTypes.vGenericCreditCard).visible()||s.GetActiveFormViewProperties(eViewTypes.vTradingSignals).visible()||s.GetActiveFormViewProperties(eViewTypes.vEconomicCalendar).visible()&&!s.GetActiveFormViewProperties(eViewTypes.vEconomicCalendarFilter).visible()||s.GetActiveFormViewProperties(eViewTypes.vEducationalTutorialsSwitcher).visible()||s.GetActiveFormViewProperties(eViewTypes.vEditClosingLimit).visible()||s.GetActiveFormViewProperties(eViewTypes.vCloseDeal).visible()||s.GetActiveFormViewProperties(eViewTypes.vEditLimit).visible()||s.GetActiveFormViewProperties(eViewTypes.vClosedDealDetails).visible()||s.GetActiveFormViewProperties(eViewTypes.vAmlStatus).visible()||s.GetActiveFormViewProperties(eViewTypes.vTradingSignalDetails).visible()||s.GetActiveFormViewProperties(eViewTypes.vEconomicCalendarFilter).visible()||s.GetActiveFormViewProperties(eViewTypes.vTransactionSwitcher).visible()||s.GetActiveFormViewProperties(eViewTypes.vEditFavoriteInstruments).visible()||s.GetActiveFormViewProperties(eViewTypes.vPaymentTypes).visible()&&o.isButtonVisibleForConcreteView()||s.GetActiveFormViewProperties(eViewTypes.vMoneyBookers).visible()||s.GetActiveFormViewProperties(eViewTypes.vGlobalCollectAPM).visible()||s.GetActiveFormViewProperties(eViewTypes.vConcretePaymentForm).visible()||s.GetActiveFormViewProperties(eViewTypes.vWithdrawalBankDetails).visible()||s.GetActiveFormViewProperties(eViewTypes.vWithdrawalCCDetails).visible()||s.GetActiveFormViewProperties(eViewTypes.vEducationalTutorialsAccess).visible()||s.GetActiveFormViewProperties(eViewTypes.vNewPriceAlert).visible()||s.GetActiveFormViewProperties(eViewTypes.vUploadDocuments).visible()||s.GetActiveFormViewProperties(eViewTypes.vChangePassword).visible()||s.GetActiveFormViewProperties(eViewTypes.vLoginOptions).visible()||s.GetActiveFormViewProperties(eViewTypes.vNotificationsSettings).visible()||s.GetActiveFormViewProperties(eViewTypes.vLanguageSettings).visible()||s.GetActiveFormViewProperties(eViewTypes.vPersonalInformation).visible()||s.GetActiveFormViewProperties(eViewTypes.vPriceAlerts).visible()||s.GetActiveFormViewProperties(eViewTypes.vClientQuestionnaire).visible()||o.showDepositButton())}),o.showContinueButton=a.createComputed(function(){return s.GetActiveFormViewProperties(eViewTypes.vEpaylinks).visible()||s.GetActiveFormViewProperties(eViewTypes.vPaySafeCard).visible()||s.GetActiveFormViewProperties(eViewTypes.vSafeChargeCashier).visible()||s.GetActiveFormViewProperties(eViewTypes.vAstropay).visible()||s.GetActiveFormViewProperties(eViewTypes.vNetellerGO).visible()||s.GetActiveFormViewProperties(eViewTypes.vMoneyBookers).visible()||s.GetActiveFormViewProperties(eViewTypes.vGlobalCollectAPM).visible()||s.GetActiveFormViewProperties(eViewTypes.vInatecAPMGiropay).visible()||s.GetActiveFormViewProperties(eViewTypes.vInatecAPMPrzelewy24).visible()||s.GetActiveFormViewProperties(eViewTypes.vEmpCashU).visible()||s.GetActiveFormViewProperties(eViewTypes.vEcoPayz).visible()||s.GetActiveFormViewProperties(eViewTypes.vSofortDirect).visible()||s.GetActiveFormViewProperties(eViewTypes.vKluwp).visible()||s.GetActiveFormViewProperties(eViewTypes.vRPN).visible()||s.GetActiveFormViewProperties(eViewTypes.vPayPal).visible()||s.GetActiveFormViewProperties(eViewTypes.vWireTransfer).visible()}),o.hideMobileMenu=a.createComputed(function(){return s.GetActiveFormViewProperties(eViewTypes.vBalance).visible()||s.GetActiveFormViewProperties(eViewTypes.vPendingWithdrawal).visible()||s.GetActiveFormViewProperties(eViewTypes.vNetExposure).visible()||s.GetActiveFormViewProperties(eViewTypes.vEditFavoriteInstruments).visible()||s.GetActiveFormViewProperties(eViewTypes.vWithdrawal).visible()||s.GetActiveFormViewProperties(eViewTypes.vContact).visible()||s.GetActiveFormViewProperties(eViewTypes.vInternalContactUs).visible()||s.GetActiveFormViewProperties(eViewTypes.vTradingSignals).visible()||s.GetActiveFormViewProperties(eViewTypes.vEconomicCalendar).visible()&&!s.GetActiveFormViewProperties(eViewTypes.vEconomicCalendarFilter).visible()||s.GetActiveFormViewProperties(eViewTypes.vEducationalTutorialsSwitcher).visible()||s.GetActiveFormViewProperties(eViewTypes.vTransactionSwitcher).visible()||s.GetActiveFormViewProperties(eViewTypes.vEditClosingLimit).visible()||s.GetActiveFormViewProperties(eViewTypes.vCloseDeal).visible()||s.GetActiveFormViewProperties(eViewTypes.vEditLimit).visible()||s.GetActiveFormViewProperties(eViewTypes.vClosedDealDetails).visible()||s.GetActiveFormViewProperties(eViewTypes.vAmlStatus).visible()||s.GetActiveFormViewProperties(eViewTypes.vTradingSignalDetails).visible()||s.GetActiveFormViewProperties(eViewTypes.vEconomicCalendarFilter).visible()||s.GetActiveFormViewProperties(eViewTypes.vEditFavoriteInstruments).visible()||s.GetActiveFormViewProperties(eViewTypes.vEducationalTutorialsAccess).visible()||o.showBackButton()||u.HasAlert()}),r(l.get(eStateObjectTopics.UserFlowChanged)),t=l.subscribe(eStateObjectTopics.UserFlowChanged,function(e){r(e)})},dispose:function(){t(),i.dispose.call(a)},Data:o}});return{viewModel:{createViewModel:function(e){var t=new a(e);return t.init(),t}}}}),define("mobileViewModels/EconomicCalendarFilterViewModel",["knockout","KoComponentViewModel","economicCalendarConfig","ViewModelsManager","FxNet/LogicLayer/EconomicCalendar/EconomicCalendarHandler"],function(m,e,b,p,v){var a=extendClass(e,function(e){var a=this,t={},i=this.parent,o=this.Data,r=function(){a.Handlers.selectDateTab=function(e){var t=v.DateInterval(e);o.selectedDateFilter(e),m.postbox.publish("fx-economic-calendar-apply-filter",t)}},n=function(){for(var e in o.dateTabs=[],eDateFilter)eDateFilter.hasOwnProperty(e)&&o.dateTabs.push({ContentKey:b.contentKeyFilterPrefix+e,DateFilterType:eDateFilter[e]})},s=function(){for(var e in o.countries=[],eCountryFilter)eCountryFilter.hasOwnProperty(e)&&o.countries.push({CountryCode:e,ContentKey:b.contentKeyFilterPrefix+e})},l=function(){for(var e in o.importance=[],eImportanceFilter)eImportanceFilter.hasOwnProperty(e)&&o.importance.push({ContentKey:b.contentKeyFilterPrefix+e,ImportanceCode:eImportanceFilter[e],ImportanceInactive:b.eventsMaxImportance-eImportanceFilter[e]})},u=function(){o.selectedDateFilter=m.observable(b.defaultDateTab),o.countryList=o.countries.map(function(e){return e.CountryCode}),o.importanceList=o.importance.map(function(e){return e.ImportanceCode}),o.countryCodes=m.observableArray(o.countryList.slice(0)),o.importanceCodes=m.observableArray(o.importanceList.slice(0))},c=function(){var e=m.postbox.subscribe("fx-economic-calendar-swipe-left",function(){var e=o.selectedDateFilter()+1,t=v.DateInterval(e);t&&(o.selectedDateFilter(e),m.postbox.publish("fx-economic-calendar-apply-filter",t))});a.addDisposable(e);var t=m.postbox.subscribe("fx-economic-calendar-swipe-right",function(){var e=o.selectedDateFilter()-1,t=v.DateInterval(e);t&&(o.selectedDateFilter(e),m.postbox.publish("fx-economic-calendar-apply-filter",t))});a.addDisposable(t),a.subscribeTo(p.VManager.GetActiveFormViewProperties(eViewTypes.vEconomicCalendarFilter).visible,function(e){if(e){var t={CountryCodes:o.countryCodes(),Importance:o.importanceCodes(),CountryCodesMandatory:!0,ImportanceMandatory:!0};m.postbox.publish("fx-economic-calendar-apply-filter",t)}},null,"beforeChange")},d=function(){o.CheckCountries=a.createComputed({read:function(){return o.countryCodes().length===o.countries.length},write:function(e){e?o.countryCodes(o.countryList.slice(0)):o.countryCodes([])}}),o.CheckImportances=a.createComputed({read:function(){return o.importanceCodes().length===o.importance.length},write:function(e){e?o.importanceCodes(o.importanceList.slice(0)):o.importanceCodes([])}})};return{init:function(e){i.init.call(a,e),o.countryList=[],o.importanceList=[],n(),r(),s(),l(),u(),c(),d()},dispose:function(){i.dispose.call(a),t.SelectDateTab=null},Handlers:t}});return{viewModel:{createViewModel:function(e){var t=new a(e);return t.init(),t}}}}),define("mobileViewModels/EconomicCalendarViewModel",["knockout","economicCalendarConfig","viewModels/EconomicCalendarViewModel","FxNet/LogicLayer/EconomicCalendar/EconomicCalendarHandler","customBindings/InfiniteScrollBinding","customBindings/SwipeTabs"],function(a,d,e,m){var i=extendClass(e.EconomicCalendarViewModel,function(){var i=this,o=this.parent,e={},t=this.Data,r={},n=m.DateInterval(d.defaultDateTab),s=function(){t.selectedDateTab=a.observable(d.defaultDateTab),t.pagedEvents=a.observableArray([])},l=function(){var e=a.postbox.subscribe("fx-economic-calendar-apply-filter",function(e){e.FromDate=e.FromDate||r.FromDate,e.ToDate=e.ToDate||r.ToDate,e.CountryCodes=e.CountryCodes||r.CountryCodes,e.CountryCodesMandatory=e.CountryCodesMandatory||r.CountryCodesMandatory,e.Importance=e.Importance||r.Importance,e.ImportanceMandatory=e.ImportanceMandatory||r.ImportanceMandatory,r=e,t.pageIndex(1),o.ApplyFilter(e)});i.addDisposable(e),i.subscribeTo(o.Data.isLoading,function(e){a.postbox.publish(ePostboxTopic.SetSpinnerVisibility,e)}),i.subscribeTo(o.Data.hasEvents,function(e){e?t.pagedEvents(o.Data.events.slice(0,d.mobilePageSize*t.pageIndex())):t.pagedEvents([])})},u=function(){e.swipeLeft=function(){a.postbox.publish("fx-economic-calendar-swipe-left")},e.swipeRight=function(){a.postbox.publish("fx-economic-calendar-swipe-right")},e.scrolled=function(){if(t.events()&&0<t.events().length){var e=t.events()[0].TotalCount;t.pageIndex()*d.mobilePageSize<e&&(t.pageIndex(t.pageIndex()+1),t.pagedEvents(t.events().slice(0,d.mobilePageSize*t.pageIndex())))}}},c=function(){t.maxDateTime=i.createComputed(function(){return 0<t.events().length?t.events()[t.events().length-1].EventTime:null})};return{init:function(e){var t,a;o.init.call(i,e),s(),l(),u(),c(),t=n.FromDate,a=n.ToDate,r={FromDate:t.toDotNetString(),ToDate:a.toDotNetString()},o.ApplyFilter(r)},dispose:function(){o.dispose.call(i),e.swipeLeft=null,e.swipeRight=null,e.scrolled=null},Handlers:e,ShowDayHeader:function(e){return 0===e||!t.events()||0===t.events().length||new Date(t.events()[e].EventTime).getPureUTCDate()>new Date(t.events()[e-1].EventTime).getPureUTCDate()}}});return{viewModel:{createViewModel:function(e){var t=new i(e);return t.init(),t}}}}),define("mobileViewModels/EditClosingLimitViewModel",["require","knockout","editClosingLimitSettings","CustomerProfileManager","viewModels/Deals/EditClosingLimitBaseViewModel","StateObject!Transaction","ViewsManager","Dictionary","DealsManager"],function(e){var s=e("knockout"),t=e("editClosingLimitSettings"),l=e("CustomerProfileManager"),a=e("viewModels/Deals/EditClosingLimitBaseViewModel"),u=e("StateObject!Transaction"),i=e("ViewsManager"),o=e("Dictionary"),r=e("DealsManager"),n=extendClass(a,function(){var a=this,i=this.parent,o=this.Data,e={},r=i.SetLimitsModel;function n(){e.Limits=i.getLimitsValidationModel(),i.createAmountFieldsWrappers(),a.subscribeTo(r.Data.stopLossPercent,function(e){o.displaySlPercentSymbol(!isEmptyValue(e)&&"NA"!==e)}),a.subscribeTo(o.stopLossInCustomerCcy,function(e){o.displaySlAmountCcySymbol(!isEmptyValue(e)&&"NA"!==e)}),a.subscribeTo(r.Data.takeProfitPercent,function(e){o.displayTpPercentSymbol(!isEmptyValue(e)&&"NA"!==e)}),a.subscribeTo(o.takeProfitInCustomerCcy,function(e){o.displayTpAmountCcySymbol(!isEmptyValue(e)&&"NA"!==e)}),o.limitsReady(!0)}return{init:function(e){var t;u.update(eStateObjectTopics.ReadyForUse,!1),i.init.call(a,e),o.showTools=s.observable(!0),o.isAdditionalInfoExpanded=s.observable(!1),a.subscribeTo(o.isAdditionalInfoExpanded,function(e){var t=l.ProfileCustomer();t.isAdditionalInfoExpanded=Number(e),l.ProfileCustomer(t)}),i.updateViewModelData(),r.Start(n),t=l.ProfileCustomer(),o.isAdditionalInfoExpanded(1===t.isAdditionalInfoExpanded),u.update(eStateObjectTopics.ReadyForUse,!0),u.update("PageName",o.PageName)},Data:o,TPField:r.TPField,SLField:r.SLField,SetLimitsInfo:r.Data,SetLimitsViewProperties:r.ViewProperties,ToggleAdditionalInfoExpanded:function(){o.isAdditionalInfoExpanded(!o.isAdditionalInfoExpanded())}}});return{viewModel:{createViewModel:function(){if(null==r.Deals.GetItem(i.GetViewArgs(eViewTypes.vEditClosingLimit).orderId))return AlertsManager.UpdateAlert(AlertTypes.ServerResponseAlert,o.GetItem("GenericAlert"),o.GetItem("OrderError7"),null,{redirectToView:eForms.OpenDeals}),AlertsManager.PopAlert(AlertTypes.ServerResponseAlert),{_valid:!1};var e=new n;return e.init(t),e}}}}),define("mobileViewModels/EditFavoriteInstrumentsViewModel",["require","knockout","KoComponentViewModel","InstrumentsManager","InstrumentTranslationsManager","FavoriteInstrumentsManager","initConfiguration","ViewModelsManager","LoadDictionaryContent!EditFavoriteInstruments"],function(e){var i=e("knockout"),t=e("KoComponentViewModel"),a=e("initConfiguration"),s=e("InstrumentTranslationsManager"),m=e("InstrumentsManager"),b=e("FavoriteInstrumentsManager"),o=e("ViewModelsManager").VmQuotesPreset,r=extendClass(t,function(){var l,t=this.parent.Data,u=new ObservableHashTable("id"),c=new ObservableHashTable("id",{enabled:!0,sortProperty:"ccyPair",asc:!1});function d(e){var t;m.GetPresetsForInstrument(e.id).some(function(e){if(o.IsSearchPreset(e))return t=parseInt(e),!0})&&(e.presetLabel=o.GetPreset(t).Label)}function a(e){u.Remove(e),b.RemoveFavoriteInstrument(e),i.postbox.publish("favorite-instrument-update",{instrumentId:e,isRemoveInstrument:!0})}return{init:function(e){this,l=e.favoriteInstrumentsLimit,t.isFavoriteListVisible=i.observable(!0),function(){for(var e,t,a=m.GetInstrumentIds(),i=b.GetFavoriteInstrumentIds(),o=0,r=a.length;o<r;o++){var n=a[o];i[n]||(e=m.GetInstrument(n),t=s.Short(n),c.Add({id:e.id,baseSymbol:e.baseSymbol,otherSymbol:e.otherSymbol,ccyPair:t}))}}(),function(){var e,t,a=(e=b.GetFavoriteInstrumentIds(),t=e.length,l&&(l=toNumeric(l),t=Math.min(t,l)),e.slice(0,t));if(a){var i=a.length||0;u.Clear();for(var o=0;o<i;o++){var r=a[o],n=c.Get(r);if(n){var s={id:n.id,baseSymbolId:n.baseSymbol,otherSymbolId:n.otherSymbol,fullInstrumentList:c.Values};d(s),u.Add(s)}}}}(),i.postbox.subscribeSingleton("edit-favorite-instruments-search-result",function(e){e=e||{},t.isFavoriteListVisible(!e.hasResults)})},dispose:function(){u.Clear(),c.Clear()},Data:t,FavoritesCollection:u.Values,RemoveInstrument:a,UpdateFavoriteInstrumentsUIOrder:function(){var e=u.Values().map(function(e){return e.id});b.ChangeUIOrder(e,!1),i.postbox.publish("favorite-instruments-reorder-drop")},FavoriteInstrumentSelected:function(e){e&&e.id&&-1!==e.id&&(b.IsFavoriteInstrument(e.id)?a(e.id):(t=e,t&&(u.AddAt(0,{id:t.id,baseSymbolId:t.baseSymbolId,otherSymbolId:t.otherSymbolId,fullInstrumentList:c.Values}),b.AddFavoriteInstrument(t.id),i.postbox.publish("favorite-instrument-update",{instrumentId:t.id,isAddInstrument:!0}))));var t}}});return{viewModel:{createViewModel:function(){var e=new r;return e.init(a.FavoriteInstrumentsConfiguration),e}}}}),define("mobileViewModels/EditLimitViewModel",["require","knockout","editLimitSettings","CustomerProfileManager","Dictionary","viewModels/Limits/EditLimitBaseViewModel","StateObject!Transaction","ActiveLimitsManager","ViewsManager"],function(e){var s=e("knockout"),t=e("editLimitSettings"),l=e("CustomerProfileManager"),a=e("Dictionary"),i=e("viewModels/Limits/EditLimitBaseViewModel"),u=e("StateObject!Transaction"),o=e("ActiveLimitsManager"),r=e("ViewsManager"),n=extendClass(i,function(){var a=this,i=this.parent,o=this.Data,e=i.ValidationModel,t=i.FieldWrappers,r=i.SetLimitsViewModel;function n(){e.Limits=s.validatedObservable({stopLossAmount:r.Data.stopLossAmount,takeProfitAmount:r.Data.takeProfitAmount,ccySLAmount:r.Data.ccySLAmount,ccyTPAmount:r.Data.ccyTPAmount,stopLossRate:r.Data.stopLossRate,takeProfitRate:r.Data.takeProfitRate,stopLossPercent:r.Data.stopLossPercent,takeProfitPercent:r.Data.takeProfitPercent}),a.subscribeTo(o.enableSLLimit,function(e){e||(r.Data.stopLossRate(""),r.Data.stopLossAmount(""),r.Data.stopLossPercent(""),t.Data.stopLossInCustomerCcy(""))}),a.subscribeTo(r.Data.curSlActiveTab,function(e){o.isSlRateActiveTab(e===eSetLimitsTabs.Rate),o.isSlAmountActiveTab(e===eSetLimitsTabs.Amount),o.isSlPercentActiveTab(e===eSetLimitsTabs.Percent)}),a.subscribeTo(r.Data.stopLossPercent,function(e){o.displaySlPercentSymbol(!isEmptyValue(e)&&"NA"!==e)}),a.subscribeTo(t.Data.stopLossInCustomerCcy,function(e){o.displaySlAmountCcySymbol(!isEmptyValue(e)&&"NA"!==e)}),a.subscribeTo(o.enableTPLimit,function(e){e||(r.Data.takeProfitRate(""),r.Data.takeProfitAmount(""),r.Data.takeProfitPercent(""),t.Data.takeProfitInCustomerCcy(""))}),a.subscribeTo(r.Data.curTpActiveTab,function(e){o.isTpRateActiveTab(e===eSetLimitsTabs.Rate),o.isTpAmountActiveTab(e===eSetLimitsTabs.Amount),o.isTpPercentActiveTab(e===eSetLimitsTabs.Percent)}),a.subscribeTo(r.Data.takeProfitPercent,function(e){o.displayTpPercentSymbol(!isEmptyValue(e)&&"NA"!==e)}),a.subscribeTo(t.Data.takeProfitInCustomerCcy,function(e){o.displayTpAmountCcySymbol(!isEmptyValue(e)&&"NA"!==e)}),o.limitsReady(!0),i.setLimitTabsFromClientProfile()}return{init:function(e){var t;u.update(eStateObjectTopics.ReadyForUse,!1),i.init.call(a,e),o.showTools=s.observable(!0),o.isAdditionalInfoExpanded=s.observable(!1),a.subscribeTo(o.isAdditionalInfoExpanded,function(e){var t=l.ProfileCustomer();t.isEditLimitInfoExpanded=Number(e),l.ProfileCustomer(t)}),r.Start(n),t=l.ProfileCustomer(),o.isAdditionalInfoExpanded(1===t.isEditLimitInfoExpanded),u.update(eStateObjectTopics.ReadyForUse,!0),u.update("PageName",o.PageName)},Data:o,ToggleAdditionalInfoExpanded:function(){o.isAdditionalInfoExpanded(!o.isAdditionalInfoExpanded())}}});return{viewModel:{createViewModel:function(){if(null==o.limits.GetItem(r.GetViewArgs(eViewTypes.vEditLimit).orderId))return AlertsManager.UpdateAlert(AlertTypes.ServerResponseAlert,a.GetItem("GenericAlert"),a.GetItem("OrderError7"),null,{redirectToView:eForms.Limits}),AlertsManager.PopAlert(AlertTypes.ServerResponseAlert),{_valid:!1};var e=new n;return e.init(t),e}}}}),define("mobileViewModels/EducationalTutorialsSwitcherViewModel",["require","knockout","dalCustomer","KoComponentViewModel","ViewModelsManager","StateObject!EducationalTutorials","LoadDictionaryContent!EducationalTutorials"],function(e){var t=e("KoComponentViewModel"),r=e("knockout"),n=e("ViewModelsManager"),s=e("StateObject!EducationalTutorials"),l=e("dalCustomer"),a=extendClass(t,function(){var t=this,a={},i=this.Data,o=this.parent;return{init:function(e){o.init.call(t,e),i.selectedTutorialsType=r.observable(eEducationalTutorialsType.Basic),i.basicTutorials=r.observableArray([]),i.advancedTutorials=r.observableArray([]),i.endDate=r.observable(""),i.isTutorialsAllowed=r.observable(!1),i.retentionEmail=r.observable(""),i.disclaimerVisible=r.observable(!0),i.isShowBasicTutorials=t.createComputed(function(){return i.selectedTutorialsType()===eEducationalTutorialsType.Basic}),i.isShowAdvancedTutorials=t.createComputed(function(){return i.selectedTutorialsType()===eEducationalTutorialsType.Advanced}),a.basicBtnClick=function(){i.selectedTutorialsType(eEducationalTutorialsType.Basic)},a.advancedBtnClick=function(){i.selectedTutorialsType(eEducationalTutorialsType.Advanced)},l.GetEducationalTutorials().then(function(e){i.basicTutorials(e.Tutorials.filter(function(e){return e.Type===eEducationalTutorialsType.Basic})),i.advancedTutorials(e.Tutorials.filter(function(e){return e.Type===eEducationalTutorialsType.Advanced})),i.endDate(e.EndDate),i.retentionEmail(e.AccountTutorials.RetentionPersonEmail),i.isTutorialsAllowed(e.IsTutorialsAllowed),e.IsTutorialsAllowed||s.containsKey("EducationalTutorialsInactive")||(s.set("EducationalTutorialsInactive",!0),n.VManager.SwitchViewVisible(eForms.EducationalTutorialsAccess))}).done()},Handlers:a,Data:i,dispose:function(){a.basicBtnClick=null,a.advancedBtnClick=null,o.dispose.call(t)}}});return{viewModel:{createViewModel:function(e){var t=new a;return t.init(e),t}}}}),define("mobileViewModels/EducationalTutorialsViewModel",["require","knockout","KoComponentViewModel","StateObject!EducationalTutorials","HistoryManager"],function(e){var t=e("KoComponentViewModel"),u=e("HistoryManager"),c=e("StateObject!EducationalTutorials"),d=e("knockout"),a=extendClass(t,function(a){var e=this,i=this.Data,o=u.GetCurrentState().id,r=!1,t=this.parent,n=StorageFactory(StorageFactory.eStorageType.local);function s(){i.selectedPath(i.temporaryPath())}var l=function(){e.subscribeTo(i.disclaimerVisible,function(e){if(a.disclaimerVisible(!e),!r)if(e){u.PushSubState("expand_tutorialsDisclaimer")}else{var t=u.GetCurrentState().id;o!==t&&u.Back(s)}}),e.subscribeTo(i.tutorialPlayerVisible,function(e){if(!r)if(e){u.PushSubState("expand_tutorialsPlayer")}else{var t=u.GetCurrentState().id;o!==t&&u.Back()}}),u.OnStateChanged.Add(function(){var e=u.GetCurrentState().id;o===e&&i.disclaimerVisible()&&(r=!0,i.disclaimerVisible(!1),r=!1),o===e&&i.tutorialPlayerVisible()&&(r=!0,i.tutorialPlayerVisible(!1),r=!1)})};return{init:function(){t.init.call(e,a),i.selectedTutorialsType=d.observable(),i.tutorials=d.observableArray([]),i.disclaimerVisible=d.observable(!1),i.tutorialPlayerVisible=d.observable(!1),i.temporaryPath=d.observable(""),i.selectedPath=d.observable("").extend({notify:"always"}),i.serviceInfoVisible=c.get("serviceInfoVisible"),l(),i.selectedTutorialsType(a.type),i.tutorials(a.tutorials)},Data:i,agreeDisclaimer:function(){i.disclaimerVisible(!1),n.setItem("showDisclaimer","false")},updateSelectedPath:function(t){var e=i.tutorials().find(function(e){return e.Id===t}).Path,a=n.getItem("showDisclaimer")||"true";n.setItem("showDisclaimer",a),"true"===a?(i.disclaimerVisible(!0),i.temporaryPath(e)):i.selectedPath(e)}}});return{viewModel:{createViewModel:function(e){var t=new a(e);return t.init(),t}}}}),define("mobileViewModels/FavoritesInstrumentSearchViewModel",["require","knockout","viewModels/BaseInstrumentSearchViewModel","LoadDictionaryContent!EditFavoriteInstruments"],function(e){var t=e("viewModels/BaseInstrumentSearchViewModel"),a=extendClass(t,function(){var a=this,i=this.parent,o=this.Data;return{init:function(e){i.init.call(a,e),t=e,t.instrumentSelectedHandler&&isFunctionType(t.instrumentSelectedHandler)&&a.subscribeTo(o.selected,t.instrumentSelectedHandler);var t}}});return{viewModel:{createViewModel:function(e){var t=new a;return t.init(e),t}}}}),define("mobileViewModels/LimitsViewModel",["require","KoComponentViewModel","viewModels/Limits/ActiveLimitsModule"],function(e){var t=e("KoComponentViewModel"),i=e("viewModels/Limits/ActiveLimitsModule"),a=extendClass(t,function(){var t=this,a=this.parent;return{init:function(e){a.init.call(t,e)},dispose:function(){a.dispose.call(t)},model:i}});return{viewModel:{createViewModel:function(e){var t=new a;return t.init(e),t}}}}),define("mobileViewModels/MainGridInstrumentSearchViewModel",["require","knockout","QuotesSubscriber","ViewsManager","viewModels/BaseInstrumentSearchViewModel"],function(e){var r=e("QuotesSubscriber"),n=e("ViewsManager"),t=e("viewModels/BaseInstrumentSearchViewModel"),a=extendClass(t,function(){var t=this,a=this.parent,i=this.Data,o=new r;return{init:function(e){a.init.call(t,e),t.subscribeTo(i.selected,function(e){if(e&&e.id&&!(e.id<=-1)){var t=o.GetQuote(e.id),a=!isNullOrUndefined(t)&&t.state()!==eQuoteStates.NotActive||null;n.SwitchViewVisible(eForms.Transaction,{instrumentId:e.id,isActiveQuote:a})}})}}});return{viewModel:{createViewModel:function(e){var t=new a;return t.init(e),t}}}}),define("mobileViewModels/MainMenuViewModel",["require","knockout","KoComponentViewModel","ViewsManager","AlertsManager","PortfolioStaticManager","PermissionsModule","ActiveLimitsManager","Dictionary"],function(e){var r=e("knockout"),t=e("KoComponentViewModel"),n=e("ViewsManager"),s=e("AlertsManager"),l=e("PortfolioStaticManager"),u=e("PermissionsModule"),c=e("ActiveLimitsManager"),d=e("Dictionary"),a=extendClass(t,function(){var t=this,a=this.parent,i=this.Data;function o(){var e=l.Portfolio;i.pendingWithdrawals(e.pendingWithdrawals)}function e(e,t){t&&r.postbox.publish(t),r.postbox.publish("action-source","SideMenu"),n.RedirectToForm(e)}return{init:function(e){a.init.call(t,e),i.pendingWithdrawals=r.observable(l.Portfolio.pendingWithdrawals),l.OnChange.Add(o)},dispose:function(){c.OnChange.Remove(o),a.dispose.call(t)},Data:i,SwitchView:e,SwitchViewWithArgs:function(e,t,a){a&&r.postbox.publish(a),r.postbox.publish("action-source","SideMenu"),n.RedirectToForm(e,t)},IsVisible:function(e){return n.GetActiveFormViewProperties(e).visible()},Logout:function(){u.CheckPermissions("commonLogout")&&(s.UpdateAlert(AlertTypes.ExitAlert),s.PopAlert(AlertTypes.ExitAlert),r.postbox.publish("trading-event","sign-out"))},Register:function(){u.RegisterLeadType()},permissionsModule:u,ChangePasswordClick:function(){u.CheckPermissions("changePassword")?e(eForms.ChangePassword):(AlertsManager.UpdateAlert(AlertTypes.ServerResponseAlert,null,d.GetItem("Forbidden"),null),AlertsManager.PopAlert(AlertTypes.ServerResponseAlert))}}});return{viewModel:{createViewModel:function(e){var t=new a(e);return t.init(),t}}}}),define("mobileViewModels/NewDealSlipViewModel",["require","knockout","newDealSettings","Customer","StatesManager","InstrumentsManager","PermissionsModule","StateObject!Transaction","FavoriteInstrumentsManager","FxNet/LogicLayer/Deal/DealLifeCycle","viewModels/Limits/AmountFieldsWrapper","FxNet/LogicLayer/Deal/NewDealValidator","viewModels/Deals/DealBaseViewModel","ViewsManager"],function(e){var m=e("knockout"),b=e("newDealSettings"),p=e("Customer"),v=e("FxNet/LogicLayer/Deal/NewDealValidator"),f=e("StatesManager"),g=e("InstrumentsManager"),D=e("PermissionsModule"),S=e("FxNet/LogicLayer/Deal/DealLifeCycle"),y=e("viewModels/Limits/AmountFieldsWrapper"),T=e("StateObject!Transaction"),w=e("FavoriteInstrumentsManager"),t=e("viewModels/Deals/DealBaseViewModel"),h=e("ViewsManager"),a=extendClass(t,function(e){var t,a=this,i=this.parent,s=this.Data,o={},r=i.BaseOrder,n=new y,l=i.SetLimitsModel,u=e||{};function c(){o.Limits=m.validatedObservable({stopLossAmount:l.Data.stopLossAmount,takeProfitAmount:l.Data.takeProfitAmount,ccySLAmount:l.Data.ccySLAmount,ccyTPAmount:l.Data.ccyTPAmount,stopLossRate:l.Data.stopLossRate,takeProfitRate:l.Data.takeProfitRate,stopLossPercent:l.Data.stopLossPercent,takeProfitPercent:l.Data.takeProfitPercent}),n.init(l,s),a.subscribeTo(s.enableSLLimit,function(e){e||(l.Data.stopLossRate(""),l.Data.stopLossAmount(""),l.Data.stopLossPercent(""),n.Data.stopLossInCustomerCcy(""))}),a.subscribeTo(l.Data.curSlActiveTab,function(e){s.isSlRateActiveTab(e===eSetLimitsTabs.Rate),s.isSlAmountActiveTab(e===eSetLimitsTabs.Amount),s.isSlPercentActiveTab(e===eSetLimitsTabs.Percent)}),a.subscribeTo(l.Data.stopLossPercent,function(e){s.displaySlPercentSymbol(!isEmptyValue(e)&&"NA"!==e)}),a.subscribeTo(n.Data.stopLossInCustomerCcy,function(e){s.displaySlAmountCcySymbol(!isEmptyValue(e)&&"NA"!==e)}),a.subscribeTo(s.enableTPLimit,function(e){e||(l.Data.takeProfitRate(""),l.Data.takeProfitAmount(""),l.Data.takeProfitPercent(""),n.Data.takeProfitInCustomerCcy(""))}),a.subscribeTo(l.Data.curTpActiveTab,function(e){s.isTpRateActiveTab(e===eSetLimitsTabs.Rate),s.isTpAmountActiveTab(e===eSetLimitsTabs.Amount),s.isTpPercentActiveTab(e===eSetLimitsTabs.Percent)}),a.subscribeTo(l.Data.takeProfitPercent,function(e){s.displayTpPercentSymbol(!isEmptyValue(e)&&"NA"!==e)}),a.subscribeTo(n.Data.takeProfitInCustomerCcy,function(e){s.displayTpAmountCcySymbol(!isEmptyValue(e)&&"NA"!==e)}),s.limitsReady(!0),i.setLimitTabsFromClientProfile()}function d(){l.SetActiveTab(eSetLimitsTabs.Rate)}return{init:function(e){T.update(eStateObjectTopics.ReadyForUse,!1),i.init.call(a,e),v.Init(r),s.corporateActionDate=m.observable(),s.showShareCorporateActionDealInfo=m.observable(),s.hasToolsDataUpdated=T.get("hasToolsDataUpdated"),s.isFavorite=T.set("isFavorite",m.observable()),s.switchIsFavorite=function(){var e;D.CheckActionAllowed("addFavorite",!0)&&(e=s.selectedInstrument(),w.IsFavoriteInstrument(e)?(w.RemoveFavoriteInstrument(e),s.isFavorite(!1),m.postbox.publish("favorite-instrument-update",{instrumentId:e,isRemoveInstrument:!0})):(w.AddFavoriteInstrument(e),s.isFavorite(!0),m.postbox.publish("favorite-instrument-update",{instrumentId:e,isAddInstrument:!0})))},s.DealButtonEnabled=a.createComputed(function(){var e=f.States.IsMarketClosed(),t=s.hasInstrument()&&s.limitsReady()&&s.quotesAvailable(),a=s.isActiveQuote(),i=s.isShowBuyBox()||s.isShowSellBox(),o=l.Validate().length<=0,r=!!isFunctionType(s.selectedDealAmount.isValid)&&s.selectedDealAmount.isValid(),n=0<s.dealMinMaxAmounts().length;return s.selectedDealAmount(),!s.isProcessing()&&n&&r&&!e&&a&&i&&t&&o}),s.isVisibleNewDeal=a.createComputed(function(){return u.isShowNewDeal()}),t=a.createComputed(function(){return s.selectedInstrument()}),a.subscribeAndNotify(t,function(e){var t=g.GetInstrument(e);t&&(l.SetInitial(),i.setLimitTabsFromClientProfile(),s.isFavorite(w.IsFavoriteInstrument(e)),s.corporateActionDate(t.getCorporateActionDate()),s.showShareCorporateActionDealInfo(S.sharesIsCorporateActionDateSignificant_BeforeDeal(p.prop.dealPermit,t.assetTypeId,t.getCorporateActionDate())))}),a.subscribeAndNotify(s.isVisibleNewDeal,function(e){e?(i.registerToDispatcher(),m.postbox.publish("deal-slip-view",{instrument:s.ccyPair(),instrumentStatus:s.isActiveQuote()?"live":"disabled",tabName:getKeyByValue(eNewDealTool,s.initialToolTab()),limit:"maximized",tools:s.showTools()?"maximized":"minimized",id:s.selectedInstrument(),orderDir:s.orderDir()})):i.unRegisterFromDispatcher()}),l.Start(c),T.update("stopLossRateDeal",l.Data.stopLossRate),T.update("takeProfitRateDeal",l.Data.takeProfitRate),T.update("chart",b.chart),T.update("switchToRate",d),s.hasToolsDataUpdated(!0),T.update(eStateObjectTopics.ReadyForUse,!0),T.update("currentRateDirectionSwitch",b.currentRateDirectionSwitch),T.update("PageName",eDealPage.NewDeal)},dispose:function(){l.Stop(),n.dispose(),n=null,T.unset("currentRateDirectionSwitch"),i.dispose.call(a)},Data:s,BaseOrder:r,DealButtonHandler:function(){if(s.DealButtonEnabled())if(!isDefinedType(r.ViewProperties)||s.isActiveQuote()){if(v.Validate(s.selectedInstrument())&&!l.Validate().length)return!!D.CheckActionAllowed("newDeal",!0,{register:registerParams.traderInstrumentId+s.selectedInstrument()+registerParams.traderOrderDir+(0===s.orderDir()?"Sell":"Buy")})&&void i.openDeal()}else r.ViewProperties.InactiveInstrumentAlert(s.selectedInstrument())},TPField:l.TPField,SLField:l.SLField,SetLimitsInfo:l.ObservableSetLimitsObject,SetLimitsViewProperties:l.ViewProperties,FieldWrappers:n,OnPriceAlertClick:function(){h.SwitchViewVisible(eForms.NewPriceAlert,{instrumentId:s.selectedInstrument(),isActiveQuote:!1})}}});return{viewModel:{createViewModel:function(e){var t=new a(e);return t.init(b),t}}}}),define("mobileViewModels/NewLimitViewModel",["require","knockout","newLimitSettings","dalOrders","Customer","InstrumentsManager","PermissionsModule","StatesManager","StateObject!Transaction","FavoriteInstrumentsManager","viewModels/Limits/AmountFieldsWrapper","viewModels/Limits/LimitBaseViewModel","ViewsManager","AlertsManager"],function(e){var v=e("knockout"),f=e("newLimitSettings"),g=e("dalOrders"),D=e("Customer"),S=e("InstrumentsManager"),y=e("PermissionsModule"),T=e("StatesManager"),w=e("StateObject!Transaction"),h=e("FavoriteInstrumentsManager"),C=e("viewModels/Limits/AmountFieldsWrapper"),t=e("viewModels/Limits/LimitBaseViewModel"),A=e("ViewsManager"),M=e("AlertsManager"),a=extendClass(t,function(e){var t,a=this,i=this.parent,d=this.Data,o={},r=new C,n=i.BaseOrder,m=i.ExpirationDate,b=i.SetLimitsModel,s=e||{};function l(){o.Limits=v.validatedObservable({stopLossAmount:b.Data.stopLossAmount,takeProfitAmount:b.Data.takeProfitAmount,ccySLAmount:b.Data.ccySLAmount,ccyTPAmount:b.Data.ccyTPAmount,stopLossRate:b.Data.stopLossRate,takeProfitRate:b.Data.takeProfitRate,stopLossPercent:b.Data.stopLossPercent,takeProfitPercent:b.Data.takeProfitPercent}),r.init(b,d),a.subscribeTo(d.enableSLLimit,function(e){e||(b.Data.stopLossRate(""),b.Data.stopLossAmount(""),b.Data.stopLossPercent(""),r.Data.stopLossInCustomerCcy(""))}),a.subscribeTo(b.Data.curSlActiveTab,function(e){d.isSlRateActiveTab(e===eSetLimitsTabs.Rate),d.isSlAmountActiveTab(e===eSetLimitsTabs.Amount),d.isSlPercentActiveTab(e===eSetLimitsTabs.Percent)}),a.subscribeTo(b.Data.stopLossPercent,function(e){d.displaySlPercentSymbol(!isEmptyValue(e)&&"NA"!==e)}),a.subscribeTo(r.Data.stopLossInCustomerCcy,function(e){d.displaySlAmountCcySymbol(!isEmptyValue(e)&&"NA"!==e)}),a.subscribeTo(d.enableTPLimit,function(e){e||(b.Data.takeProfitRate(""),b.Data.takeProfitAmount(""),b.Data.takeProfitPercent(""),r.Data.takeProfitInCustomerCcy(""))}),a.subscribeTo(b.Data.curTpActiveTab,function(e){d.isTpRateActiveTab(e===eSetLimitsTabs.Rate),d.isTpAmountActiveTab(e===eSetLimitsTabs.Amount),d.isTpPercentActiveTab(e===eSetLimitsTabs.Percent)}),a.subscribeTo(b.Data.takeProfitPercent,function(e){d.displayTpPercentSymbol(!isEmptyValue(e)&&"NA"!==e)}),a.subscribeTo(r.Data.takeProfitInCustomerCcy,function(e){d.displayTpAmountCcySymbol(!isEmptyValue(e)&&"NA"!==e)}),d.limitsReady(!0),i.setLimitTabsFromClientProfile()}function u(){if(d.OrderButtonEnabled()&&!b.Validate().length){if(!y.CheckActionAllowed("newLimit",!0,{register:registerParams.traderInstrumentId+d.selectedInstrument()+registerParams.traderOrderDir+(0===d.orderDir()?"Sell":"Buy")}))return!1;if(1==T.States.fxDenied())return n.ValidateOnlineTradingUser(),!1;if(n.LimitValidateQuote(d.selectedInstrument())){var e=new TLimit;if(i.fillData(e),t=e,d.enableSLLimit()&&0===t.ifDoneSLRate||d.enableTPLimit()&&0===t.ifDoneTPRate)return M.UpdateAlert(AlertTypes.GeneralOkAlert,Dictionary.GetItem("pleaseNoteTitle"),Dictionary.GetItem("sltpValidationMsg","deals_NewLimit"),null,{okButtonCallback:c}),void M.PopAlert(AlertTypes.GeneralOkAlert);d.isProcessing(!0),d.hasInstrument(!1),g.AddLimit(e,i.onOpenLimit),v.postbox.publish("new-limit-details",{tradingDirection:e.orderDir===eOrderDir.Buy?"Buy":e.orderDir===eOrderDir.Sell?"Sell":"None",dealSize:e.amount,isAdvancedView:b.ViewProperties.isAdvancedView().toString(),expirationType:m.Data.expirationDateSelector.IsGoodTillCancelChecked()?"Good Till Cancel":"Specific Date"})}var t}}function c(){d.enableSLLimit(!1),d.enableTPLimit(!1),u()}function p(){b.SetActiveTab(eSetLimitsTabs.Rate)}return{init:function(e){w.update(eStateObjectTopics.ReadyForUse,!1),i.init.call(a,e),d.isFavorite=w.set("isFavorite",v.observable()),d.hasToolsDataUpdated=w.get("hasToolsDataUpdated"),d.switchIsFavorite=function(){var e;y.CheckActionAllowed("addFavorite",!0)&&(e=d.selectedInstrument(),h.IsFavoriteInstrument(e)?(h.RemoveFavoriteInstrument(e),d.isFavorite(!1),v.postbox.publish("favorite-instrument-update",{instrumentId:e,isRemoveInstrument:!0})):(h.AddFavoriteInstrument(e),d.isFavorite(!0),v.postbox.publish("favorite-instrument-update",{instrumentId:e,isAddInstrument:!0})))},d.profileKeyForDefaultTab=v.observable(f.profileKeyForDefaultTab),d.isProcessing=v.observable(!1),d.OrderButtonEnabled=a.createComputed(function(){var e=T.States.IsMarketClosed(),t=d.hasInstrument(),a=d.hasInstrument()&&d.limitsReady()&&d.quotesAvailable(),i=!!d.openLimit&&d.openLimit.isValid(),o=d.isActiveQuote(),r=D.prop.brokerAllowLimitsOnNoRates,n=m.IsValid(),s=0<b.Validate().length,l=d.isShowBuyBox()||d.isShowSellBox(),u=!!isFunctionType(d.selectedDealAmount.isValid)&&d.selectedDealAmount.isValid(),c=0<d.dealMinMaxAmounts().length;return d.selectedDealAmount(),!d.isProcessing()&&(r||!e&&o)&&l&&t&&a&&n&&i&&!s&&c&&u}),d.isVisibleNewLimit=a.createComputed(function(){return s.isShowNewLimit()}),t=a.createComputed(function(){return d.selectedInstrument()}),a.subscribeAndNotify(t,function(e){var t=S.GetInstrument(e);t&&(b.SetInitial(),i.setLimitTabsFromClientProfile(),d.isFavorite(h.IsFavoriteInstrument(e)),m.UpdateSelectedWithToday(e))}),a.subscribeAndNotify(d.isVisibleNewLimit,function(e){e?(i.registerToDispatcher(),v.postbox.publish("new-limit-view",{instrument:d.ccyPair(),instrumentStatus:d.isActiveQuote()?"live":"disabled"})):i.unRegisterFromDispatcher()}),b.Start(l),w.update("stopLossRateLimit",b.Data.stopLossRate),w.update("takeProfitRateLimit",b.Data.takeProfitRate),w.update("openLimit",d.openLimit),w.update("chart",f.chart),w.update("switchToRate",p),d.hasToolsDataUpdated(!0),w.update(eStateObjectTopics.ReadyForUse,!0),w.update("currentRateDirectionSwitch",f.currentRateDirectionSwitch),w.update("PageName",eDealPage.NewLimitViewModel)},dispose:function(){b.Stop(),r.dispose(),r=null,w.unset("currentRateDirectionSwitch"),i.dispose.call(a)},Data:d,BaseOrder:n,OrderButtonHandler:u,ExpirationDate:m,TPField:b.TPField,SLField:b.SLField,SetLimitsInfo:b.ObservableSetLimitsObject,LimitLevelField:i.LimitLevelField,FieldWrappers:r,OnPriceAlertClick:function(){A.SwitchViewVisible(eForms.NewPriceAlert,{transactionTab:eTransactionSwitcher.NewPriceAlert,isActiveQuote:!1,instrumentId:d.selectedInstrument()})}}});return{viewModel:{createViewModel:function(e){var t=new a(e);return t.init(f),t}}}}),define("mobileViewModels/OpenDealsViewModel",["require","knockout","KoComponentViewModel","openDealsGridSettings","viewModels/Deals/OpenDealsModule","Customer","LoadDictionaryContent!views_vMobileOpenDeals","LoadDictionaryContent!views_vMobileLimits","LoadDictionaryContent!views_vMobileClosedDeals"],function(e){var r=e("knockout"),t=e("KoComponentViewModel"),a=e("openDealsGridSettings"),n=new(e("viewModels/Deals/OpenDealsModule")),s=e("Customer");n.Init(a);var i=extendClass(t,function(){var t=this,e=this.parent,a=this.Data,i=1;function o(e){var t={currencyId:s.prop.baseCcyId(),value:Number.fromStr(e.pl())};return Format.toNumberWithCurrency(t.value,t).length}return{init:function(){e.init.call(t),a.maxPlLength=r.pureComputed(function(){var e=Math.max.apply(null,r.utils.arrayMap(n.OpenDeals(),o));return t._previousMaxPlLength&&(t._previousMaxPlLength=e),e=Math.abs(t._previousMaxPlLength-e)>i?e:t._previousMaxPlLength=e}).extend({throttle:500})},Data:a,model:n}});return{viewModel:{createViewModel:function(e){var t=new i(e);return t.init(),t}}}}),define("mobileViewModels/PopupHeaderViewModel",["require","Dictionary","HistoryManager","ViewsManager"],function(e){var o=e("Dictionary"),r=e("HistoryManager"),n=e("ViewsManager");return{viewModel:function(e){var t=n.ActiveFormType(),a=n.Activeform().args?n.Activeform().args.returnTo:null,i=n.Activeform().args?n.Activeform().args.titleParams:String.empty;return{CloseClick:function(){a?n.SwitchViewVisible(a):r.Back()},TitleText:isNullOrUndefined(e)||isEmptyValue(e.title)?String.format(o.GetGlobalItem("view_"+t+"_title"),i):e.title}}}}),define("mobileViewModels/SignalDetailsViewModel",["require","viewModels/BaseSignalsViewModel","QuotesManager","InstrumentsManager","dalTradingSignals"],function(e){var t=e("viewModels/BaseSignalsViewModel"),u=e("QuotesManager"),c=e("InstrumentsManager"),d=e("dalTradingSignals"),a=extendClass(t,function(t){var a=this,i=this.Data,o=this.parent,r=!1;function n(){if(i.hasAgreedDisclaimer())if(t.instrumentId){var e=c.GetInstrument(t.instrumentId());e.hasSignal&&(i.fetchingData(!0),d.getLatestTradingSignal({symbol:e.signalName}).then(function(e){s(JSONHelper.STR2JSON("getLatestTradingSignal/onLoadComplete",e))}).done())}else t.signalId&&(i.fetchingData(!0),d.getTradingSignal({signalId:t.signalId}).then(function(e){s(JSONHelper.STR2JSON("getTradingSignal/onLoadComplete",e))}).done())}function s(e){e.status==eResult.Success&&0==e.resultStatus&&e.result.length&&(i.currentSignal(o.toSignalObject(e.result[0])),l(),u.OnChange.Add(l)),i.signalsAreAvailable(e.status==eResult.Success&&0==e.resultStatus),i.fetchingData(!1)}function l(){var e;i.currentSignal()&&i.currentSignal().instrument.id&&(e=u.Quotes.GetItem(i.currentSignal().instrument.id)),isNullOrUndefined(e)?!r&&i.currentSignal()&&(o.registerInstruments([i.currentSignal().instrument.id]),r=!0):i.currentChange(Format.toSignedPercent(e.change,""))}return{init:function(e){o.init.call(a,e),i.currentSignal=ko.observable(null),i.currentChange=ko.observable(""),a.subscribeTo(i.hasAgreedDisclaimer,function(e){e&&n()}),n()},dispose:function(){u.OnChange.Remove(l),o.dispose.call(a)},OpenNewDeal:o.openDeal,Data:i}});return{viewModel:{createViewModel:function(e){var t=new a((e=e||{}).filterData||{});return t.init(),t}}}}),define("mobileViewModels/SignalsViewModel",["viewModels/BaseSignalsViewModel","signalsConfig","customBindings/InfiniteScrollBinding"],function(e,s){var a=extendClass(e,function(){var t=this,a=this.parent,e=this.Data,i=this.Handlers,o=function(){e.pageIndex=ko.observable(1),e.totalRecords=ko.observable(0)},r=function(){e.scrollingEnabled=t.createComputed(function(){return e.pageIndex()*s.pageSize<e.totalRecords()})},n=function(){i.scrolled=function(){e.pageIndex(e.pageIndex()+1),ko.postbox.publish("signals-view-more",{pageIndex:e.pageIndex()}),a.updateSignalsList()}};return{init:function(e){o(),a.init.call(t,e),r(),n()},Handlers:i,PermissionsModule:a.permissionsModule}});return{viewModel:{createViewModel:function(e){var t=new a((e=e||{}).filterData||{});return t.init(),t}}}}),define("mobileViewModels/TransactionSwitcherViewModel",["require","knockout","KoComponentViewModel","Q","ViewModelsManager","Customer","QuotesManager","RegistrationManager","StatesManager","InstrumentsManager","BuilderForInBetweenQuote","StateObject!Transaction"],function(e){var d=e("knockout"),t=e("KoComponentViewModel"),m=e("Q"),b=e("ViewModelsManager"),p=e("Customer"),v=e("QuotesManager"),f=e("RegistrationManager"),g=e("StatesManager"),D=e("InstrumentsManager"),S=e("BuilderForInBetweenQuote"),y=e("StateObject!Transaction"),a=extendClass(t,function(){var i=this,o=this.parent,r=this.Data||{},n=m.defer(),s=47,l={},u=[];function c(e){var t,a=b.VManager.GetViewArgsByKeyName(eViewTypes.vTransactionSwitcher,"transactionTab"),i=g.States.IsMarketClosed();t=!p.prop.brokerAllowLimitsOnNoRates||e&&!i?isDefinedType(a)&&isDefinedType(eTransactionSwitcher[a])?eTransactionSwitcher[a]:eTransactionSwitcher.NewDeal:eTransactionSwitcher.NewLimit,y.update("selectedTab",t)}return{init:function(e){var t;o.init.call(i,e),r.hasToolsDataUpdated=y.set("hasToolsDataUpdated",d.observable(!1)),r.quoteForOtherCcyToAccountCcy=y.set("quoteForOtherCcyToAccountCcy",d.observable("")),r.quoteForBaseCcyToAccountCcy=y.set("quoteForBaseCcyToAccountCcy",d.observable("")),r.quoteForUsdCcyToAccountCcy=y.set("quoteForUsdCcyToAccountCcy",d.observable("")),r.instrumentId=d.observable(),r.orderDir=d.observable(),r.selectedTransactionTab=d.observable(),r.selectedTransactionTab(y.update("selectedTab","")),u.push({unsubscribe:y.subscribe("selectedTab",function(e){r.selectedTransactionTab(e)})}),r.ToolsData=null,r.isShowNewDeal=i.createComputed(function(){return r.selectedTransactionTab()===eTransactionSwitcher.NewDeal}),r.isShowNewLimit=i.createComputed(function(){return r.selectedTransactionTab()===eTransactionSwitcher.NewLimit}),r.showTools=i.createComputed(function(){return r.hasToolsDataUpdated()&&(r.selectedTransactionTab()===eTransactionSwitcher.NewDeal||r.selectedTransactionTab()===eTransactionSwitcher.NewLimit)}),i.subscribeTo(r.instrumentId,function(t){var a=function(){var e=v.Quotes.GetItem(t);return!!e&&(v.OnChange.Remove(a),n.resolve(e.state!==eQuoteStates.NotActive),!0)};v.OnChange.Add(a),!1===a()&&f.Update(eRegistrationListName.SingleQuote,t);var e,i=D.GetInstrument(t);i&&(e=i,S.GetInBetweenQuote(e.otherSymbol,p.prop.baseCcyId()).then(function(e){r.quoteForOtherCcyToAccountCcy(e)}).done(),S.GetInBetweenQuote(e.baseSymbol,p.prop.baseCcyId()).then(function(e){r.quoteForBaseCcyToAccountCcy(e)}).done())}),l.newDealBtnClick=function(){y.update("selectedTab",eTransactionSwitcher.NewDeal)},l.newLimitBtnClick=function(){y.update("selectedTab",eTransactionSwitcher.NewLimit)},a=b.VManager.GetViewArgs(eViewTypes.vTransactionSwitcher)||{},!isNullOrUndefined(a.orderDir)&&a.instrumentId&&D.GetInstrument(a.instrumentId).isStock&&a.orderDir===eOrderDir.Sell&&(a.orderDir=eOrderDir.None),r.instrumentId(a.instrumentId),a.orderDir===eOrderDir.Buy||a.orderDir===eOrderDir.Sell?r.orderDir(a.orderDir):r.orderDir(eOrderDir.None),t=b.VManager.GetViewArgsByKeyName(eViewTypes.vTransactionSwitcher,"isActiveQuote"),isNullOrUndefined(t)||n.resolve(t),S.GetInBetweenQuote(s,p.prop.baseCcyId()).then(function(e){r.quoteForUsdCcyToAccountCcy(e)}).done(),m.when(n.promise).then(c).done();var a},dispose:function(){var e=y.get("selectedDealAmount");for(e&&e("");0<u.length;)u.pop().unsubscribe();y.clear(),o.dispose.call(i)},Handlers:l,Data:r}});return{viewModel:{createViewModel:function(e){var t=new a(e);return t.init(),t}}}}),define("mobileViewModels/LoginOptionsViewModel",["require","knockout","KoComponentViewModel","ViewModelsManager","AlertsManager","dalCommon","FingerprintTools","LastLoginMethod","Customer","Dictionary"],function(e){var m=e("knockout"),t=e("KoComponentViewModel"),b=e("ViewModelsManager"),p=e("AlertsManager"),v=e("FingerprintTools"),f=e("LastLoginMethod"),g=e("Customer"),D=e("Dictionary"),S=e("dalCommon"),a=extendClass(t,function(){var a=this,i=this.parent,r=this.Data,n=!1,s=!0,o=function(){p.UpdateAlert(AlertTypes.FingerprintLoginActivatedAlert,D.GetItem("fingerprintActivatedTitle","loginOptions"),"",null,{}),p.PopAlert(AlertTypes.FingerprintLoginActivatedAlert)};function e(e){var t;e===v.DeviceSupportErrorEnum.BIOMETRY_IS_LOCKED_OUT?l():(t=D.GetItem("deviceNotSupportFingerprintMessage","loginOptions"),p.UpdateAlert(AlertTypes.DeviceNotSupportFingerprintAlert,D.GetItem("scanFingerprintTitle","loginOptions"),t,null,{okButtonCallback:function(){}}),p.PopAlert(AlertTypes.DeviceNotSupportFingerprintAlert),r.isFingerprintOn(!1))}function l(){var e={title:D.GetItem("scanFingerprintMessage","loginOptions"),message:" ",cancel:D.GetItem("cancelButton","loginOptions"),fingerprint_not_recognized:D.GetItem("scanFingerprintNotRecognized","loginOptions"),fingerprint_success:D.GetItem("scanFingerprintSuccess","loginOptions"),secure_lock_screen_required:D.GetItem("scanFingerprintSecureLockRequired","loginOptions"),finger_moved_too_fast:D.GetItem("scanFingerprintMoovedTooFast","loginOptions"),too_many_attempts:D.GetItem("scanFingerprintTooManyAttempts","loginOptions")},t=0;v.ShowSetFingerprint(e,function(){S.GetJWTLogin().then(function(e){v.SetToken(g.prop.accountNumber,e),n=!0,r.isFingerprintOn(!0),f.SetLastLoginMethod(eLoginMethods.Fingerprint),o()}).fail(function(e){n=!1,r.isFingerprintOn(!1),f.SetLastLoginMethod(eLoginMethods.Password)})},function(e,t){var a;"string"!=typeof e||t||(a=e,p.UpdateAlert(AlertTypes.DeviceNotSupportFingerprintAlert,"",a,null,{okButtonCallback:function(){}}),p.PopAlert(AlertTypes.DeviceNotSupportFingerprintAlert)),r.isFingerprintOn(!1)},function(){r.isFingerprintOn(!1),(t+=1)>=window.systemInfo.fingerprintMaxScanAttempts&&v.FingerprintScanCancel(function(){},function(){})})}var u=function(){v.IsDeviceSupportFingerprint(l,e)},c=function(){a.subscribeTo(r.isFingerprintOn,function(e){var t,a,i,o;!1!==s?e?n||(i={okButtonCallback:function(){u()},cancelButtonCallback:function(){r.isFingerprintOn(!1)}},o=D.GetItem("confirmAddFingerprintMessage"),p.UpdateAlert(AlertTypes.AddFingerprintLoginOptionConfirmationAlert,D.GetItem("scanFingerprintTitle","loginOptions"),o,null,i),p.PopAlert(AlertTypes.AddFingerprintLoginOptionConfirmationAlert)):n&&(t={okButtonCallback:function(){r.isFingerprintOn(!1),v.DeleteToken(),f.SetLastLoginMethod(eLoginMethods.Password),n=!1},cancelButtonCallback:function(){r.isFingerprintOn(!0)}},a=D.GetItem("RemoveFingerprintLoginOptionConfirmationMessage"),p.UpdateAlert(AlertTypes.RemoveFingerprintLoginOptionConfirmationAlert,"",a,null,t),p.PopAlert(AlertTypes.RemoveFingerprintLoginOptionConfirmationAlert)):r.isFingerprintOn(!1)},a)};function d(t){v.GetToken(g.prop.accountNumber,function(e){n=!0,r.isFingerprintOn(!0)},function(e){n=!1,t.option&&"fingerprint"===t.option.toLowerCase()?r.isFingerprintOn(!0):r.isFingerprintOn(!1)})}return{init:function(e){var t=b.VManager.GetViewArgs(eViewTypes.vLoginOptions);i.init.call(a,e),r.isFingerprintOn=m.observable(!1),c(),v.IsDeviceSupportFingerprint(function(){d(t)},function(e){e===v.DeviceSupportErrorEnum.BIOMETRY_IS_LOCKED_OUT?d(t):(e!==v.DeviceSupportErrorEnum.DEVICE_HAS_NO_ENROLLED_FINGERPRINT&&(s=!1),v.DeleteToken(),n=!1)})},dispose:function(){i.dispose.call(a)},Data:r}});return{viewModel:{createViewModel:function(e){var t=new a(e);return t.init(),t}}}}),define("mobileViewModels/PriceAlertsViewModel",["require","KoComponentViewModel","viewModels/Limits/PriceAlertsModule"],function(e){var t=e("KoComponentViewModel"),i=e("viewModels/Limits/PriceAlertsModule"),a=extendClass(t,function(){var t=this,a=this.parent;return{init:function(e){a.init.call(t,e)},dispose:function(){a.dispose.call(t)},model:i}});return{viewModel:{createViewModel:function(e){var t=new a;return t.init(e),t}}}});"use strict";define("mobileViewModels/RisingSunAPMViewModel",["require","knockout","initConfiguration","eWalletPaymentFlow","viewModels/Payments/EwalletComponentViewModel","Dictionary","LoadDictionaryContent!payments_concreteView_mobile"],function(e){var i=e("knockout"),o=e("Dictionary"),r=e("initConfiguration"),n=e("eWalletPaymentFlow"),s=e("viewModels/Payments/EwalletComponentViewModel");return function(){var e=Object.assign(r.RisingSunAPMConfiguration,{title:o.GetItem("eConcretePayment_660","payments_concreteView_mobile")}),t=new s(n,eDepositingActionType.RisingSunAPM,e),a=[];return a.push(i.postbox.subscribe(ePostboxTopic.PaymentDeposit,t.Deposit)),t.init(null,!0),{Form:t.Form,Info:t.Info,Amount:t.Amount,Deposit:function(){i.postbox.publish(ePostboxTopic.PaymentDeposit),i.postbox.publish("trading-event","deposit-submit")},dispose:function(){a.forEach(function(e){e.dispose()}),a.length=0,t.Info.isPaymentButtonVisible(!1),t.dispose()}}}}),define("mobileViewModels/MobileRegularWireTransferViewModel",["require","knockout","viewModels/Payments/RegularWireTransferViewModel"],function(e){var o=e("knockout"),r=e("viewModels/Payments/RegularWireTransferViewModel");return function(){var e=new r,t=[],a={isAmountInputFocused:o.observable(!1),isPaymentButtonVisible:o.observable(!0)};function i(){e.Deposit()}return t.push(o.postbox.subscribe(ePostboxTopic.PaymentDeposit,i)),{Form:e.Form,Info:a,Amount:e.Amount,dispose:function(){t.forEach(function(e){e.dispose()}),t.length=0,e.dispose()},SubmitIfValid:function(){o.postbox.publish(ePostboxTopic.PaymentDeposit),o.postbox.publish("trading-event","deposit-submit")}}}}),define("mobileViewModels/Deposit/WireTransferSuccessViewModel",["require","knockout","Dictionary","LoadDictionaryContent!payments_regularWireTransferDeposit"],function(e){var t=e("knockout"),a=e("Dictionary"),i={amount:t.observable(),accName:t.observable(),accNumber:t.observable(),bankAccNumber:t.observable(),telephone:t.observable(),depCurrency:t.observable(),depAmount:t.observable(),beneficiary:t.observable(),bank:t.observable(),bankCity:t.observable(),bankCountry:t.observable(),iban:t.observable(),swift:t.observable(),paymentRef:t.observable(),specialID:t.observable(),GClogoVisible:t.observable(!1),tooltip:t.observable(a.GetItem("lblIbanDesc","payments_regularWireTransferDeposit"))},o=function(){return{init:function(e){var t;isDefinedType(e)&&isDefinedType(e.data)&&(t=e.data,i.amount(t.amount),i.accName(t.accName),i.accNumber(t.accNumber),i.bankAccNumber(t.bankAccNumber),i.telephone(t.telephone),i.depCurrency(t.depCurrency),i.depAmount(t.depAmount),i.beneficiary(t.beneficiary),i.bank(t.bank),i.bankCity(t.bankCity),i.bankCountry(t.bankCountry),i.iban(t.iban),i.swift(t.swift),i.paymentRef(t.paymentRefForView),i.specialID(t.specialID),i.GClogoVisible(t.GClogoVisible),i.tooltip(a.GetItem("lblIbanDesc","payments_regularWireTransferDeposit")))},Form:i}};return{viewModel:{createViewModel:function(e){var t=new o;return t.init(e),t}}}}),define("currentAppFolder/UILayer/uiBehavior",["HistoryManager"],function(e){return{closeAmlPepForm:function(){e.Back()}}}),define("mobileViewModels/HelpViewModel",["require","KoComponentViewModel","LoadDictionaryContent!Support"],function(e){var t=e("KoComponentViewModel"),a=extendClass(t,function(e){var t=this.parent,a=this.Data;return t.init.call(this,e),a.faqKey=e.faqKey,a.openEventName=e.openEventName,a.overrideAbTesting=e.overrideAbTesting,{data:a}});return{viewModel:{createViewModel:function(e){return new a(e)}}}}),define("mobileViewModels/QuestionMarkViewModel",["require","ViewsManager","AlertsManager","Dictionary"],function(e){var o=e("ViewsManager"),r=e("AlertsManager"),n=e("Dictionary"),t=function(i){return{faqKey:i.faqKey,formToShow:i.formToShow,onClick:function(){var e,t,a;i.alertType?(t=i,a=n.GetItem(t.titleKey),r.UpdateAlert(t.alertType,a,null,null,t),r.PopAlert(t.alertType)):i.formToShow&&(e=i,o.SwitchViewVisible(e.formToShow,e))}}};return{viewModel:{createViewModel:function(e){return new t(e)}}}}),define("mobileViewModels/SearchCountryViewModel",["require","knockout","HistoryManager","viewModels/BaseSearchCountryViewModel"],function(e){var r=e("knockout"),n=e("HistoryManager"),t=e("viewModels/BaseSearchCountryViewModel"),a=extendClass(t,function(){var e=this,t=this.parent,a=this.Data,i=n.GetCurrentState().id,o=!1;return{Init:function(){t.Init.call(e),a.displaySearch=r.observable(!1),a.searchFocus=r.observable(!0),a.displaySearch.subscribe(function(e){if(!o)if(e)n.PushSubState("expand_search_countries");else{var t=n.GetCurrentState().id;i!==t&&n.Back()}}),n.OnStateChanged.Add(function(){var e=n.GetCurrentState().id;i===e&&a.displaySearch()&&(o=!0,a.displaySearch(!1),o=!1)}),a.selectedCountry.subscribe(function(e){!e||!e.id||e.id<=-1||a.displaySearch(!1)})},SetCouuntry:t.SetCouuntry,OnClickBackButton:function(){a.displaySearch(!1),a.searchFocus(!1)},Data:a}});return{viewModel:{createViewModel:function(e){var t=new a(e);return t.Init(),t}}}}),define("viewModels/NewPriceAlertViewModel",["require","knockout","Q","newLimitSettings","dalOrders","ViewModelsManager","Customer","CustomerProfileManager","PermissionsModule","InstrumentsManager","StatesManager","viewModels/Limits/AmountFieldsWrapper","viewModels/Limits/LimitBaseViewModel","StateObject!Transaction"],function(e){var l=e("knockout"),i=e("newLimitSettings"),u=e("Q"),c=e("dalOrders"),d=e("Customer"),m=e("CustomerProfileManager"),b=e("PermissionsModule"),p=e("InstrumentsManager"),v=e("StatesManager"),t=e("viewModels/Limits/LimitBaseViewModel"),f=e("StateObject!Transaction"),g=e("LimitValuesCalculator"),o=extendClass(t,function(){var t,a=this,i=this.parent,n=this.Data,r=i.BaseOrder,s=0;var e=i.updateDistances;function o(e,t,a,i){switch(n.hasInstrument(!0),n.isProcessing(!1),s=n.orderDir()+n.openLimit(),e[0].msgKey){case"OrderError20":l.postbox.publish("price-alert-error",{message:environmentData.maxPriceAlertsCount+" price alert limit reached"}),e[0].result=eResult.Success;break;case"OrderError21":return l.postbox.publish("price-alert-error",{message:"price alert exist"}),void n.priceAlertExist(!0);case"OrderError22":l.postbox.publish("price-alert-error",{message:"general server error"}),e[0].result=eResult.Success;break;case"SuccessPriceAlertAdd":l.postbox.publish("price-alert-create")}var o=p.GetInstrument(a);r.OnActionReturn(e,t,o,{redirectToView:eForms.PriceAlerts,requestData:i,backFormTarget:eForms.Quotes}),o&&p.SetInstrumentDealAmount(a,o.defaultDealSize)}return i.updateDistances=a.updateDistances=function(){e(),n.openLimit()?n.orderDir()===eOrderDir.Sell?n.percentageFromMarketRate(Format.toPercent(g.CalculatePercentFromRate(n.openLimit(),n.activeQuote.ask))):n.orderDir()===eOrderDir.Buy?n.percentageFromMarketRate(Format.toPercent(g.CalculatePercentFromRate(n.openLimit(),n.activeQuote.bid))):n.percentageFromMarketRate(""):n.percentageFromMarketRate(""),s!=n.orderDir()+n.openLimit()&&n.priceAlertExist(!1)},{init:function(e){f.containsKey("stateObjectIsReadyDefer")||f.set("stateObjectIsReadyDefer",u.defer()),n.showLimits=l.observable(1===m.ProfileCustomer().newLimitOrders).extend({notify:"always"}),n.showLimitsSlideCompleted=l.observable(!1),n.toggleLimitsSection=function(){var e=!!n.showLimits();n.showLimits(!e)},n.priceAlertExist=l.observable(!1),n.priceAlertExceedAmount=l.observable(!1),n.percentageFromMarketRate=l.observable(),i.init.call(a,e),n.selectedInstrument.extend({validatable:!1}),n.selectedInstrument.extend({validation:{validator:function(e){var t=n.isActiveQuote(),a=d.prop.brokerAllowLimitsOnNoRates||!v.States.IsMarketClosed()&&t;return isEmptyValue(e)||isEmptyValue(t)||a},message:Dictionary.GetItem("InstrumentInactive")}}),n.selectedInstrument.extend({tooltipValidation:{notify:"always"}}),a.parent.subscribeTo(n.openLimit,a.updateDistances),n.showForexNonIslamicDealInfo=a.createComputed(function(){return n.isForex()&&d.prop.dealPermit!==eDealPermit.Islamic}),n.OrderButtonEnabled=a.createComputed(function(){var e=n.selectedInstrument.isValid(),t=n.hasInstrument()&&n.quotesAvailable(),a=n.isActiveQuote(),i=d.prop.brokerAllowLimitsOnNoRates,o=n.isShowBuyBox()||n.isShowSellBox(),r=0<n.dealMinMaxAmounts().length;return n.openLimit.isValid()&&!n.isProcessing()&&(i||a)&&o&&e&&t&&r}),t=a.createComputed(function(){return n.selectedInstrument()}),a.subscribeAndNotify(t,function(e){var t=p.GetInstrument(e);t&&i.setLimitTabsFromClientProfile()}),i.registerToDispatcher(),f.get("stateObjectIsReadyDefer").resolve(),n.showTools(!1),n.orderDir(eOrderDir.Buy)},dispose:function(){i.dispose.call(a)},Data:n,BaseOrder:r,OrderButtonHandler:function(){if(n.OrderButtonEnabled()&&b.CheckActionAllowed("newLimit",!0,{register:registerParams.traderInstrumentId+n.selectedInstrument()+registerParams.traderOrderDir+(0===n.orderDir()?"Sell":"Buy")}))if(1!=v.States.fxDenied()){if(r.LimitValidateQuote(n.selectedInstrument())){var e=new TLimit;i.fillData(e),e.mode=eLimitMode.PriceAlert,e.amount=0,n.isProcessing(!0),n.hasInstrument(!1),c.AddLimit(e,o)}}else r.ValidateOnlineTradingUser()}}});return{viewModel:{createViewModel:function(e){var t=new o,a=Object.assign(i,e);return t.init(a),t}}}}),define("viewModels/AccessRequestViewModel",["require","knockout","KoComponentViewModel","FxNet/DataAccessLayer/dalCompliance","ViewsManager","StateObject!RequestAccess","HistoryManager"],function(e){var l=e("knockout"),t=e("KoComponentViewModel"),u=e("FxNet/DataAccessLayer/dalCompliance"),c=e("ViewsManager"),d=e("HistoryManager"),m=e("StateObject!RequestAccess"),a=extendClass(t,function(a){var i,o=this,r=this.parent,n=this.Data,s=a.requestAccessType;function t(e){n.currentStatus(e),m.update(i,e)}return{init:function(e){r.init.call(o,e),n.currentStatus=l.observable(eAccessRequestStatus.RequestNotSubmitted),n.isRequestNotSubmitted=l.computed(function(){return n.currentStatus()===eAccessRequestStatus.RequestNotSubmitted},n),n.isRequestSubmitted=l.computed(function(){return n.currentStatus()===eAccessRequestStatus.RequestSubmitted},n),n.isExtensionNotSubmitted=l.computed(function(){return n.currentStatus()===eAccessRequestStatus.ExtensionNotSubmitted},n),n.isExtensionSubmitted=l.computed(function(){return n.currentStatus()===eAccessRequestStatus.ExtensionSubmitted},n),i=function(){var e="";switch(s){case eRequestAccessType.Signals:e=eStateObjectAccessRequest.Signals;break;case eRequestAccessType.VideoLessons:e=eStateObjectAccessRequest.VideoLessons;break;case eRequestAccessType.Tutorials:e=eStateObjectAccessRequest.Tutorials}return e}(),m.containsKey(i)?t=m.get(i):(t=a.isAllowedAccess?eAccessRequestStatus.ExtensionNotSubmitted:eAccessRequestStatus.RequestNotSubmitted,m.set(i,t)),n.currentStatus(t);var t},Data:n,OnClickSubmitRequest:function(){u.sendRequestAccess(s).then(function(e){e===eOperationStatus.Success&&(n.isRequestNotSubmitted()?t(eAccessRequestStatus.RequestSubmitted):n.isExtensionNotSubmitted()&&t(eAccessRequestStatus.ExtensionSubmitted))})},OnCloseClick:function(){var e=c.Activeform().args?c.Activeform().args.returnTo:null;e?c.SwitchViewVisible(e):d.Back()}}});return{viewModel:{createViewModel:function(e){var t=new a(e||{});return t.init(),t}}}}),define("viewModels/accounthub/AccountHeaderViewModel",["require","knockout","KoComponentViewModel","Customer","UserFlowManager","StateObject!userFlow","StateObject!AccountHub","StateObject!IM","PermissionsModule"],function(e){var t=e("KoComponentViewModel"),l=e("knockout"),u=e("Customer"),c=e("StateObject!userFlow"),d=e("StateObject!AccountHub"),m=e("StateObject!IM"),b=e("PermissionsModule"),a=extendClass(t,function(e){var t=this,a=this.parent,i=this.Data,o=[],r=l.observable(!1),n=20;function s(e){if(e)switch(!u.prop.isDemo&&u.prop.abTestings.configuration["account-hub-map"]?i.userStatusName(getEnumName(eUserStatus,e.userStatus)):i.userStatusName(getEnumName(eUserStatus,eUserStatus.Active)),i.generalStatusName("flow_"+getEnumName(eUserStatus,e.userStatus)),e.userStatus){case eUserStatus.ReadyToTrade:case eUserStatus.ActiveLimited:i.generalStatusColor("yellow");break;case eUserStatus.Active:i.generalStatusColor("green");break;case eUserStatus.Locked:case eUserStatus.NotActivated:case eUserStatus.Restricted:i.generalStatusColor("red");break;default:i.generalStatusColor("blue")}}return{init:function(){i.generalStatusColor=l.observable(""),i.userStatusName=l.observable(getEnumName(eUserStatus,eUserStatus.Active)),i.generalStatusName=l.observable(""),i.onClose=e.onClose,s(c.get(eStateObjectTopics.UserFlowChanged)),i.userName=function(){if(!u.prop.firstName&&!u.prop.lastName)return"";var e=u.prop.firstName?u.prop.firstName:"",t=u.prop.lastName?u.prop.lastName.charAt(0):"",a=(e+" "+t+".").trim();if(a.length>n&&0<(a=e).length)if(a="",e.length>n)a=e.substr(0,n).trim()+"...";else for(var i=e.split(" "),o=0;o<i.length;o++)(a+i[o]).length<=n&&(a+=i[o]+" ");return a=a.trim()}(),m.get("message")||m.set("message","empty"),i.MessageCSS=l.observable(m.get("message")),d.get("visible")||d.set("visible",!1),r(d.get("visible")),o.push({unsubscribe:m.subscribe("message",function(e){i.MessageCSS(e)})},{unsubscribe:d.subscribe("visible",function(e){r(e)})},{unsubscribe:c.subscribe(eStateObjectTopics.UserFlowChanged,function(e){s(e)})})},dispose:function(){for(;0<o.length;)o.pop().unsubscribe();a.dispose.call(t)},Data:i,toggleAccountHub:function(){var e=d.get("visible");d.update("visible",!e),e?l.postbox.publish("hub-menu-close"):l.postbox.publish("hub-menu-open")},AccountButtonSelected:r,Customer:u,permissionsModule:b,generalStatusClick:function(){l.postbox.publish("action-source","StatusRow"),$viewModelsManager.VManager.SwitchViewVisible(eForms.UserFlowMap)}}});return{viewModel:{createViewModel:function(e){var t=new a(e||{});return t.init(),t}}}}),define("viewModels/TradingSummaryViewModel",["require","knockout","UserFlowManager","StateObject!userFlow","UserFlowCTA","Customer","StatesManager"],function(e){var s,l,u,c,d=e("knockout"),m=e("StateObject!userFlow"),b=e("UserFlowCTA"),p=e("Customer"),v=e("StatesManager"),f={},g={};function a(e){var t=function(){g.generalStatusColor=d.observable(""),g.ctaText=d.observable(""),g.showCta=d.observable(!0===p.prop.abTestings.configuration["account-hub-map"]&&!(v.States.IsActive()||p.prop.customerType===eCustomerType.TradingBonus))},a=function(){i(),o(),$csHolderManager.OnChange.Add(r)},i=function(){f.availableMargin=d.observable(),f.openPL=d.observable(),f.equity=d.observable(),f.accountBalance=d.observable(),f.customerCcyName=$customer.prop.defaultCcy(),f.availableMarginSign=d.observable(),f.openPLSign=d.observable(),f.equitySign=d.observable(),f.accountBalanceSign=d.observable(),c=$portfolioManager.Portfolio,f.cashBackVisibility=d.observable(!1),f.spreadDiscountVisibility=d.observable(!1),f.pendingBonusType=d.observable(c.pendingBonusType)},o=function(){f.bonusAmount=d.computed(function(){return window.$bonusManager.bonus().amountBase?window.$bonusManager.bonus().amountBase:0})},r=function(){var e=$csHolderManager.CSHolder;f.availableMargin(e.availableMargin),f.openPL(e.openPL),f.equity(e.equity),f.accountBalance(e.accountBalance),f.availableMarginSign(e.availableMargin.sign()),f.openPLSign(e.openPL.sign()),f.equitySign(e.equity.sign()),f.accountBalanceSign(e.accountBalance.sign()),f.cashBackVisibility(ePendingBonusType.cashBack===c.pendingBonusType),f.spreadDiscountVisibility(ePendingBonusType.spreadDiscount===c.pendingBonusType)};function n(e){e&&(e.cta===eCta.ContactUs&&e.userStatus===eUserStatus.Restricted?g.ctaText("fs_"+e.ctaText+"_restricted"):e.cta===eCta.ContactUs&&e.userStatus===eUserStatus.Locked?g.ctaText("fs_"+e.ctaText+"_locked"):g.ctaText("fs_"+e.ctaText),u=e.cta)}return{init:function(){t(),!0===p.prop.abTestings.configuration["account-hub-map"]&&(l=v.States.IsActive.subscribe(function(e){g.showCta(!(e||p.prop.customerType===eCustomerType.TradingBonus))}),n(m.get(eStateObjectTopics.UserFlowChanged)),s=m.subscribe(eStateObjectTopics.UserFlowChanged,function(e){n(e)})),a(),r()},Data:g,ctaClick:function(){d.postbox.publish("action-source","FinancialSummaryCTA"),b.getUserFlowAction(u)()},CustomerInfo:f,dispose:function(){$csHolderManager.OnChange.Remove(r),$vmHelpers.CleanKoObservableSimpleObject(f),s&&s(),l&&l.dispose()}}}return{viewModel:{createViewModel:function(e){var t=new a(e||{});return t.init(),t}}}}),define("UserFlowBaseViewModel",["require","UserFlowManager","StateObject!userFlow","KoComponentViewModel","Customer"],function(e){var t=e("KoComponentViewModel"),h=e("StateObject!userFlow"),C=e("Customer"),A=e("UserFlowManager");return extendClass(t,function(){var a,i,o,r,n,s=this,e=s.parent,l=this.Data||{},u="collapsedContent";function c(e){e&&e.userStatus!==eUserStatus.NA&&(e.userFlowStepsStatuses.forEach(function(e,t){i()[t](e)}),l.userStatus(e.userStatus),l.generalStatusName("flow_"+getEnumName(eUserStatus,e.userStatus)),l.isLocked(e.userStatus===eUserStatus.Locked),l.isRestricted(e.userStatus===eUserStatus.Restricted),l.userMessage(e.userMessage),o(e.currentStep),l.ctaTxt(e.ctaText),r(e.documentProofOfResidenceStatus),n(e.documentProofOfIDStatus),l.maxDaysCounter(e.maxDaysCounter),l.daysCounter(e.daysCounter),l.cta=e.cta)}function d(){switch(l.userStatus()){case eUserStatus.NotActivated:return"ico-not-active redColor";case eUserStatus.ReadyToTrade:case eUserStatus.ActiveLimited:return"ico-limited orangeColor";case eUserStatus.Active:return"ico-active greenColor";case eUserStatus.Restricted:return"ico-restricted redColor";case eUserStatus.Locked:return"ico-locked redColor"}}function m(){switch(l.userStatus()){case eUserStatus.ReadyToTrade:case eUserStatus.ActiveLimited:return"yellowBackground";case eUserStatus.Active:return"greenBackground";case eUserStatus.Locked:case eUserStatus.NotActivated:case eUserStatus.Restricted:return"redBackground"}}function b(e){switch(i()[eUserFlowSteps[e]]()){case eStepStatus.Error:return"ico-milestone-error redColor";case eStepStatus.Restricted:return"ico-milestone-restricted redColor";case eStepStatus.Available:return"ico-milestone blueColor";case eStepStatus.Complete:return 0===eUserFlowSteps[e]||eUserFlowSteps[e]===i().length-1?"ico-milestone-dot greenColor":"ico-milestone-done greenColor";case eStepStatus.Seamless:return 0===eUserFlowSteps[e]?"ico-milestone-dot blueColor":"ico-milestone grayColor";case eStepStatus.Hidden:case eStepStatus.NotActive:default:return 0===eUserFlowSteps[e]||eUserFlowSteps[e]===i().length-1?"ico-milestone-dot grayColor":"ico-milestone grayColor"}}function p(e){return l.userStatus()!==eUserStatus.Locked&&i()[eUserFlowSteps[e]]()===eStepStatus.Available}function v(e){return eUserFlowSteps[e]===o()}function f(e){return i()[eUserFlowSteps[e]]()===eStepStatus.Complete}function g(e){return i()[eUserFlowSteps[e]]()===eStepStatus.Hidden}function D(e){var t=-1;switch(e){case"id":t=n();break;case"addr":t=r()}switch(t){case eUploadDocumentStatus.Approved:return"ico-poi-"+e+"-done greenColor";case eUploadDocumentStatus.Incomplete:return"ico-poi-"+e+"-error redColor";case eUploadDocumentStatus.Processing:return"ico-poi-"+e+"-pending orangeColor";case eUploadDocumentStatus.AwaitingDocument:if(i()[eUserFlowSteps.ProofOfIdentity]()===eStepStatus.NotActive)break;return"ico-poi-"+e+" blueColor";case eUploadDocumentStatus.AwaitingSignature:return"ico-poi-"+e+" blueColor"}return"ico-poi-"+e+" grayColor"}function S(){var e=!l.userFlowToggle();l.userFlowToggle(e),h.update(u,l.userStatus()===eUserStatus.Active?!e:e),!1===l.userFlowToggle()?(ko.postbox.publish("hub-map-expand"),A.startGetDocumentsStatus()):ko.postbox.publish("hub-map-collapse")}function y(){return""!==l.ctaTxt()}function T(e){}function w(){}return{init:function(e){var t;l.cta=eCta.None,t=h.get(u),i=ko.observableArray([ko.observable(),ko.observable(),ko.observable(),ko.observable(),ko.observable(),ko.observable()]),o=ko.observable(),r=ko.observable(),n=ko.observable(),l.userMessage=ko.observable(""),l.ctaTxt=ko.observable(""),l.userStatus=ko.observable(),l.generalStatusName=ko.observable(""),l.isLocked=ko.observable(!1),l.isRestricted=ko.observable(!1),l.stepStatus=b,l.isAvailable=p,l.isCurrent=v,l.isHidden=g,l.isComplete=f,l.poiState=D,l.generalStatusIcon=d,l.generalStatusColor=m,l.userFlowToggle=ko.observable(!isNullOrUndefined(t)&&t),l.toggleUserFlow=S,l.ctaVisible=y,l.stepClick=T,l.ctaClick=w,l.tooltipIdToggle=ko.observable(!1),l.tooltipAddrToggle=ko.observable(!1),l.tooltipNumToggle=ko.observable(!1),l.daysCounter=ko.observable(),l.maxDaysCounter=ko.observable(14),l.isVisible=!C.prop.isDemo,l.daysCounterProgress=s.createComputed(function(){return 4<l.daysCounter()?"":"redProgress"}),l.daysCounterBar=s.createComputed(function(){return 4<l.daysCounter()?"":"redBar"}),l.daysCounterText=s.createComputed(function(){return 4<l.daysCounter()?"":"redDays"}),c(h.get(eStateObjectTopics.UserFlowChanged)),l.userStatus()===eUserStatus.Active?S():A.startGetDocumentsStatus(),a=h.subscribe(eStateObjectTopics.UserFlowChanged,function(e){c(e)})},dispose:function(){a&&a(),e.dispose.call(s)},data:l}})}),define("UserFlowCTA",["require","PermissionsModule","ViewsManager"],function(e){var t=e("PermissionsModule"),a=e("ViewsManager");return{getUserFlowAction:function(e){switch(e){case eCta.Seamless:return t.RegisterLeadType;case eCta.ContactUs:return a.SwitchViewVisible.bind(null,eForms.InternalContactUs);case eCta.ClientQuestionnaire:return a.SwitchViewVisible.bind(null,eForms.ClientQuestionnaire);case eCta.Deposit:return a.SwitchViewVisible.bind(null,eForms.Deposit);case eCta.UploadDocuments:return a.SwitchViewVisible.bind(null,eForms.UploadDocuments);case eCta.None:default:return function(){}}}}}),define("mobileViewModels/account/UserFlowViewModel",["require","UserFlowManager","StateObject!userFlow","UserFlowBaseViewModel","UserFlowCTA"],function(e){var t=e("UserFlowBaseViewModel"),a=e("UserFlowManager"),i=e("UserFlowCTA"),o=extendClass(t,function(){var t=this.parent;return{init:function(e){t.init(e),a.startGetDocumentsStatus(),t.data.stepClick=function(e){ko.postbox.publish("action-source","HubMap"),i.getUserFlowAction(e)()},t.data.ctaClick=function(){ko.postbox.publish("action-source","HubCTA"),i.getUserFlowAction(t.data.cta)()}},dispose:t.dispose,data:t.data}});return{viewModel:{createViewModel:function(e){var t=new o;return t.init(e),t}}}}),define("viewModels/account/LanguageSettingsViewModel",["require","LanguageSettings","ViewModelsManager"],function(e){var a=e("LanguageSettings"),i=e("ViewModelsManager"),t=function(){return{changeLanguage:function(e,t){a(e,t,!0),i.VManager.History.GoBack(i.VManager.Reload)}}};return{viewModel:{createViewModel:function(e){return new t}}}}),define("viewModels/deposit/DepositConfirmationViewModel",["require","knockout","KoComponentViewModel","SymbolsManager","Customer","ErrorManager","dalWithdrawal","fxnet/uilayer/Modules/HtmlToCanvas","fxnet/uilayer/Modules/DomHelper","depositConfirmationConfiguration"],function(e){var d=e("knockout"),t=e("KoComponentViewModel"),m=e("SymbolsManager"),b=e("Customer"),p=e("ErrorManager"),v=e("dalWithdrawal"),f=e("fxnet/uilayer/Modules/HtmlToCanvas"),g=e("fxnet/uilayer/Modules/DomHelper"),D=e("depositConfirmationConfiguration"),a=extendClass(t,function(a){var t=this,i=this.parent,o=this.Data,r={},n={elementToPrint:null,topOffset:emptyFn};function s(e){var t=JSONHelper.STR2JSON("ViewAndPrintWithdrawalViewModel/onLoadCCDepositsComplete",e,eErrorSeverity.medium);r.deposits(t.Deposits),r.depositsTotal(t.DepositsTotal),r.firstDepositDate(t.FirstDepositDate),r.lastDepositDate(t.LastDepositDate)}function l(e){return g.NodeExists(e,D.excludeList)}function u(e){var t={content:e.toDataURL(),fileName:"DC_"+o.accountNumber+"_"+o.dateNow.toISOString().replace(/(-|T|:)/g,"").slice(0,12)+".png"};isFunctionType(a.uploadStringImage)&&a.uploadStringImage(t)}function c(e){o.isLoading(!1),o.hasErrors(!0),p.onError("DepositConfirmationVM/sendDepositConfirmation",e.message,eErrorSeverity.medium)}return{init:function(e){i.init.call(t,e),o.isEmailClicked=d.observable(!1),o.fullName=b.prop.firstName+" "+b.prop.lastName,o.accountNumber=b.prop.accountNumber,o.userName=b.prop.userName,o.dateNow=new Date,o.isLoading=d.observable(!1),o.drawStatus=d.observable(!1),o.editFullName=d.observable(""),o.editPhoneNumber=d.observable(""),o.hasErrors=d.observable(!1),r.depositsTotal=d.observableArray(),r.deposits=d.observableArray(),r.firstDepositDate=d.observable(""),r.lastDepositDate=d.observable(""),v.getCCDeposits(s)},DepositsInfo:r,data:o,sendDepositConfirmation:function(){if(o.hasErrors(!1),0!==o.editFullName().length&&0!==o.editPhoneNumber().length&&o.drawStatus()&&!o.isLoading()){o.isLoading(!0);var e={scrollX:0,scrollY:n.topOffset(),ignoreElements:l,useCORS:!0};f.convert(n.elementToPrint,e).then(u).catch(c)}},getTranslatedSymbolByName:function(e){return m.GetTranslatedSymbolByName(e)},setPrintSettings:function(e,t){n.elementToPrint=e,n.topOffset=t}}});return{viewModel:{createViewModel:function(e){var t=new a(e);return t.init(e),t}}}}),define("LanguageSettings",[],function(){return function(e,t,a){CookieHandler.CreateCookie("LID",e,(new Date).AddMonths(6)),CookieHandler.CreateCookie("Language",t,(new Date).AddMonths(6)),a||window.location.reload(!0)}}),define("viewModels/PersonalDetailsViewModel",["require","knockout","Customer","ViewModelsManager","StatesManager","StateObject!Setting","UserFlowManager","StateObject!userFlow"],function(e){var s=e("knockout"),l=e("Customer"),u=e("ViewModelsManager"),c=e("StateObject!Setting"),d=e("StatesManager"),m=e("StateObject!userFlow");function t(){var e,t,a=s.observable(!0),i={brokerID:s.observable(""),contactFirstName:s.observable(""),contactLastName:s.observable(""),contactFullName:s.observable(""),contactInitials:s.observable(""),contactUserName:s.observable(""),phone:s.observable(""),mobile:s.observable(""),country:s.observable(""),expiryDate:s.observable(""),updateInfoVisible:d.States.IsCddOrKycRequired,generalStatusColor:s.observable(""),generalStatusName:s.observable(""),generalStatusIcon:s.observable(""),generalStatusClick:function(){s.postbox.publish("action-source","StatusRow"),$viewModelsManager.VManager.SwitchViewVisible(eForms.UserFlowMap)},showCta:!1};function o(e){if(e){switch(i.generalStatusName("flow_"+getEnumName(eUserStatus,e.userStatus)),e.userStatus){case eUserStatus.ReadyToTrade:case eUserStatus.ActiveLimited:i.generalStatusColor("yellow");break;case eUserStatus.Active:i.generalStatusColor("green");break;case eUserStatus.Locked:case eUserStatus.NotActivated:case eUserStatus.Restricted:i.generalStatusColor("red");break;default:i.generalStatusColor("blue")}switch(e.userStatus){case eUserStatus.NotActivated:i.generalStatusIcon("ico-not-active redColor");break;case eUserStatus.ReadyToTrade:case eUserStatus.ActiveLimited:i.generalStatusIcon("ico-limited orangeColor");break;case eUserStatus.Active:i.generalStatusIcon("ico-active greenColor");break;case eUserStatus.Restricted:i.generalStatusIcon("ico-restricted redColor");break;case eUserStatus.Locked:i.generalStatusIcon("ico-locked redColor")}}}function r(e){return isNullOrUndefined(e)?"":e}function n(){u.VManager.GetViewArgs(eViewTypes.vPersonalDetails)===eViewTypes.vPersonalDetails&&a(!1)}return{viewModel:i,isOpenCollapsed:n,collapsedToggle:function(){a(!a())},isCollapsed:a,init:function(){c.get("AccountHubSetting")||c.set("AccountHubSetting",null),t=c.subscribe("AccountHubSetting",function(e){a(e!==eViewTypes.vPersonalDetails)}),n(),i.showCta=!1,i.showCta&&(o(m.get(eStateObjectTopics.UserFlowChanged)),e=m.subscribe(eStateObjectTopics.UserFlowChanged,function(e){o(e)})),l.GetCustomerDetails().then(function(e){var t=JSON.parse(e);i.contactFirstName(r(t.contactFirst)),i.contactLastName(r(t.contactLast)),i.brokerID(t.brokerID),i.contactFullName(i.contactFirstName()+" "+i.contactLastName()),i.phone(t.phone),i.mobile(t.mobile),i.country("cntr_"+l.prop.countryID),i.expiryDate(t.expiryDate),i.contactInitials(i.contactFirstName().charAt(0)+i.contactLastName().charAt(0)),i.contactUserName(l.prop.userName)}).done()},dispose:function(){e&&e(),t&&t()},goToUploaddocuments:function(){u.VManager.RedirectToForm(eForms.UploadDocuments)},goToClientQuestionnaire:function(){u.VManager.RedirectToForm(eForms.ClientQuestionnaire)}}}return{viewModel:{createViewModel:function(){var e=new t;return e.init(),e}}}}),define("viewModels/InstrumentNotAvailableViewModel",["require","KoComponentViewModel","StateObject!Transaction","StatesManager"],function(e){var t=e("KoComponentViewModel"),r=e("StateObject!Transaction"),n=e("StatesManager"),a=extendClass(t,function(){var o,e=this,t=this.Data;return{Data:t,init:function(){var a,i;a=r.get("isActiveQuote"),i=r.get("selectedInstrument"),t.instrumentData=e.createComputed(function(){var e=!n.States.IsMarketClosed()&&a(),t=o!==i();return o=i(),{isAvailable:e,isChanged:t}},null,!1)}}});return{viewModel:{createViewModel:function(){var e=new a;return e.init(),e}}}}),define("viewModels/NavigationWizardViewModel",["require","knockout","KoComponentViewModel","HistoryManager","StateObject!wizardState"],function(e){var m,b,p=e("knockout"),v=e("HistoryManager"),t=e("KoComponentViewModel"),f=e("StateObject!wizardState"),a=extendClass(t,function(e){var o=this,r=this.parent,n=this.Data,s=e.configuration,l=s.useBrowserHistory||!1;function u(e){f.update("stepData",{previousStep:{valid:e.previousStep.valid,visible:e.previousStep.visible},nextStep:{valid:e.nextStep.valid,visible:e.nextStep.visible}})}function c(e){if(e.view===s.defaultForm&&e.type===eHistoryStateType.Wizard)return n.step(isEmptyValue(e.step)?s.defaultStep:e.step)}function d(e){l?v.PushWizardState(s.defaultForm,e):n.step(e)}return n.stepData={previousStep:{},nextStep:{}},{init:function(e){var t,a,i;r.init.call(o,e),f.containsKey("step")||f.set("step",s.defaultStep),n.currentStep={next:emptyFn,prev:emptyFn},a=s.default||1,i=s.steps[a],n.step=p.observable(a),n.renderedComponent=p.observable(i.component),Object.assign(n.stepData.previousStep,{label:p.observable(i.previousStep.label),valid:p.observable(i.previousStep.valid),visible:p.observable(i.previousStep.visible)}),Object.assign(n.stepData.nextStep,{label:p.observable(i.nextStep.label),valid:p.observable(i.nextStep.valid),visible:p.observable(i.nextStep.visible)}),u(i),m=f.subscribe("step",function(e){d(e)}),l&&v.OnStateChanged.Add(c),n.step.subscribe(function(e){var t,a,i;a=t=e,i=s.steps[a],n.stepData.previousStep.label(i.previousStep.label),n.stepData.nextStep.label(i.nextStep.label),u(i),Object.assign(n.currentStep,{next:emptyFn,prev:emptyFn}),n.renderedComponent(s.steps[t].component)}),b=f.subscribe("stepData",function(e){n.stepData.previousStep.valid(e.previousStep.valid),n.stepData.previousStep.visible(e.previousStep.visible),n.stepData.nextStep.valid(e.nextStep.valid),n.stepData.nextStep.visible(e.nextStep.visible)}),l&&n.step()!==((t=v.GetCurrentState().data).step?t.step:s.defaultStep)&&d(s.defaultStep)},dispose:function(){f.unset("step"),f.unset("stepData"),m(),b(),l&&v.OnStateChanged.Remove(c),r.dispose.call(o)},Data:n,UpdateStepActions:function(e,t){Object.assign(n.currentStep,{next:e,prev:t})},previousStep:n.stepData.previousStep,nextStep:n.stepData.nextStep,next:function(){n.stepData.nextStep.valid()&&n.currentStep.next()},prev:function(){n.stepData.previousStep.valid()&&n.currentStep.prev()}}});return{viewModel:{createViewModel:function(e){var t=new a(e);return t.init(),t}}}}),define("viewModels/Withdrawal/Wizard/WithdrawalSetAmountViewModel",["require","knockout","KoComponentViewModel","Dictionary","Customer","StatesManager","AlertsManager","JSONHelper","SymbolsManager","dalWithdrawal","LastWithdrawalRequest","SystemInfo","initConfiguration","WithdrawalCommon","StateObject!wizardState","StateObject!withdrawal"],function(e){var c=e("knockout"),t=e("KoComponentViewModel"),d=e("JSONHelper"),n=e("dalWithdrawal"),m=e("Customer"),b=e("SymbolsManager"),s=e("StatesManager"),p=e("Dictionary"),v=e("AlertsManager"),l=e("initConfiguration"),f=e("WithdrawalCommon"),g=e("StateObject!wizardState"),D=e("StateObject!withdrawal"),a=extendClass(t,function(e){var t=this,a=this.parent,u=this.Data,i=g.get("stepData");function o(){var e=eWithdrawalSteps.setMethod;isEmptyValue(u.withdrawalForm.Amount())||isEmptyValue(u.withdrawalForm.SymbolId())||(u.hasCcWithdrawal&&(e=eWithdrawalSteps.setMethod),D.update("withdrawal",{hasCcWithdrawal:u.hasCcWithdrawal,lastBank:u.LastBankWithdrawal(),selectedWithdrawal:u.selectedWithdrawal(),withdrawalOptions:u.withdrawalOptions(),taxAmount:u.withdrawalInfo.TaxAmount(),currency:u.withdrawalForm.SymbolId(),currencyLabel:c.utils.arrayFirst(u.depositCurrencies(),function(e){return e.SymbolID===u.withdrawalForm.SymbolId()}).SymbolName,amount:u.withdrawalForm.Amount(),details:u.withdrawalForm.Details()}),g.update("step",e))}function r(e){var t=d.STR2JSON("WithdrawalViewModel/onLoadWithdrawalInfoComplete",e,eErrorSeverity.medium)||{};if("ServerError"===t.status||"SecurityError"===t.result)return v.ShowAlert(AlertTypes.ServerResponseAlert,p.GetItem("GenericAlert"),p.GetItem("ServerError"),null),void u.isLoaded(!0);u.hasCcWithdrawal=u.withdrawalInfo.canWithdrawal()&&null!==c.utils.arrayFirst(u.withdrawalOptions(),function(e){return!isEmptyValue(e.CCId)}),u.withdrawalOptions(t.WithdrawalTiles),u.LastBankWithdrawal(t.LastBankWithdrawal);var a=t.AllowedWithdrawalInfo||{};if(!isNullOrUndefined(a.AllowedWithdrawalAmount)){u.withdrawalInfo.MaxWithdrawalAmount(a.AllowedWithdrawalAmount),u.withdrawalInfo.TaxAmount(a.TaxAmount);var i=0<a.AllowedWithdrawalAmount.sign(),o=0<a.TaxAmount.sign();u.withdrawalInfo.hasAmount(i),u.withdrawalInfo.hasNoAmount(!i),u.withdrawalInfo.hasTaxAmount(o)}var r,n,s=a.Symbols;if(s){!function(e){for(var t=0;t<e.length;t++)e[t].SymbolName=b.GetTranslatedSymbolById(e[t].SymbolID)}(s),n=s,u.depositCurrencies.removeAll(),c.utils.arrayPushAll(u.depositCurrencies,n),-1!==(r=function(e){for(var t=0;t<e.length;t++)if(e[t].SymbolID===m.prop.selectedCcyId())return t;return-1}(s))&&u.baseSymbol(u.depositCurrencies()[r]);var l=isNullOrUndefined(u.baseSymbol())?"":u.baseSymbol().SymbolID.toString();u.withdrawalForm.SymbolId(f.getSymbolIdOrDefault(l,u.depositCurrencies()))}u.isLoaded(!0)}return u.withdrawalInfo={},u.withdrawalForm={},{init:function(){u.hasCcWithdrawal=!1,u.isLoaded=c.observable(!1),u.LastBankWithdrawal=c.observable(),u.selectedWithdrawal=c.observable(null),u.withdrawalOptions=c.observableArray([]),u.depositCurrencies=c.observableArray([]),u.baseSymbol=c.observable(),Object.assign(u.withdrawalInfo,{hasAmount:c.observable(!1),hasNoAmount:c.observable(!1),hasTaxAmount:c.observable(!1),MaxWithdrawalAmount:c.observable(),TaxAmount:c.observable(),defaultCcy:m.prop.defaultCcy()}),Object.assign(u.withdrawalForm,{ccyList:c.observableArray([]),SymbolId:c.observable(),Details:c.observable(""),Amount:c.observable()}),u.isValidStep=t.createComputed(function(){return!isEmptyValue(u.withdrawalForm.Amount())&&parseFloat(u.withdrawalForm.Amount())<=parseFloat(u.withdrawalInfo.MaxWithdrawalAmount())},t,!1),u.withdrawalInfo.canWithdrawal=t.createComputed(function(){return(!s.States.IsPortfolioInactive()||!0===l.WithdrawalConfiguration.overrideCanWithdrawal)&&u.withdrawalInfo.hasAmount()},t,!1),t.subscribeTo(u.withdrawalOptions,function(e){1===e.length&&u.selectedWithdrawal(u.withdrawalOptions()[0])}),t.subscribeTo(u.isValidStep,function(e){i.nextStep.valid=e,g.update("stepData",i)}),function(){if(m.prop.isDemo)return f.goToDefaultPage();n.getWithdrawalInfo(r),c.postbox.publish("trading-event","witdrawal-view")}(),e.setStepActions(o,emptyFn)},dispose:function(){u.withdrawalInfo.hasAmount(!1),u.withdrawalInfo.hasNoAmount(!1),a.dispose.call(t)},WithdrawalInfo:u.withdrawalInfo,Data:u}});return{viewModel:{createViewModel:function(e){var t=new a(e||{});return t.init(),t}}}}),define("viewModels/Withdrawal/Wizard/WithdrawalSetMethodViewModel",["require","knockout","KoComponentViewModel","WithdrawalCommon","StateObject!wizardState","StateObject!withdrawal"],function(e){var u=e("knockout"),t=e("KoComponentViewModel"),c=e("WithdrawalCommon"),d=e("StateObject!wizardState"),m=e("StateObject!withdrawal"),a=extendClass(t,function(t){var a=this,i=this.parent,o=this.Data,r=d.get("stepData"),n=m.get("withdrawal");function s(){d.update("step",eWithdrawalSteps.setAmount)}function l(){var e,t=o.selectedMethod()===eWithdrawalMethods.card?eWithdrawalSteps.setApproval:eWithdrawalSteps.setBankDetails;(e=m.get("withdrawal")).selectedMethod=o.selectedMethod(),m.update("withdrawal",e),d.update("step",t)}return{init:function(e){if(i.init.call(a,e),o.methods=Object.keys(eWithdrawalMethods),o.isValidStep=u.observable(!1),o.Amount=u.observable(),o.CurrencyLabel=u.observable(),o.selectedMethod=u.observable(),isEmptyValue(n)||isEmptyValue(n.amount)||isEmptyValue(n.currencyLabel))return c.goToDefaultPage();a.subscribeTo(o.selectedMethod,function(e){o.isValidStep(!isNullOrUndefined(e))}),a.subscribeTo(o.isValidStep,function(e){r.nextStep.valid=e,d.update("stepData",r)}),o.Amount(n.amount),o.CurrencyLabel(n.currencyLabel),t.setStepActions(l,s)},dispose:function(){i.dispose.call(a)},Data:o}});return{viewModel:{createViewModel:function(e){var t=new a(e);return t.init(),t}}}}),define("viewModels/Withdrawal/Wizard/WithdrawalSetbankdetailsViewModel",["require","knockout","KoComponentViewModel","WithdrawalCommon","StateObject!wizardState","StateObject!withdrawal"],function(e){var l=e("knockout"),t=e("KoComponentViewModel"),u=e("WithdrawalCommon"),c=e("StateObject!wizardState"),d=e("StateObject!withdrawal"),a=extendClass(t,function(t){var a=this,i=this.parent,o=this.Data,r=d.get("withdrawal");function n(){c.update("step",eWithdrawalSteps.setAmount)}function s(){var e;(e=d.get("withdrawal")).bankName=o.BankName(),d.update("withdrawal",e),c.update("step",eWithdrawalSteps.setApproval)}return{init:function(e){if(i.init.call(a,e),o.Amount=l.observable(),o.CurrencyLabel=l.observable(),o.BankName=l.observable(),isEmptyValue(r)||isEmptyValue(r.amount)||isEmptyValue(r.currencyLabel))return u.goToDefaultPage();o.Amount(r.amount),o.CurrencyLabel(r.currencyLabel),t.setStepActions(s,n)},dispose:function(){i.dispose.call(a)},Data:o}});return{viewModel:{createViewModel:function(e){var t=new a(e);return t.init(),t}}}}),define("viewModels/Withdrawal/Wizard/WithdrawalSetApprovalViewModel",["require","knockout","KoComponentViewModel","WithdrawalCommon","StateObject!wizardState","StateObject!withdrawal"],function(e){e("knockout");var t=e("KoComponentViewModel"),l=e("WithdrawalCommon"),u=e("StateObject!wizardState"),c=e("StateObject!withdrawal"),a=extendClass(t,function(t){var a=this,i=this.parent,o=this.Data,r=c.get("withdrawal");function n(){u.update("step",eWithdrawalSteps.setMethod)}function s(){return c.update("withdrawal",null),l.goToDefaultPage()}return{init:function(e){if(i.init.call(a,e),isEmptyValue(r)||isEmptyValue(r.amount)||isEmptyValue(r.currencyLabel))return l.goToDefaultPage();o.withdrawalInfo={},Object.assign(o.withdrawalInfo,{Amount:r.amount,CurrencyLabel:r.currencyLabel,SelectedMethod:r.selectedMethod,BankName:r.bankName}),t.setStepActions(s,n)},dispose:function(){i.dispose.call(a)},Data:o}});return{viewModel:{createViewModel:function(e){var t=new a(e);return t.init(),t}}}});
//# sourceMappingURL=mobileviewmodels.js.map