var eDepositMessageTypes={d3ProcessStarted:-2,showAmlPending:-1,none:0,confirmation:1,succeeded:2,changeGeneratedPasswordAfterFirstDeposit:3,minDeposit:4,maxDeposit:5,clearerMaxRangeDeposit:33,maxCCAllowed:6,invalidCardType:7,refundableClearer:8,minMaxBlocked:9,maxCardTypeUSDAmount:10,creditCardExpired:11,whiteListValidation:12,meikoPayMaxAmount:13,depositFailed:14,succeededAdditionalWithDescriptor:15,succeededAdditional:16,ccBinCountryBlacklistWithCountryId:17,requestPended:18,unableProcessRequest:19,unsupportedCardType:20,d3secureNotAllowed:21,noSupportedClearers:22,notEnrolledCard:23,notice3DSecureDeposit:24,d3SecureMissed:25,removeCCMessage:26,serverError:27,moneyBookersDepositRequestCancelled:28,cancelledByUser:29,pendingDepositRequest:30,showAdditionalPaymentOnFailedDeposit:31,transactionCancelledByUser:32},eWithdrawalStatuses={None:0,Pending:1,Approved:2,Canceled:3,Processing:4},TDepositCurrency=function(e,t){this.currencyID=e[eDepositCurrency.CurrencyID],this.orderID=e[eDepositCurrency.SortOrderID],this.name=t},DepositMessagesManager=function(){var a=[],t=[],n=[],s=[];return a[eDepositMessageTypes.none]=null,a[eDepositMessageTypes.confirmation]={messageKey:cDepositMessageKeys.confirmation},a[eDepositMessageTypes.succeeded]={messageKey:cDepositMessageKeys.succeeded,titleKey:cDepositMessageKeys.succeededTitle},a[eDepositMessageTypes.changeGeneratedPasswordAfterFirstDeposit]={messageKey:cDepositMessageKeys.changeGeneratedPasswordAfterFirstDeposit},a[eDepositMessageTypes.minDeposit]={messageKey:cDepositMessageKeys.minDeposit,titleKey:cDepositMessageTitleKeys.failedDepositMinimumDeposit},a[eDepositMessageTypes.maxDeposit]={messageKey:cDepositMessageKeys.maxDeposit},a[eDepositMessageTypes.clearerMaxRangeDeposit]={messageKey:cDepositMessageKeys.clearerMaxRangeDeposit},a[eDepositMessageTypes.maxCCAllowed]={messageKey:cDepositMessageKeys.maxCCAllowed},a[eDepositMessageTypes.invalidCardType]={messageKey:cDepositMessageKeys.invalidCardType,titleKey:cDepositMessageTitleKeys.failedDepositDoubleCheck},a[eDepositMessageTypes.refundableClearer]={messageKey:cDepositMessageKeys.refundableClearer},a[eDepositMessageTypes.minMaxBlocked]={messageKey:cDepositMessageKeys.minMaxBlocked},a[eDepositMessageTypes.maxCardTypeUSDAmount]={messageKey:cDepositMessageKeys.maxCardTypeUSDAmount},a[eDepositMessageTypes.creditCardExpired]={messageKey:cDepositMessageKeys.creditCardExpired,titleKey:cDepositMessageTitleKeys.failedDepositExpiryDate},a[eDepositMessageTypes.whiteListValidation]={messageKey:cDepositMessageKeys.whiteListValidation},a[eDepositMessageTypes.meikoPayMaxAmount]={messageKey:cDepositMessageKeys.meikoPayMaxAmount},a[eDepositMessageTypes.depositFailed]={messageKey:cDepositMessageKeys.depositFailed},a[eDepositMessageTypes.requestPended]={messageKey:cDepositMessageKeys.requestPended},a[eDepositMessageTypes.unableProcessRequest]={messageKey:cDepositMessageKeys.unableProcessRequest},a[eDepositMessageTypes.unsupportedCardType]={messageKey:cDepositMessageKeys.unsupportedCardType},a[eDepositMessageTypes.d3secureNotAllowed]={messageKey:cDepositMessageKeys.d3secureNotAllowed},a[eDepositMessageTypes.noSupportedClearers]={messageKey:cDepositMessageKeys.noSupportedClearers},a[eDepositMessageTypes.notEnrolledCard]={messageKey:cDepositMessageKeys.notEnrolledCard},a[eDepositMessageTypes.notice3DSecureDeposit]={messageKey:cDepositMessageKeys.notice3DSecureDeposit},a[eDepositMessageTypes.d3SecureMissed]={messageKey:cDepositMessageKeys.d3SecureMissed},a[eDepositMessageTypes.removeCCMessage]={messageKey:cDepositMessageKeys.removeCCMessage},a[eDepositMessageTypes.serverError]={messageKey:cDepositMessageKeys.serverError},a[eDepositMessageTypes.moneyBookersDepositRequestCancelled]={messageKey:cDepositMessageKeys.moneyBookersDepositRequestCancelled},a[eDepositMessageTypes.cancelledByUser]={messageKey:cDepositMessageKeys.cancelledByUser},a[eDepositMessageTypes.pendingDepositRequest]={messageKey:cDepositMessageKeys.pendingDepositRequest},a[eDepositMessageTypes.succeededAdditionalWithDescriptor]={messageKeyPrefix:cDepositMessageKeyPrefixes.succeededAdditionalWithDescriptor},a[eDepositMessageTypes.succeededAdditional]={messageKeyPrefix:cDepositMessageKeyPrefixes.succeededAdditional},a[eDepositMessageTypes.ccBinCountryBlacklistWithCountryId]={messageKeyPrefix:cDepositMessageKeyPrefixes.ccBinCountryBlacklistWithCountryId,titleKey:cDepositMessageTitleKeys.failedDepositSorry},t[eDepositValidationStatus.Valid]=eDepositMessageTypes.none,t[eDepositValidationStatus.MinDeposit]=eDepositMessageTypes.minDeposit,t[eDepositValidationStatus.MaxDeposit]=eDepositMessageTypes.maxDeposit,t[eDepositValidationStatus.DepositRangeValidationFailed]=eDepositMessageTypes.clearerMaxRangeDeposit,t[eDepositValidationStatus.MaxCCReached]=eDepositMessageTypes.maxCCAllowed,t[eDepositValidationStatus.InvalidCardType]=eDepositMessageTypes.invalidCardType,t[eDepositValidationStatus.RefundableClearer]=eDepositMessageTypes.refundableClearer,t[eDepositValidationStatus.ExceededLimit]=eDepositMessageTypes.showAmlPending,t[eDepositValidationStatus.MinMaxDepositBlocked]=eDepositMessageTypes.minMaxBlocked,t[eDepositValidationStatus.CCBinCountryBlacklist]=eDepositMessageTypes.ccBinCountryBlacklistWithCountryId,t[eDepositValidationStatus.MeikoPayMaxAmount]=eDepositMessageTypes.meikoPayMaxAmount,t[eDepositValidationStatus.MaxCardTypeUSDAmount]=eDepositMessageTypes.maxCardTypeUSDAmount,t[eDepositValidationStatus.ShowAdditionalPaymentOnFailedDeposit]=eDepositMessageTypes.showAdditionalPaymentOnFailedDeposit,t[eDepositValidationStatus.WhiteList]=eDepositMessageTypes.whiteListValidation,t[eDepositValidationStatus.TransactionCancelledByUser]=eDepositMessageTypes.cancelledByUser,t[eDepositValidationStatus.CreditCardExpired]=eDepositMessageTypes.creditCardExpired,n[eDepositEngineStatus.Failed]=eDepositMessageTypes.depositFailed,n[eDepositEngineStatus.Success]=eDepositMessageTypes.succeeded,n[eDepositEngineStatus.CCStored]=eDepositMessageTypes.succeeded,n[eDepositEngineStatus.Finished]=eDepositMessageTypes.succeeded,n[eDepositEngineStatus.Pending]=eDepositMessageTypes.requestPended,s[eClearingStatus.TransactionApproved]=eDepositMessageTypes.none,s[eClearingStatus.FailedOn3DMissing]=eDepositMessageTypes.d3SecureMissed,s[eClearingStatus.FailedOnMoneybookersRequestCanceled]=eDepositMessageTypes.moneyBookersDepositRequestCancelled,{getMessageTypeForValidationStatusId:function(e){return isNullOrUndefined(t[e])?eDepositMessageTypes.depositFailed:t[e]},getMessageTypeForDepositEngineStatusId:function(e){return isNullOrUndefined(n[e])?eDepositMessageTypes.unableProcessRequest:n[e]},getMessageTypeForClearingStatusId:function(e){return isNullOrUndefined(s[e])?eDepositMessageTypes.depositFailed:s[e]},getDepositMessageWrapper:function(e,t){var n=function(e,t){var n=t.messageDetails,s=t.currency;switch(e){case eDepositMessageTypes.minDeposit:case eDepositMessageTypes.maxDeposit:case eDepositMessageTypes.clearerMaxRangeDeposit:return String.format(Dictionary.GetItem(a[e].messageKey),n,s);case eDepositMessageTypes.ccBinCountryBlacklistWithCountryId:return Dictionary.GetItem(a[e].messageKeyPrefix+n);case eDepositMessageTypes.creditCardExpired:case eDepositMessageTypes.maxCardTypeUSDAmount:return String.format(Dictionary.GetItem(a[e].messageKey),n);case eDepositMessageTypes.showAdditionalPaymentOnFailedDeposit:return Dictionary.GetItem(n);case eDepositMessageTypes.succeeded:case eDepositMessageTypes.confirmation:return function(e){var t,n=e.confirmationCode,s=e.currency,o=e.amount;t=n?String.format(Dictionary.GetItem(cDepositMessageKeys.confirmation),o,s,n):String.format(Dictionary.GetItem(cDepositMessageKeys.succeeded),o,s);var a,r,i,u,d,l=[];return u=(r=e).baseClearerTypeId,d=r.transactionDescriptor,(a=u?(i=d?cDepositMessageKeyPrefixes.succeededAdditionalWithDescriptor+u:cDepositMessageKeyPrefixes.succeededAdditional+u,Dictionary.ValueIsEmpty(i)?"":String.format(Dictionary.GetItem(i),d)):"")&&l.push(a),(a=$customer&&$customer.prop&&$customer.prop.showSuggestionChangePassword&&!Dictionary.ValueIsEmpty(cDepositMessageKeys.changeGeneratedPasswordAfterFirstDeposit)?Dictionary.GetItem(cDepositMessageKeys.changeGeneratedPasswordAfterFirstDeposit):"")&&l.push(a),{message:t,messages:l}}(t);default:return Dictionary.GetItem(a[e].messageKey)}}(e,t);return{messages:isObjectType(n)?n.messages:"",message:isStringType(n)?n:n.message,title:function(e,t){var n=(t=t||{}).baseClearerTypeId;if(a[e]&&a[e].titleKey){var s=a[e].titleKey;if(n){var o=s+"_"+n;if(!Dictionary.ValueIsEmpty(o))return Dictionary.GetItem(o)}return Dictionary.GetItem(s)}return null}(e,t)}}}}(),TCreditCard=function(e){var t,n,s,o,a,r,i,u,d=function(e){for(var t=new THashTable,n=0,s=e.length;n<s;n++)t.SetItem(e[n][eDepositCurrency.CurrencyID],new TDepositCurrency(e[n]));return t};return t=(u=e)[eCreditCard.CardTypeID],n=u[eCreditCard.OrderID],s=u[eCreditCard.Name],r=u[eCreditCard.D3SecureStatus],o=d(u[eCreditCard.Currencies]),a=o.Sort("orderID"),i=u[eCreditCard.DepositingActionType],{typeID:t,orderID:n,name:s,D3SecureStatus:r,ccyList:o,ccyUIOrder:a,depositingActionType:i}},TCreditCardManager=function(){var s={},o=new THashTable,r=new ObservableHashTable("typeID","orderID"),i=[];return i[2]={images:["diners-logo.gif"]},i[1]={images:["american-express-logo.gif"]},i[13]={images:["visa-logo.gif","Visa_Electron logo.gif"]},i[22]={images:["qiwi.gif"],langId:7},i[7]={images:["master-card-logo.gif"]},i[8]={images:["maestro_logo.gif"]},{usedCards:o,creditCardsType:r,defaultUsedCard:s,setUsedCardAsDefault:function(e){s.value=e},removeUsedCard:function(e){e==s&&(s.value=-1)},loadData:function(e){!function(e,t){if(r.Clear(),e)for(var n=0,s=e.length;n<s;n++){var o=new TCreditCard(e[n]);if(i[o.typeID]){o.images=i[o.typeID].images.slice();for(var a=0;a<o.images.length;a++)o.images[a]=t+o.images[a]}r.Add(o)}}(e.CreditCards,e.ImagePath),function(e){if(o.Clear(),e)for(var t=0,n=e.length;t<n;t++)o.SetItem(e[t][eCardView.PaymentID],new TCreditCardView(e[t])),o.Container[e[t][eCardView.PaymentID]].D3SecureStatus=r.Get(e[t][eCardView.CardTypeID]).D3SecureStatus,e[t][eCardView.IsDefault]&&(s.value=e[t][eCardView.PaymentID])}(e.UsedCards)},hasData:function(){return!(!r.HasItems()&&!o.hasItems())}}};define("FxNet/LogicLayer/Deposit/CreditCardTypesManager",[],function(){var e={};return e[eDepositCreditCardType.AmericanExpress]=["american_express.svg"],e[eDepositCreditCardType.Diners]=["diners.svg"],e[eDepositCreditCardType.Discover]=["discover.svg"],e[eDepositCreditCardType.Jcb]=["jcb.svg"],e[eDepositCreditCardType.Mastercard]=["mastercard.svg"],e[eDepositCreditCardType.Maestro]=["maestro.svg"],e[eDepositCreditCardType.Switch]=["switch.svg"],e[eDepositCreditCardType.Visa]=["visa.svg","delta.svg"],{Images:e}});var TCreditCardView=function(e){this.paymentID=e[eCardView.PaymentID],this.holderName=e[eCardView.CardHolderName],this.last4=e[eCardView.Last4],this.cardLength=e[eCardView.CardNumberLength],this.expMonth=e[eCardView.ExpirationMonth],this.expYear=e[eCardView.ExpirationYear],this.isDefault=e[eCardView.IsDefault],this.isCVVRequired=e[eCardView.IsCVVRequired],this.cardTypeID=e[eCardView.CardTypeID],this.first6=e[eCardView.First6],this.ccGuid=e[eCardView.CcGuid]},TMoneyBookersManager=function(){var e=new THashTable;return{hasData:function(){return e.hasItems()}}},TWireTransferCountry=function(e){var t,n={id:"",name:"",defaultCurrencyID:"",defaultCurrencyName:"",localCcy:null,internationalCcy:null,localCcyOrder:null,internationalCcyOrder:null,dataStatus:eDataStatus.partial},s=function(e){for(var t=new THashTable,n=0,s=e.length;n<s;n++)t.SetItem(e[n][eWireTransferBankCurrency.CurrencyID],new TWireTransferBankCurrency(e[n]));return t};return t=e,n.id=t[eWireTransferCountry.CountryID],n.name=t[eWireTransferCountry.Name],{prop:n,updateInfo:function(e){n.defaultCurrencyID=e[eWireTransferCountryContainer.DefaultCurrencyID],n.defaultCurrencyName=e[eWireTransferCountryContainer.DefaultCurrencyName],n.localCcy=s(e[eWireTransferCountryContainer.LocalCurrencies]),n.localCcyOrder=n.localCcy.Sort("orderId"),n.internationalCcy=s(e[eWireTransferCountryContainer.InternationalCurrencies]),n.internationalCcyOrder=n.internationalCcy.Sort("orderId"),n.dataStatus=eDataStatus.full}}},TWireTransferBankCurrency=function(e){this.currencyId=e[eWireTransferBankCurrency.CurrencyID],this.orderId=e[eWireTransferBankCurrency.SortOrderID],this.minDeposit=e[eWireTransferBankCurrency.MinDeposit]},TWireTransferManager=function(){var s=new THashTable,o=new TDALDeposit,t=function(e){for(var t=0,n=e.length;t<n;t++)s.SetItem(e[t][eWireTransferCountry.CountryID],new TWireTransferCountry(e[t]))},a=function(e){var t=s.GetItem(e[eWireTransferCountry.CountryID]);return t&&t.updateInfo(e),t},r=function(e,t){var n=JSONHelper.STR2JSON("TWireTransferManager/GetCountryInfoComplete",e);t(a(n))};return{countries:s,init:function(e){t(e.Countries),a(e.UserCountryInfo)},GetCountryInfo:function(e,t){var n=s.GetItem(e);if(n.prop.dataStatus==eDataStatus.full)return t&&t(n),n;o.getWireTransferCountryInfo(e).then(function(e){r(e,t)}).fail(emptyFn).done()},hasData:function(){return s.hasItems()}}};window.CommunicationManager=function(e){var n=e.actionUrl,o=e.postData,t=!1,s=function(){return!!(o&&0<o.length)},a=function(e){s()&&i(e)},r=function(e){t||(s()?(t=!0,e.document.forms[0].submit()):e.location=n,null!==window.FxNet&&void 0!==window.FxNet&&"function"==typeof window.FxNet.exposeUI&&window.FxNet.exposeUI())},i=function(e){var n=e.document,t=u(n);n.getElementsByTagName("body")[0].appendChild(t);var s=o.map(function(e){var t=n.createElement("input");return t.setAttribute("type","hidden"),t.setAttribute("name",e.name),t.setAttribute("value",e.value),t});ko.utils.setDomNodeChildren(t,s)},u=function(e){var t=e.createElement("form");return t.setAttribute("method","post"),t.setAttribute("action",n),t};return{Send:function(e){a(e),r(e)},ActionUrl:n,PostDataArr:o,Hash:e.hash,AccountNumber:e.accountNumber,Title:e.title}};"use strict";define("viewModels/Payments/AstropayCardViewModel",["require","knockout","jquery","initConfiguration","eWalletPaymentFlowNo3rdParty","viewModels/Payments/EwalletComponentViewModel","CcNumberFormatterModule"],function(e){var i=e("knockout"),u=e("jquery"),d=e("initConfiguration"),l=e("eWalletPaymentFlowNo3rdParty"),c=e("viewModels/Payments/EwalletComponentViewModel"),p=e("CcNumberFormatterModule");return function(){var e=function(e){for(var t=(new Date).getFullYear(),n=t+e,s=[];t<n;)s.push([t++]);return s},t={months:i.observableArray(),years:i.observableArray(),isPaymentButtonVisible:i.observable(!0)},n={cardNumber:i.observable(),cvv:i.observable(),expirationMonth:i.observable(""),expirationYear:i.observable(""),paymentNote:i.observable(),expirationDate:i.pureComputed(function(){return n.expirationMonth()&&n.expirationMonth.isValid()&&n.expirationYear()&&n.expirationYear.isValid()?new Date(n.expirationYear(),n.expirationMonth()):null})},s=new c(l,eDepositingActionType.AstropayCard,d.AstropayCardConfiguration),o={cardNumberValidation:n.cardNumber.extend({required:{params:!0,onlyIf:s.Form.isDepositClicked}}),cvv:n.cvv.extend({required:{onlyIf:s.Form.isDepositClicked},digit:{value:!0,onlyIf:s.Form.isDepositClicked}}),expirationMonth:n.expirationMonth.extend({required:{value:!0,message:Dictionary.GetItem("reqMonth"),onlyIf:s.Form.isDepositClicked}}),expirationYear:n.expirationYear.extend({required:{value:!0,message:Dictionary.GetItem("reqYear"),onlyIf:s.Form.isDepositClicked}}),expirationDate:n.expirationDate.extend({required:{value:!0,onlyIf:s.Form.isDepositClicked}})},a=[];function r(){s.Deposit(u.extend({cardNumber:s.Form.cardNumber(),cardCvv:s.Form.cvv(),cardExpirationMonth:s.Form.expirationMonth(),cardExpirationYear:s.Form.expirationYear()},s.buildRequest()))}return u.extend(s.Info,t),u.extend(s.Form,n),a.push(i.postbox.subscribe(ePostboxTopic.PaymentDeposit,r)),s.init(function(){s.Info.months(["01","02","03","04","05","06","07","08","09","10","11","12"]),s.Info.years(e(30)),s.Amount.Data.value()&&s.Amount.Data.value("")},!0),s.AddAdditionalValidations(o),{Form:s.Form,Info:s.Info,Amount:s.Amount,OnKeyPress:function(e,t){return p.OnKeyPress(t)},OnKeyUp:function(e,t){p.OnKeyUp(t)},dispose:function(){a.forEach(function(e){e.dispose()}),a.length=0,s.Info.isPaymentButtonVisible(!1),s.dispose()},SubmitIfValid:function(){i.postbox.publish(ePostboxTopic.PaymentDeposit),i.postbox.publish("trading-event","deposit-submit")}}}}),define("viewModels/Payments/AstropayViewModel",["require","knockout","jquery","initConfiguration","eWalletPaymentFlow","dalDeposit","Customer","viewModels/Payments/EwalletComponentViewModel","dalCustomer"],function(e){var r=e("knockout"),i=e("jquery"),u=e("initConfiguration"),d=e("eWalletPaymentFlow"),l=e("dalDeposit"),c=e("Customer"),p=e("viewModels/Payments/EwalletComponentViewModel"),m=e("dalCustomer");return function(){var t={paymentMethods:r.observableArray([]),showPaymentMethodsSelect:r.observable(!0)},o={idNumber:r.observable(""),countries:r.observableArray([]),selectedCountry:r.observable(),selectedPayment:r.observable()},e=[];m.GetCustomerDetails().then(function(e){var t=JSON.parse(e);o.idNumber(t.idNumber)}).done();var n=new p(d,eDepositingActionType.Astropay,u.AstropayConfiguration);function s(e){o.idNumber(c.prop.idNumber);var n,t,s=o.selectedCountry()?o.selectedCountry().code:e?e.paymentCountry:"";n=s,o.selectedPayment()||l.getAstropayPaymentMethods().then(function(e){var t=JSON.parse(e);o.countries(t),function(e,t){if(e&&0!==e.length){var n=e.filter(function(e){return t?e.code.toLowerCase()===t.toLowerCase():e.id.toString()===c.prop.countryID}),s=0<n.length?n[0]:null;o.selectedCountry(s)}}(t,n)}).fail(emptyFn).done(),e&&(t=e,o.idNumber(t.idNumber))}function a(){o.isDepositClicked(!0),o.formValidation.isValid()?n.Deposit(i.extend({idNumber:o.idNumber(),paymentMethod:o.selectedPayment(),paymentCountry:o.selectedCountry().code},n.buildRequest())):o.formValidation.errors.showAllMessages()}return n.AddAdditionalValidations({selectedCountry:o.selectedCountry.extend({required:!0}),idNumber:o.idNumber.extend({required:{params:!0,onlyIf:n.Form.isDepositClicked}}),selectedPayment:o.selectedPayment.extend({required:{params:!0,onlyIf:n.Form.isDepositClicked}})}),e.push(r.postbox.subscribe(ePostboxTopic.ConcretePaymentData,function(e){o.selectedCountry(e.paymentCountry),o.selectedPayment(e.paymentData),t.showPaymentMethodsSelect(!e.paymentData)},!0)),o.paymentMethods=r.computed(function(){if(!t.showPaymentMethodsSelect()||!o.selectedCountry())return[];var e=o.countries().filter(function(e){return e.code.toLowerCase()===o.selectedCountry().code.toLowerCase()});return e&&0!==e.length?e[0].paymentMethods:[]}).extend({throttle:1}),e.push(o.paymentMethods.subscribe(function(){setTimeout(function(){var e=o.paymentMethods();o.selectedPayment(0<e.length?e[0].code:"")},100)})),e.push(r.postbox.subscribe(ePostboxTopic.PaymentDeposit,a)),n.init(s,!0),i.extend(t,n.Info),i.extend(o,n.Form),{Deposit:a,Form:o,Info:t,Amount:n.Amount,dispose:function(){e.forEach(function(e){e.dispose()}),e.length=0,n.dispose()}}}}),define("viewModels/Payments/ConcretePaymentBehavior",["require","knockout","PaymentSelectionBehaviors","StateObject!PaymentType"],function(e){var c=e("knockout"),p=e("PaymentSelectionBehaviors"),m=e("StateObject!PaymentType");return m.set(ePostboxTopic.ConcretePaymentData),function(){return{showPaymentView:function(e,t,n,s){if(!isNullOrUndefined(e)&&!isNullOrUndefined(e.paymentType)){var o,a,r,i,u,d=function(e){try{return e.paymentData?JSON.parse(e.paymentData):{}}catch(e){return{}}}(e),l=d.viewType;p.ShowSelectedBehavior(e.paymentType,l),p.CheckMissingCustomerInformation(),o=e,a=n,r=t,i=s,u={paymentData:d.paymentData||o.paymentData,paymentCountry:r,concretePaymentType:o.id,paymentCurrencies:o.currencies,paymentType:o.paymentType,paymentImageClass:a,originalPaymentName:o.originalPaymentName||o.name,subtitleContentKey:o.subtitleContentKey,allowedCreditCards:i,isCcBinFromEea:o.isCcBinFromEea},c.postbox.publish(ePostboxTopic.ConcretePaymentData,u),m.update(ePostboxTopic.ConcretePaymentData,u)}}}}}),define("viewModels/Payments/ConcretePaymentFormViewModel",["require","knockout","KoComponentViewModel","viewModels/Payments/ConcretePaymentBehavior","StatesManager","ViewsManager"],function(e){var d=e("knockout"),t=e("KoComponentViewModel"),n=e("viewModels/Payments/ConcretePaymentBehavior"),s=e("StatesManager"),l=e("ViewsManager"),o=extendClass(t,function(){var o=this,a=this.parent,e=a.Data,r={},i=new n;function u(e){r.selectedPaymentType(e.paymentType),r.paymentTitle(e.originalPaymentName)}return{init:function(e){a.init.call(o,e),r.selectedPaymentType=d.observable(),r.paymentTitle=d.observable(),r.paymentSubtitle=d.observable(),r.imageClass=d.observable(),r.name=d.observable(),r.lastChars=d.observable(),r.isExistingCC=d.observable(),r.cardHolder=d.observable(),r.expirationDate=d.observable(),r.lastUsed=d.observable(),r.isGeneric=d.observable(),r.allowedCreditCards=d.observableArray([]),o.addDisposable(d.postbox.subscribe(ePostboxTopic.ConcretePaymentData,u,!0)),s=l.GetViewArgs(eViewTypes.vConcretePaymentForm),s&&(r.imageClass(s.imageClass||""),r.name((t=s.payment,Dictionary.ValueIsEmpty(t.textContentKey)||(t.name=Dictionary.GetItem(t.textContentKey)),t.name||"")),r.lastChars(s.lastChars||""),r.paymentSubtitle(((n=s.payment).subtitleContentKey&&!Dictionary.ValueIsEmpty(n.subtitleContentKey)?Dictionary.GetItem(n.subtitleContentKey):"")||""),r.isExistingCC(!!s.payment.isExistingCC),r.cardHolder(s.cardHolder||""),r.expirationDate(s.expirationDate||""),r.lastUsed(s.lastUsed||""),r.isGeneric(s.isGeneric||""),r.allowedCreditCards(s.allowedCreditCards||[]),i.showPaymentView(s.payment,s.country,"",[]));var t,n,s},Data:e,IsVisible:function(e){return e===r.selectedPaymentType()},IsDemo:s.States.IsDemo,DepositActionTypes:window.eDepositingActionType,Form:r}});return{viewModel:{createViewModel:function(e){var t=new o;return t.init(e),t}}}}),define("viewModels/Payments/ConcretePaymentSubtitleViewModel",["require","knockout"],function(e){var n=e("knockout");return function(){var e=[],t={};return t.subtitleContentKey=n.observable(null),t.hasSubtitle=n.pureComputed(function(){return!isEmptyValue(t.subtitleContentKey())}),e.push(n.postbox.subscribe(ePostboxTopic.ConcretePaymentData,function(e){t.subtitleContentKey(e.subtitleContentKey)},!0)),{Info:t,dispose:function(){e.forEach(function(e){e.dispose()}),e.length=0}}}}),define("viewModels/Payments/ConcretePaymentsViewModel",["require","knockout","Q","dalDeposit","Customer","initConfiguration","AlertsManager","CustomerProfileManager","viewModels/Payments/ConcretePaymentBehavior","ViewsManager","Dictionary","PaymentSelectionBehaviors","FxNet/LogicLayer/Deposit/CreditCardTypesManager","UrlResolver","JSONHelper","StateObject!Deposit"],function(e){var x=e("knockout"),F=e("Q"),N=e("dalDeposit"),R=e("Customer"),E=e("initConfiguration"),k=e("AlertsManager"),O=e("CustomerProfileManager"),K=e("viewModels/Payments/ConcretePaymentBehavior"),B=e("ViewsManager"),G=e("Dictionary"),q=e("PaymentSelectionBehaviors"),U=e("FxNet/LogicLayer/Deposit/CreditCardTypesManager"),L=e("UrlResolver"),W=e("JSONHelper"),H=e("StateObject!Deposit");return function(){var f={selectedCategory:x.observable(),selectedCountry:x.observable().extend({rateLimit:{timeout:500,method:"notifyWhenChangesStop"}}),lastHandledCountry:x.observable()},D={payments:x.observableArray([]),categories:x.observableArray([]),countries:x.observableArray([]),allowedCreditCards:x.observableArray([]),currentPayment:x.observable(),customerHasMissingInfo:x.observable(R.prop.hasMissingInformation),arePaymentsLoading:x.observable(!1),isLoading:x.observable(!0)},e=x.observable(!1).extend({notify:"always"}),t=x.computed(function(){isNullOrUndefined(f.selectedCountry())||isNullOrUndefined(f.selectedCategory())||e(!0)}),n=[],s=["rcmd","cc","epayment","bank","prepaid","last"],g=E.PaymentsConfiguration.supportLastPaymentCategory,o=E.PaymentsConfiguration.redirectToLastPaymentOnLoad,v=E.PaymentsConfiguration.viewTypeForExistingCC,a=E.PaymentsConfiguration.showAllowedCreditCards,r=new K;function i(){D.arePaymentsLoading(!0),f.lastHandledCountry(f.selectedCountry()),F.all([N.getConcretePayments(f.selectedCountry().id,parseInt(R.prop.countryID),R.prop.brokerID),N.getUserDepositDetails(null)]).then(u).done()}function b(e,t,n){return n&&e===t?eConcretePaymentCategory.LastPayment:eConcretePaymentCategory.Recommended}function u(e){f.lastHandledCountry()!==f.selectedCountry()?(f.lastHandledCountry(f.selectedCountry()),f.selectedCountry.valueHasMutated()):(function(e){var t=JSON.parse(e[0]),n=t.maxRecommended,r=t.payments,s=t.categories,o=JSON.parse(e[1]).actions;r.forEach(T);var a,i,u,d,l,c,p,m,y,C=function(e,t){for(var n=t.length-1;0<=n;--n){var s=P(e,t[n]);if(s)return n}return-1}(r,o);o&&0<o.length&&o.forEach(function(e,t){var n,s,o,a;e.id?function(e,t,n){var s=P(t,e);if(s){var o=t[s.index];o.isUserAction=!0,o.isRecommended=!0,o.categories.push(n),t.splice(s.index,1),t.unshift(o)}}(e,r,b(t,C,g)):(n=e,s=r,o=b(t,C,g),(a=JSON.parse(n.paymentData)).viewType=v,s.unshift({id:null,name:n.name,paymentType:1,currencies:n.currencies,ccTypeId:a.paymentData,categories:[o,eConcretePaymentCategory.CreditCard],paymentData:JSON.stringify(a),textContentKey:"",originalPaymentName:n.paymentName,imageClass:n.imageClass+"_saved",isRecommended:!0,isExistingCC:!0,isGeneric:!1,isUserAction:!0,subtitleContentKey:n.subtitleContentKey,cardHolder:n.cardHolder,expirationDate:function(e){if(isEmptyType(e)||!isStringType(e))return null;var t=e.split("/");if(2!==t.length)return e;var n=t[0],s=t[1],o=2===s.length?"20"+s:s;return String.format("{0}/{1}",n,o)}(n.expirationDate),lastUsed:n.lastUsed?new Date(n.lastUsed):"",isCcBinFromEea:n.isCcBinFromEea}))}),m=n,y=0,r.forEach(function(e){e.isRecommended&&(y<m?++y:e.isRecommended=!1)}),c=s,p=g&&0<=C,r.find(function(e){return e.isRecommended})&&(c.unshift(eConcretePaymentCategory.Recommended),p&&c.unshift(eConcretePaymentCategory.LastPayment)),D.payments(r),a=s,i=r,g&&a.forEach(function(e,t){var n,s,o;e!==eConcretePaymentCategory.LastPayment&&(n=e,s=t,o=a,i.find(function(e){return n===eConcretePaymentCategory.Recommended&&e.isRecommended||n!==eConcretePaymentCategory.Recommended&&e.categories.contains(n)})||o.splice(s,1))}),d=(u=a).filter(function(e){return!(e===eConcretePaymentCategory.Recommended||e===eConcretePaymentCategory.LastPayment)}).length,l=u.indexOf(eConcretePaymentCategory.Recommended),1===d&&0<=l&&u.splice(l,1),s=a,D.categories(s),s&&(isDefinedType(O.ProfileCustomer().lastSelectedCategory)&&g?(M(O.ProfileCustomer().lastSelectedCategory),f.selectedCategory(O.ProfileCustomer().lastSelectedCategory),O.ProfileCustomer().lastSelectedCategory=void 0):M(s[0]))}(e),x.postbox.publish(ePostboxTopic.ConcretePaymentSelectedCountry,f.selectedCountry())),D.arePaymentsLoading(!1)}function P(e,t){for(var n=0;n<e.length;++n){var s=e[n];if(r=s,(i=t).id&&r.id===i.id||(o=s,!(a=t).id&&1===o.paymentType&&o.paymentDataObject&&o.paymentDataObject.paymentData===a.ccType))return{details:s,index:n}}var o,a,r,i;return null}function T(e){if(e){var t=w(e.paymentData||""),n=t&&"generic"===t.paymentData,s=null;!n&&t&&isNumber(t.paymentData)&&(s=Number(t.paymentData)),isObjectType(t)&&(e.paymentDataObject=t),e.isGeneric=n,e.ccTypeId=s}}function d(e){return e.imageClass?e.imageClass:f.selectedCategory()===eConcretePaymentCategory.Recommended?c(e.categories.find(l)):c(f.selectedCategory())}function l(e){return e!==eConcretePaymentCategory.Recommended}function c(e){return"unavailable "+s[e]}function M(e){if(isNullOrUndefined(e))V();else{var t;if(f.selectedCategory(e),g&&e===eConcretePaymentCategory.LastPayment){var n=D.payments().find(function(e){return e.isRecommended});setTimeout(m,200,n),t=!0}else t=function(){if(!o)return!1;if(H.get("skipRedirectToLastPayment"))return H.update("skipRedirectToLastPayment",!1),!1;var e=D.payments().find(function(e){return e.isRecommended&&e.isUserAction});return!!e&&(p(),setTimeout(y,200,e),!0)}();t||(q.Stop(),D.currentPayment(null),D.isLoading(!1))}}function p(){H.update("skipRedirectToLastPayment",!0)}function m(e){D.isLoading(!1),D.arePaymentsLoading()||(q.Stop(),D.currentPayment(e),r.showPaymentView(e,f.selectedCountry(),d(e),e.isGeneric&&a?D.allowedCreditCards():[]),O.ProfileCustomer().lastSelectedCategory=f.selectedCategory())}function y(e){D.isLoading(!1),p(),B.SwitchViewVisible(eForms.ConcretePaymentForm,{payment:e,country:f.selectedCountry(),imageClass:d(e),lastChars:h(e),cardHolder:e.cardHolder,expirationDate:e.expirationDate,lastUsed:e.lastUsed,isGeneric:e.isGeneric,allowedCreditCards:D.allowedCreditCards(),isCcBinFromEea:e.isCcBinFromEea}),O.ProfileCustomer().lastSelectedCategory=f.selectedCategory(),O.ProfileCustomer().lastSelectedPaymentMethodCountry=f.selectedCountry()}function C(e){return G.ValueIsEmpty(e.textContentKey)||(e.name=G.GetItem(e.textContentKey)),e.name}function h(e){if(!isDefinedType(e))return"";var t=C(e);if(isNullOrUndefined(t))return"";if(t.length<4)return t;var n=t.length-4;return t.substring(n)}function w(e){return W.IsValid(e)?W.STR2JSON("ConcretePaymentsViewModel/deserializeData",e):null}function I(e){e.CreditCards.forEach(S)}function S(e){var t=e[0],n=U.Images[t];n&&n.forEach(A)}function A(e){D.allowedCreditCards.push(L.getImageSharedPath(e))}function V(){k.UpdateAlert(AlertTypes.ServerResponseAlert,null,G.GetItem("DepositNoPaymentMethods"),null,{redirectToView:E.PaymentsConfiguration.missingPaymentsRedirect}),k.PopAlert(AlertTypes.ServerResponseAlert)}return n.push(f.selectedCountry.subscribe(function(){f.selectedCountry()&&i()})),n.push(x.postbox.subscribeSingleton(ePostboxTopic.ReloadConcretePayments,function(){e(!0),i()})),n.push(x.postbox.subscribeSingleton(ePostboxTopic.MissingInfo,function(e){D.customerHasMissingInfo(e)})),N.getPaymentCountries(R.prop.brokerID,R.prop.countryID).then(function(e){var t=JSON.parse(e).result.countries.map(function(e){var t=function(e){var t={"(":cTextMarks.Ltr+"(","[":cTextMarks.Ltr+"[",")":")"+cTextMarks.Ltr,"]":"]"+cTextMarks.Ltr};for(var n in t)t.hasOwnProperty(n)&&(e=e.replace(n,t[n]));return e}(e.name);return{text:t,id:e.id,code:e.code.toLowerCase(),label:t}});D.countries(t);var n=R.prop.countryID;isDefinedType(O.ProfileCustomer().lastSelectedPaymentMethodCountry)&&(n=O.ProfileCustomer().lastSelectedPaymentMethodCountry.id.toString()),function(e,t){if(!e||0===e.length)return V();var n=e.filter(function(e){return e.id.toString()===t});f.selectedCountry(0<n.length?n[0]:e[0])}(t,n)}).fail(V).done(),N.getAllowedCreditCardData(R.prop.accountNumber).then(w).then(I).fail(emptyFn).done(),{Form:f,Info:D,getPaymentVisibility:function(e){return!!e.categories&&(0<=e.categories.indexOf(f.selectedCategory())&&f.selectedCategory()!==eConcretePaymentCategory.Recommended&&f.selectedCategory()!==eConcretePaymentCategory.LastPayment||e.isRecommended&&f.selectedCategory()===eConcretePaymentCategory.Recommended)},changeSelectedCategory:M,showPaymentView:m,getConcretePaymentName:C,getConcretePaymentSubtitle:function(e){return!e.subtitleContentKey||G.ValueIsEmpty(e.subtitleContentKey)?"":G.GetItem(e.subtitleContentKey)},getLastFourCharsOfConcretePaymentName:h,isSelectedCategory:function(e){return f.selectedCategory()===e},isSelectedPayment:function(e){return e===D.currentPayment()},getPaymentClass:d,getCategoryClass:function(e){var t=s[e];return f.selectedCategory()===e&&(t+=" active"),t},getCategoryName:function(e){var t=G.GetItem("ePaymentCategory_"+e);return e===eConcretePaymentCategory.LastPayment&&0<D.payments().length?t+" ("+C(D.payments()[0])+") ":t},getPaymentId:function(e){return e=x.utils.unwrapObservable(e),isNullOrUndefined(e.id)?"PaymentData_"+function(e){try{return JSON.parse(e.paymentData)}catch(e){return{}}}(e).paymentData:"ConcretePaymentTypeId_"+e.id},dispose:function(){q.CloseMissingDetailsDialog(),n.forEach(function(e){e.dispose()}),n.length=0},goToPaymentView:y,resetPaymentsFormPositionOn:t,shouldResetPaymentsFormPosition:e,skipRedirectToLastPayment:p,removeConcretePayment:function(e){var t,n,s;e&&e.isExistingCC&&(t={okButtonCallback:function(){N.removeUsedCard(e.ccTypeId).fail(emptyFn).done(),p(),x.postbox.publish(ePostboxTopic.ReloadConcretePayments)},okButtonCaption:"depConfirmRemoveCC",cancelButtonCaption:"depCancelRemoveCC"},n=h(e),s=String.format(G.GetItem(cDepositMessageKeys.removeCCMessage),n),k.UpdateAlert(AlertTypes.RemoveCreditCardConfirmationAlert,"",s,null,t),k.PopAlert(AlertTypes.RemoveCreditCardConfirmationAlert))}}}}),define("viewModels/Payments/CreditCard3rdPartyViewModel",["require","knockout","ViewModelBase","initConfiguration","VmHelpers","eWalletPaymentFlow","viewModels/Payments/CreditCard3rdPartyPublicData"],function(e){var c=e("knockout"),p=e("ViewModelBase"),m=e("initConfiguration"),y=e("VmHelpers"),C=e("eWalletPaymentFlow"),f=e("viewModels/Payments/CreditCard3rdPartyPublicData");return function(){var e={},t={},n=this,s=[],o=eDepositingActionType.SafechargePPP,a=new f(o),r=clone(p),i=m.PaymentsConfiguration;function u(){y.CleanKoObservableSimpleObject(e)}function d(){if(a.Form.isValidationEnabled(!0),e.formValidation.isValid())return a.Form.selectedCCType()?void C.DepositCreditCard3rdParty({depositCurrency:a.Amount.Data.selectedCurrency().orderId,amount:a.Amount.Data.value(),paymentType:o}):(AlertsManager.UpdateAlert(AlertTypes.ServerResponseAlert,null,Dictionary.GetItem("depUnsupportedCardType"),""),void AlertsManager.PopAlert(AlertTypes.ServerResponseAlert));e.formValidation.errors.showAllMessages(!0)}function l(){u()}return s.push(c.postbox.subscribe(ePostboxTopic.PaymentDeposit,d)),r.setSettings(n,i),a.Init(),C.Init(i,l),e.isDepositInProgress=c.observable(!1),e.formValidation=c.validatedObservable({ccData:a.Form.isValid.extend({equal:!0}),isDepositInProgress:e.isDepositInProgress.extend({notEqual:!0}),amount:a.Amount.Data.value}),t.isPaymentButtonVisible=c.observable(!0),t.isAmountInputFocused=c.observable(!1),u(),a.Start(),C.start(),{PublicInfo:a.Info,PublicForm:a.Form,Form:e,Info:t,Amount:a.Amount,Deposit:d,dispose:function(){u(),t.isPaymentButtonVisible(!1),a.Stop(),C.stop(),s.forEach(function(e){e.dispose()}),s.length=0}}}}),define("viewModels/Payments/CreditCard3rdPartyPublicData",["require","knockout","VmHelpers","JSONHelper","dalDeposit","CreditCardManager","defaultCurrencyManager","Customer","Dictionary","SymbolsManager","AlertsManager","fxnet/uilayer/viewmodels/payments/validation/amountcurrencyvalidation"],function(e){var m=e("knockout"),y=e("VmHelpers"),C=e("JSONHelper"),f=e("dalDeposit"),D=e("CreditCardManager"),g=e("defaultCurrencyManager"),v=e("Customer"),b=e("Dictionary"),P=e("SymbolsManager"),T=e("AlertsManager"),M=e("fxnet/uilayer/viewmodels/payments/validation/amountcurrencyvalidation");return function(e){g.loadLastUsedCurrency();var s={},o={},t=[],n=[],a=e,r=!1,i=this,u=new M({paymentType:e});function d(e){return e.map(function(e){return e.MinAmount=0,e.MaxAmount=2e9,e})}function l(e){var t,n;t=e,0<(n=C.STR2JSON("CreditCardViewModel/onLoadComplete",t)).CreditCards.length?D.loadData(n):(T.UpdateAlert(AlertTypes.ServerResponseAlert,null,b.GetItem("paymentMethodUnavailable"),null,{redirectToView:eForms.Quotes}),T.PopAlert(AlertTypes.ServerResponseAlert)),D.hasData()&&(function(){o.ccTypes([]);var e=function(){var e,t=D.usedCards;if(t&&t.Container){var u=[],n=-1,d=0;return t.ForEach(function(e,t){t.paymentID>n&&(n=t.paymentID),t.isDefault&&(d=t.paymentID)}),e=n,d=d||e,t.ForEach(function(e,t){var n,s,o=D.creditCardsType.Get(t.cardTypeID);if(o){var a=o.name+" "+t.last4,r=t.paymentID,i={shortName:(n=a,s=t.last4,-1!=n.indexOf("Visa")&&(n=n.split(",")[0]+" "+s),n),name:a,typeId:r,isDefault:t.paymentID===d?1:0};i.isDefault?u.unshift(i):u.push(i)}}),u}return[]}().concat(D.creditCardsType.Values().map(function(e){return{shortName:e.name,name:e.name,typeId:e.typeID,images:e.images,lang:e.lang}}));o.ccTypes(e)}(),c(s.selectedCCTypeId()),p(),s.selectedCCTypeId.valueHasMutated()),r=!1}function c(e){var t=u.Data.selectedCurrency(),n=D.creditCardsType.Get(e);if(n){var s=n.ccyUIOrder.map(function(e){return{name:P.GetTranslatedSymbolById(e),orderId:e}});u.Data.currencyList(d(s))}u.Data.selectedCurrency()!==t&&u.Data.value("")}function p(){g.getDefaultCurrency(u.Data.currencyList()).then(function(e){u.Data.selectedCurrency(e),u.Data.selectedCurrency.valueHasMutated()})}return{Form:s,Info:o,Amount:u,Init:function(){s.isValidationEnabled=m.observable(!1),s.isValidationEnabled.subscribeTo(ePostboxTopic.EnableCCFormFieldsValidation,!0),i.tilesSelectedCountry=m.observable({id:v.prop.countryID}),i.tilesSelectedCountry.subscribeTo(ePostboxTopic.ConcretePaymentSelectedCountry,!0),o.ccTypes=m.observableArray([]),s.isPreviousSelectionUsedCard=m.observable(!1),s.selectedCCTypeId=m.observable(),s.concretePaymentType=m.observable(),s.originalPaymentName=m.observable(),s.usedCardSelected=m.computed(function(){var e=D.usedCards.GetItem(s.selectedCCTypeId());return!!e}),s.usedCard=m.computed(function(){var e=D.usedCards.GetItem(s.selectedCCTypeId());return e||null}),s.selectedCCType=m.computed(function(){if(s.usedCardSelected()){var e=D.usedCards.GetItem(s.selectedCCTypeId());return D.creditCardsType.Get(e.cardTypeID)}return D.creditCardsType.Get(s.selectedCCTypeId())}),s.selectedCreditCardName=m.computed(function(){var e=D.usedCards.GetItem(s.selectedCCTypeId());return e?D.creditCardsType.Get(e.cardTypeID)?D.creditCardsType.Get(e.cardTypeID).name:"XXXX "+e.last4:null}),n.push(s.usedCardSelected),n.push(s.usedCard),n.push(s.selectedCCType),n.push(s.selectedCreditCardName),s.isValid=m.validatedObservable(Object.assign({},s,{amount:u.Data.value})).isValid,u.init()},Start:function(){o.ccTypes([]),u.Data.currencyList([]),u.Data.selectedCurrency(""),u.Data.value(""),u.Data.value.isModified(!1),s.isValidationEnabled(!1),t.push(s.selectedCCTypeId.subscribe(function(){var e;c((e=D.usedCards.GetItem(s.selectedCCTypeId()))?e.cardTypeID:s.selectedCCTypeId()),p(),s.isValidationEnabled(!1)})),t.push(m.postbox.subscribe(ePostboxTopic.ConcretePaymentData,function(e){s.concretePaymentType(e.concretePaymentType),s.originalPaymentName(e.originalPaymentName);var t=parseInt(e.paymentData,10);isNaN(t)||s.selectedCCTypeId(t);var n=d(e.paymentCurrencies);u.Data.concretePaymentCurrencies(n)},!0)),t.push(s.isValidationEnabled.subscribe(function(e){e&&u.Data.validationOn(!0)})),r||(r=!0,f.getCreditCardData(a).then(l).fail(emptyFn).done())},Stop:function(){u.dispose(),s.isValidationEnabled.unsubscribeFrom(ePostboxTopic.EnableCCFormFieldsValidation),i.tilesSelectedCountry.unsubscribeFrom(ePostboxTopic.ConcretePaymentSelectedCountry),disposeArray(t),disposeArray(n),y.CleanKoObservableSimpleObject(s),y.CleanKoObservableSimpleObject(o)}}}}),define("defaultCurrencyManager",["Customer","dalDeposit"],function(n,i){return function(){var s,e,o=n.prop.baseCcyId;function t(e){s=parseInt(e)}function a(){return e=i.getLastSuccesfullDepositCurrency().then(t).fail(emptyFn)}function r(e,t){if(isEmptyValue(e))return-1;var n=e.map(function(e){return parseInt(e[t])});return-1<s?n.indexOf(s):-1<o()?n.indexOf(o()):0}return{loadLastUsedCurrency:a,getDefaultCurrencyId:function(t,n){return e||a(),e.then(function(){var e=r(t,n=n||"orderId");return 0<=e?t[e][n]:null})},getDefaultCurrency:function(t,n){return e||a(),e.then(function(){var e=r(t,n=n||"orderId");return 0<=e?t[e]:null})}}}()}),define("viewModels/Payments/DefaultEwalletViewModel",["require","initConfiguration","eWalletPaymentFlow","viewModels/Payments/EwalletComponentViewModel"],function(e){var n=e("initConfiguration"),s=e("eWalletPaymentFlow"),o=e("viewModels/Payments/EwalletComponentViewModel");return function(e){var t=new o(s,e.depositingType,n.PaymentInNewWindowConfiguration);return t.init(),{Deposit:t.Deposit,Form:t.Form,Info:t.Info,Amount:t.Amount,dispose:t.dispose}}}),define("viewModels/Payments/EwalletComponentViewModel",["knockout","jquery","ViewModelBase","VmHelpers","defaultCurrencyManager","fxnet/uilayer/viewmodels/payments/validation/amountcurrencyvalidation"],function(f,D,e,g,v,b){return function(s,o,n){v.loadLastUsedCurrency();var a,r=clone(e),i=new b({paymentType:o}),u=this,d={isPaymentButtonVisible:f.observable(!0)},l={isDepositInProgress:f.observable(!1).publishOn(ePostboxTopic.SetSpinnerVisibility),isDepositClicked:f.observable(!1),concretePaymentType:f.observable(null),originalPaymentName:f.observable(null),selectedUserCountry:f.observable(),concretePaymentData:f.observable(null)},c=[],p=[],m={isDepositInProgress:l.isDepositInProgress.extend({notEqual:!0})};function y(e,t){var n;g.CleanKoObservableSimpleObject(l),g.CleanKoObservableSimpleObject(d),d.isPaymentButtonVisible(!0),d.isAmountInputFocused=f.observable(!1),l.isEmailInputFocused=f.observable(!1),l.isIDInputFocused=f.observable(!1),d.isContinueButtonVisible=f.computed(function(){return i.Data.value.isValid()}),s.stop(),s.start(),s.GetCurrencies(o,function(e){i.Data.currencyList(e);var t=i.Data.currencyList().find(function(e){return e.orderId===a});isEmptyValue(t)?v.getDefaultCurrency(i.Data.currencyList()).then(function(e){isEmptyValue(e)||i.Data.selectedCurrency(e)}):(i.Data.selectedCurrency(t),i.Data.selectedCurrency.valueHasMutated())}),e?(n=e,i.Data.value(n.amount),a=n.depositCurrency,l.concretePaymentType(n.concretePaymentType),l.originalPaymentName(n.originalPaymentName),i.Data.concretePaymentCurrencies(p),l.concretePaymentData(n.concretePaymentData),l.selectedUserCountry(n.userSelectedCountry)):a=null,t&&t(e)}function C(e){l.isDepositClicked(!0),l.formValidation.isValid()?s.Deposit(e||t()):l.formValidation.errors.showAllMessages(!0)}function t(){return{depositCurrency:i.Data.selectedCurrency().orderId,depositCurrencyName:i.Data.selectedCurrency().name,amount:i.Data.value(),paymentType:o,concretePaymentType:l.concretePaymentType(),concretePaymentName:l.originalPaymentName(),userSelectedCountry:l.selectedUserCountry()||0,concretePaymentData:l.concretePaymentData()}}return{Deposit:C,Form:l,Info:d,Amount:i,buildRequest:t,init:function(t,e){i.init(),D.extend(m,{amount:i.Data.value}),l.formValidation=f.validatedObservable(D.extend({},m)),l.formValidation.isValid.publishOn(ePostboxTopic.PaymentFormValid),e||c.push(f.postbox.subscribe(ePostboxTopic.PaymentDeposit,C)),y(void 0,t),r.setSettings(u,n),s.Init(n,function(e){y(e,t)}),c.push(f.postbox.subscribe(ePostboxTopic.ConcretePaymentData,function(e){l.concretePaymentType(e.concretePaymentType),l.originalPaymentName(e.originalPaymentName),l.concretePaymentData(e.paymentData),l.selectedUserCountry(e.paymentCountry.id),i.Data.concretePaymentCurrencies(e.paymentCurrencies),p=e.paymentCurrencies},!0)),c.push(l.isDepositClicked.subscribe(function(e){e&&i.Data.validationOn(!0)}))},dispose:function(){i.dispose(),s.stop(),c.forEach(function(e){e.dispose()}),c.length=0,d.isPaymentButtonVisible(!1)},AddAdditionalValidations:function(e){D.extend(m,e),l.formValidation=f.validatedObservable(D.extend({},m))}}}}),define("eWalletPaymentFlow",["require","knockout","JSONHelper","ViewModelBase","dalDeposit","ComplianceBeforeDeposit","AlertsManager","SymbolsManager","Customer","AmlPopupManager"],function(e){var o=e("knockout"),r=e("JSONHelper"),t=e("ViewModelBase"),i=e("dalDeposit"),n=e("ComplianceBeforeDeposit"),a=e("AlertsManager"),u=e("SymbolsManager"),s=e("Customer"),d=e("AmlPopupManager"),l={},c={},p=null,m=function(){},y=null,C=null,f=[],D=o.observable(!1).publishOn(ePostboxTopic.SetSpinnerVisibility),g=clone(t),v=function(){return I().currencySortPropertyName||"orderID"},b=function(e){var t=new THashTable;return e.map(function(e){return new TDepositCurrency(e,u.GetTranslatedSymbolById(e[eDepositCurrency.CurrencyID]))}).forEach(function(e){t.SetItem(e.currencyID,e)}),t},P=function(e,s,o){return e.map(function(e){var t=e.orderId,n=s.find(function(e){return t===e[eDepositCurrencyWithValidation.CurrencyID]});n&&(e.MinAmount=n[eDepositCurrencyWithValidation.MinAmount],e.MaxAmount=n[eDepositCurrencyWithValidation.MaxAmount],o&&(e.MaxAmlAmount=n[eDepositCurrencyWithValidation.MaxAmlAmount]))}),e},T=function(e){l=e,S(),FxNet.hideUI()};function M(e){return c.concretePaymentType=e.concretePaymentType,c.concretePaymentName=e.concretePaymentName,c.currencyName=e.depositCurrencyName,c.amount=e.amount,c.concretePaymentType=e.concretePaymentType||C,c}function h(){return c}var w=function(e){function t(){D(!0),T(e),i.depositEWallet(l).then(V).fail(A).done()}return M(e),n.isCddBeforeDeposit()?n.openCdd(h,t):n.isKycStatusFailCannotDeposit()?n.showKycWarningAlert():t(),!0},I=function(){return g.getSettings(p)},S=function(){window.paymentsPopup=I().prepare3rdPartyView(),window.paymentsPopup.OnClose(function(){D(!1),m(l)})},A=function(e){N(),D(!1)},V=function(e){var t=r.STR2JSON("EWalletPaymentFlow/onDepositRequestCompleted",e);if("ServerError"===t.status)return a.ShowAlert(AlertTypes.ServerResponseAlert,Dictionary.GetItem("GenericAlert"),Dictionary.GetItem("ServerError"),null),void D(!1);var n=t.result;if(l.EngineStatusID=n[eDepositResponse.EngineStatusID],n[eDepositResponse.ValidationStatusID]==eDepositValidationStatus.Valid)if(n[eDepositResponse.EngineStatusID]!=eDepositEngineStatus.Failed){var s=new PaymentResultProcessor(I(),m,l);i.getPaymentStatus(s.OnDepositPaymentStatusTimeout).then(s.ProcessPaymentFinalResponse).fail(emptyFn).done(),window.paymentsPopup.Navigate(R(n))}else x(eDepositMessageTypes.depositFailed,n);else{var o=DepositMessagesManager.getMessageTypeForValidationStatusId(n[eDepositResponse.ValidationStatusID]);x(o,n)}},x=function(e,t){var n={messageDetails:t[eDepositResponse.MessageDetails],currency:u.GetTranslatedSymbolById(l.depositCurrency),amount:l.amount,confirmationCode:t[eDepositResponse.ConfirmationCode],transactionDescriptor:t[eDepositResponse.TransactionDescriptor],baseClearerTypeId:t[eDepositResponse.BaseClearerTypeId]};if(e!==eDepositMessageTypes.showAmlPending){var s=DepositMessagesManager.getDepositMessageWrapper(e,n);o.postbox.publish("deposit-failed",s.message),F(s,{redirectToView:I().formToDisplayForFailedPayments})}else o.postbox.publish("deposit-failed"),d.show();N(),D(!1),m(l)},F=function(e,t){a.UpdateAlert(AlertTypes.ServerResponseAlert,e.title,e.message,e.messages||"",t),a.PopAlert(AlertTypes.ServerResponseAlert)},N=function(){window.paymentsPopup&&(window.paymentsPopup.Close&&window.paymentsPopup.Close(),window.paymentsPopup=null)},R=function(e){var t=E(e);return new CommunicationManager(t)},E=function(e){var t=e[eDepositResponse.ClearerPostData].map(function(e){return{name:e[ePostData.Name],value:e[ePostData.Value]}});return{actionUrl:e[eDepositResponse.ClearerRequestUrl]||e[eDepositResponse.MoneybookersURL],postData:t,hash:e[eDepositResponse.ClearerUrlHash],accountNumber:s.prop.accountNumber,title:I().title}};return{Init:function(e,t){p=this,g.setSettings(p,e),m=t,D.extend({notEqual:!0})},GetCurrencies:function(e,a){i.getEWalletCurrencies(e,y,C).then(function(e){var t=r.STR2JSON("EWalletPaymentViewModel/onGetCurrenciesCompleted",e),n=t.result,s=b(n),o=s.Sort(v()).map(function(e){return s.GetItem(e)}).map(function(e){return{name:e.name,orderId:e.currencyID}});isEmptyValue(t.validation)||P(o,t.validation,1===parseInt(t.validateAml)),a(o)}).fail(emptyFn).done()},Deposit:w,DepositMoneyBookers:function(e){function t(){D(!0),T(e),i.depositMoneyBookers(l).then(V).fail(A).done()}return M(e),n.isCddBeforeDeposit()?n.openCdd(h,t):n.isKycStatusFailCannotDeposit()?n.showKycWarningAlert():t(),!0},DepositInatecAPM:function(e){function t(){D(!0),T(e),i.depositInatecAPM(l).then(V).fail(A).done()}return M(e),n.isCddBeforeDeposit()?n.openCdd(h,t):n.isKycStatusFailCannotDeposit()?n.showKycWarningAlert():t(),!0},DepositCreditCard3rdParty:function(e){function t(){D(!0),e.userSelectedCountry=e.userSelectedCountry||y||0,w(e)}return M(e),n.isCddBeforeDeposit()?n.openCdd(h,t):n.isKycStatusFailCannotDeposit()?n.showKycWarningAlert():t(),!0},start:function(){f.push(o.postbox.subscribe(ePostboxTopic.ConcretePaymentData,function(e){y=e.paymentCountry.id,C=e.concretePaymentType},!0))},stop:function(){f.forEach(function(e){e.dispose()}),f.length=0}}}),define("eWalletPaymentFlowNo3rdParty",["require","knockout","dalDeposit","ComplianceBeforeDeposit","AlertsManager","JSONHelper","ViewModelBase","SymbolsManager","AmlPopupManager"],function(e){var r=e("knockout"),a=e("dalDeposit"),s=e("ComplianceBeforeDeposit"),i=e("AlertsManager"),c=e("JSONHelper"),t=e("ViewModelBase"),p=e("SymbolsManager"),u=e("AmlPopupManager"),d={},o={},n=null,l=function(){},m=null,y=null,C=[],f=r.observable(!1).publishOn(ePostboxTopic.SetSpinnerVisibility),D=clone(t),g=function(){return D.getSettings(n)};function v(){return o}var b=function(e,t){var n,s,o={messageDetails:t[eDepositResponse.MessageDetails],currency:p.GetTranslatedSymbolById(d.depositCurrency),amount:d.amount,confirmationCode:t[eDepositResponse.ConfirmationCode],transactionDescriptor:t[eDepositResponse.TransactionDescriptor],baseClearerTypeId:t[eDepositResponse.BaseClearerTypeId]};if(e!==eDepositMessageTypes.showAmlPending){var a=DepositMessagesManager.getDepositMessageWrapper(e,o);r.postbox.publish("deposit-failed",a.message),n=a,s={redirectToView:g().formToDisplayForFailedPayments},i.UpdateAlert(AlertTypes.ServerResponseAlert,n.title,n.message,"",s),i.PopAlert(AlertTypes.ServerResponseAlert)}else r.postbox.publish("deposit-failed"),u.show();f(!1),l(d)};function P(e){f(!1)}function T(e){var t=c.STR2JSON("EWalletPaymentFlow/onDepositRequestCompleted",e);if("ServerError"===t.status)return i.ShowAlert(AlertTypes.ServerResponseAlert,Dictionary.GetItem("GenericAlert"),Dictionary.GetItem("ServerError"),null),void f(!1);var n=t.result;if(d.EngineStatusID=n[eDepositResponse.EngineStatusID],n[eDepositResponse.ValidationStatusID]===eDepositValidationStatus.Valid){if(n[eDepositResponse.EngineStatusID]!==eDepositEngineStatus.Failed){var s=new PaymentResultProcessor(g(),l,d);return a.getPaymentStatus(s.OnDepositPaymentStatusTimeout).then(s.ProcessPaymentFinalResponse).fail(emptyFn).done(),s.ProcessPaymentFinalResponse(e)?void 0:(f(!1),void l(d))}b(eDepositMessageTypes.depositFailed,n)}else{var o=DepositMessagesManager.getMessageTypeForValidationStatusId(n[eDepositResponse.ValidationStatusID]);b(o,n)}}return{Init:function(e,t){n=this,D.setSettings(n,e),l=t,f.extend({notEqual:!0})},GetCurrencies:function(e,l){a.getEWalletCurrencies(e,m,y).then(function(e){var t,n,s,o,a,r=c.STR2JSON("EWalletPaymentViewModel/onGetCurrenciesCompleted",e),i=r.result,u=(t=i,n=new THashTable,t.map(function(e){return new TDepositCurrency(e,p.GetTranslatedSymbolById(e[eDepositCurrency.CurrencyID]))}).forEach(function(e){n.SetItem(e.currencyID,e)}),n),d=u.Sort(g().currencySortPropertyName||"orderID").map(function(e){return u.GetItem(e)}).map(function(e){return{name:e.name,orderId:e.currencyID}});isEmptyValue(r.validation)||(s=d,o=r.validation,a=1===parseInt(r.validateAml),s.map(function(e){var t=e.orderId,n=o.find(function(e){return t===e[eDepositCurrencyWithValidation.CurrencyID]});n&&(e.MinAmount=n[eDepositCurrencyWithValidation.MinAmount],e.MaxAmount=n[eDepositCurrencyWithValidation.MaxAmount],a&&(e.MaxAmlAmount=n[eDepositCurrencyWithValidation.MaxAmlAmount]))})),l(d)}).fail(emptyFn).done()},Deposit:function(e){var t;function n(){f(!0),d=e,a.depositEWallet(d).then(T).fail(P).done()}return t=e,o.concretePaymentType=t.concretePaymentType,o.concretePaymentName=t.concretePaymentName,o.currencyName=t.depositCurrencyName,o.amount=t.amount,o.concretePaymentType=t.concretePaymentType||y,s.isCddBeforeDeposit()?s.openCdd(v,n):s.isKycStatusFailCannotDeposit()?s.showKycWarningAlert():n(),!0},start:function(){C.push(r.postbox.subscribe(ePostboxTopic.ConcretePaymentData,function(e){m=e.paymentCountry.id,y=e.concretePaymentType},!0))},stop:function(){C.forEach(function(e){e.dispose()}),C.length=0}}}),define("viewModels/Payments/GlobalCollectAPMViewModel",["require","knockout","jquery","initConfiguration","eWalletPaymentFlow","viewModels/Payments/EwalletComponentViewModel"],function(e){var a=e("knockout"),r=e("jquery"),i=e("initConfiguration"),u=e("eWalletPaymentFlow"),d=e("viewModels/Payments/EwalletComponentViewModel");return function(){var t="840",n=null,e=[],s=new d(u,eDepositingActionType.GlobalCollectAPM,i.PaymentInNewWindowConfiguration);function o(){s.Deposit(r.extend({paymentMethod:t,paymentCountry:n},s.buildRequest()))}return e.push(a.postbox.subscribe(ePostboxTopic.PaymentDeposit,o)),e.push(a.postbox.subscribe(ePostboxTopic.ConcretePaymentData,function(e){t=e.paymentData,n=e.paymentCountry.code},!0)),s.init(void 0,!0),{Deposit:o,Form:s.Form,Info:s.Info,Amount:s.Amount,dispose:function(){e.forEach(function(e){e.dispose()}),e.length=0,s.dispose()}}}}),define("viewModels/Payments/InatecAPMViewModel",["require","knockout","jquery","initConfiguration","eWalletPaymentFlow","viewModels/Payments/EwalletComponentViewModel"],function(e){var r=e("knockout"),i=e("jquery"),u=e("initConfiguration"),d=e("eWalletPaymentFlow"),l=e("viewModels/Payments/EwalletComponentViewModel");return function(e){var t={holderName:r.observable(),accountNumber:r.observable(),bankCode:r.observable()},n=[],s={};function o(e){e&&(t.holderName(e.holderName),t.accountNumber(e.accountNumber),t.bankCode(e.bankCode))}function a(){t.isDepositClicked(!0),t.formValidation.isValid()?d.DepositInatecAPM("giropay"===e.inatecSubtype?i.extend({holderName:t.holderName(),accountNumber:t.accountNumber(),bankCode:t.bankCode()},s.buildRequest()):i.extend({holderName:t.holderName()},s.buildRequest())):t.formValidation.errors.showAllMessages()}return"giropay"===e.inatecSubtype?(s=new l(d,eDepositingActionType.InatecAPM,u.PaymentInNewWindowConfiguration)).AddAdditionalValidations({holderName:t.holderName.extend({required:{params:!0,onlyIf:s.Form.isDepositClicked}}),accountNumber:t.accountNumber.extend({required:{params:!0,onlyIf:s.Form.isDepositClicked}}),bankCode:t.bankCode.extend({required:{params:!0,onlyIf:s.Form.isDepositClicked}})}):(s=new l(d,eDepositingActionType.InatecAPM,u.PaymentInNewWindowConfiguration)).AddAdditionalValidations({holderName:t.holderName.extend({required:{params:!0,onlyIf:s.Form.isDepositClicked}})}),i.extend(t,s.Form),n.push(r.postbox.subscribe(ePostboxTopic.PaymentDeposit,a)),s.init(o,!0),t.isAmountInputFocused=r.observable(!1),t.isNameInputFocused=r.observable(!1),t.isAccountInputFocused=r.observable(!1),t.isBankInputFocused=r.observable(!1),t.isContinueButtonVisible=r.computed(function(){return!(t.isAmountInputFocused()||t.isNameInputFocused()||t.isAccountInputFocused()||t.isBankInputFocused())}),{Deposit:a,Form:t,Info:s.Info,Amount:s.Amount,dispose:function(){n.forEach(function(e){e.dispose()}),n.length=0,s.dispose()}}}}),define("viewModels/Payments/MoneyBookersViewModel",["require","knockout","jquery","initConfiguration","eWalletPaymentFlow","Customer","viewModels/Payments/EwalletComponentViewModel"],function(e){var a=e("knockout"),r=e("jquery"),i=e("initConfiguration"),u=e("eWalletPaymentFlow"),d=e("Customer"),l=e("viewModels/Payments/EwalletComponentViewModel");return function(){var t={email:a.observable(d.prop.email)},e=[],n=new l(u,eDepositingActionType.Moneybookers,i.PaymentInNewWindowConfiguration);function s(e){e&&t.email(e.email)}function o(){t.isDepositClicked(!0),t.formValidation.isValid()?u.DepositMoneyBookers({depositCurrency:n.Amount.Data.selectedCurrency().orderId,depositCurrencyName:n.Amount.Data.selectedCurrency().name,amount:n.Amount.Data.value(),email:t.email(),concretePaymentType:n.Form.concretePaymentType(),concretePaymentName:n.Form.originalPaymentName(),userSelectedCountry:n.Form.selectedUserCountry()?n.Form.selectedUserCountry().id:0,paymentType:eDepositingActionType.Moneybookers}):t.formValidation.errors.showAllMessages()}return n.AddAdditionalValidations({email:t.email.extend({required:{params:!0,onlyIf:n.Form.isDepositClicked}})}),e.push(a.postbox.subscribe(ePostboxTopic.PaymentDeposit,o)),n.init(s,!0),r.extend(t,n.Form),{Deposit:o,Form:t,Info:n.Info,Amount:n.Amount,dispose:function(){e.forEach(function(e){e.dispose()}),n.dispose()}}}}),define("viewModels/Payments/NoAPIClearerViewModel",["require","knockout"],function(e){var t=e("knockout");return function(){var n={paymentData:t.observable(),logData:t.observable()},e=[];return e.push(t.postbox.subscribe(ePostboxTopic.ConcretePaymentData,function(e){var t=JSON.parse(e.paymentData);n.paymentData(Dictionary.GetItem(t.paymentInfo)),n.logData(t.logInfo)},!0)),{Form:n,dispose:function(){e.forEach(function(e){e.dispose()}),e.length=0}}}}),define("viewModels/Payments/NoticeViewModel",["require","knockout","StatesManager"],function(e){var t=e("knockout"),n=e("StatesManager");return function(){var e={};return e.showNoAmlDeclaration=t.pureComputed(function(){return n.States.IsAmlPending()}),e.showView=t.pureComputed(function(){return e.showNoAmlDeclaration()}),{ViewOptions:e}}});var PaymentResultProcessor=function(c,p,e){var m=e,l=c;function y(){return!0===$statesManager.States.IsTradingBonusGoingToCDDAfterDeposit()||!0===$statesManager.States.IsCddStatusNotComplete()||!0===$statesManager.States.IsKycStatusRequired()||!0===$statesManager.States.IsKycReviewStatusRequired()}function C(e,t,n){var s,o,a,r={},i=f(e,r,t),u={redirectToView:n};if((a=e)===eDepositMessageTypes.pendingDepositRequest||a===eDepositMessageTypes.requestPended||a===eDepositMessageTypes.succeeded){var d=c.formToDisplayForPendingPayments;if(e===eDepositMessageTypes.succeeded){d=c.formToDisplayForSuccessfulPayments;var l={};y()&&(l={redirectToView:eForms.ClientQuestionnaire}),r=Object.assign({},r,l)}s=d,o=r,require(["StateObject!PostLoginAlerts"],function(e){e.set("SetAlertsBehaviorMode",1)}),$viewModelsManager.VManager.SwitchViewVisible(s,o)}else D(i,u);p(m),window.paymentsPopup?(window.paymentsPopup.Close&&window.paymentsPopup.Close(),window.paymentsPopup=null):window.external&&window.external.CloseHostForm&&window.external.CloseHostForm()}function f(e,t,n){t.messageDetails=n[eDepositResponse.MessageDetails],t.currency=m.depositCurrencyName||$symbolsManager.GetTranslatedSymbolById(m.depositCurrency),t.depositPaymentLast4=n[eDepositResponse.Last4],t.amount=m.amount,t.confirmationCode=n[eDepositResponse.ConfirmationCode],t.transactionDescriptor=n[eDepositResponse.TransactionDescriptor],t.baseClearerTypeId=n[eDepositResponse.BaseClearerTypeId];var s=DepositMessagesManager.getDepositMessageWrapper(e,t);return isArrayType(s.messages)&&0<s.messages.length&&Object.assign(t,{depositMessages:s.messages}),s}function D(e,t){AlertsManager.UpdateAlert(AlertTypes.ServerResponseAlert,e.title,e.message,e.messages||"",t),AlertsManager.PopAlert(AlertTypes.ServerResponseAlert)}return{ProcessPaymentFinalResponse:function(e,t){var n=JSONHelper.STR2JSON("PaymentResultProcessor/processPaymentResponse",e).result,s=n[eDepositResponse.EngineStatusID],o=eDepositMessageTypes.none,a=null;switch(s){case eDepositEngineStatus.Failed:o=n[eDepositResponse.ClearingStatusID]===eClearingStatus.FailedOnMoneybookersRequestCanceled?eDepositMessageTypes.moneyBookersDepositRequestCancelled:n[eDepositResponse.ValidationStatusID]===eDepositValidationStatus.TransactionCancelledByUser?eDepositMessageTypes.cancelledByUser:n[eDepositResponse.ValidationStatusID]===eDepositValidationStatus.RefundableClearer?eDepositMessageTypes.refundableClearer:eDepositMessageTypes.depositFailed,ko.postbox.publish("deposit-failed");break;case eDepositEngineStatus.Finished:case eDepositEngineStatus.CCStored:CustomerProfileManager.ProfileCustomer().lastSelectedCategory=void 0,CustomerProfileManager.ProfileCustomer().lastSelectedPaymentMethodCountry=void 0,o=eDepositMessageTypes.succeeded,a=y()?eForms.ClientQuestionnaire:l.formToDisplayForSuccessfulPayments;break;default:o=eDepositMessageTypes.pendingDepositRequest,a=l.formToDisplayForPendingPayments}t?(r=o,i=n,u={},d=f(r,u,i),r===eDepositMessageTypes.succeeded?(d.message&&(u.depositMessages=[d.message]),m.succeeded=1):D(d,{}),m.depositMessages=u.depositMessages,p(m)):C(o,n,a);var r,i,u,d},OnDepositPaymentStatusTimeout:function(){C(eDepositMessageTypes.pendingDepositRequest,{},l.formToDisplayForPendingPayments)}}},PaymentTypeModel=function(e){var t=this;t.showUI=!0,t.userControl=null,t.imgCssClassName="imgClassName_"+e.methodId,t.methodID=e.methodId,t.hasImage=e.hasImage,t.hasAppendImage=e.hasAppendImage,t.helpLink=e.helpLinkDictionaryItem?Dictionary.GetItem(e.helpLinkDictionaryItem):"",t.hasLeftSideText=e.hasLeftSideText,t.hasRightSideText=e.hasRightSideText,t.text=e.text?Dictionary.GetItem(e.text):"",t.order=parseInt(e.order)};define("DepositResponseAnalyzer",[],function(){function a(e){return e[eDepositResponse.ValidationStatusID]===eDepositValidationStatus.Valid}function n(e){var t=e[eDepositResponse.EngineStatusID];return a(e)&&(t===eDepositEngineStatus.Success||t===eDepositEngineStatus.CCStored||t===eDepositEngineStatus.Finished)}function r(e){if(n(e))return eDepositMessageTypes.none;if(e[eDepositResponse.CreditCardAuthenticationModeID]!==ePaymentAuthMode.D3Secure)return eDepositMessageTypes.none;if(e[eDepositResponse.DepositingRequest3DSecureStatusID]!==eDepositingRequest3DSecureStatus.Enrolled)return e[eDepositResponse.DepositingRequest3DSecureStatusID]===eDepositingRequest3DSecureStatus.NoSupportedClearers?eDepositMessageTypes.noSupportedClearers:eDepositMessageTypes.notEnrolledCard;var t=e[eDepositResponse.D3SecureURL];return isEmptyValue(t)?eDepositMessageTypes.d3secureNotAllowed:eDepositMessageTypes.d3ProcessStarted}return{GetMessageType:function(e){var t,n,s,o=eDepositMessageTypes.none;return a(e)&&(o=r(e))===eDepositMessageTypes.d3ProcessStarted||(o||(t=e,o=DepositMessagesManager.getMessageTypeForValidationStatusId(t[eDepositResponse.ValidationStatusID])),o||(n=e,o=DepositMessagesManager.getMessageTypeForClearingStatusId(n[eDepositResponse.ClearingStatusID])),o||(s=e,o=DepositMessagesManager.getMessageTypeForDepositEngineStatusId(s[eDepositResponse.EngineStatusID]))),o},IsValidDeposit:a,IsSuccessfulDeposit:n}}),define("GenericCCInterWindowsCommunicator",["JSONHelper","dalCommon","dalDeposit"],function(){var n,s,o=require("JSONHelper"),a=require("dalCommon"),r=require("dalDeposit");function i(e){var t=e.toString()+"\n";for(var n in e)e.hasOwnProperty(n)&&(t+="\t"+n+"\n");return t}return window.addEventListener&&window.addEventListener("message",function(e){if(!n||!s)return;if(e.origin.replace(/\/$/,"")!==n.replace(/\/$/,""))return;var t=o.STR2JSON("GenericCCInterWindowsCommunicator/receiveMessage",e.data,eErrorSeverity.medium);if(isNullOrUndefined(t))return;r.LogGenericCCDepositCommunication(t.msg,e.data,"received"),s.hasOwnProperty(t.msg)?s[t.msg](t.value):a.WriteInfoLog(t.msg,"[Not a function] Message object: "+i(t)+",\nEvent object:"+i(e)+",\nEvent origin:"+i(e.origin)+",\nEvent data:"+i(e.data))},!1),{registerMessageHandler:function(e,t){!function(e,t){var n="";for(var s in t)t.hasOwnProperty(s)&&(n+="\t"+s+"\n");a.WriteInfoLog("RegisterHandler","Registered handler for source: "+e+"\nHandler members:\n"+n.slice(0,-1))}(e,t),n=e,s=t},unregisterMessageHandler:function(){s=null},postMessage:function(e,t,n){(function(e,t){if(!e||!e.postMessage)return!1;var n=!1;try{e.location&&0<=e.location.href.indexOf(t)&&(n=!0)}catch(e){n=!0}return n})(e,n)&&(e.postMessage(t,n),r.LogGenericCCDepositCommunication(t.msg,JSON.stringify(t),"sent"))}}}),define("viewModels/Payments/GenericCreditCardViewModel",["require","knockout","KoComponentViewModel","GenericCCInterWindowsCommunicator","FxNet/DataAccessLayer/dalClaims","dalDeposit","environmentData","Q","Customer","ComplianceBeforeDeposit","AlertsManager","Dictionary","JSONHelper","DepositResponseAnalyzer","initConfiguration","StatesManager","AmlPopupManager","CustomerProfileManager","SymbolsManager","ViewModelBase","UrlResolver","ViewModelsManager","TCreditCardView","ViewsManager","LoadDictionaryContent!payments_genericcreditcard","StateObject!PostLoginAlerts"],function(e){var ne=e("knockout"),t=e("KoComponentViewModel"),se=e("GenericCCInterWindowsCommunicator"),oe=e("FxNet/DataAccessLayer/dalClaims"),ae=e("dalDeposit"),re=e("environmentData"),ie=e("Q"),ue=e("Customer"),de=e("ComplianceBeforeDeposit"),le=e("AlertsManager"),ce=e("Dictionary"),pe=e("JSONHelper"),me=e("DepositResponseAnalyzer"),ye=e("initConfiguration"),Ce=e("StatesManager"),fe=e("AmlPopupManager"),De=e("CustomerProfileManager"),ge=e("SymbolsManager"),ve=e("ViewModelBase"),be=e("ViewModelsManager"),Pe=e("TCreditCardView"),Te=e("ViewsManager"),Me=e("StateObject!PostLoginAlerts"),he=e("UrlResolver");return extendClass(t,function(){var e,n,s,o,a,l,r,t,c,p,i=this,u=[],d=1e4,m=5e3,y=3e4,C={},f={prepareDepositRequest:function(){M(),window.FxNet.hideUI()},handle3DDeposit:function(e){isEmptyValue(window.paymentsPopup)?(t=e,n={okButtonCaption:ce.GetItem("ok","payments_genericcreditcard"),okButtonCallback:function(){var e;e=t,M(),h(e)},onClose:function(){ae.failDeposit(t[eDepositResponse.RequestID]).fail(emptyFn).done(),l.isDepositInProgress(!1)}},le.UpdateAlert(AlertTypes.GeneralOkAlert,ce.GetItem("pleaseNoteTitle","payments_genericcreditcard"),ce.GetItem(cDepositMessageKeys.notice3DSecureDeposit),null,n),le.PopAlert(AlertTypes.GeneralOkAlert)):h(e);var t,n}},D=ye.PaymentsConfiguration,g=clone(ve),v=[],b=createGuid(),P={};var T=function(){return g.getSettings(i)};function M(){window.paymentsPopup=T().prepare3rdPartyView(),window.paymentsPopup.OnClose(function(){l.isDepositInProgress(!1)})}function h(e){S(e);var t=new PaymentResultProcessor(g.getSettings(i),I,C);ae.getPaymentStatus(t.OnDepositPaymentStatusTimeout).then(w).fail(emptyFn).done()}function w(e){S(pe.STR2JSON("GenericCreditCardViewModel/onDepositRequestCompleted",e).result);var t=new PaymentResultProcessor(g.getSettings(i),I,C);ae.getFinalPaymentStatus(t.OnDepositPaymentStatusTimeout).then(t.ProcessPaymentFinalResponse).fail(emptyFn).done()}function I(){l.isDepositInProgress(!1)}function S(e){var t;window.paymentsPopup.Navigate((t=function(e){var t,n,s=JSON.parse(e[eDepositResponse.D3SecureURL]),o=s[eDepositResponseThreeDIndex.acsUrl];""!=o?(n=o,s[eDepositResponseThreeDIndex.paReq]&&(t=[{name:"PaReq",value:s[eDepositResponseThreeDIndex.paReq]},{name:"MD",value:s[eDepositResponseThreeDIndex.md]},{name:"TermUrl",value:s[eDepositResponseThreeDIndex.termUrl]}])):(n=e[eDepositResponse.ClearerRequestUrl],t=e[eDepositResponse.ClearerPostData].map(function(e){return{name:e[eNameValuePairIndex.name],value:e[eNameValuePairIndex.value]}}));return{actionUrl:n,postData:t,hash:e[eDepositResponse.ClearerUrlHash],accountNumber:ue.prop.accountNumber}}(e),new CommunicationManager(t)))}function A(){l={iframeSrc:ne.observable(R()+E()),iframeElement:ne.observable(),iframeReady:ne.observable(!1),paymentNote:ne.observable(),isIframeInputInFocus:ne.observable(!1),isLiveValidationEnabled:ne.observable(!1),isIframeDataBinded:ne.observable(!1),CCNumberGuid:ne.observable(),CVVGuid:ne.observable(),isDepositInProgress:ne.observable(!1).publishOn(ePostboxTopic.SetSpinnerVisibility),isDepositButtonDisabled:ne.observable(!1),selectedCCId:ne.observable(),allowedCreditCards:ne.observableArray([]),isCcBinFromEea:ne.observable()},r={isCvvTooltipVisible:ne.observable(!1),name:ne.observable(),text:ne.observable(),imgClassName:ne.observable()},P.isContinueButtonVisible=ne.computed(function(){return!l.isIframeInputInFocus()})}function V(e){var t,n;if(e?(n=e,t=p.find(function(e){return e[eCreditCard.CardTypeID]===n}),r.name(t[eCreditCard.Name])):p&&0<p.length&&(t=p[0]),!isEmptyValue(t)){var s=t[eCreditCard.Name].split(",")[0].replace(/\s/g,"");r.text(ce.GetItem(s+"_CVV_Info")),r.imgClassName(s+"-Img")}}function x(){var e;e=[{resourceName:"payments_genericcreditcard",content:["reqValidCCNumber","reqSupportedCCType","reqValidCvvLength","reqamount","rngamount","reqchname","invalidcc","invalidcvv","latinonly","month","year","amount","cardholdername","depMinMaxBlocked","cardno","cvvtext","expirationdate","amounttodeposit","use3dsecure","whatiscvv","reqMinDeposit","reqMaxDeposit","uploadDocuments","reqExpiration","amlValidationRequiredDocuments","amlValidationMessage","btnDeposit","reqValidExpiration"]}],v=[].concat.apply([],e.map(function(s){return{resourceName:s.resourceName,content:s.content.reduce(function(e,t){var n=ce.GetItem(t.toLowerCase(),s.resourceName.toLowerCase());return n.startsWith("***")&&(n=ce.GetItem(t.toLowerCase())),e[t.toLowerCase()]=n,e},{})}}))}function F(){var e,t;o+=s,ae.LogFrameNotLoadedMessage(function(){if(y<=o&&!a)return a=!0,eTokenizationError.frameNotLoadedDepositIntended;return eTokenizationError.frameNotLoaded}(),N(),extractGuid(l.iframeSrc())),(e=document.getElementById("ccNumberIframe"))&&(e.src=(t=R(),he.getUrlWithRndKeyValue(t)+E())),clearInterval(n),s+=m,n=setInterval(F,s)}function N(e){return encodeURI(l.iframeSrc())+"; waited time:"+o+"; "+(e||"")+" userAgent: "+navigator.userAgent}function R(){return re.pciPath+re.pciGenericCCNumberPage+"&v="+window.versionPCI+"&d="+window.location.host.replace(/\./g,"_")}function E(){return"#an="+ue.prop.accountNumber+"&guid="+b}function k(e){l.isIframeInputInFocus(e)}function O(e){l.isDepositInProgress(e)}function K(e){e.type==eDepositErrorType.fieldValidation&&(isObjectType(e.details)?ne.postbox.publish("deposit-failed-data",{message:String.format("Error type: {0}, message: {1}",e.type,e.details.message),key:e.details.contentKey}):ne.postbox.publish("deposit-failed",String.format("Error type: {0}, message: {1}",e.type,e.details)))}function B(){l.isDepositButtonDisabled(!0),Te.RedirectToForm(eForms.UploadDocuments)}function G(){l.isIframeDataBinded(!0)}function q(e){r.isCvvTooltipVisible(!r.isCvvTooltipVisible()),r.isCvvTooltipVisible()&&V(e||eDepositCreditCardType.Unknown)}function U(){l.iframeReady(!0),e.resolve("ready"),t.then(function(e){se.postMessage(l.iframeElement(),e,re.pciPath)}).done()}function L(e,t,n){var s,o=pe.STR2JSON("GenericCreditCardViewModel/prepareInitialDataForIframe",e),a=parseInt(t),r=ue.prop.baseCcyId(),i=ue.prop.brokerID,u=pe.STR2JSON("GenericCreditCardViewModel/prepareInitialDataForIframe",n);if(p=o?o.CreditCards:[],u&&u.UsedCards){s=u.UsedCards,c=s.map(function(e){return new Pe(e)});var d=W();d&&V(d.cardTypeID)}return{msg:"init",value:{content:v,customerCurrencyId:r,brokerId:i,lastPaymentCurrencyId:a,creditCards:o?o.CreditCards:[],isUsedCreditCard:ee(),ccTypeId:ee()?W().cardTypeID:void 0,ccFirst6:d?d.first6:"",isCcBinFromEea:l.isCcBinFromEea()}}}function W(){if(ee()){var t=l.selectedCCId(),e=c.find(function(e){return e.paymentID===t});if(!isEmptyType(e))return e;throw new Error("Missing used card with CC id: "+t)}}function H(){var e=[eClaimRecordType.CVV];return l.isDepositInProgress(!0),ee()||e.push(eClaimRecordType.CreditCard),oe.postGetCCClaim(eClaimActionType.Save,e,ue.prop.accountNumber).timeout(D.getClaimsTimeoutInMiliseconds,"Claim request failed after a time out of "+D.getClaimsTimeoutInMiliseconds+" ms").then(J).fail(j)}function J(e){var t=JSON.parse(e);if(!t||t.error)throw new Error(e);var n={msg:"setClaims",value:{cvvClaim:t.Cvv.claimGuid,ccNumberClaim:t.CreditCard?t.CreditCard.claimGuid:""}};se.postMessage(l.iframeElement(),n,re.pciPath)}function j(e){l.isDepositInProgress(!1),l.isDepositButtonDisabled(!1),se.postMessage(l.iframeElement(),{msg:"resetDepositButtonState"},re.pciPath),le.UpdateAlert(AlertTypes.ServerResponseAlert,null,ce.GetItem("depUnableProcessRequest"),"",{}),le.PopAlert(AlertTypes.ServerResponseAlert),z({type:eDepositErrorType.claim,details:e.status?"Claim request failed with status "+e.status:e})}function _(e){if(isEmptyValue(e)||isEmptyValue(e.depositDetails))I();else{if(e.depositDetails.is3DFlow&&f.prepareDepositRequest(),!e.depositDetails.ccType)return le.UpdateAlert(AlertTypes.ServerResponseAlert,null,ce.GetItem("depUnsupportedCardType","payments_genericcreditcard"),"",{}),le.PopAlert(AlertTypes.ServerResponseAlert),void I();var t;C={paymentID:-1,cardTypeID:e.depositDetails.ccType,cardNumber:e.tokens.ccNumberGuid,cvv:e.tokens.cvvGuid,expMonth:e.depositDetails.expMonth,expYear:e.depositDetails.expYear,depositCurrency:e.depositDetails.currency,cardHolderName:e.depositDetails.cardholderName,amount:e.depositDetails.amount,paymentAuthMode:e.depositDetails.is3DFlow?ePaymentAuthMode.D3Secure:ePaymentAuthMode.None},ee()&&(t=W(),C.cardTypeID=t.cardTypeID,C.cardNumber=t.ccGuid,C.expMonth=t.expMonth,C.expYear=t.expYear,C.cardHolderName=t.holderName),ne.postbox.publish("trading-event","deposit-submit"),ae.depositCreditCard(C).then($).fail(Y).done()}}function Y(e){Q(),l.isDepositInProgress(!1)}function $(e){if(null===e)return Q(),void l.isDepositInProgress(!1);var t=pe.STR2JSON("GenericCreditCardViewModel/onDepositRequestCompleted",e).result;C.EngineStatusID=t[eDepositResponse.EngineStatusID];var n=me.GetMessageType(t);switch(n){case eDepositMessageTypes.noSupportedClearers:case eDepositMessageTypes.notEnrolledCard:Q();break;case eDepositMessageTypes.d3ProcessStarted:return l.isDepositInProgress(!0),void f.handle3DDeposit(t)}!function(e,t){var n=null,s={messageDetails:t[eDepositResponse.MessageDetails],currency:ge.GetTranslatedSymbolById(C.depositCurrency),depositPaymentLast4:t[eDepositResponse.Last4],amount:C.amount,confirmationCode:t[eDepositResponse.ConfirmationCode],transactionDescriptor:t[eDepositResponse.TransactionDescriptor],baseClearerTypeId:t[eDepositResponse.BaseClearerTypeId]},o=!0===Ce.States.IsTradingBonusGoingToCDDAfterDeposit()||!0===Ce.States.IsCddStatusNotComplete()||!0===Ce.States.IsKycStatusRequired()||!0===Ce.States.IsKycReviewStatusRequired();if(e===eDepositMessageTypes.showAmlPending)return ne.postbox.publish("deposit-failed"),I(),fe.show();var a=DepositMessagesManager.getDepositMessageWrapper(e,s);if(e===eDepositMessageTypes.succeeded){if(ne.postbox.publish("deposit-success"),!isEmptyValue(C.cardTypeID))ae.setUsedCardAsDefault(C.cardTypeID),De.ProfileCustomer().lastSelectedCategory=void 0;o?(n={redirectToView:eForms.ClientQuestionnaire},s=Object.assign({},s,n)):n={redirectToView:D.formToDisplayForSuccessfulPayments}}else ne.postbox.publish("deposit-failed",a.message);if(I(),m=e,m===eDepositMessageTypes.pendingDepositRequest||m===eDepositMessageTypes.requestPended||m===eDepositMessageTypes.succeeded){var r=e===eDepositMessageTypes.succeeded?D.formToDisplayForSuccessfulPayments:D.formToDisplayForPendingPayments;isArrayType(a.messages)&&0<a.messages.length&&Object.assign(s,{depositMessages:a.messages}),c=r,(p=s).isCCDeposit=!0,Me.update("SetAlertsBehaviorMode",1),be.VManager.SwitchViewVisible(c,p)}else n=n||{},e===eDepositMessageTypes.succeeded?n.AlertType=AlertTypes.DepositSuccessAlert:(l=n,t[eDepositResponse.ValidationStatusID]===eDepositValidationStatus.ShowAdditionalPaymentOnFailedDeposit&&(l.AlertType=AlertTypes.GeneralCancelableAlert)),i=a,d=function(e){if(e&&e.AlertType)return e.AlertType;return AlertTypes.ServerResponseAlert}(u=n),le.UpdateAlert(d,i.title,i.message,i.messages||"",u),le.PopAlert(d);var i,u,d;var l;var c,p;var m}(n,t),Q()}function Q(){window.external&&window.external.CloseHostForm&&window.external.CloseHostForm(),window.paymentsPopup&&(window.paymentsPopup.Close&&window.paymentsPopup.Close(),window.paymentsPopup=null)}function z(e){if(!isEmptyValue(e))switch(e.type){case eDepositErrorType.upload:case eDepositErrorType.claim:case eDepositErrorType.ccTypeUnknown:case eDepositErrorType.isInvalidLuhn:ae.LogGenericCCDepositActivityMessage(eTokenizationError.uploadError,N(function(e){if(!e)return"";if(e instanceof Error)return e.message+" StackTrace: "+(e.stack?e.stack:"");return JSON.stringify(e)}(e.details)));break;case eDepositErrorType.fieldValidation:}}function X(t){if(de.isCddBeforeDeposit())de.openCdd(function(){var e;(e=t).depositDetails.depositCurrency.name,e.depositDetails.amount},function(){te(t)});else{if(de.isKycStatusFailCannotDeposit())return void de.showKycWarningAlert();te(t)}l.isDepositButtonDisabled(!1)}function Z(e){if(ee()){var t=function(t){var e=c.find(function(e){return e.paymentID===t});if(!isEmptyType(e))return e.ccGuid;throw new Error("Missing used card with CC id: "+t)}(l.selectedCCId());isEmptyValue(t)||(e.tokens.ccNumberGuid=t)}}function ee(){return!isEmptyValue(l.selectedCCId())}function te(e){var t,n;e.isValid?(l.isDepositInProgress(!0),Z(e),n=e,l.CCNumberGuid(n.tokens.ccNumberGuid),l.CVVGuid(n.tokens.cvvGuid),_(e)):(t=e,l.isDepositInProgress(!1),isEmptyValue(t.errors)||t.errors.length<=0||t.errors.forEach(function(e){z(e)}))}return A(),l.isUsedCreditCard=ne.pureComputed(function(){return ee()}),x(),t=ie.all([ae.getAllowedCreditCardsWithAmountValidation(eDepositingActionType.Regular),ae.getLastSuccesfullDepositCurrency(),ae.getCreditCardData(eDepositingActionType.Regular)]).spread(L),g.setSettings(i,D),se.registerMessageHandler(re.pciPath,{showCvvPopup:q,readyIframe:U,validationResponse:X,iframeDataBinded:G,redirectToUploadDocuments:B,eventTracking:K,ifarmeInputInFocus:k,isDepositInProgress:O,getClaims:H}),s=d,ae.LogGenericCCDepositCommunication("VM load","load promise timeout started","written"),clearInterval(n),n=setInterval(F,s),(e=ie.defer()).promise.then(function(e){ae.LogGenericCCDepositCommunication("VM load","load promise timeout was resolved with result:"+e,"written"),clearInterval(n)}).done(),u.push(ne.postbox.subscribe(ePostboxTopic.ConcretePaymentData,function(e){var t=parseInt(e.paymentData,10);isNaN(t)||l.selectedCCId(t),l.allowedCreditCards(e.allowedCreditCards||[]),l.isCcBinFromEea(e.isCcBinFromEea)},!0)),{Form:l,Deposit:function(){l.isDepositButtonDisabled(!0),se.postMessage(l.iframeElement(),{msg:"startDeposit"},re.pciPath)},ShowCVV:q,CVVTooltipInfo:r,dispose:function(){se.unregisterMessageHandler(),disposeArray(u),e.resolve("stop")},CVVInfo:P}})}),define("mobileViewModels/GenericCreditCardMobileViewModel",["require","knockout","viewModels/Payments/GenericCreditCardViewModel"],function(n){var e=n("viewModels/Payments/GenericCreditCardViewModel");return extendClass(e,function(){var e=n("knockout"),t=this.parent;return t.CVVTooltipInfo.isPaymentButtonVisible=e.observable(!0),{Form:t.Form,Deposit:t.Deposit,ShowCVV:t.ShowCVV,CVVTooltipInfo:t.CVVTooltipInfo,dispose:function(){t.dispose(),t.CVVTooltipInfo.isPaymentButtonVisible(!1)},CVVInfo:t.CVVInfo}})}),define("CcNumberFormatterModule",[],function(){return{OnKeyUp:function(e){var t=e.currentTarget||e.srcElement;if(t&&!t.readOnly){var n,s,o,a,r=(s=(n=e).currentTarget||n.srcElement,o=n.keyCode?n.keyCode:n.which?n.which:n.charCode,a=s.selectionEnd!==s.value.length,{start:s.selectionStart,originalText:s.value,isInserting:function(){return a},isDeleteKey:function(){return 46===o},isBackspaceKey:function(){return 8===o},isCursorAfterDash:function(){return this.start%5==0},isCursorBeforeDash:function(){return(this.start-4)%5==0},isDigitKeyCode:function(){return 48<=o&&o<=57||96<=o&&o<=105},hasEditedText:function(){return this.isDigitKeyCode()||this.isDeleteKey()||this.isBackspaceKey()},getCursorPosition:function(){return this.start+this.getSupplementaryCursorMove()},getSupplementaryCursorMove:function(){return this.isBackspaceKey()&&this.isCursorAfterDash()?-1:this.isDeleteKey()?0:this.isCursorAfterDash()?1:0}});if(r.hasEditedText()){var i=function(e){for(var t=0;t<e.length;t++)e[t]||e.splice(t,1);return e}(function(e){for(var t=[],n=Math.floor(e.length/4),s=0;s<n;s++)t.push(e.slice(4*s,4*(s+1)));var o=e.length%4;return t.push(e.slice(4*n,4*n+o)),t}(r.originalText.replace(/-/g,""))).join("-");if(t.value=i,r.isInserting()){var u=r.getCursorPosition();t.selectionStart=u,t.selectionEnd=t.selectionStart}}}},OnKeyPress:function(e){return t=e,n=(t=window.event?window.event:t).keyCode?t.keyCode:t.which?t.which:t.charCode,s=void 0!==[8,9,37,39,46].find(function(e){return e===n}),!(!/^\d$/.test(String.fromCharCode(n))&&!s)||!!window.event&&(t.cancelBubble=!0,t.returnValue=!1);var t,n,s}}}),define("objects/Funds/Deposit/DepositPopupControl",["require","objects/Containers/SharedFormDepositContainer"],function(e){var m=e("objects/Containers/SharedFormDepositContainer");return function(e){e=e||{};var t={dalMethod:function(){return!1}};t=Object.assign(t,e);var s,o,n=this,a=!1,r=new TDALDeposit,i=function(e,t){o&&!o.closed&&(o.close(),o=null),m.GetInstance().HandleMessageAndRedirect(e,t)},u=function(e,t,n){return(o=m.GetInstance().HandlePopupWindow(e,t,n))&&!o.closed&&(o.alert=i,o.focus()),o},d={onLoad:function(e){if("href"in e.contentWindow.location){var t=e.parentElement;0<t.length&&t.height(e.contentWindow.document.body.offsetHeight)}},iframeFunctions:function(e){var t=this.superFunction(e);if(t===eFrameContentValidation.Available&&(e.contentWindow.fxOverridden||(e.contentWindow.alert=i,e.contentWindow.open=u,e.contentWindow.fxOverridden=!0),o))if(o.closed)o=null;else try{"href"in o.location&&(o.fxOverridden||(o.alert=i,o.fxOverridden=!0))}catch(e){}return t}},l=function(){a=!0,t.dalMethod.call(n,c)},c=function(e){p(e)},p=function(e){var t=e.split("_ResponseSplitter_"),n=JSONHelper.STR2JSON("DepositPopup/createObjects",t[1]);"SharedFormSrc"in n&&(s=n.SharedFormSrc||"",m.GetInstance().Show(s,d))};return{show:function(){a?""!=s&&m.GetInstance().Show(s,d):l()},hide:function(){},dispose:function(){if(r&&(r=null),a=!1,s="",o&&!o.closed)try{o.close()}catch(e){}o=null}}}});
//# sourceMappingURL=deposit.js.map