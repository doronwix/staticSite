{
  "requestUrl": "/webpl3/assets/20201230110628/js/scripts/fxnet/uilayer/viewmodels/Deals/DealBaseViewModel.js?v=20201230110628",
  "contentType": "application/javascript",
  "method": "GET",
  "statusCode": 200,
  "data": "ï»¿/*global eNewDealLimitType  */\r\ndefine(\r\n    'viewmodels/Deals/DealBaseViewModel',\r\n    [\r\n        'require',\r\n        'helpers/ObservableCustomExtender',\r\n        'handlers/general',\r\n        'handlers/Deal',\r\n        'helpers/KoComponentViewModel',\r\n        'configuration/initconfiguration',\r\n        'initdatamanagers/Customer',\r\n        'deviceviewmodels/BaseOrder',\r\n        'viewmodels/limits/SetLimitsViewModel',\r\n        'dataaccess/dalorder',\r\n        'generalmanagers/RegistrationManager',\r\n        'cachemanagers/QuotesManager',\r\n        'initdatamanagers/InstrumentsManager',\r\n        'managers/CustomerProfileManager',\r\n        'managers/viewsmanager',\r\n        'FxNet/LogicLayer/Deal/DealAmountLabel',\r\n        'initdatamanagers/SymbolsManager',\r\n        'generalmanagers/DealTypeManager',\r\n        'StateObject!Transaction',\r\n        'modules/BuilderForInBetweenQuote',\r\n        'cachemanagers/PortfolioStaticManager',\r\n        'devicemanagers/AlertsManager'\r\n    ],\r\n    function DealBaseDef(require) {\r\n        var ko = require('helpers/ObservableCustomExtender'),\r\n            general = require('handlers/general'),\r\n            TDeal = require('handlers/Deal'),\r\n            KoComponentViewModel = require('helpers/KoComponentViewModel'),\r\n            settings = require('configuration/initconfiguration').NewDealConfiguration,\r\n            Customer = require('initdatamanagers/Customer'),\r\n            BaseOrder = require('deviceviewmodels/BaseOrder'),\r\n            SetLimitsViewModel = require('viewmodels/limits/SetLimitsViewModel'),\r\n            dalOrders = require('dataaccess/dalorder'),\r\n            RegistrationManager = require('generalmanagers/RegistrationManager'),\r\n            QuotesManager = require('cachemanagers/QuotesManager'),\r\n            InstrumentsManager = require('initdatamanagers/InstrumentsManager'),\r\n            CustomerProfileManager = require('managers/CustomerProfileManager'),\r\n            ViewsManager = require('managers/viewsmanager'),\r\n            DealAmountLabel = require('FxNet/LogicLayer/Deal/DealAmountLabel'),\r\n            SymbolsManager = require('initdatamanagers/SymbolsManager'),\r\n            DealTypeManager = require('generalmanagers/DealTypeManager'),\r\n            stateObject = require('StateObject!Transaction'),\r\n            BuilderForInBetweenQuote = require('modules/BuilderForInBetweenQuote'),\r\n            portfolioStaticManager = require('cachemanagers/PortfolioStaticManager'),\r\n            AlertsManager = require('devicemanagers/AlertsManager');\r\n\r\n        var DealBaseViewModel = general.extendClass(KoComponentViewModel, function DealBaseClass() {\r\n            var self = this,\r\n                parent = this.parent, // inherited from KoComponentViewModel\r\n                data = this.Data, // inherited from KoComponentViewModel\r\n                baseOrder = new BaseOrder(),\r\n                usdId = 47,\r\n                setLimitsModel = new SetLimitsViewModel();\r\n\r\n            function init(customSettings) {\r\n                parent.init.call(self, customSettings);\t // inherited from KoComponentViewModel\r\n\r\n                baseOrder.Init({}, data);\r\n\r\n                setObservables();\r\n                setSubscribers();\r\n                setComputables();\r\n\r\n                var setlimitsConfiguration = self.getSettings().setlimitsConfiguration;\r\n                setLimitsModel.Init(data, setlimitsConfiguration);\r\n\r\n                setPropertiesFromViewArgs();\r\n            }\r\n\r\n            function setObservables() {\r\n                data.PageName = eDealPage.NewDeal;\r\n                data.ready = ko.observable(false);\r\n\r\n                data.customerSymbolName = stateObject.set(\"customerSymbolName\", ko.observable(Customer.prop.baseCcyName()));\r\n                data.customerSymbolId = stateObject.set(\"customerSymbolId\", ko.observable(Customer.prop.baseCcyId()));\r\n                data.orderDir = stateObject.set(\"orderDir\", ko.observable(eOrderDir.None).extend({ dirty: false }));\r\n                data.selectedInstrument = stateObject.set(\"selectedInstrument\", ko.observable());\r\n                data.selectedDealAmount = stateObject.set(\"selectedDealAmount\", ko.observable());\r\n                data.selectedDealAmount.extend({ notify: 'always' });\r\n                data.selectedDealAmount.extend({ amountValidation: [] });\r\n                data.amountSymbol = stateObject.set(\"amountSymbol\", ko.observable(\"\"));\r\n                data.quoteForOtherCcyToAccountCcy = stateObject.get(\"quoteForOtherCcyToAccountCcy\");\r\n                data.quoteForBaseCcyToAccountCcy = stateObject.get(\"quoteForBaseCcyToAccountCcy\");\r\n                data.quoteForUsdCcyToAccountCcy = stateObject.get(\"quoteForUsdCcyToAccountCcy\");\r\n                data.bid = stateObject.set(\"bid\", ko.observable(''));\r\n                data.ask = stateObject.set(\"ask\", ko.observable(''));\r\n\r\n                data.initialToolTab = stateObject.set(\"initialToolTab\", ko.observable(\"\"));\r\n                data.showTools = stateObject.set(\"showTools\", ko.observable(true));\r\n\r\n                data.bidPips = stateObject.set(\"bidPips\", ko.observable(\"\"));\r\n                data.askPips = stateObject.set(\"askPips\", ko.observable(\"\"));\r\n                data.changePips = stateObject.set(\"changePips\", ko.observable(\"\"));\r\n                data.tradeTime = stateObject.set(\"tradeTime\", ko.observable(\"\"));\r\n                data.highBid = stateObject.set(\"highBid\", ko.observable(\"\"));\r\n                data.lowAsk = stateObject.set(\"lowAsk\", ko.observable(\"\"));\r\n                data.open = stateObject.set(\"open\", ko.observable(\"\"));\r\n                data.close = stateObject.set(\"close\", ko.observable(\"\"));\r\n                data.change = stateObject.set(\"change\", ko.observable(\"\"));\r\n                data.formattedChange = stateObject.set(\"formattedChange\", ko.observable(\"\"));\r\n\r\n                data.isForex = stateObject.set(\"isForex\", ko.observable(false));\r\n                data.isFuture = stateObject.set(\"isFuture\", ko.observable(false));\r\n                data.isShare = stateObject.set(\"isShare\", ko.observable(false));\r\n                data.isStock = stateObject.set(\"isStock\", ko.observable(false));\r\n                data.isNonForex = ko.observable(true);\r\n\r\n                data.hasInstrument = ko.observable(false);\r\n                data.baseSymbolName = ko.observable(\"\");\r\n                data.otherSymbolName = ko.observable(\"\");\r\n                data.dealAmountLabel = ko.observable(\"\");\r\n                data.dealMinMaxAmounts = ko.observableArray([]);\r\n                data.originalSymbolName = ko.observable(\"\");\r\n                data.baseSymbol = ko.observable(\"\");\r\n                data.ccyPair = stateObject.set(\"ccyPair\", ko.observable(''));\r\n\r\n                data.quotesAvailable = ko.observable(false);\r\n                data.isProcessing = ko.observable(false);\r\n                data.limitsReady = ko.observable(false);\r\n\r\n                data.activeQuote = null;\r\n                data.isActiveQuote = stateObject.set('isActiveQuote', ko.observable(false));\r\n                data.activeQuoteState = ko.observable();\r\n                data.bid10K = ko.observable(\"\");\r\n                data.bid100K = ko.observable(\"\");\r\n                data.ask10K = ko.observable(\"\");\r\n                data.ask100K = ko.observable(\"\");\r\n\r\n                data.bidLabel = {\r\n                    First: ko.observable(\"\"),\r\n                    Middle: ko.observable(\"\"),\r\n                    Last: ko.observable(\"\")\r\n                };\r\n\r\n                data.askLabel = {\r\n                    First: ko.observable(\"\"),\r\n                    Middle: ko.observable(\"\"),\r\n                    Last: ko.observable(\"\")\r\n                };\r\n\r\n                data.profileKeyForDefaultTab = stateObject.set('profileKeyForDefaultTab', ko.observable(settings.profileKeyForDefaultTab));\r\n\r\n                data.enableSLLimit = ko.observable(false);\r\n                data.enableTPLimit = ko.observable(false);\r\n\r\n                data.isSlRateActiveTab = ko.observable(false);\r\n                data.isSlAmountActiveTab = ko.observable(false);\r\n                data.isSlPercentActiveTab = ko.observable(false);\r\n                data.isTpRateActiveTab = ko.observable(false);\r\n                data.isTpAmountActiveTab = ko.observable(false);\r\n                data.isTpPercentActiveTab = ko.observable(false);\r\n                data.displaySlPercentSymbol = ko.observable(false);\r\n                data.displayTpPercentSymbol = ko.observable(false);\r\n                data.displaySlAmountCcySymbol = ko.observable(false);\r\n                data.displayTpAmountCcySymbol = ko.observable(false);\r\n\r\n                data.quoteForAccountCcyToUSDCcy = ko.observable(\"\");\r\n                data.quoteForBaseCcyToUSDCcy = ko.observable(\"\");\r\n                data.quoteForAccountCcyToOtherCcy = ko.observable(\"\");\r\n\r\n                // Functions\r\n                data.buyBtnClick = function () {\r\n                    setOrderDir(eOrderDir.Buy);\r\n                };\r\n\r\n                data.sellBtnClick = function () {\r\n                    setOrderDir(eOrderDir.Sell);\r\n                };\r\n\r\n                data.pendingBonusType = ko.observable();\r\n                data.spreadDiscount = ko.observable();\r\n\r\n                data.chartTransactionEnabled = stateObject.set('chartTransactionEnabled', ko.observable(false));\r\n            }\r\n\r\n            function setSubscribers() {\r\n                self.subscribeAndNotify(data.ask, function (rate) {\r\n                    var splitRate = Format.tenthOfPipSplitRate(rate, data.selectedInstrument());\r\n\r\n                    data.askLabel.First(splitRate.button.first);\r\n                    data.askLabel.Middle(splitRate.button.middle);\r\n                    data.askLabel.Last(splitRate.button.last);\r\n                });\r\n\r\n                self.subscribeAndNotify(data.bid, function (rate) {\r\n                    var splitRate = Format.tenthOfPipSplitRate(rate, data.selectedInstrument());\r\n\r\n                    data.bidLabel.First(splitRate.button.first);\r\n                    data.bidLabel.Middle(splitRate.button.middle);\r\n                    data.bidLabel.Last(splitRate.button.last);\r\n                });\r\n\r\n                self.subscribeChanged(data.selectedInstrument, function (instrumentId, prevInstrumentId) {\r\n                    if (prevInstrumentId && instrumentId !== prevInstrumentId) {\r\n                        data.selectedDealAmount(\"\");\r\n\r\n                        if (!(stateObject.containsKey('skipReset') && stateObject.get('skipReset'))) {\r\n                            data.orderDir(eOrderDir.None);\r\n                        }\r\n                    }\r\n                });\r\n\r\n                self.subscribeTo(data.baseSymbol, function (baseSymbolId) {\r\n                    setInBetweenQuotes(baseSymbolId);\r\n                });\r\n\r\n                self.subscribeTo(data.selectedInstrument, function (instrumentId) {\r\n                    var instrument = InstrumentsManager.GetInstrument(instrumentId),\r\n                        roundMinMaxAmounts = function (amount) {\r\n                            return [Math.ceil(amount[0]), Math.floor(amount[1])]\r\n                        },\r\n                        roundDefaultSize = function (defaultSize, minMaxAmounts) {\r\n                            var up = Math.ceil(defaultSize);\r\n                            return up < minMaxAmounts[1] ? up : Math.floor(defaultSize);\r\n                        };\r\n\r\n                    if (instrument) {\r\n                        data.quotesAvailable(false);\r\n                        data.dealMinMaxAmounts([]);\r\n\r\n                        if (!(stateObject.containsKey('skipReset') && stateObject.get('skipReset'))) {\r\n                            data.enableSLLimit(false);\r\n                            data.enableTPLimit(false);\r\n                        }\r\n\r\n                        //order matters because of valueAllowUnset param from select in View  \r\n                        InstrumentsManager.GetUpdatedInstrumentWithDealMinMaxAmounts(instrumentId).then(function (response) {\r\n                            var dealMinMaxAmounts = instrument.isStock && response.dealMinMaxAmounts && response.dealMinMaxAmounts.length > 1 ?\r\n                                roundMinMaxAmounts(response.dealMinMaxAmounts) : response.dealMinMaxAmounts,\r\n                                defaultSize = instrument.isStock && dealMinMaxAmounts && dealMinMaxAmounts.length > 1 ?\r\n                                    roundDefaultSize(response.defaultDealSize, dealMinMaxAmounts) : response.defaultDealSize;\r\n                            data.dealMinMaxAmounts(dealMinMaxAmounts);\r\n                            data.selectedDealAmount.extend({ amountValidation: dealMinMaxAmounts });\r\n                            data.selectedDealAmount(data.selectedDealAmount() || defaultSize);\r\n                        }).done();\r\n\r\n                        data.amountSymbol(instrument.otherSymbol);\r\n                        data.baseSymbolName(SymbolsManager.GetTranslatedSymbolById(instrument.baseSymbol));\r\n                        data.otherSymbolName(SymbolsManager.GetTranslatedSymbolById(instrument.otherSymbol));\r\n                        data.originalSymbolName(instrument.baseSymbolName);\r\n                        data.baseSymbol(instrument.baseSymbol);\r\n                        data.ccyPair(instrument.ccyPair);\r\n\r\n                        data.isNonForex(instrument.instrumentTypeId !== eInstrumentType.Currencies);\r\n                        data.isForex(instrument.isForex);\r\n                        data.isShare(instrument.isShare);\r\n                        data.isFuture(instrument.isFuture);\r\n                        data.isStock(instrument.isStock);\r\n\r\n                        registerInstruments(instrumentId);\r\n\r\n                        var result = DealAmountLabel.Translate(instrument);\r\n                        data.dealAmountLabel(result.label);\r\n\r\n                        DealTypeManager.Init();\r\n\r\n                        if (instrument.isFuture) {\r\n                            DealTypeManager.ConsumeEvent('future');\r\n                        } else if (instrument.isShare) {\r\n                            DealTypeManager.ConsumeEvent('share');\r\n                        } else {\r\n                            DealTypeManager.ConsumeEvent();\r\n                        }\r\n                        data.pendingBonusType(portfolioStaticManager.Portfolio.pendingBonusType);\r\n                        data.spreadDiscount(portfolioStaticManager.Portfolio.spreadDiscountVolumePercentage);\r\n\r\n                        updateQuoteValues();\r\n\r\n                        BuilderForInBetweenQuote.GetInBetweenQuote(Customer.prop.baseCcyId(), instrument.otherSymbol)\r\n                            .then(function (response) {\r\n                                data.quoteForAccountCcyToOtherCcy(response);\r\n                            }).done();\r\n\r\n                        data.hasInstrument(true);\r\n\r\n                        updateTransactionSwitcherViewArgs(instrumentId);\r\n                    } else {\r\n                        data.hasInstrument(false);\r\n                    }\r\n                });\r\n            }\r\n\r\n            /**\r\n             * Get Transaction Switcher view args, \r\n             * if the view is not visible then return false\r\n             * @returns {Object|False} \r\n             */\r\n            function getTransactionSwitcherViewArgs() {\r\n                var transactionView = ViewsManager.GetActiveFormViewProperties(eViewTypes.vTransactionSwitcher);\r\n\r\n                if (transactionView && transactionView.visible()) {\r\n                    return transactionView.args || {};\r\n                }\r\n\r\n                return false;\r\n            }\r\n\r\n            function updateTransactionSwitcherViewArgs(instrumentId) {\r\n                var args = getTransactionSwitcherViewArgs();\r\n\r\n                if (!general.isNullOrUndefined(args) && args !== false) {\r\n                    args.instrumentId = instrumentId;\r\n                    ViewsManager.ChangeViewState(eViewTypes.vTransactionSwitcher, eViewState.Update, args);\r\n                }\r\n            }\r\n\r\n            function setComputables() {\r\n                data.isShowBuyBox = self.createComputed(function () {\r\n                    return data.orderDir() === eOrderDir.Buy;\r\n                });\r\n\r\n                data.isShowSellBox = self.createComputed(function () {\r\n                    return data.orderDir() === eOrderDir.Sell;\r\n                });\r\n\r\n                data.ViewModelReady = self.createComputed(function () {\r\n                    if (data.ready()) {\r\n                        return true;\r\n                    }\r\n\r\n                    var hasInstrument = data.hasInstrument(),\r\n                        hasLimits = data.limitsReady();\r\n\r\n                    var isReady = hasInstrument && hasLimits;\r\n                    data.ready(isReady);\r\n\r\n                    return isReady;\r\n                });\r\n\r\n                data.isUp = ko.pureComputed(function () {\r\n                    return data.activeQuoteState() === eQuoteStates.Up;\r\n                });\r\n\r\n                data.isDown = ko.pureComputed(function () {\r\n                    return data.activeQuoteState() === eQuoteStates.Down;\r\n                });\r\n            }\r\n\r\n            function setInBetweenQuotes(baseSymbolId) {\r\n                BuilderForInBetweenQuote.GetInBetweenQuote(Customer.prop.baseCcyId(), usdId).then(function (response) {\r\n                    data.quoteForAccountCcyToUSDCcy(response);\r\n                }).done();\r\n\r\n                BuilderForInBetweenQuote.GetInBetweenQuote(baseSymbolId, usdId).then(function (response) {\r\n                    data.quoteForBaseCcyToUSDCcy(response);\r\n                }).done();\r\n            }\r\n\r\n            function setPropertiesFromViewArgs() {\r\n                var args = getTransactionSwitcherViewArgs() || {},\r\n                    toolTab = args.tab,\r\n                    prevInstrumentId = data.selectedInstrument(),\r\n                    instrumentId = args.instrumentId\r\n                        || data.selectedInstrument()\r\n                        || InstrumentsManager.GetUserDefaultInstrumentId();\r\n\r\n                data.selectedInstrument(instrumentId);\r\n\r\n                if (prevInstrumentId === instrumentId) {\r\n                    data.selectedInstrument.notifySubscribers(instrumentId);\r\n                }\r\n\r\n                if (general.isInt(args.orderDir)) {\r\n                    setOrderDir(args.orderDir);\r\n                }\r\n\r\n                if (args.selectedDealAmount) {\r\n                    data.selectedDealAmount(args.selectedDealAmount);\r\n                }\r\n\r\n                data.initialToolTab((general.isDefinedType(toolTab) && general.isDefinedType(eNewDealTool[toolTab])) ? eNewDealTool[toolTab] : CustomerProfileManager.ProfileCustomer()[settings.profileKeyForDefaultTab] || eNewDealTool.Chart);\r\n            }\r\n\r\n            function setLimitTabsFromClientProfile() {\r\n                var profileCustomer = CustomerProfileManager.ProfileCustomer();\r\n\r\n                if (profileCustomer.defaultSlLimitTab) {\r\n                    setLimitsModel.SetSlActiveTab(profileCustomer.defaultSlLimitTab);\r\n                } else {\r\n                    setLimitsModel.SetSlActiveTab(eSetLimitsTabs.Amount);\r\n                }\r\n\r\n                if (profileCustomer.defaultTpLimitTab) {\r\n                    setLimitsModel.SetTpActiveTab(profileCustomer.defaultTpLimitTab);\r\n                } else {\r\n                    setLimitsModel.SetTpActiveTab(eSetLimitsTabs.Amount);\r\n                }\r\n            }\r\n\r\n            function setOrderDir(orderDir) {\r\n                if (orderDir != eOrderDir.Buy && orderDir != eOrderDir.Sell && orderDir != eOrderDir.None) {\r\n                    orderDir = eOrderDir.None;\r\n                }\r\n\r\n                data.orderDir(orderDir);\r\n            }\r\n\r\n            function registerInstruments(instrumentId) {\r\n                RegistrationManager.Update(eRegistrationListName.SingleQuote, instrumentId);\r\n            }\r\n\r\n            function registerToDispatcher() {\r\n                QuotesManager.OnChange.Add(updateQuoteValues);\r\n                portfolioStaticManager.OnChange.Add(updatePendingBonusType);\r\n            }\r\n\r\n            function unRegisterFromDispatcher() {\r\n                QuotesManager.OnChange.Remove(updateQuoteValues);\r\n                portfolioStaticManager.OnChange.Remove(updatePendingBonusType);\r\n            }\r\n\r\n            function updatePendingBonusType() {\r\n                data.pendingBonusType(portfolioStaticManager.Portfolio.pendingBonusType);\r\n            }\r\n\r\n            function updateQuoteValues() {\r\n                data.activeQuote = QuotesManager.Quotes.GetItem(data.selectedInstrument());\r\n\r\n                if (data.activeQuote) {\r\n                    data.isActiveQuote(data.activeQuote.isActive());\r\n                    data.bid(data.activeQuote.bid);\r\n                    data.ask(data.activeQuote.ask);\r\n                    data.open(data.activeQuote.open);\r\n                    data.close(data.activeQuote.close);\r\n                    data.change(Format.toPercent(data.activeQuote.change));\r\n                    data.formattedChange(Format.toSignedPercent(data.activeQuote.change, ''));\r\n                    data.changePips(data.activeQuote.changePips);\r\n                    data.highBid(data.activeQuote.highBid);\r\n                    data.lowAsk(data.activeQuote.lowAsk);\r\n                    data.tradeTime(data.activeQuote.tradeTime);\r\n                    data.activeQuoteState(data.activeQuote.state);\r\n                    data.quotesAvailable(true);\r\n                }\r\n            }\r\n\r\n            function openDeal() {\r\n                var deal = new TDeal();\r\n\r\n                deal.dealType = DealTypeManager.GetStatus();\r\n                deal.instrumentID = data.selectedInstrument();\r\n                deal.amount = data.selectedDealAmount();\r\n                deal.marketRate = data.orderDir() === eOrderDir.Sell ? data.activeQuote.bid : data.activeQuote.ask;\r\n                deal.otherRateSeen = data.orderDir() === eOrderDir.Sell ? data.activeQuote.ask : data.activeQuote.bid;\r\n                deal.orderDir = data.orderDir();\r\n                deal.slRate = 0;\r\n                deal.tpRate = 0;\r\n\r\n                if (data.enableSLLimit()) {\r\n                    if (setLimitsModel.Data.stopLossRate() === \"\") {\r\n                        return enabledSltpValidationError();\r\n                    }\r\n                    deal.slRate = setLimitsModel.Data.stopLossRate();\r\n                }\r\n\r\n                if (data.enableTPLimit()) {\r\n                    if (setLimitsModel.Data.takeProfitRate() === \"\") {\r\n                        return enabledSltpValidationError();\r\n                    }\r\n                    deal.tpRate = setLimitsModel.Data.takeProfitRate();\r\n                }\r\n\r\n                data.hasInstrument(false);\r\n                data.isProcessing(true);\r\n                dalOrders.OpenDeal(deal, onOpenDeal);\r\n            }\r\n\r\n            function onOpenDeal(result, callerId, instrumentId, requestData) {\r\n                data.hasInstrument(true);\r\n                data.isProcessing(false);\r\n\r\n                var instrument = InstrumentsManager.GetInstrument(instrumentId);\r\n                var redirectToView = self.getSettings().onSuccessRedirectTo;\r\n\r\n                if (instrument) {\r\n                    if (baseOrder.ResultStatusSuccess(result)) {\r\n                        InstrumentsManager.SetInstrumentDealAmount(instrumentId, requestData.amount);\r\n                        ko.postbox.publish('deal-slip-success', { instrument: data.ccyPair() });\r\n                        saveDefaultLimitTab();\r\n                        resetDealValues();\r\n                    }\r\n\r\n                    // Check if redirect is required\r\n                    if (redirectToView) {\r\n                        baseOrder.OnActionReturn(result, callerId, instrument, { redirectToView: redirectToView, requestData: requestData });\r\n                    } else {\r\n                        baseOrder.OnActionReturn(result, callerId, instrument, { requestData: requestData });\r\n                    }\r\n\r\n                    baseOrder.RaiseErrorEvent(result, 'deal-slip-error-details', {});\r\n                }\r\n            }\r\n\r\n            function ignoreSltpValidationError() {\r\n                data.enableSLLimit(false);\r\n                data.enableTPLimit(false);\r\n                openDeal();\r\n            }\r\n\r\n            function enabledSltpValidationError() {\r\n                AlertsManager.UpdateAlert(\r\n                    AlertTypes.GeneralOkAlert,\r\n                    Dictionary.GetItem('pleaseNoteTitle'),\r\n                    Dictionary.GetItem('sltpValidationMsg', 'deals_NewDeal'),\r\n                    null,\r\n                    { okButtonCallback: ignoreSltpValidationError }\r\n                );\r\n                AlertsManager.PopAlert(AlertTypes.GeneralOkAlert);\r\n            }\r\n\r\n            function resetDealValues() {\r\n                setLimitsModel.Data.stopLossRate(String.empty);\r\n                setLimitsModel.Data.takeProfitRate(String.empty);\r\n\r\n                data.enableSLLimit(false);\r\n                data.enableTPLimit(false);\r\n                setOrderDir(eOrderDir.None);\r\n            }\r\n\r\n            function saveDefaultLimitTab() {\r\n                var profileCustomer = CustomerProfileManager.ProfileCustomer();\r\n                profileCustomer.defaultSlLimitTab = setLimitsModel.Data.curSlActiveTab();\r\n                profileCustomer.defaultTpLimitTab = setLimitsModel.Data.curTpActiveTab();\r\n                CustomerProfileManager.ProfileCustomer(profileCustomer);\r\n            }\r\n\r\n            function dispose() {\r\n                unRegisterFromDispatcher();\r\n                data.selectedDealAmount.extend({ amountValidation: false });\r\n                stateObject.unset('cachedOvernightFinancing');\r\n                parent.dispose.call(self);  // inherited from KoComponentViewModel\r\n            }\r\n\r\n            return {\r\n                init: init,\r\n                dispose: dispose,\r\n                Data: data,\r\n                BaseOrder: baseOrder,\r\n                SetLimitsModel: setLimitsModel,\r\n                openDeal: openDeal,\r\n                unRegisterFromDispatcher: unRegisterFromDispatcher,\r\n                registerToDispatcher: registerToDispatcher,\r\n                setLimitTabsFromClientProfile: setLimitTabsFromClientProfile\r\n            };\r\n        });\r\n\r\n        return DealBaseViewModel;\r\n    }\r\n);\r\n",
  "isBase64": false
}