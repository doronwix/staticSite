function ProChart_InitAlert(v){function n(){for(var b=a.panels.allpanels,g=0;g<b.length;g++)switch(b[g].type){case "price":return b[g]}return null}function q(b){if(!r){var a=n().main.guiid,d=null;switch(b.currentTarget.id){case a:(a=$.prochartcache.get(f.parent,"#"+n().pricealert.guiid,"canvas"))&&(d=a.offset())}a=parseInt(b.pageX-d.left);b=parseInt(b.pageY-d.top);for(d=0;d<f.DATA.length;d++){var c=f.DATA[d];if(c.alerpoint){var e=a-c.alerpoint.center_x,k=b-c.alerpoint.center_y;if(64>=e*e+k*k){s.debug(c.alerpoint.type);
w(c);break}}$(f.parent).find(".alert-container").css({display:"none"})}}}function w(b){var g=b.alerpoint.center_x,d=b.alerpoint.center_y,c=null,e="";switch(b.alerpoint.type){case "news":c=b.news[0];e=b.news[0].html;break;case "events":c=b.events;e=b.events.html;break;case "dividens":c=b.dividens[0];e=b.dividens[0].text;break;case "candlestick_patterns":c=b.candlestick_patterns[0];e=b.candlestick_patterns[0].text;break;case "splits":c=b.splits[0],e=b.splits[0].text}var k,h,l,m,q;k=a.api.props.alerts[b.alerpoint.type].background_color?
a.api.props.alerts[b.alerpoint.type].background_color:c.color;a.api.props.alerts[b.alerpoint.type].border_width&&(h=a.api.props.alerts[b.alerpoint.type].border_color?a.api.props.alerts[b.alerpoint.type].border_color:c.background_color,l=a.api.props.alerts[b.alerpoint.type].border_width);m=a.api.props.alerts[b.alerpoint.type].color?a.api.props.alerts[b.alerpoint.type].color:c.labelFontColor;q=a.api.props.alerts[b.alerpoint.type].font_size?a.api.props.alerts[b.alerpoint.type].font_size:"10";var c=a.api.props.alerts[b.alerpoint.type].symbol?
a.api.props.alerts[b.alerpoint.type].symbol:c.label,p={left:g-9,top:d-9};k={"background-color":a.api.props.alerts.alertselected.background_color?a.api.props.alerts.alertselected.background_color:k,color:a.api.props.alerts.alertselected.color?a.api.props.alerts.alertselected.color:m,"font-size":q+"px","font-weight":a.api.props.alerts[b.alerpoint.type].font_bold?"bold":"normal"};if(a.api.props.alerts[b.alerpoint.type].border_width||a.api.props.alerts.alertselected.border_width)k.border=(a.api.props.alerts.alertselected.border_color?
a.api.props.alerts.alertselected.border_color:h)+" solid "+l+"px";h=b.alerpoint.id;l=a.commonutils.func.getPartStyle(p,"px");p=a.commonutils.func.getPartStyle(k,"px");e=a.patterns.alert.alert.replace(/%style-part-main%/g,l).replace(/%text%/g,e).replace(/%style-part-point%/g,p).replace(/%title%/g,c).replace(/%id%/,h);b.alerpoint.parenttooltop.html(e);if(b=b.alerpoint.parenttooltop.find(".alert-tooltip"))l=$.prochartcache.get(f.parent,"#"+n().pricealert.guiid,"canvas").width(),p=b.width(),e=parseInt(p/
2),h=c=null,e=0>g-e?-g:g+e>l?-(p-(l-g)):-e,g=b.height(),0>d-g&&(c=10,h="auto"),b.css({left:e+"px"}),null!=c&&null!=h&&b.css({top:c+"px",bottom:h});var r=$(f.parent).find(".alert-container");$(f.parent).find(".alert-point").on("click",function(){r.css({display:"none"})});r.on("mouseleave",function(){$(this).css({display:"none"});$(this).off("mouseleave")})}function t(){var b=f.DATA,a=$.prochartcache.get(f.parent,"#"+n().pricealert.guiid,"canvas")[0],d=a.getContext("2d");a.width=a.width;for(var c=0;c<
b.length;c++){var e=b[c];e.candlestick_patterns&&m(e,a,d,"candlestick_patterns");e.news&&m(e,a,d,"news");e.events&&m(e,a,d,"events");e.dividens&&(s.debug("dividens",e),m(e,a,d,"dividens"));e.splits&&m(e,a,d,"splits")}}function m(b,g,d,c){var e=null,k=e=0,h=0,h=a.api.props.alerts.gui.top_padding?a.api.props.alerts.gui.top_padding:12,l=a.api.props.alerts.gui.alert_size?a.api.props.alerts.gui.alert_size:8;switch(c){case "candlestick_patterns":case "events":case "dividens":case "splits":case "news":e=
Object.keys(b[c]).length;if(0<e)e="events"==c?b[c]:b[c]["0"],k=b.rx1+(b.rx2-b.rx1)/2|0,h="price"==a.api.props.alerts[c].place?b.ry1-h|0:g.height-(l+2),b.alerpoint={center_x:k,center_y:h,type:c,parenttooltop:$.prochartcache.get(f.parent,"#"+n().pricealert.guiid,".alertdata"),id:a.commonutils.func.returnShortUniqID()};else return;break;default:return}d.beginPath();d.save();d.fillStyle=a.api.props.alerts[c].background_color?a.api.props.alerts[c].background_color:e.color;d.shadowColor=a.api.props.alerts.gui.shadow_color?
a.api.props.alerts.gui.shadow_color:"rgba(0,0,0,0.3)";d.shadowBlur=a.api.props.alerts.gui.shadow_blur?a.api.props.alerts.gui.shadow_blur:3;d.shadowOffsetX=a.api.props.alerts.gui.shadow_offset_x?a.api.props.alerts.gui.shadow_offset_x:3;d.shadowOffsetY=a.api.props.alerts.gui.shadow_offset_y?a.api.props.alerts.gui.shadow_offset_y:2;d.arc(k,h,l,0,2*Math.PI,!0);d.fill();d.restore();a.api.props.alerts[c].border_width&&(d.strokeStyle=a.api.props.alerts[c].border_color?a.api.props.alerts[c].border_color:
e.background_color,d.lineWidth=a.api.props.alerts[c].border_width,d.stroke());d.restore();d.fillStyle=a.api.props.alerts[c].color?a.api.props.alerts[c].color:e.labelFontColor;d.textAlign="center";d.textBaseline="middle";d.font=(a.api.props.alerts[c].font_bold?"bold":"")+" "+(a.api.props.alerts[c].font_size?a.api.props.alerts[c].font_size:"10")+"px sans-serif";d.fillText(a.api.props.alerts[c].symbol?a.api.props.alerts[c].symbol:e.label,k,h);d.restore()}var a=v,f={};a.alertobj=f;var s=a.api.debug.getLogger("prochart.gui.alert"),
u=!0;f.gui={initPattern:function(){},viewAlert:function(a){f.parent=a},updateAlerts:function(b,g,d){u&&(b=$.prochartcache.get(f.parent,"#"+n().main.guiid),b[0].addEventListener("mousedown",q,!0),b[0].addEventListener("mousemove",q,!0),u=!1);!0==a.patterns.alert.alreadyread&&(f.DATA=jQuery.extend(!0,[],d),t())},refreshAlerts:function(){t()},initMouseEvents:function(a){r=a}};f.DATA=[];f.guuid=null;f.mycache={};var r=!1;return f};
