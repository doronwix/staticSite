function ProChart_InitSignals(E){function x(){y();u="Signals form";F("",u);var a=!1==b.guiinit.cache?"?"+b.version.gui.name+(new Date).getTime():"?"+b.version.gui.name,a=b.guiinit.rootpath+"/ChartUI/gui/signals/plugins.htm"+a;if(b.navigator.XMLHttpRequest()){var d=new XMLHttpRequest,c=$.Deferred();d.open("get",a);d.onload=function(){var a=d.responseText;z($(a).find("#dlg-plugins"));c.resolve(a)};d.send();return c}return $.ajax({type:"GET",async:!0,dataType:"html",url:a,success:function(a){z($(a).find("#dlg-plugins"))}})}
function z(a){$("#chart-dialog").html(a);G();if("undefined"!=typeof e.init.list&&null!=e.init.list){a=[];a.push('<li id="li-browser-%id%" data-localize="dialogs.signals.signalprovider.name">%name%</li>');a.push('<div class = "main-page" id="signal-%id%-page" style ="display:none"></div> ');var d=$("#template-mainpage").html();a.push(d);d=$("#template-mainpage-listitem > ul").html();a.push(d);$("#main-signal-browser");for(var d=$("#dialog-main-page"),c=e.init.list.plugins,h=0;h<c.length;h++){var g=
c[h],f=g.id;if(!0==g.use){var l=!1;"undefined"==typeof g.pluginit||null==g.pluginit?l=!1:(l=b.chart.Plugins.IsEnabled(f),"undefined"==typeof l&&(l=!1));for(var l=!1==l?"stardisabled-icon":"startenabled-icon",q=g.description,f=a[3].replace(/%id%/g,f).replace(/%itemid%/g,f).replace(/%starsignal%/g,l).replace(/%caption%/g,"").replace(/%name%/g,q),g=g.types,l=0;l<g.length;l++)q=$(d).find("#plugins-"+g[l]+"-list"),0<q.length&&q.append(f)}}H();$("#template-mainpage").remove();$("#template-mainpage-listitem").remove()}I();
J();a=$("#favorite-signal-page");"undefined"!=typeof a&&$(a).css("display","block");$("#chart-dialog").dialog("open");"undefined"!=typeof b.localizationobj&&b.localizationobj.gui.updateFromDataLang($("#chart-dialog"))}function w(a){if("undefined"!=typeof e.init.list&&null!=e.init.list)for(var d=0;d<e.init.list.plugins.length;d++){var c=e.init.list.plugins[d];if(a==c.id){"undefined"==typeof c.pluginit||null==c.pluginit?(a=!1==b.guiinit.cache?"?"+(new Date).getTime():"",$.ajax({async:!0,global:!1,url:b.guiinit.rootpath+
"/"+c.path+"plugin.init.json.js"+a,dataType:"json",success:function(a){c.pluginit=a;c.pluginit.userCallback=function(){return{user:"548",password:"LtbzVPWzX0d%2bfJAhDpADUA%3d%3d"}};b.chart.Plugins.LoadPlugin(c.pluginit);b.chart.Plugins.Enable(c.pluginit.id,!0);A(c)},error:function(a,c,d){}})):(b.chart.Plugins.Enable(c.pluginit.id,!0),A(c),c.gui_js.gui.createPanel());break}}}function v(a){b.chart.Plugins.Enable(a,!1);a=s(a);null===a||"undefined"==typeof a.gui_js&&null==a.gui_js||a.gui_js.gui.closePanel()}
function A(a){if("undefined"==typeof a.gui_js){var d=!1==b.guiinit.cache?"?"+(new Date).getTime():"",d=b.guiinit.rootpath+"/"+a.path+"plugin.gui.js"+d;if(b.navigator.XMLHttpRequest()){var c=new XMLHttpRequest;$.Deferred();c.plugin=a;c.open("get",d);c.onload=function(){eval.call(c.responseText);c.plugin.gui_js=eval.call(c.plugin.initfunction)(b);c.plugin.gui_js.info.path=c.plugin.path;c.plugin.gui_js.gui.createPanel();"undefined"!=b.localizationobj&&b.localizationobj.gui.addPluginSource(c.plugin.id,
"/"+c.plugin.path)};c.send()}else $.ajax({url:d,contentType:"application/javascript",async:!0,global:!1,plugin:a,dataType:"script",type:"get",success:function(a){eval.call(a);this.plugin.gui_js=eval(this.plugin.initfunction)(b);this.plugin.gui_js.info.path=this.plugin.path;this.plugin.gui_js.gui.createPanel();"undefined"!=b.localizationobj&&b.localizationobj.gui.addPluginSource(this.plugin.id,"/"+this.plugin.path)}})}}function H(){$("ul.ul-plugins-list  li .star-button").on("click",function(){var a=
$(this).parent().attr("idx");$(this).parent().attr("prv");$(this).parent().attr("mod");$(this).hasClass("stardisabled-icon")?($(this).addClass("startenabled-icon").removeClass("stardisabled-icon"),w(a)):($(this).removeClass("startenabled-icon").addClass("stardisabled-icon"),v(a))})}function s(a){if("undefined"==typeof e.init.list||null==e.init.list)return null;for(var d=e.init.list.plugins,c=0;c<d.length;c++){var b=d[c];if(b.id==a)return b}return null}function B(a){$("#"+k).html(a);a=[];var d=$("#"+
k+" #template-tr > table > tbody").html();a.push(d);var d=$("#"+k+" #signal-list-table"),c=0,h=b.chart.signals.GetSignalsList();if("undefined"!=typeof d.html())for(var g=0;g<h.length&&!(300<=c);g++){var f=h[g];if(!0==f.visible){var l=new Date(f.date),e=f.uid,m=f.direction,p=f.type,n=f.provider,f=f.properties,p=b.localizationobj.gui.returnLocalizationString("signals."+n+".items."+p+".name",p),n=b.localizationobj.gui.returnLocalizationString("signals."+n+".name",n),t="";switch(m){case 0:t="neutral";
break;case 1:t="up";break;case -1:t="down";break;case 2:t="news"}l=a[0].replace(/%itemid%/g,e).replace(/%title%/g,f.title).replace(/%description%/g,f.description).replace(/%directionvalue%/g,t).replace(/%signalitemname%/g,p).replace(/%provider%/g,n).replace(/%date%/g,l);d.append(l);c++}}C();$("#"+k).dialog("open");"undefined"!=typeof b.localizationobj&&b.localizationobj.gui.updateFromDataLang($("#chart-dialog"))}function C(){$("button.signal-select-button").off();$("button.signal-select-button").on("click",
function(){var a=$(this).attr("idx");b.chart.signals.SelectSignal(a);$("#"+k+" #signal-list-table tr").removeClass("selected-signal");$("#"+k+' #signal-list-table tr.signalslist_list_s[idx="'+a+'"]').addClass("selected-signal")})}function K(a){$("#"+k+' #signal-list-table tr[idx="'+a.uid+'"]').each(function(){$(this).remove()})}function F(a,d,c){function h(a){$(a).find(".spectrum-color").each(function(){$(this).spectrum("destroy")})}function g(a){$(a).find(".ui-dialog-buttonset").prepend('<button class="chart-button adv-buttons eye-orange " type="button" title="" ></button>').on("click",
function(){var a=$(".chart-ui-dialog.signals-dialog").css("opacity"),a=1==a?.5:1,c=1==a?"":2;$(".chart-ui-dialog.signals-dialog").css("opacity",a);$(this).css("opacity",c)})}a="Close";var f=d,e="";"undefined"==typeof c&&(c="");"undefined"!=typeof b.localizationobj&&(a=b.localizationobj.gui.returnLocalizationString("dialogs.common.button-close","Close"),f=b.localizationobj.gui.returnLocalizationString("signals.title",d),f+=c);"undefined"!=typeof b.init.TemplateName&&(e=b.init.TemplateName);$('<div id="chart-dialog" title="'+
f+'"></div>').insertAfter("body");$("#chart-dialog").dialog({dialogClass:"chart-ui-dialog signals-dialog "+e,draggable:!0,autoOpen:!1,resizable:!1,closeOnEscape:!0,width:"auto",modal:!0,open:function(a,c){g($(this).parent());$(".ui-widget-overlay").last().addClass("chart-ui-widget-overlay");if(b.api.props){var d=b.api.props.chart.gui.layout.zindex_dialog;$(".chart-ui-widget-overlay").css({"z-index":d});$(".chart-ui-dialog").css({"z-index":d})}$(".ui-widget-overlay").bind("click",function(){$("#chart-dialog").dialog("close")});
D()},close:function(a,c){h($(this).parent());$("#chart-dialog").remove();$("div.chart-ui-dialog.signals-dialog  adv-buttons.eye-orange").off().remove();$("div.chart-ui-dialog.signals-dialog").off().remove();$(this).off().empty().remove()},buttons:[{id:"btn-dialogs-close",text:a,click:function(){$(this).dialog("close")}}]})}function G(){$(".properties-tabs").delegate("a","click",function(){var a=$(this).parents(".dialog_level"),d=$(a).find(".properties-tabs a").index(this);$(a).find(".main-properties").each(function(){$(this).css("display",
"none")});$(a).find(".properties-tabs-label").each(function(){$(this).removeClass("active")});$(a).find(".main-properties").eq(d).css("display","block");$(this).addClass("active")})}function I(){$(" .title_level").delegate("a","click",function(){for(var a=$(this).parents(".main-page"),d=$(a).find(".title_level a").index(this),c=$(a).find(".dialog_level"),b=0;b<c.length;b++){var g=b==d?"block":"none";$(c[b]).css("display",g)}a=$(a).find(".title_level");for(b=d+1;b<a.length;b++)$(a[b]).css("display",
"none").removeClass("active");$(a[d]).addClass("active")})}function J(){$("#main-signal-browser > li").on("click",function(){for(var a=$("#main-signal-browser > li").index(this),d=$("#chart-dialog .main-page"),c=0;c<d.length;c++){var b=c==a?"block":"none";$(d[c]).css("display",b)}a=$(this).html();d=void 0;c=$("#dlg-signals .main-page").eq(0).find(".title_level");for(b=0;b<c.length;b++)$(c[b]).removeClass("active"),0<b&&$(c[b]).css("display","none");"undefined"==typeof a&&(a="");"undefined"==typeof d&&
(d="");$(c[0]).find("a").html(a+" "+d);$(c[0]).css("display","block").addClass("active")})}function L(a,d,c,h,g,f){function e(a){$(a).find(".spectrum-color").each(function(){$(this).spectrum("destroy")})}function k(a){$(a).find(".ui-dialog-buttonset").prepend('<button class="chart-button adv-buttons eye-orange " type="button" title="" ></button>').on("click",function(){var a=$(".chart-ui-dialog."+g).css("opacity"),a=1==a?.5:1,c=1==a?"":2;$(".chart-ui-dialog."+g).css("opacity",a);$(this).css("opacity",
c)})}a="Close";var m=d,p="";"undefined"==typeof c&&(c="");"undefined"!=typeof b.localizationobj&&(a=b.localizationobj.gui.returnLocalizationString("dialogs.common.button-close","Close"),m=b.localizationobj.gui.returnLocalizationString("signals.history-title",d),m+=c);"undefined"!=typeof b.init.TemplateName&&(p=b.init.TemplateName);$('<div id="'+h+'" title="'+m+'"></div>').insertAfter("body");$("#"+h).dialog({dialogClass:"chart-ui-dialog "+g+" "+p,draggable:!0,autoOpen:!1,resizable:!1,closeOnEscape:!0,
width:"auto",modal:f,open:function(a,c){k($(this).parent());$(".ui-widget-overlay").last().addClass("chart-ui-widget-overlay");if(b.api.props){var d=b.api.props.chart.gui.layout.zindex_dialog;$(".chart-ui-widget-overlay").css({"z-index":d});$(".chart-ui-dialog").css({"z-index":d})}$(".ui-widget-overlay").bind("click",function(){$("#"+h).dialog("close")});D()},close:function(a,c){e($(this).parent());$("#"+h).remove();$("div.chart-ui-dialog."+g+" adv-buttons.eye-orange").off().remove();$("div.chart-ui-dialog."+
g).off().remove();$(this).off().empty().remove()},buttons:[{id:"btn-dialogs-close",text:a,click:function(){$(this).dialog("close")}}]})}function y(){"undefined"!=typeof b.preloadobj&&b.preloadobj.startPreload()}function D(){"undefined"!=typeof b.preloadobj&&b.preloadobj.endPreload()}var b=E,e={};b.signals=e;var u="";b.symbolslist=null;var r=0,k="chart-dialog-2";e.gui={viewSignals:x,callNewsignal:function(a,d){!0==d.visible&&(0>r&&(r=0),r++);if("undefined"!=typeof b.toolboxobj){b.toolboxobj.gui.updateSignalListAlert(r);
var c=[],h=$("#"+k+" #template-tr > table > tbody").html();"undefined"!=typeof h&&c.push(h);h=$("#"+k+" #signal-list-table");if("undefined"!=typeof h.html()&&0<c.length&&!0==d.visible){var g=new Date(d.date),f=d.uid,e=d.direction,q=d.type,m=d.provider,p=d.properties,q=b.localizationobj.gui.returnLocalizationString("signals."+m+".items."+q+".name",q),m=b.localizationobj.gui.returnLocalizationString("signals."+m+".name",m),n="";switch(e){case 0:n="neutral";break;case 1:n="up";break;case -1:n="down";
break;case 2:n="news"}c=c[0].replace(/%itemid%/g,f).replace(/%title%/g,p.title).replace(/%description%/g,p.description).replace(/%signalitemname%/g,q).replace(/%directionvalue%/g,n).replace(/%provider%/g,m).replace(/%date%/g,g);h.prepend(c)}C()}},callRemovesignal:function(a,d){r--;0<r&&(r=0);"undefined"!=typeof b.toolboxobj&&(b.toolboxobj.gui.updateSignalListAlert(r),K(d))},callFullRefreshsignals:function(a,b){r=0},callfuncOnSignalMouseClick:function(a,b){var c=b.uid,h=$("#"+k+" .signals-list-mainpage"),
e=$("#"+k+" #signal-list-table"),f=$("#"+k+' #signal-list-table tr.signalslist_list_f[idx="'+c+'"]'),c=$("#"+k+' #signal-list-table tr.signalslist_list_s[idx="'+c+'"]');$("#"+k+" #signal-list-table tr").removeClass("selected-signal");"undefined"!=typeof f.html()&&(e=parseInt($(f).offset().top)-parseInt($(e).offset().top),$(h).animate({scrollTop:e},2E3),$(c).addClass("selected-signal"),console.log(parseInt($(f).offset().top)),console.log(parseInt($(h).offset().top)))},viewSignalProviders:x,viewSignalList:function(){if(!$("#"+
k).hasClass("ui-dialog-content")){y();u="Signals History List";L("",u,"",k,"signals-dialog-list",!1);var a=!1==b.guiinit.cache?"?"+b.version.gui.name+(new Date).getTime():"?"+b.version.gui.name,a=b.guiinit.rootpath+"/ChartUI/gui/signals/signalslist.htm"+a;if(b.navigator.XMLHttpRequest()){var d=new XMLHttpRequest,c=$.Deferred();d.open("get",a);d.onload=function(){B($(d.responseText).find("#dlg-signals-list-history"))};d.send();return c}return $.ajax({type:"GET",async:!0,dataType:"html",url:a,success:function(a){B($(a).find("#dlg-signals-list-history"))}})}},
pluginContentUpdate:function(a,b,c,e){a=s(b);null===a||"undefined"==typeof a.gui_js&&null==a.gui_js||a.gui_js.gui.contentUpdate(c,e)},pluginEnableChanged:function(a,b){s(a)},pluginDelete:v,pluginOpenDialog:function(a){"undefined"!=typeof e.init.list&&null!=e.init.list&&(a=s(a),null===a||"undefined"==typeof a.gui_js&&null==a.gui_js||a.gui_js.gui.openDialog())},startWaitSignal:function(a){a=s(a);null===a||"undefined"==typeof a.gui_js&&null==a.gui_js||a.gui_js.gui.startWaitSignal()},stopWaitSignal:function(a){a=
s(a);null===a||"undefined"==typeof a.gui_js&&null==a.gui_js||a.gui_js.gui.stopWaitSignal()},initSignalsList:function(){var a=$.Deferred();if("undefined"!=typeof e.init.list&&null!=e.init.list)return"ok";var d=!1==b.guiinit.cache?"?"+(new Date).getTime():"",d=b.guiinit.rootpath+"/Plugins/plugins.list.json.js"+d;if(b.navigator.XMLHttpRequest()){var c=new XMLHttpRequest;c.open("get",d);c.onload=function(){var b=$.parseJSON(c.responseText);e.init.list=b;a.resolve(b)};c.send()}else $.ajax({url:d,contentType:"application/javascript",
dataType:"json",data:{},async:!0,error:function(a,b){}}).done(function(b){e.init.list=b;a.resolve(b)});return a.promise()}};e.api={deactivatePlugin:v,activatePlugin:w,swiftPlugin:function(a){!0==b.chart.Plugins.IsEnabled(a)?v(a):w(a)}};e.init={list:null};return e};
